(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"0Tit":function(e,t){var n="function"==typeof Float32Array;function o(e,t){return 1-3*t+3*e}function i(e,t){return 3*t-6*e}function r(e){return 3*e}function a(e,t,n){return((o(t,n)*e+i(t,n))*e+r(t))*e}function s(e,t,n){return 3*o(t,n)*e*e+2*i(t,n)*e+r(t)}function c(e){return e}e.exports=function(e,t,o,i){if(!(0<=e&&e<=1&&0<=o&&o<=1))throw new Error("bezier x values must be in [0, 1] range");if(e===t&&o===i)return c;for(var r=n?new Float32Array(11):new Array(11),l=0;l<11;++l)r[l]=a(.1*l,e,o);return function(n){return 0===n?0:1===n?1:a(function(t){for(var n=0,i=1;10!==i&&r[i]<=t;++i)n+=.1;--i;var c=n+(t-r[i])/(r[i+1]-r[i])*.1,l=s(c,e,o);return l>=.001?function(e,t,n,o){for(var i=0;i<4;++i){var r=s(t,n,o);if(0===r)return t;t-=(a(t,n,o)-e)/r}return t}(t,c,e,o):0===l?c:function(e,t,n,o,i){var r,s,c=0;do{(r=a(s=t+(n-t)/2,o,i)-e)>0?n=s:t=s}while(Math.abs(r)>1e-7&&++c<10);return s}(t,n,n+.1,e,o)}(n),t,i)}}},"6f8I":function(e,t){function n(){return"function"==typeof cancelAnimationFrame?cancelAnimationFrame:clearTimeout}function o(){return"function"==typeof requestAnimationFrame?requestAnimationFrame:function(e){return setTimeout(e,16)}}e.exports=function(e,t,i){"object"!=typeof i&&(i={});var r,a,s,c,l,d,u,h,b,m,f="number"==typeof i.minVelocity?i.minVelocity:5,p="number"==typeof i.amplitude?i.amplitude:.25,g="function"==typeof i.cancelAnimationFrame?i.cancelAnimationFrame:n(),v="function"==typeof i.requestAnimationFrame?i.requestAnimationFrame:o();return{start:function(){r=e(),d=b=c=u=0,a=new Date,g(s),g(m),s=v(y)},stop:function(){g(s),g(m);var t=e();l=t.x,h=t.y,a=Date.now(),(c<-f||c>f)&&(l+=d=p*c),(u<-f||u>f)&&(h+=b=p*u),m=v(w)},cancel:function(){g(s),g(m)}};function y(){var t=Date.now(),n=t-a;a=t;var o=e(),i=o.x-r.x,l=o.y-r.y;r=o;var d=1e3/(1+n);c=.8*i*d+.2*c,u=.8*l*d+.2*u,s=v(y)}function w(){var e=Date.now()-a,n=!1,o=0,i=0;d&&((o=-d*Math.exp(-e/342))>.5||o<-.5?n=!0:o=d=0),b&&((i=-b*Math.exp(-e/342))>.5||i<-.5?n=!0:i=b=0),n&&(t(l+o,h+i),m=v(w))}}},AMdQ:function(e,t){e.exports=function(e){!function(e){if(!e)throw new Error("Eventify cannot use falsy object as events subject");for(var t=["on","fire","off"],n=0;n<t.length;++n)if(e.hasOwnProperty(t[n]))throw new Error("Subject cannot be eventified, since it already has property '"+t[n]+"'")}(e);var t=function(e){var t=Object.create(null);return{on:function(n,o,i){if("function"!=typeof o)throw new Error("callback is expected to be a function");var r=t[n];return r||(r=t[n]=[]),r.push({callback:o,ctx:i}),e},off:function(n,o){if(void 0===n)return t=Object.create(null),e;if(t[n])if("function"!=typeof o)delete t[n];else for(var i=t[n],r=0;r<i.length;++r)i[r].callback===o&&i.splice(r,1);return e},fire:function(n){var o,i=t[n];if(!i)return e;arguments.length>1&&(o=Array.prototype.splice.call(arguments,1));for(var r=0;r<i.length;++r){var a=i[r];a.callback.apply(a.ctx,o)}return e}}}(e);return e.on=t.on,e.off=t.off,e.fire=t.fire,e}},AgEI:function(e,t){function n(e){return e.stopPropagation(),!1}function o(){}e.exports=function(e){if(e)return{capture:o,release:o};var t,i,r,a=!1;return{capture:function(e){a=!0,i=window.document.onselectstart,r=window.document.ondragstart,window.document.onselectstart=n,(t=e).ondragstart=n},release:function(){a&&(a=!1,window.document.onselectstart=i,t&&(t.ondragstart=r))}}}},QIvw:function(e,t){e.exports=function(){this.x=0,this.y=0,this.scale=1}},Vkd7:function(e,t){function n(e){return e&&e.parentElement&&e.style}e.exports=function(e,t){if(!n(e))throw new Error("panzoom requires DOM element to be attached to the DOM tree");var o=e.parentElement;return e.scrollTop=0,t.disableKeyboardInteraction||o.setAttribute("tabindex",0),{getBBox:function(){return{left:0,top:0,width:e.clientWidth,height:e.clientHeight}},getOwner:function(){return o},applyTransform:function(t){e.style.transformOrigin="0 0 0",e.style.transform="matrix("+t.scale+", 0, 0, "+t.scale+", "+t.x+", "+t.y+")"}}},e.exports.canAttach=n},cQc6:function(e,t){e.exports=function(e,t){for(var n=e[0],o=e[1],i=!1,r=0,a=t.length-1;r<t.length;a=r++){var s=t[r][0],c=t[r][1],l=t[a][1];c>o!=l>o&&n<(t[a][0]-s)*(o-c)/(l-c)+s&&(i=!i)}return i}},dwjH:function(e,t,n){var o=n("0Tit"),i={ease:o(.25,.1,.25,1),easeIn:o(.42,0,1,1),easeOut:o(0,0,.58,1),easeInOut:o(.42,0,.58,1),linear:o(0,0,1,1)};function r(){}function a(){var e=new Set,t=new Set,n=0;return{next:o,cancel:o,clearAll:function(){e.clear(),t.clear(),cancelAnimationFrame(n),n=0}};function o(e){t.add(e),n||(n=requestAnimationFrame(i))}function i(){n=0;var o=t;t=e,(e=o).forEach(function(e){e()}),e.clear()}}e.exports=function(e,t,n){var o=Object.create(null),a=Object.create(null),s="function"==typeof(n=n||{}).easing?n.easing:i[n.easing];s||(n.easing&&console.warn("Unknown easing function in amator: "+n.easing),s=i.ease);var c="function"==typeof n.step?n.step:r,l="function"==typeof n.done?n.done:r,d=function(e){if(!e)return"undefined"!=typeof window&&window.requestAnimationFrame?{next:window.requestAnimationFrame.bind(window),cancel:window.cancelAnimationFrame.bind(window)}:{next:function(e){return setTimeout(e,1e3/60)},cancel:function(e){return clearTimeout(e)}};if("function"!=typeof e.next)throw new Error("Scheduler is supposed to have next(cb) function");if("function"!=typeof e.cancel)throw new Error("Scheduler is supposed to have cancel(handle) function");return e}(n.scheduler),u=Object.keys(t);u.forEach(function(n){o[n]=e[n],a[n]=t[n]-e[n]});var h,b=Math.max(1,.06*("number"==typeof n.duration?n.duration:400)),m=0;return h=d.next(function t(){var n=s(m/b);m+=1,function(t){u.forEach(function(n){e[n]=a[n]*t+o[n]})}(n),m<=b?(h=d.next(t),c(e)):(h=0,setTimeout(function(){l(e)},0))}),{cancel:function(){d.cancel(h),h=0}}},e.exports.makeAggregateRaf=a,e.exports.sharedScheduler=a()},fQX0:function(e,t,n){"use strict";var o=n("fWck"),i=n("dwjH"),r=n("AMdQ"),a=n("6f8I"),s=n("AgEI"),c=s(),l=s(!0),d=n("QIvw"),u=n("wyfB"),h=n("Vkd7");function b(e,t){var n=(t=t||{}).controller;if(n||(u.canAttach(e)?n=u(e,t):h.canAttach(e)&&(n=h(e,t))),!n)throw new Error("Cannot create panzoom for the current type of dom element");var s=n.getOwner(),b={x:0,y:0},f=!1,y=new d;n.initTransform&&n.initTransform(y);var w,S="function"==typeof t.filterKey?t.filterKey:p,x="number"==typeof t.pinchSpeed?t.pinchSpeed:1,C=t.bounds,I="number"==typeof t.maxZoom?t.maxZoom:Number.POSITIVE_INFINITY,R="number"==typeof t.minZoom?t.minZoom:0,M="number"==typeof t.boundsPadding?t.boundsPadding:.05,O="number"==typeof t.zoomDoubleClickSpeed?t.zoomDoubleClickSpeed:1.75,k=t.beforeWheel||p,P=t.beforeMouseDown||p,D="number"==typeof t.zoomSpeed?t.zoomSpeed:1,K=m(t.transformOrigin),J=t.enableTextSelection?l:c;!function(e){var t=typeof e;if("undefined"!==t&&"boolean"!==t&&!(g(e.left)&&g(e.top)&&g(e.bottom)&&g(e.right)))throw new Error("Bounds object is not valid. It can be: undefined, boolean (true|false) or an object {left, top, right, bottom}")}(C),t.autocenter&&function(){var e,t,o=0,i=0,r=Q();if(r)o=r.left,i=r.top,e=r.right-r.left,t=r.bottom-r.top;else{var a=s.getBoundingClientRect();e=a.width,t=a.height}var c=n.getBBox();if(0!==c.width&&0!==c.height){var l=Math.min(e/c.width,t/c.height);y.x=-(c.left+c.width/2)*l+e/2+o,y.y=-(c.top+c.height/2)*l+t/2+i,y.scale=l}}();var B,L,F,E,N,_,A,T,j=0,V=!1,z=!1;N="smoothScroll"in t&&!t.smoothScroll?{start:p,stop:p,cancel:p}:a(function(){return{x:y.x,y:y.y}},function(e,t){Ie(),q(e,t)},t.smoothScroll);var W=!1;ie();var G={dispose:function(){re()},moveBy:oe,moveTo:q,smoothMoveTo:function(e,t){oe(e-y.x,t-y.y,!0)},centerOn:function(e){var t=e.ownerSVGElement;if(!t)throw new Error("ui element is required to be within the scene");var n=e.getBoundingClientRect(),o=n.left+n.width/2,i=n.top+n.height/2,r=t.getBoundingClientRect();oe(r.width/2-o,r.height/2-i,!0)},zoomTo:Ce,zoomAbs:ne,smoothZoom:Se,smoothZoomAbs:function(e,t,n){var o={scale:y.scale},r={scale:n};N.cancel(),Ie(),A=i(o,r,{step:function(n){ne(e,t,n.scale)}})},showRectangle:function(e){var t=s.getBoundingClientRect(),n=Z(t.width,t.height),o=e.right-e.left,i=e.bottom-e.top;if(!Number.isFinite(o)||!Number.isFinite(i))throw new Error("Invalid rectangle");var r=Math.min(n.x/o,n.y/i);y.x=-(e.left+o/2)*r+n.x/2,y.y=-(e.top+i/2)*r+n.y/2,y.scale=r},pause:function(){re(),W=!0},resume:function(){W&&(ie(),W=!1)},isPaused:function(){return W},getTransform:function(){return y},getMinZoom:function(){return R},setMinZoom:function(e){R=e},getMaxZoom:function(){return I},setMaxZoom:function(e){I=e},getTransformOrigin:function(){return K},setTransformOrigin:function(e){K=m(e)},getZoomSpeed:function(){return D},setZoomSpeed:function(e){if(!Number.isFinite(e))throw new Error("Zoom speed should be a number");D=e}};r(G);var H="number"==typeof t.initialX?t.initialX:y.x,X="number"==typeof t.initialY?t.initialY:y.y,Y="number"==typeof t.initialZoom?t.initialZoom:y.scale;return H==y.x&&X==y.y&&Y==y.Scale||ne(H,X,Y),G;function Z(e,t){if(n.getScreenCTM){var o=n.getScreenCTM(),i=o.d,r=o.f;b.x=e*o.a-o.e,b.y=t*i-r}else b.x=e,b.y=t;return b}function q(e,t){y.x=e,y.y=t,U(),Pe("pan"),ee()}function $(e,t){q(y.x+e,y.y+t)}function U(){var e=Q();if(e){var t,o,i=!1,r={left:(o={x:(t=n.getBBox()).left*y.scale+y.x,y:t.top*y.scale+y.y}).x,top:o.y,right:t.width*y.scale+o.x,bottom:t.height*y.scale+o.y},a=e.left-r.right;return a>0&&(y.x+=a,i=!0),(a=e.right-r.left)<0&&(y.x+=a,i=!0),(a=e.top-r.bottom)>0&&(y.y+=a,i=!0),(a=e.bottom-r.top)<0&&(y.y+=a,i=!0),i}}function Q(){if(C){if("boolean"==typeof C){var e=s.getBoundingClientRect(),t=e.width,n=e.height;return{left:t*M,top:n*M,right:t*(1-M),bottom:n*(1-M)}}return C}}function ee(){f=!0,w=window.requestAnimationFrame(ae)}function te(e,t,n){if(v(e)||v(t)||v(n))throw new Error("zoom requires valid numbers");var o=y.scale*n;if(o<R){if(y.scale===R)return;n=R/y.scale}if(o>I){if(y.scale===I)return;n=I/y.scale}var i=Z(e,t);y.x=i.x-n*(i.x-y.x),y.y=i.y-n*(i.y-y.y),C&&1===M&&1===R?(y.scale*=n,U()):U()||(y.scale*=n),Pe("zoom"),ee()}function ne(e,t,n){te(e,t,n/y.scale)}function oe(e,t,n){if(!n)return $(e,t);_&&_.cancel();var o=0,r=0;_=i({x:0,y:0},{x:e,y:t},{step:function(e){$(e.x-o,e.y-r),o=e.x,r=e.y}})}function ie(){s.addEventListener("mousedown",me,{passive:!1}),s.addEventListener("dblclick",be,{passive:!1}),s.addEventListener("touchstart",ce,{passive:!1}),s.addEventListener("keydown",se,{passive:!1}),o.addWheelListener(s,ye,{passive:!1}),ee()}function re(){o.removeWheelListener(s,ye),s.removeEventListener("mousedown",me),s.removeEventListener("keydown",se),s.removeEventListener("dblclick",be),s.removeEventListener("touchstart",ce),w&&(window.cancelAnimationFrame(w),w=0),N.cancel(),ge(),ve(),J.release(),Oe()}function ae(){f&&(f=!1,n.applyTransform(y),Pe("transform"),w=0)}function se(e){var t=0,n=0,o=0;if(38===e.keyCode?n=1:40===e.keyCode?n=-1:37===e.keyCode?t=1:39===e.keyCode?t=-1:189===e.keyCode||109===e.keyCode?o=1:187!==e.keyCode&&107!==e.keyCode||(o=-1),!S(e,t,n,o)){if(t||n){e.preventDefault(),e.stopPropagation();var i=s.getBoundingClientRect();oe(.05*(r=Math.min(i.width,i.height))*t,.05*r*n)}if(o){var r,a=Re(100*o);Ce((r=K?xe():{x:(c=s.getBoundingClientRect()).width/2,y:c.height/2}).x,r.y,a)}var c}}function ce(e){if(function(e){t.onTouch&&!t.onTouch(e)||(e.stopPropagation(),e.preventDefault())}(e),1===e.touches.length)return function(e){var t=we(e.touches[0]);B=t;var n=Z(t.x,t.y);L=n.x,F=n.y,N.cancel(),le()}(e);2===e.touches.length&&(E=he(e.touches[0],e.touches[1]),T=!0,le())}function le(){V||(V=!0,document.addEventListener("touchmove",de),document.addEventListener("touchend",ue),document.addEventListener("touchcancel",ue))}function de(e){if(1===e.touches.length){e.stopPropagation();var t=Z((d=we(e.touches[0])).x,d.y),n=t.x-L,o=t.y-F;0!==n&&0!==o&&Me(),L=t.x,F=t.y,oe(n,o)}else if(2===e.touches.length){T=!0;var i=e.touches[0],r=e.touches[1],a=he(i,r),s=1+(a/E-1)*x,c=we(i),l=we(r);if(L=(c.x+l.x)/2,F=(c.y+l.y)/2,K){var d=xe();L=d.x,F=d.y}Ce(L,F,s),E=a,e.stopPropagation(),e.preventDefault()}}function ue(e){if(e.touches.length>0){var t=Z((n=we(e.touches[0])).x,n.y);L=t.x,F=t.y}else{var n,o=new Date;o-j<300&&(K?Se((n=xe()).x,n.y,O):Se(B.x,B.y,O)),j=o,Oe(),ve()}}function he(e,t){var n=e.clientX-t.clientX,o=e.clientY-t.clientY;return Math.sqrt(n*n+o*o)}function be(e){!function(e){t.onDoubleClick&&!t.onDoubleClick(e)||(e.preventDefault(),e.stopPropagation())}(e);var n=we(e);K&&(n=xe()),Se(n.x,n.y,O)}function me(e){if(!P(e)){if(V)return e.stopPropagation(),!1;if(1===e.button&&null!==window.event||0===e.button){N.cancel();var t=we(e),n=Z(t.x,t.y);return L=n.x,F=n.y,document.addEventListener("mousemove",fe),document.addEventListener("mouseup",pe),J.capture(e.target||e.srcElement),!1}}}function fe(e){if(!V){Me();var t=we(e),n=Z(t.x,t.y),o=n.x-L,i=n.y-F;L=n.x,F=n.y,oe(o,i)}}function pe(){J.release(),Oe(),ge()}function ge(){document.removeEventListener("mousemove",fe),document.removeEventListener("mouseup",pe),z=!1}function ve(){document.removeEventListener("touchmove",de),document.removeEventListener("touchend",ue),document.removeEventListener("touchcancel",ue),z=!1,T=!1,V=!1}function ye(e){if(!k(e)){N.cancel();var t=e.deltaY;e.deltaMode>0&&(t*=100);var n=Re(t);if(1!==n){var o=K?xe():we(e);Ce(o.x,o.y,n),e.preventDefault()}}}function we(e){var t=s.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top}}function Se(e,t,n){var o=y.scale,r={scale:o},a={scale:n*o};N.cancel(),Ie(),A=i(r,a,{step:function(n){ne(e,t,n.scale)},done:ke})}function xe(){var e=s.getBoundingClientRect();return{x:e.width*K.x,y:e.height*K.y}}function Ce(e,t,n){return N.cancel(),Ie(),te(e,t,n)}function Ie(){A&&(A.cancel(),A=null)}function Re(e){return 1-Math.sign(e)*Math.min(.25,Math.abs(D*e/128))}function Me(){z||(Pe("panstart"),z=!0,N.start())}function Oe(){z&&(T||N.stop(),Pe("panend"))}function ke(){Pe("zoomend")}function Pe(e){G.fire(e,G)}}function m(e){if(e)return"object"==typeof e?(g(e.x)&&g(e.y)||f(e),e):void f()}function f(e){throw console.error(e),new Error(["Cannot parse transform origin.","Some good examples:",'  "center center" can be achieved with {x: 0.5, y: 0.5}','  "top center" can be achieved with {x: 0.5, y: 0}','  "bottom right" can be achieved with {x: 1, y: 1}'].join("\n"))}function p(){}function g(e){return Number.isFinite(e)}function v(e){return Number.isNaN?Number.isNaN(e):e!=e}e.exports=b,function(){if("undefined"!=typeof document){var e=document.getElementsByTagName("script");if(e){for(var t,n=0;n<e.length;++n){var o=e[n];if(o.src&&o.src.match(/\bpanzoom(\.min)?\.js/)){t=o;break}}if(t){var i=t.getAttribute("query");if(i){var r=t.getAttribute("name")||"pz",a=Date.now();!function e(){var n=document.querySelector(i);if(!n)return Date.now()-a<2e3?void setTimeout(e,100):void console.error("Cannot find the panzoom element",r);var o=function(e){for(var t=e.attributes,n={},o=0;o<t.length;++o){var i=s(t[o]);i&&(n[i.name]=i.value)}return n}(t);console.log(o),window[r]=b(n,o)}()}}}}function s(e){if(e.name&&"p"===e.name[0]&&"z"===e.name[1]&&"-"===e.name[2])return{name:e.name.substr(3),value:JSON.parse(e.value)}}}()},fWck:function(e,t){function n(e,t,n){e.addEventListener("wheel",t,n)}e.exports=n,e.exports.addWheelListener=n,e.exports.removeWheelListener=function(e,t,n){e.removeEventListener("wheel",t,n)}},sO0u:function(e,t,n){"use strict";n.r(t),n.d(t,"NavigationPageModule",function(){return xe});var o=n("TEn/"),i=n("tyNb"),r=n("ofXK"),a=n("3Pt+"),s=n("mrSG"),c=n("EnSQ"),l=n("WdNr"),d=n("fXoL");class u{constructor(e){this.icon=e}render(e,t,n,o,i){const r=new Image;r.onload=()=>{e.drawImage(r,t,n,o,i)},r.src="assets/"+this.icon}}var h=n("cQc6");class b{constructor(e){this.mapItem=e,this.doAnim=!1}get MapItem(){return this.mapItem}render(e){this.mapItem.Sections&&this.mapItem.Sections.length>0&&(e.beginPath(),this.renderSections(e),e.strokeStyle="#FFF",e.fillStyle=this.mapItem.Color,e.stroke(),e.fill(),e.closePath())}startAnimation(e,t){this.animationCallback=()=>{if(!0!==this.doAnim)return;e.save();const n=new Date;if(e.beginPath(),this.renderSections(e),e.lineWidth=1,e.strokeStyle=n.getSeconds()%2==0?"#FFF":"#000",e.fillStyle=n.getSeconds()%2==0?"#000":this.mapItem.Color,e.stroke(),e.fill(),e.closePath(),e.restore(),window.requestAnimationFrame(this.animationCallback),void 0!==t&&void 0!==t.renderer&&void 0!==t.floor)for(const o of t.renderer)o.render(e,t)},this.doAnim=!0,window.requestAnimationFrame(this.animationCallback)}stopAnimation(e){this.doAnim=!1,this.animationCallback=null}renderSections(e){e.moveTo(this.mapItem.Sections[0].Start.X,this.mapItem.Sections[0].Start.Y);for(let t=1;t<this.mapItem.Sections.length;t++)e.lineTo(this.mapItem.Sections[t].Start.X,this.mapItem.Sections[t].Start.Y);e.lineTo(this.mapItem.Sections[0].Start.X,this.mapItem.Sections[0].Start.Y)}}class m{constructor(e){this.location=e}get Location(){return this.location}render(e){e.font="12px Arial",e.textAlign="center",e.fillStyle="#000",e.fillText(this.location.Name,this.location.PathNode.Coordinate.X,this.location.PathNode.Coordinate.Y)}startAnimation(e){}stopAnimation(e){}}class f{constructor(e){this.route=e}get Route(){return this.route}render(e,t){const n=new u("pin-sharp.png");this.route.Start.Floor===t.floor&&n.render(e,this.route.Start.Node.Coordinate.X-15,this.route.Start.Node.Coordinate.Y-30,30,30);const o=new u("flag-sharp.png");this.route.End.Floor===t.floor&&o.render(e,this.route.End.Node.Coordinate.X-5,this.route.End.Node.Coordinate.Y-30,30,30);const i=this.route.RouteSections.filter(e=>e.Floor===t.floor);if(null!=i){for(const t of i){e.strokeStyle="#A00",e.lineWidth=3,e.beginPath(),e.moveTo(t.Route[0].Coordinate.X,t.Route[0].Coordinate.Y);for(let n=1;n<t.Route.length;n++)e.lineTo(t.Route[n].Coordinate.X,t.Route[n].Coordinate.Y);e.stroke(),e.closePath()}for(const t of i){const n=t.Route.length,o=t.Distance,i=t.Route[Math.round((n-1)/2)].Coordinate.X,r=t.Route[Math.round((n-1)/2)].Coordinate.Y,a="14px Arial",s=e.measureText(o.toString()).width+14,c=parseInt("14px Arial",10)+14;e.fillStyle="#A00",e.fillRect(i-s/2,r-c/2,s,20),e.font=a,e.fillStyle="#FFF",e.fillText(o.toString(),i,r)}}}startAnimation(e){}stopAnimation(e){}}class p{static GetMapItemRendererCanvas(...e){const t=[];for(const n of e)t.push(new b(n));return t}static GetLocationRendererCanvas(...e){const t=[];for(const n of e)t.push(new m(n));return t}static GetRouteRendererCanvas(...e){const t=[];for(const n of e)t.push(new f(n));return t}}var g=n("fQX0"),v=n.n(g);const y=["fab"];function w(e,t){if(1&e){const e=d.Lb();d.Kb(0,"ion-fab-button",4),d.Wb("click",function(){d.hc(e);const n=t.index;return d.Yb().emitAnotherFloorToShow(n)}),d.Ib(1,"span",5),d.Jb()}if(2&e){const e=t.$implicit;d.xb(1),d.dc("innerHTML",e,d.ic)}}let S=(()=>{class e{constructor(e){this._dataService=e,this.floorWithBuilding=new d.o}ngOnInit(){}ngOnChanges(e){return Object(s.a)(this,void 0,void 0,function*(){if(void 0!==e.currentBuilding&&void 0!==this.currentBuilding){const e=yield this._dataService.get_building(this.currentBuilding).toPromise();this.availableFloors=e.Floors}})}emitAnotherFloorToShow(e){return Object(s.a)(this,void 0,void 0,function*(){this.floorWithBuilding.emit({floor:this.availableFloors[e],building:this.currentBuilding}),this.currentFloor=this.availableFloors[e]})}}return e.\u0275fac=function(t){return new(t||e)(d.Hb(c.a))},e.\u0275cmp=d.Bb({type:e,selectors:[["app-floor-button"]],viewQuery:function(e,t){if(1&e&&d.rc(y,!0),2&e){let e;d.fc(e=d.Xb())&&(t.fab=e.first)}},inputs:{currentBuilding:"currentBuilding",currentFloor:"currentFloor"},outputs:{floorWithBuilding:"floorWithBuilding"},features:[d.vb],decls:7,vars:3,consts:[["vertical","top","horizontal","end","slot","fixed"],["fab",""],["side","bottom"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],[3,"innerHTML"]],template:function(e,t){1&e&&(d.Kb(0,"ion-fab",0,1),d.Kb(2,"ion-fab-button"),d.Kb(3,"span"),d.nc(4),d.Jb(),d.Jb(),d.Kb(5,"ion-fab-list",2),d.mc(6,w,2,1,"ion-fab-button",3),d.Jb(),d.Jb()),2&e&&(d.xb(4),d.qc("",t.currentBuilding,".",t.currentFloor,""),d.xb(2),d.dc("ngForOf",t.availableFloors))},directives:[o.q,o.r,o.s,r.i],styles:[""]}),e})(),x=(()=>{class e{constructor(e){this.dataService=e,this.clickThreshold=20,this.mapItemRenderer=[],this.locationRenderer=[],this.routeRenderer=[],this.locationClick=new d.o,this.mapScroll=new d.o}get CurrentRoute(){return this.currentRoute}get CurrentBuilding(){return this.currentBuilding}ngAfterViewInit(){const e=this;this.panZoomController||(this.panZoomController=v()(document.getElementById("map"),{maxZoom:2,minZoom:.25,initialZoom:.7,bounds:!0,boundsPadding:.1,onTouch(t){return Object(s.a)(this,void 0,void 0,function*(){return 1===t.touches.length&&(yield e.onElementClick(t.touches[0].clientX,t.touches[0].clientY,t.target)),!1})}}))}showRoute(e,t){return Object(s.a)(this,void 0,void 0,function*(){this.stopAllAnimations(),yield this.renderNavigationPage(e,t.Building,t.Floor)})}showDiscoveryLocation(e){return Object(s.a)(this,void 0,void 0,function*(){this.stopAllAnimations();const t=yield this.dataService.get_locations_search(e).toPromise();if(null===t||0===t.length)throw new Error("Studi-Guide can't find "+e);const n=t[0];this.currentBuilding=n.Building;const o=yield this.dataService.get_map_floor(this.currentBuilding,n.Floor).toPromise();this.mapItemRenderer=p.GetMapItemRendererCanvas(...o);const i=yield this.dataService.get_locations(n.Building,n.Floor).toPromise();return this.locationRenderer=p.GetLocationRendererCanvas(...i),this.clearMapCanvas(),this.createNewCanvasMap(),this.renderMapItems(),this.renderLocations(),this.displayPin(n.PathNode),this.currentFloor=n.Floor,this.CenterMap(n.PathNode.Coordinate.X,n.PathNode.Coordinate.Y),n})}showFloor(e,t){return Object(s.a)(this,void 0,void 0,function*(){if(this.stopAllAnimations(),null!=this.currentRoute)yield this.renderNavigationPage(this.currentRoute,this.currentBuilding,e);else{const n=yield this.dataService.get_map_items("",e,t).toPromise();this.mapItemRenderer=p.GetMapItemRendererCanvas(...n),this.createNewCanvasMap();const o=yield this.dataService.get_locations_items("",e,t).toPromise();this.locationRenderer=p.GetLocationRendererCanvas(...o),this.renderMapItems(),this.renderLocations()}this.currentFloor=e,this.currentBuilding=t,this.FitMap()})}showDiscoveryMap(e,t){return Object(s.a)(this,void 0,void 0,function*(){const n=yield this.dataService.get_map_items(e,t,"").toPromise();this.mapItemRenderer=p.GetMapItemRendererCanvas(...n);const o=yield this.dataService.get_locations_items(e,t,"").toPromise();this.locationRenderer=p.GetLocationRendererCanvas(...o),this.createNewCanvasMap(),this.renderMapItems(),this.renderLocations(),this.currentFloor=t,this.FitMap()})}clearMapCanvas(){const e=document.getElementById("map").getContext("2d");null!=e&&e.clearRect(0,0,e.canvas.width,e.canvas.height)}onClick(e){return Object(s.a)(this,void 0,void 0,function*(){yield this.onElementClick(e.clientX,e.clientY,e.target)})}onElementClick(e,t,n){return Object(s.a)(this,void 0,void 0,function*(){const o=this.panZoomController.getTransform(),i=class{static transformInOriginCoordinate(e,t,n){const o=n.getBoundingClientRect(),i=(e.x-o.left)/t,r=(e.y-o.top)/t;return console.log("Transform x:"+e.x+" y:"+e.y+"  to coordinate: x:"+i+" y:"+r),{x:i,y:r}}}.transformInOriginCoordinate({x:e,y:t},o.scale,n),r=[i.x,i.y];if(null!=this.currentRoute){const e=[];for(const t of this.getInteractiveStairWellMapItemRenderer(this.currentFloor))e.push(t.MapItem);for(const t of e){const e=[];for(const n of t.Sections)e.push([n.Start.X,n.Start.Y]);if(h(r,e))return void(yield this.showNextFloor(t))}}for(const e of this.locationRenderer){const t=e.Location;if(Math.abs(t.PathNode.Coordinate.X-r[0])<this.clickThreshold&&Math.abs(t.PathNode.Coordinate.Y-r[1])<this.clickThreshold)return void this.locationClick.emit(t)}})}renderNavigationPage(e,t,n){var o,i;return Object(s.a)(this,void 0,void 0,function*(){let r=null!==(o=yield this.dataService.get_map_floor(t,n).toPromise())&&void 0!==o?o:new Array,a=null!==(i=yield this.dataService.get_locations(t,n).toPromise())&&void 0!==i?i:new Array;for(const o of e.RouteSections)if(o.Floor===n&&o.Building!==t){const e=yield this.dataService.get_map_floor(o.Building,o.Floor).toPromise();r=r.concat(e);const t=yield this.dataService.get_locations(o.Building,o.Floor).toPromise();a=a.concat(t)}this.mapItemRenderer=p.GetMapItemRendererCanvas(...r),this.locationRenderer=p.GetLocationRendererCanvas(...a),this.routeRenderer=p.GetRouteRendererCanvas(e),this.createNewCanvasMap(),this.currentBuilding=t,this.renderMapItems(),this.renderLocations(),this.renderRoutes({floor:n});for(const e of this.getInteractiveStairWellMapItemRenderer(n))e.startAnimation(this.renderingContext,{renderer:this.routeRenderer,floor:n});this.currentRoute=e,this.currentFloor=n})}createNewCanvasMap(){const e=document.getElementById("map");let t=0,n=0;for(const o of this.mapItemRenderer){const e=o.MapItem;if(e.Sections)for(const o of e.Sections)o.End.X>n&&(n=o.End.X),o.End.Y>t&&(t=o.End.Y);if(e.PathNodes)for(const o of e.PathNodes)o.Coordinate.X>n&&(n=o.Coordinate.X),o.Coordinate.Y>t&&(t=o.Coordinate.Y)}this.renderingContext=class{static setup(e,t,n){const o=this.GetPixelRatio();return e.width=t*o,e.height=n*o,e.style.width=t+"px",e.style.height=n+"px",this.getContext(e)}static getContext(e){const t=this.GetPixelRatio(),n=e.getContext("2d");return n.scale(t,t),n}static GetPixelRatio(){return window.devicePixelRatio||1}}.setup(e,n,t)}displayPin(e){const t=e.Coordinate.X-15,n=e.Coordinate.Y-30;new u("pin-sharp.png").render(this.renderingContext,t,n,30,30)}showNextFloor(e){return Object(s.a)(this,void 0,void 0,function*(){for(let t=0;t<this.currentRoute.RouteSections.length-1;t++)if(this.currentRoute.RouteSections[t].Floor===e.Floor&&this.currentRoute.RouteSections[t].Building===e.Building)return this.currentFloor=this.currentRoute.RouteSections[t+1].Floor,this.currentBuilding=this.currentRoute.RouteSections[t+1].Building,void(yield this.showFloor(this.currentFloor,this.currentBuilding))})}getInteractiveStairWellMapItemRenderer(e){const t=[];for(const o of this.routeRenderer)for(let e=0;e<o.Route.RouteSections.length-1;e++)o.Route.RouteSections[e].Building===o.Route.RouteSections[e+1].Building&&t.push(o.Route.RouteSections[e].Route[o.Route.RouteSections[e].Route.length-1]);const n=[];for(const o of t)for(const t of this.mapItemRenderer)t.MapItem.Floor===e&&t.MapItem.PathNodes.filter(e=>e.Id===o.Id).length>0&&n.push(t);return n}stopAllAnimations(){for(const e of this.routeRenderer)e.stopAnimation(this.renderingContext);for(const e of this.mapItemRenderer)e.stopAnimation(this.renderingContext);for(const e of this.locationRenderer)e.stopAnimation(this.renderingContext)}renderMapItems(){for(const e of this.mapItemRenderer)e.render(this.renderingContext)}renderLocations(){for(const e of this.locationRenderer)e.render(this.renderingContext)}renderRoutes(e){for(const t of this.routeRenderer)t.render(this.renderingContext,e)}onFloorChangeByFloorButton(e){return Object(s.a)(this,void 0,void 0,function*(){yield this.showAnotherFloorOfCurrentBuilding(e.floor,e.building)})}showAnotherFloorOfCurrentBuilding(e,t){return Object(s.a)(this,void 0,void 0,function*(){Y.progressIsVisible=!0,yield this.showFloor(e,t),Y.progressIsVisible=!1})}CenterMap(e,t){const n=this.calulateMovePosition(e,t);this.panZoomController.smoothMoveTo(n.x,n.y)}calulateMovePosition(e,t){const n=document.getElementById("canvas-wrapper");return{x:n.clientWidth/2-e,y:n.parentElement.parentElement.clientHeight/2-t}}MapSize(){return document.getElementById("map").getBoundingClientRect()}FitMap(){const e=this.MapSize();this.CenterMap(e.width/2,e.height/2)}}return e.\u0275fac=function(t){return new(t||e)(d.Hb(c.a))},e.\u0275cmp=d.Bb({type:e,selectors:[["app-map-view"]],outputs:{locationClick:"locationClick",mapScroll:"mapScroll"},decls:4,vars:2,consts:[["id","canvas-wrapper",1,"draggable"],[3,"currentBuilding","currentFloor","floorWithBuilding"],["id","map",3,"click"],["map",""]],template:function(e,t){1&e&&(d.Kb(0,"div",0),d.Kb(1,"app-floor-button",1),d.Wb("floorWithBuilding",function(e){return t.onFloorChangeByFloorButton(e)}),d.Jb(),d.Kb(2,"canvas",2,3),d.Wb("click",function(e){return t.onClick(e)}),d.Jb(),d.Jb()),2&e&&(d.xb(1),d.dc("currentBuilding",t.CurrentBuilding)("currentFloor",t.currentFloor))},directives:[S],styles:["body[_ngcontent-%COMP%], html[_ngcontent-%COMP%]{height:100%;width:100%}#canvas-wrapper[_ngcontent-%COMP%]{padding:2px;overflow:hidden;scrollbar-width:none;-ms-overflow-style:none}#canvas-wrapper[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.draggable[_ngcontent-%COMP%]{cursor:-webkit-grab;cursor:grab}.draggable[_ngcontent-%COMP%]:active{cursor:-webkit-grabbing;cursor:grabbing}"]}),e})();var C=n("tk/3");const I=["destinationSearchbar"],R=["startSearchBar"];function M(e,t){if(1&e){const e=d.Lb();d.Kb(0,"ion-button",8),d.Wb("click",function(){return d.hc(e),d.Yb().emitDiscoveryEvent()}),d.Ib(1,"ion-icon",9),d.Jb()}}function O(e,t){1&e&&d.Ib(0,"span",10)}function k(e,t){if(1&e){const e=d.Lb();d.Kb(0,"ion-button",5),d.Wb("click",function(){return d.hc(e),d.Yb(2).hideRouteSearchBar()}),d.Ib(1,"ion-icon",14),d.Jb()}}function P(e,t){if(1&e){const e=d.Lb();d.Kb(0,"ion-item",0),d.Kb(1,"ion-searchbar",11,12),d.Wb("click",function(){return d.hc(e),d.Yb().onSearchBarHasFocus("startSearchBar")})("keydown",function(t){return d.hc(e),d.Yb().onKey(t,"startSearchBar")},!1,d.gc),d.Jb(),d.mc(3,k,2,0,"ion-button",13),d.Jb()}if(2&e){const e=d.Yb();d.xb(1),d.dc("value",e.startSearchBarValue),d.xb(2),d.dc("ngIf",e.closeRouteBtnIsVisible)}}let D=(()=>{class e{constructor(){this.discovery=new d.o,this.route=new d.o,this.searchBarFocus=new d.o,this.searchBtnIsVisible=!0,this.routeInputIsVisible=!1,this.closeRouteBtnIsVisible=!1}ngOnInit(){}showRouteSearchBar(){this.routeInputIsVisible=!0,this.searchBtnIsVisible=!1,this.closeRouteBtnIsVisible=!0}hideRouteSearchBar(){this.routeInputIsVisible&&(this.routeInputIsVisible=!1,this.searchBtnIsVisible=!0,this.closeRouteBtnIsVisible=!1)}routeBtnClick(){this.routeInputIsVisible?this.emitRouteEvent():this.showRouteSearchBar()}emitDiscoveryEvent(){let e=""===this.destinationSearchbar.value||void 0===this.destinationSearchbar.value;if(e=e||null===this.destinationSearchbar.value,!e){const e=document.activeElement;e&&e.blur&&e.blur(),this.discovery.emit(this.destinationSearchbar.value)}}emitRouteEvent(){let e=""===this.destinationSearchbar.value||void 0===this.destinationSearchbar.value;e=e||null===this.destinationSearchbar.value;let t=""===this.startSearchBar.value||void 0===this.startSearchBar.value;if(t=t||null===this.startSearchBar.value,!e&&!t){const e=[this.startSearchBar.value,this.destinationSearchbar.value],t=document.activeElement;t&&t.blur&&t.blur(),this.route.emit(e)}}clearDestinationInput(){this.destinationSearchbar.value=""}clearStartInput(){this.startSearchBar.value=""}setDiscoverySearchbarValue(e){this.destinationSearchbarValue=e}setStartSearchbarValue(e){this.startSearchBarValue=e}onSearchBarHasFocus(e){this.searchBarFocus.emit(e)}onKey(e,t){"Enter"===e.key&&("destinationSearchbar"===t&&this.emitDiscoveryEvent(),"startSearchBar"===t&&this.emitRouteEvent())}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=d.Bb({type:e,selectors:[["app-search-input"]],viewQuery:function(e,t){if(1&e&&(d.rc(I,!0),d.rc(R,!0)),2&e){let e;d.fc(e=d.Xb())&&(t.destinationSearchbar=e.first),d.fc(e=d.Xb())&&(t.startSearchBar=e.first)}},outputs:{discovery:"discovery",route:"route",searchBarFocus:"searchBarFocus"},decls:8,vars:4,consts:[["lines","none"],["search-icon","navigate-circle-outline","inputmode","text","mode","ios","placeholder","destination","color","","icon-color","dark",3,"value","click","keydown"],["destinationSearchbar",""],["size","default","mode","ios","color","medium",3,"click",4,"ngIf"],["class","vertical-line",4,"ngIf"],["size","default","mode","ios","color","primary",3,"click"],["size","large","slot","icon-only","src","assets/navigation-svgs/directions-24px.svg"],["lines","none",4,"ngIf"],["size","default","mode","ios","color","medium",3,"click"],["size","large","slot","icon-only","name","search","color",""],[1,"vertical-line"],["animated","true","color","","icon-color","dark","inputmode","text","mode","ios","placeholder","start","search-icon","locate-outline",3,"value","click","keydown"],["startSearchBar",""],["size","default","mode","ios","color","primary",3,"click",4,"ngIf"],["size","large","slot","icon-only","name","close-outline"]],template:function(e,t){1&e&&(d.Kb(0,"ion-item",0),d.Kb(1,"ion-searchbar",1,2),d.Wb("click",function(){return t.onSearchBarHasFocus("destinationSearchbar")})("keydown",function(e){return t.onKey(e,"destinationSearchbar")},!1,d.gc),d.Jb(),d.mc(3,M,2,0,"ion-button",3),d.mc(4,O,1,0,"span",4),d.Kb(5,"ion-button",5),d.Wb("click",function(){return t.routeBtnClick()}),d.Ib(6,"ion-icon",6),d.Jb(),d.Jb(),d.mc(7,P,4,2,"ion-item",7)),2&e&&(d.xb(1),d.dc("value",t.destinationSearchbarValue),d.xb(2),d.dc("ngIf",t.searchBtnIsVisible),d.xb(1),d.dc("ngIf",t.searchBtnIsVisible),d.xb(3),d.dc("ngIf",t.routeInputIsVisible))},directives:[o.y,o.J,o.db,r.j,o.h,o.w],styles:["ion-searchbar[_ngcontent-%COMP%]{max-width:300px}"]}),e})();var K=n("+JbE"),J=n("YD5U");class B{constructor(e){this._campus=e,this._addressString=this.getAddressString(this._campus)}get Address(){return this._addressString}get Name(){return this._campus.Name}get ShortName(){return this._campus.ShortName}get LatLng(){return{lat:this._campus.Latitude,lng:this._campus.Longitude}}getAddressString(e){let t="";if(null!==e.edges.Address){const n=L(e.edges.Address,e=>e.Street);for(const e of Object.keys(n)){const o=n[e];""!==t&&(t+="; ");let i=o[0].Number;o.length>1&&(i+="-"+o[o.length-1].Number),t+=e+" "+i+", ",t+=n[e][0].PLZ+" "+n[e][0].City}}return t}}const L=(e,t)=>e.reduce((e,n)=>{const o=t(n);return e[o]||(e[o]=[]),e[o].push(n),e},{});let F=(()=>{class e{constructor(){this.recentSearches=[],this.latestSearchResult={Name:"",Description:"",Information:[],DetailRouterParams:{},RouteRouterParams:{},LatLng:{lat:0,lng:0}},this.availableCampus=[],this.Route={Coordinates:[],Distance:0,NavigationInstructions:[],Time:0}}SetCampusAsSearchResultObject(e){this.latestSearchResult={Name:e.Name,Description:e.ShortName,Information:[["ShortName: ",e.ShortName],["Longitude: ",e.Longitude],["Latitude: ",e.Latitude]],DetailRouterParams:{},RouteRouterParams:{},LatLng:{lat:e.Latitude,lng:e.Longitude}}}SetBuildingAsSearchResultObject(e,t){this.latestSearchResult={Name:e.Name,Description:"Campus:"+e.Campus,Information:[],DetailRouterParams:{building:e.Name},RouteRouterParams:{},LatLng:t}}SetLocationAsSearchResultObject(e,t){const n=[["Building: ",e.Name]];e.Tags&&n.push(["Tags: ",e.Tags.join(", ")]),this.latestSearchResult={Name:e.Name,Description:e.Description,Information:n,DetailRouterParams:{location:e.Name},RouteRouterParams:{start:e.Building+".Entrance",destination:e.Name},LatLng:t}}SetGraphHopperRouteAsRoute(e){const t=[];for(const n of e.Points.Coordinates)t.push([n.Lat,n.Lng]);this.Route={Coordinates:t,Distance:Math.round(e.Distance),NavigationInstructions:e.Instructions,Time:Math.round(e.Time/1e3/60)}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=d.Db({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),E=(()=>{class e{static addRecentSearch(e,t,n){t.recentSearches.includes(e)&&t.recentSearches.splice(t.recentSearches.indexOf(e),1),t.recentSearches.unshift(e),t.recentSearches.length>3&&t.recentSearches.pop(),n.set(this.recentSearchesKey,JSON.stringify([t.recentSearches])),console.log(t.recentSearches)}static readRecentSearch(e){return Object(s.a)(this,void 0,void 0,function*(){const t=JSON.parse(yield e.get(this.recentSearchesKey));return null!=t?t[0]:null})}}return e.recentSearchesKey="searches",e})();var N=n("gcOT"),_=n("e8h1");const A=["drawerContent"],T=["searchDrawer"],j=["locationDrawer"];function V(e,t){1&e&&d.Ib(0,"ion-progress-bar",37)}function z(e,t){if(1&e&&(d.Kb(0,"ion-text",38),d.Kb(1,"h5"),d.Kb(2,"span",39),d.nc(3),d.Jb(),d.Jb(),d.Kb(4,"p"),d.Ob(5,40),d.Jb(),d.Kb(6,"p"),d.Rb(7,41),d.Ib(8,"br"),d.Ib(9,"a",42),d.Pb(),d.Jb(),d.Jb()),2&e){const e=d.Yb();d.xb(3),d.oc(e.errorMessage)}}function W(e,t){if(1&e){const e=d.Lb();d.Kb(0,"ion-item",43),d.Wb("click",function(){d.hc(e);const n=t.$implicit;return d.Yb().recentSearchClick(n)}),d.Kb(1,"ion-label"),d.Kb(2,"h2"),d.nc(3),d.Jb(),d.Jb(),d.Jb()}if(2&e){const e=t.$implicit;d.xb(3),d.oc(e)}}function G(e,t){if(1&e&&(d.Kb(0,"ion-item"),d.Kb(1,"ion-label"),d.Kb(2,"h2"),d.nc(3),d.Jb(),d.Kb(4,"h3"),d.nc(5),d.Jb(),d.Jb(),d.Jb()),2&e){const e=t.$implicit;d.xb(3),d.qc("",e.ShortName,": ",e.Name,""),d.xb(2),d.oc(e.Address)}}function H(e,t){if(1&e&&(d.Kb(0,"ion-row"),d.Kb(1,"ion-col"),d.nc(2),d.Jb(),d.Kb(3,"ion-col"),d.nc(4),d.Jb(),d.Jb()),2&e){const e=t.$implicit;d.xb(2),d.oc(e[0]),d.xb(2),d.oc(e[1])}}const{Keyboard:X}=N.a;let Y=(()=>{class e{constructor(e,t,n,o,i,r,a){this.dataService=e,this.modalCtrl=t,this.route=n,this.router=o,this.storage=i,this.model=r,this.platform=a,this.availableCampus=[],this.isSubscripted=!1}ngAfterViewInit(){this.locationDrawer.SetState(K.a.Hidden),this.searchDrawer.SetState(J.a.GetRecommendedDrawerStateForDevice())}ionViewDidEnter(){!1===this.isSubscripted&&(this.isSubscripted=!0,this.route.queryParams.subscribe(e=>Object(s.a)(this,void 0,void 0,function*(){var t;if(null!=e&&null!=e.location&&e.location.length>0)return this.searchInput.setDiscoverySearchbarValue(e.location),void(yield this.onDiscovery(e.location));if(null!=e&&null!=e.start&&e.start.length>0&&null!=e.destination&&e.destination.length>0)yield this.showNavigation(e.start,e.destination);else if(null!=e&&null!=e.building&&e.building.length>0){const n=yield this.dataService.get_building(e.building).toPromise();null!==n&&(yield this.mapView.showFloor((null===(t=n.Floors)||void 0===t?void 0:t.includes("EG"))?"EG":n.Floors[0],n.Name))}else yield this.showDiscoveryMode()})))}ngOnInit(){return Object(s.a)(this,void 0,void 0,function*(){if(0===this.model.recentSearches.length){const e=yield E.readRecentSearch(this.storage);null!==e&&(this.model.recentSearches=e,console.log(this.model.recentSearches))}0===this.model.availableCampus.length&&(this.model.availableCampus=yield this.dataService.get_campus_search().toPromise());for(const e of this.model.availableCampus)this.availableCampus.push(new B(e))})}onDiscovery(t){return Object(s.a)(this,void 0,void 0,function*(){this.model.errorMessage="",e.progressIsVisible=!0;try{const n=yield this.mapView.showDiscoveryLocation(t);E.addRecentSearch(t,this.model,this.storage),yield this.showLocationDrawer(n)}catch(n){this.handleInputError(n,t)}finally{e.progressIsVisible=!1}})}onRoute(t){return Object(s.a)(this,void 0,void 0,function*(){this.errorMessage="",e.progressIsVisible=!0;try{const n=yield this.dataService.get_location(t[0]).toPromise(),o=yield this.dataService.get_route(t[0],t[1]).toPromise();yield this.mapView.showRoute(o,n),this.mapView.CenterMap(n.PathNode.Coordinate.X,n.PathNode.Coordinate.Y)}catch(n){let e="";if(n instanceof C.d){const o=n.error.message;o.includes(t[0])&&(e=t[0]),o.includes(t[1])&&(e.length>0&&(e+=" and "),e+=t[1])}this.handleInputError(n,0===e.length?t.toString():e)}finally{e.progressIsVisible=!1}})}onDrawerStateChange(e){void 0!==this.drawerContent&&(this.drawerContent.scrollY=e===K.a.Top)}showLocationDrawer(e){return Object(s.a)(this,void 0,void 0,function*(){yield this.locationDrawer.SetState(K.a.Hidden),this.model.latestSearchResult.Name=e.Name,this.model.latestSearchResult.Description=e.Description,this.model.latestSearchResult.Information=e.Tags?[["Tags: ",e.Tags.join(",")]]:[],this.platform.is("hybrid")&&(yield X.hide()),yield this.searchDrawer.SetState(K.a.Hidden),yield this.locationDrawer.SetState(J.a.GetRecommendedDrawerStateForDevice())})}onCloseLocationDrawer(e){return Object(s.a)(this,void 0,void 0,function*(){yield this.locationDrawer.SetState(K.a.Hidden),yield this.searchDrawer.SetState(J.a.GetRecommendedDrawerStateForDevice())})}presentAvailableFloorModal(){return Object(s.a)(this,void 0,void 0,function*(){let e=new Array,t=yield this.dataService.get_buildings_search().toPromise();t=t.filter((e,n)=>t.indexOf(e)===n);for(const i of t){const t=yield this.dataService.get_building(i.Name).toPromise();e=e.concat(t.Floors)}e=e.filter((t,n)=>e.indexOf(t)===n);const n=yield this.modalCtrl.create({component:l.a,cssClass:"floor-modal",componentProps:{floors:e}});yield n.present();const o=yield n.onDidDismiss();o.data&&(yield this.mapView.showAnotherFloorOfCurrentBuilding(o.data,this.mapView.CurrentBuilding))})}handleInputError(e,t){if(console.log(e),e instanceof C.d){const n=e;this.errorMessage=400===n.status?"Studi-Guide can't find "+t:n.message}else this.errorMessage=e.message;null!=this.mapView&&this.mapView.clearMapCanvas()}navigationBtnClick(){return Object(s.a)(this,void 0,void 0,function*(){if(null!=this.model.latestSearchResult)try{const t=yield this.dataService.get_location(this.model.latestSearchResult.Name).toPromise();yield this.showNavigation(t.Building+".Entrance",t.Name)}catch(t){let e="";t instanceof C.d&&t.error.message.includes(this.model.latestSearchResult.Name)&&(e=this.model.latestSearchResult.Name),this.handleInputError(t,0===e.length?this.model.latestSearchResult.Name:e)}finally{e.progressIsVisible=!1}})}showNavigation(e,t){return Object(s.a)(this,void 0,void 0,function*(){this.searchInput.showRouteSearchBar(),this.searchInput.setDiscoverySearchbarValue(t),this.searchInput.setStartSearchbarValue(e),yield this.onCloseLocationDrawer(null),yield this.onRoute([e,t])})}showDiscoveryMode(){return Object(s.a)(this,void 0,void 0,function*(){null==this.mapView.CurrentRoute&&null==this.mapView.CurrentBuilding&&(yield this.mapView.showDiscoveryMap("","EG"),this.mapView.CenterMap(310,550))})}recentSearchClick(e){return Object(s.a)(this,void 0,void 0,function*(){yield this.router.navigate(["tabs/navigation/detail"],{queryParams:{location:e}})})}presentMapPage(){return Object(s.a)(this,void 0,void 0,function*(){yield this.router.navigate(["tabs/navigation/"])})}get ProgressIsVisible(){return e.progressIsVisible}}return e.progressIsVisible=!1,e.\u0275fac=function(t){return new(t||e)(d.Hb(c.a),d.Hb(o.Y),d.Hb(i.a),d.Hb(i.g),d.Hb(_.b),d.Hb(F),d.Hb(o.ab))},e.\u0275cmp=d.Bb({type:e,selectors:[["app-navigation"]],viewQuery:function(e,t){if(1&e&&(d.rc(x,!0),d.rc(D,!0),d.rc(A,!0),d.rc(T,!0),d.rc(j,!0)),2&e){let e;d.fc(e=d.Xb())&&(t.mapView=e.first),d.fc(e=d.Xb())&&(t.searchInput=e.first),d.fc(e=d.Xb())&&(t.drawerContent=e.first),d.fc(e=d.Xb())&&(t.searchDrawer=e.first),d.fc(e=d.Xb())&&(t.locationDrawer=e.first)}},decls:72,vars:7,consts:function(){let e,t;return e="\xDCberpr\xFCfe deine Eingabe auf Rechtschreibfehler.",t="Sollte dieser Ort im Studi-Guide sein?\n        " + "\ufffd#8\ufffd\ufffd/#8\ufffd" + "\n        " + "\ufffd#9\ufffd" + "F\xFCge den Ort hinzu" + "\ufffd/#9\ufffd" + "\n      ",[["translucent",""],["slot","start"],["id","close-open-map","defaultHref","/"],["data-tap-disabled","true","scroll-y","false"],["type","indeterminate","color","secondary",4,"ngIf"],["id","map-content"],["id","error-message",4,"ngIf"],[3,"locationClick"],[3,"stateChange"],["searchDrawer",""],[1,"nav-bottom-drawer"],[1,"drawer-grip"],[1,"ion-padding-top"],[1,"nav-hbar"],[3,"discovery","route"],["drawerContent",""],["shape","round",1,"square-md","ion-no-padding",3,"click"],["slot","icon-only","name","business-outline","size","large"],["shape","round","color","medium",1,"square-md","ion-no-padding",3,"click"],["slot","icon-only","name","layers-outline","size","large"],["shape","round","color","dark",1,"square-md","ion-no-padding"],["slot","icon-only","name","library-outline","size","large"],[1,"ion-no-padding"],["button","",3,"click",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[1,"ion-padding-vertical"],["state","DrawerState.Hidden"],["locationDrawer",""],[1,"ion-padding-bottom"],["id","locationdrawerContent"],[1,"ion-justify-content-between","ion-align-self-center"],["size","auto"],["id","locationdrawerName"],[1,"ion-justify-content-end","ion-padding-horizontal"],["shape","round","color","medium",1,"square-sm","ion-no-padding","ion-float-right",3,"click"],["slot","icon-only","name","close-outline","size","small"],["id","routeBtn","color","primary","expand","block",3,"click"],["type","indeterminate","color","secondary"],["id","error-message"],[1,"error"],e,t,["href","https://github.com/Studi-Guide/Studi-Guide/issues/new/choose"],["button","",3,"click"]]},template:function(e,t){1&e&&(d.Kb(0,"ion-header",0),d.Kb(1,"ion-toolbar"),d.Kb(2,"ion-buttons",1),d.Ib(3,"ion-back-button",2),d.Jb(),d.Jb(),d.Jb(),d.Kb(4,"ion-content",3),d.mc(5,V,1,0,"ion-progress-bar",4),d.Kb(6,"div",5),d.mc(7,z,10,1,"ion-text",6),d.Kb(8,"app-map-view",7),d.Wb("locationClick",function(e){return t.showLocationDrawer(e)}),d.Jb(),d.Jb(),d.Jb(),d.Kb(9,"app-ionic-bottom-drawer",8,9),d.Wb("stateChange",function(e){return t.onDrawerStateChange(e)}),d.Kb(11,"div",10),d.Kb(12,"div",11),d.Ib(13,"div",12),d.Ib(14,"div",13),d.Kb(15,"app-search-input",14),d.Wb("discovery",function(e){return t.onDiscovery(e)})("route",function(e){return t.onRoute(e)}),d.Jb(),d.Jb(),d.Kb(16,"ion-content",null,15),d.Kb(18,"ion-grid"),d.Kb(19,"ion-list-header"),d.nc(20,"Current Campus"),d.Jb(),d.Kb(21,"ion-row"),d.Kb(22,"ion-col"),d.Kb(23,"ion-button",16),d.Wb("click",function(){return t.presentMapPage()}),d.Ib(24,"ion-icon",17),d.Jb(),d.Jb(),d.Kb(25,"ion-col"),d.Kb(26,"ion-button",18),d.Wb("click",function(){return t.presentAvailableFloorModal()}),d.Ib(27,"ion-icon",19),d.Jb(),d.Jb(),d.Kb(28,"ion-col"),d.Kb(29,"ion-button",20),d.Ib(30,"ion-icon",21),d.Jb(),d.Jb(),d.Ib(31,"ion-col"),d.Jb(),d.Jb(),d.Kb(32,"ion-list",22),d.Kb(33,"ion-list-header"),d.nc(34," Recent Searches "),d.Jb(),d.mc(35,W,4,1,"ion-item",23),d.Jb(),d.Kb(36,"ion-list",22),d.Kb(37,"ion-list-header"),d.nc(38," Choose a Campus "),d.Jb(),d.mc(39,G,6,3,"ion-item",24),d.Jb(),d.Ib(40,"div",25),d.Ib(41,"div",25),d.Ib(42,"div",25),d.Ib(43,"div",25),d.Ib(44,"div",25),d.Ib(45,"div",25),d.Jb(),d.Jb(),d.Jb(),d.Kb(46,"app-ionic-bottom-drawer",26,27),d.Kb(48,"div",10),d.Kb(49,"div",11),d.Ib(50,"div",12),d.Ib(51,"div",13),d.Ib(52,"div",28),d.Jb(),d.Kb(53,"ion-content"),d.Kb(54,"ion-grid",29),d.Kb(55,"ion-row",30),d.Kb(56,"ion-col",31),d.Kb(57,"ion-text",32),d.nc(58),d.Jb(),d.Jb(),d.Kb(59,"ion-col",33),d.Kb(60,"ion-button",34),d.Wb("click",function(e){return t.onCloseLocationDrawer(e)}),d.Ib(61,"ion-icon",35),d.Jb(),d.Jb(),d.Jb(),d.Kb(62,"ion-row"),d.Kb(63,"ion-col"),d.Kb(64,"ion-button",36),d.Wb("click",function(){return t.navigationBtnClick()}),d.nc(65," Route "),d.Jb(),d.Jb(),d.Jb(),d.Kb(66,"ion-row"),d.Kb(67,"ion-col"),d.nc(68,"Description:"),d.Jb(),d.Kb(69,"ion-col"),d.nc(70),d.Jb(),d.Jb(),d.mc(71,H,5,2,"ion-row",24),d.Jb(),d.Jb(),d.Jb(),d.Jb()),2&e&&(d.xb(5),d.dc("ngIf",t.ProgressIsVisible),d.xb(2),d.dc("ngIf",t.errorMessage),d.xb(28),d.dc("ngForOf",t.model.recentSearches),d.xb(4),d.dc("ngForOf",t.availableCampus),d.xb(19),d.oc(t.model.latestSearchResult.Name),d.xb(12),d.oc(t.model.latestSearchResult.Description),d.xb(1),d.dc("ngForOf",t.model.latestSearchResult.Information))},styles:["#map-content[_ngcontent-%COMP%]{height:100%;width:100%;position:fixed}.error[_ngcontent-%COMP%]{color:red}#error-message[_ngcontent-%COMP%]{margin-left:20px}#available-floors-btn[_ngcontent-%COMP%]{position:fixed;bottom:0;display:block;z-index:10}.center[_ngcontent-%COMP%]{margin-left:auto;margin-right:auto;display:block}ion-progress-bar[_ngcontent-%COMP%]{position:absolute;z-index:9999}.vertical-line[_ngcontent-%COMP%]{border-left:2px solid #9d9fa6;height:38px}.nav-hbar[_ngcontent-%COMP%]{border-top:2px solid var(--ion-color-medium,#9d9fa6);border-bottom:2px solid var(--ion-color-medium,#9d9fa6);border-radius:2px;height:0;width:auto;margin:0 45%}.nav-bottom-drawer[_ngcontent-%COMP%]{background-color:#fff;border-top-left-radius:20px;border-top-right-radius:20px;box-shadow:0 4px 8px 0 rgba(0,0,0,.4),0 6px 20px 0 rgba(0,0,0,.29);height:inherit;z-index:1}.square-md[_ngcontent-%COMP%]{height:64px;width:64px}.square-sm[_ngcontent-%COMP%]{height:32px;width:32px}.square-xs[_ngcontent-%COMP%]{height:16px;width:16px}#locationdrawerContent[_ngcontent-%COMP%]{margin-left:30px;margin-right:30px;position:center}#locationdrawerName[_ngcontent-%COMP%]{font-weight:700}"]}),e})(),Z=(()=>{class e{}return e.\u0275mod=d.Fb({type:e}),e.\u0275inj=d.Eb({factory:function(t){return new(t||e)},imports:[[r.b,o.V]]}),e})();var q=n("4R65"),$=n("Bfh1"),U=n("AytR");let Q=(()=>{class e{constructor(e,t,n){this.locale=e,this.httpClient=t,this.env=n}GetRoute(t,n){return Object(s.a)(this,void 0,void 0,function*(){return yield this.httpClient.get(this.env.serverUrl+e.serverPathPrefix+e.routePath+"?start="+t.lat+","+t.lng+"&end="+n.lat+","+n.lng+"&locale="+this.locale).toPromise()})}GetBounds(){return Object(s.a)(this,void 0,void 0,function*(){return yield this.httpClient.get(this.env.serverUrl+e.serverPathPrefix+e.boundsPath).toPromise()})}}return e.serverPathPrefix="/osm",e.routePath="/route",e.boundsPath="/bounds",e.\u0275fac=function(t){return new(t||e)(d.Sb(d.v),d.Sb(C.b),d.Sb(U.a))},e.\u0275prov=d.Db({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const ee=["ionSlides"];function te(e,t){if(1&e&&(d.Kb(0,"ion-slide"),d.Kb(1,"ion-text"),d.Kb(2,"h2"),d.nc(3),d.Jb(),d.Kb(4,"p"),d.nc(5),d.Jb(),d.Jb(),d.Jb()),2&e){const e=t.$implicit;d.xb(3),d.oc(e.Text),d.xb(2),d.pc("",e.Distance,"m")}}let ne=(()=>{class e{constructor(e){this.element=e,this.nextSlide=new d.o,this.previousSlide=new d.o,this.slideOpts={initialSlide:0,speed:400}}ngOnInit(){this.hide()}onPrevSlide(){return Object(s.a)(this,void 0,void 0,function*(){this.previousSlide.emit(yield this.ionSlides.getActiveIndex())})}onNextSlide(){return Object(s.a)(this,void 0,void 0,function*(){this.nextSlide.emit(yield this.ionSlides.getActiveIndex())})}hide(){return Object(s.a)(this,void 0,void 0,function*(){this.element.nativeElement.hidden=!0})}show(){return Object(s.a)(this,void 0,void 0,function*(){this.element.nativeElement.hidden=!1})}}return e.\u0275fac=function(t){return new(t||e)(d.Hb(d.m))},e.\u0275cmp=d.Bb({type:e,selectors:[["app-navigation-instruction-slides"]],viewQuery:function(e,t){if(1&e&&d.rc(ee,!0),2&e){let e;d.fc(e=d.Xb())&&(t.ionSlides=e.first)}},inputs:{instructions:"instructions"},outputs:{nextSlide:"nextSlide",previousSlide:"previousSlide"},decls:3,vars:2,consts:[["pager","true",3,"options","ionSlideNextEnd","ionSlidePrevEnd"],["ionSlides",""],[4,"ngFor","ngForOf"]],template:function(e,t){1&e&&(d.Kb(0,"ion-slides",0,1),d.Wb("ionSlideNextEnd",function(){return t.onNextSlide()})("ionSlidePrevEnd",function(){return t.onPrevSlide()}),d.mc(2,te,6,2,"ion-slide",2),d.Jb()),2&e&&(d.dc("options",t.slideOpts),d.xb(2),d.dc("ngForOf",t.instructions))},directives:[o.N,r.i,o.M,o.R],styles:["[_nghost-%COMP%]{z-index:auto}ion-slide[_ngcontent-%COMP%]{height:100%;width:100%}@media (min-width:992px){ion-slide[_ngcontent-%COMP%]{padding-bottom:2em}}@media (max-width:991.98px){ion-slide[_ngcontent-%COMP%]{padding-bottom:.5em}}"]}),e})(),oe=(()=>{class e{static persist(e,t){return Object(s.a)(this,void 0,void 0,function*(){yield e.set(this.LAST_MAP_EVENT_KEY,t)})}load(t,n,o){return Object(s.a)(this,void 0,void 0,function*(){t.ready().then(()=>Object(s.a)(this,void 0,void 0,function*(){yield t.get(e.LAST_MAP_EVENT_KEY).then(e=>{n.setView([49.452368,11.093299],o),null!=e&&n.flyTo(e.center,e.zoom)})}))})}}return e.LAST_MAP_EVENT_KEY="lastOpenStreetMapEventTarget",e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=d.Db({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const ie=["drawerContent"],re=["searchDrawer"],ae=["locationDrawer"],se=["routeDrawer"],ce=["inNavigationDrawer"],le=["searchInput"],de=["navSlides"];function ue(e,t){1&e&&d.Ib(0,"ion-progress-bar",37)}function he(e,t){if(1&e&&(d.Kb(0,"ion-text",38),d.Kb(1,"h5"),d.Kb(2,"span",39),d.nc(3),d.Jb(),d.Jb(),d.Kb(4,"p"),d.Ob(5,40),d.Jb(),d.Kb(6,"p"),d.Rb(7,41),d.Ib(8,"br"),d.Ib(9,"a",42),d.Pb(),d.Jb(),d.Jb()),2&e){const e=d.Yb();d.xb(3),d.oc(e.errorMessage)}}function be(e,t){if(1&e){const e=d.Lb();d.Kb(0,"ion-item",43),d.Wb("click",function(){d.hc(e);const n=t.$implicit;return d.Yb(2).recentSearchClick(n)}),d.Kb(1,"ion-text"),d.nc(2),d.Jb(),d.Jb()}if(2&e){const e=t.$implicit;d.xb(2),d.oc(e)}}function me(e,t){if(1&e&&(d.Kb(0,"ion-list",17),d.Kb(1,"ion-list-header"),d.Kb(2,"h2"),d.nc(3,"Recent Searches"),d.Jb(),d.Jb(),d.mc(4,be,3,1,"ion-item",18),d.Jb()),2&e){const e=d.Yb();d.xb(4),d.dc("ngForOf",e.model.recentSearches)}}function fe(e,t){if(1&e){const e=d.Lb();d.Kb(0,"ion-item",43),d.Wb("click",function(){d.hc(e);const n=t.$implicit;return d.Yb().onCampusClick(n)}),d.Kb(1,"ion-label"),d.Kb(2,"h2"),d.nc(3),d.Jb(),d.Kb(4,"h3"),d.nc(5),d.Jb(),d.Jb(),d.Jb()}if(2&e){const e=t.$implicit;d.xb(3),d.qc("",e.ShortName,": ",e.Name,""),d.xb(2),d.oc(e.Address)}}function pe(e,t){if(1&e&&(d.Kb(0,"ion-row"),d.Kb(1,"ion-col"),d.nc(2),d.Jb(),d.Kb(3,"ion-col"),d.nc(4),d.Jb(),d.Jb()),2&e){const e=t.$implicit;d.xb(2),d.oc(e[0]),d.xb(2),d.oc(e[1])}}function ge(e,t){if(1&e){const e=d.Lb();d.Kb(0,"ion-button",44),d.Wb("click",function(){return d.hc(e),d.Yb().onLaunchNavigation()}),d.nc(1," Go "),d.Jb()}}function ve(e,t){if(1&e){const e=d.Lb();d.Kb(0,"ion-item",43),d.Wb("click",function(){d.hc(e);const n=t.$implicit;return d.Yb().onNavigationInstructionClick(n)}),d.Kb(1,"ion-label"),d.nc(2),d.Jb(),d.Kb(3,"ion-text"),d.nc(4),d.Jb(),d.Jb()}if(2&e){const e=t.$implicit;d.xb(2),d.oc(e.Text),d.xb(2),d.pc("",e.Distance,"m")}}const{Keyboard:ye}=N.a,we=q.icon({iconRetinaUrl:"leaflet/marker-icon-2x.png",iconUrl:"leaflet/marker-icon.png",shadowUrl:"leaflet/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]});q.Marker.prototype.options.icon=we;let Se=(()=>{class e{constructor(e,t,n,o,i,r,a,s,c){this._dataService=e,this.router=t,this.model=n,this.storage=o,this.dataService=i,this.geolocation=r,this.openStreetMapService=a,this.lastOpenStreetMapCenterPersistence=s,this.platform=c,this.searchMarker=[],this.routes=[],this.availableCampus=[],this.progressIsVisible=!1,this.currentPositionMarker=null,this.isInitialized=!1,this.DEFAULT_ZOOM=17,this.MAX_ZOOM=18,this.MIN_ZOOM=14,this.isHybridPlatform=this.platform.is("hybrid")}static convertToLeafLetCoordinates(e){const t=[];for(const n of e)t.push({lat:n.Latitude,lng:n.Longitude});return t}ngOnInit(){return Object(s.a)(this,void 0,void 0,function*(){if(!this.model.recentSearches||0===this.model.recentSearches.length){const e=yield E.readRecentSearch(this.storage);null!==e&&(this.model.recentSearches=e,console.log(this.model.recentSearches))}if(this.model.availableCampus&&0!==this.model.availableCampus.length||(this.model.availableCampus=yield this.dataService.get_campus_search().toPromise()),this.model.availableCampus)for(const e of this.model.availableCampus)this.availableCampus.push(new B(e));yield Promise.all([this.searchDrawer.SetState(J.a.GetRecommendedDrawerStateForDevice()),this.locationDrawer.SetState(K.a.Hidden),this.routeDrawer.SetState(K.a.Hidden),this.inNavigationDrawer.SetState(K.a.Hidden)])})}ionViewDidEnter(){return Object(s.a)(this,void 0,void 0,function*(){this.isInitialized||(yield this.initializeMap(this.router),this.isInitialized=!0);try{const e=yield this.geolocation.getCurrentPosition();null===this.currentPositionMarker?this.currentPositionMarker=q.marker([e.coords.latitude,e.coords.longitude]).addTo(this.map).bindPopup("Position"):this.currentPositionMarker.setLatLng([e.coords.latitude,e.coords.longitude])}catch(e){console.log("Error getting location",e)}})}initializeMap(t){var n;return Object(s.a)(this,void 0,void 0,function*(){const o=yield this.openStreetMapService.GetBounds(),i=q.latLng(o.SouthWest.Lat,o.SouthWest.Lng),r=q.latLng(o.NorthEast.Lat,o.NorthEast.Lng),a=q.latLngBounds(i,r);console.log(o,a),this.map=q.map("leafletMap",{maxBounds:a,maxZoom:this.MAX_ZOOM,minZoom:this.MIN_ZOOM,zoomControl:!this.platform.is("hybrid")}),this.map.on("moveend",e=>{oe.persist(this.storage,{center:e.target.getCenter(),zoom:e.target.getZoom()})}),yield this.lastOpenStreetMapCenterPersistence.load(this.storage,this.map,this.DEFAULT_ZOOM),q.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"edupala.com \xa9 Angular LeafLet"}).addTo(this.map),this.platform.is("hybrid")&&(yield this.delay(500),this.map.invalidateSize());const s=yield this._dataService.get_buildings_search().toPromise();function c(e){t.navigate(["tabs/navigation/detail"],{queryParams:{building:e.target.options.className}}).then(()=>console.log(e.latlng,e.target.options.className))}if(null!==s)for(const t of s)null!==t.Body&&t.Body.length>0&&q.polygon(e.convertToLeafLetCoordinates(t.Body),{className:t.Name,color:null!==(n=t.Color)&&void 0!==n?n:"#0083C6"}).addTo(this.map).on("click",c)})}ngOnDestroy(){this.map.remove()}onSearch(e){return Object(s.a)(this,void 0,void 0,function*(){this.model.errorMessage="",this.progressIsVisible=!0;try{this.clearSearchMarkers();try{const t=yield this.dataService.get_location(e).toPromise();if(t){const n=yield this.dataService.get_building(t.Building).toPromise(),o=this.getCenterCoordinateFromBody(n.Body);return this.model.SetLocationAsSearchResultObject(t,{lat:o.Latitude,lng:o.Longitude}),this.searchMarker.push(this.showMarker(o.Latitude,o.Longitude,"Room "+t.Name,!0)),this.map.flyTo(this.model.latestSearchResult.LatLng,this.DEFAULT_ZOOM),yield this.showElementDrawer(),void E.addRecentSearch(e,this.model,this.storage)}}catch(t){console.log(t)}try{const t=yield this.dataService.get_building(e,!1).toPromise();if(t){const n=this.getCenterCoordinateFromBody(t.Body);return this.model.SetBuildingAsSearchResultObject(t,{lat:n.Latitude,lng:n.Longitude}),this.map.flyTo(this.model.latestSearchResult.LatLng,this.DEFAULT_ZOOM),this.searchMarker.push(this.showMarker(n.Latitude,n.Longitude,"Building "+t.Name,!0)),yield this.showElementDrawer(),void E.addRecentSearch(e,this.model,this.storage)}}catch(t){console.log(t)}try{const t=yield this.dataService.get_campus(e,!1).toPromise();if(t)return this.model.SetCampusAsSearchResultObject(t),this.searchMarker.push(this.showMarker(t.Latitude,t.Longitude,"Campus "+t.Name,!0)),this.map.flyTo([t.Latitude,t.Longitude],this.DEFAULT_ZOOM),yield this.showElementDrawer(),void E.addRecentSearch(e,this.model,this.storage)}catch(t){console.log(t)}const n=yield this.dataService.get_buildings_search(e).toPromise();if(null!==n&&n.length>0){E.addRecentSearch(e,this.model,this.storage);for(const e of n){const t=this.getCenterCoordinateFromBody(e.Body);this.searchMarker.push(this.showMarker(t.Latitude,t.Longitude,e.Name,!1))}}else{const t=yield this.dataService.get_campus_search(e).toPromise();if(null!==t&&t.length>0){E.addRecentSearch(e,this.model,this.storage);for(const e of t)this.searchMarker.push(this.showMarker(e.Latitude,e.Longitude,e.Name,!1))}}}catch(n){this.handleInputError(n,e)}finally{this.progressIsVisible=!1}})}onRoute(e){}recentSearchClick(e){}onDrawerStateChange(e){void 0!==this.drawerContent&&(this.drawerContent.scrollY=e===K.a.Top)}onCloseLocationDrawer(e){return Object(s.a)(this,void 0,void 0,function*(){this.searchInput.clearDestinationInput(),yield this.locationDrawer.SetState(K.a.Hidden),yield this.searchDrawer.SetState(J.a.GetRecommendedDrawerStateForDevice()),this.clearSearchMarkers()})}onCloseRouteDrawer(e){return Object(s.a)(this,void 0,void 0,function*(){this.clearRoutes(),yield this.routeDrawer.SetState(K.a.Hidden),yield this.locationDrawer.SetState(J.a.GetRecommendedDrawerStateForDevice()),this.map.flyTo(this.model.latestSearchResult.LatLng,this.DEFAULT_ZOOM)})}showElementDrawer(){return Object(s.a)(this,void 0,void 0,function*(){this.isHybridPlatform&&(yield ye.hide()),yield this.searchDrawer.SetState(K.a.Hidden),yield this.locationDrawer.SetState(J.a.GetRecommendedDrawerStateForDevice())})}onCampusClick(e){this.map.flyTo(e.LatLng,this.DEFAULT_ZOOM)}onRouteBtnClick(){return Object(s.a)(this,void 0,void 0,function*(){const e=yield this.geolocation.getCurrentPosition();console.log(e);const t=yield this.openStreetMapService.GetRoute({lat:e.coords.latitude,lng:e.coords.longitude},this.model.latestSearchResult.LatLng);console.log(t),this.model.SetGraphHopperRouteAsRoute(t[0]),yield this.locationDrawer.SetState(K.a.Hidden),yield this.routeDrawer.SetState(J.a.GetRecommendedDrawerStateForDevice());const n=q.polyline(this.model.Route.Coordinates,{color:"red"}).addTo(this.map);this.map.flyTo(n.getCenter(),this.DEFAULT_ZOOM),yield this.map.fitBounds(n.getBounds()),this.routes.push(n)})}onLaunchNavigation(){return Object(s.a)(this,void 0,void 0,function*(){yield this.routeDrawer.SetState(K.a.Hidden),this.navSlides.instructions=this.model.Route.NavigationInstructions,this.navSlides.show(),yield this.inNavigationDrawer.SetState(J.a.GetRecommendedDrawerStateForDevice()),this.map.flyTo(this.model.Route.Coordinates[this.model.Route.NavigationInstructions[0].Interval[0]],this.MAX_ZOOM)})}onSlideChange(e){this.onNavigationInstructionClick(this.model.Route.NavigationInstructions[e])}onEndRouteClick(){return Object(s.a)(this,void 0,void 0,function*(){yield this.inNavigationDrawer.SetState(K.a.Hidden),yield this.locationDrawer.SetState(J.a.GetRecommendedDrawerStateForDevice()),this.clearRoutes(),this.map.flyTo(this.model.latestSearchResult.LatLng,this.DEFAULT_ZOOM)})}detailsBtnClick(){return Object(s.a)(this,void 0,void 0,function*(){yield this.router.navigate(["tabs/navigation/detail"],{queryParams:0===this.routes.length?this.model.latestSearchResult.DetailRouterParams:this.model.latestSearchResult.RouteRouterParams})})}onNavigationInstructionClick(e){this.map.flyTo(this.model.Route.Coordinates[e.Interval[0]],this.MAX_ZOOM)}handleInputError(e,t){if(e instanceof C.d){const n=e;this.errorMessage=400===n.status?"Studi-Guide can't find "+t:n.message}else this.errorMessage=e.message}showMarker(e,t,n="",o){const i=q.marker([e,t]).addTo(this.map);return n?o?i.bindPopup(n).openPopup():i.bindPopup(n):i}getCenterCoordinateFromBody(e){const t=[];for(const i of e)t.push([i.Latitude,i.Longitude]);const n=new q.Polygon(t).addTo(this.map),o={Longitude:n.getCenter().lng,Latitude:n.getCenter().lat};return n.remove(),o}clearSearchMarkers(){for(const e of this.searchMarker)this.map.removeLayer(e)}clearRoutes(){for(const e of this.routes)e.remove();this.routes=[],this.navSlides.hide()}UseDrawerForNavigation(){return!(J.a.GetRecommendedDrawerStateForDevice()===K.a.Bottom)}delay(e){return new Promise(t=>setTimeout(t,e))}onSearchFocus(e){return Object(s.a)(this,void 0,void 0,function*(){this.platform.is("hybrid")&&(yield this.searchDrawer.SetState(K.a.Top))})}}return e.\u0275fac=function(t){return new(t||e)(d.Hb(c.a),d.Hb(i.g),d.Hb(F),d.Hb(_.b),d.Hb(c.a),d.Hb($.a),d.Hb(Q),d.Hb(oe),d.Hb(o.ab))},e.\u0275cmp=d.Bb({type:e,selectors:[["app-map-page"]],viewQuery:function(e,t){if(1&e&&(d.rc(ie,!0),d.rc(re,!0),d.rc(ae,!0),d.rc(se,!0),d.rc(ce,!0),d.rc(le,!0),d.rc(de,!0)),2&e){let e;d.fc(e=d.Xb())&&(t.drawerContent=e.first),d.fc(e=d.Xb())&&(t.searchDrawer=e.first),d.fc(e=d.Xb())&&(t.locationDrawer=e.first),d.fc(e=d.Xb())&&(t.routeDrawer=e.first),d.fc(e=d.Xb())&&(t.inNavigationDrawer=e.first),d.fc(e=d.Xb())&&(t.searchInput=e.first),d.fc(e=d.Xb())&&(t.navSlides=e.first)}},decls:112,vars:14,consts:function(){let e,t;return e="\xDCberpr\xFCfe deine Eingabe auf Rechtschreibfehler.",t="Sollte dieser Ort im Studi-Guide sein?\n        " + "\ufffd#8\ufffd\ufffd/#8\ufffd" + "\n        " + "\ufffd#9\ufffd" + "F\xFCge den Ort hinzu" + "\ufffd/#9\ufffd" + "\n      ",[[3,"nextSlide","previousSlide"],["navSlides",""],["data-tap-disabled","true","scroll-y","false"],["type","indeterminate","color","secondary",4,"ngIf"],["id","map-content"],["id","error-message",4,"ngIf"],["id","leafletMap"],["id","searchDrawer",3,"stateChange"],["searchDrawer",""],[1,"nav-bottom-drawer"],[1,"drawer-grip"],[1,"ion-padding-top"],[1,"nav-hbar"],[3,"discovery","route","searchBarFocus"],["searchInput",""],["drawerContent",""],["class","ion-no-padding",4,"ngIf"],[1,"ion-no-padding"],["button","",3,"click",4,"ngFor","ngForOf"],[1,"ion-padding-vertical"],["id","locationDrawer","state","DrawerState.Hidden"],["locationDrawer",""],[1,"ion-padding-bottom"],["id","locationdrawerContent"],[1,"ion-justify-content-between","ion-align-self-center"],[1,"ion-justify-content-end","ion-padding-horizontal"],["shape","round","color","medium",1,"square-sm","ion-no-padding","ion-float-right",3,"click"],["slot","icon-only","name","close-outline","size","small"],["color","primary","expand","block",3,"click"],["id","routeBtn","color","primary","expand","block",3,"click"],[4,"ngFor","ngForOf"],["id","routeDrawer","state","DrawerState.Hidden"],["routeDrawer",""],["color","success","expand","block",3,"click",4,"ngIf"],["id","inNavigationDrawer","state","DrawerState.Hidden"],["inNavigationDrawer",""],["color","danger","expand","block",3,"click"],["type","indeterminate","color","secondary"],["id","error-message"],[1,"error"],e,t,["href","https://github.com/Studi-Guide/Studi-Guide/issues/new/choose"],["button","",3,"click"],["color","success","expand","block",3,"click"]]},template:function(e,t){1&e&&(d.Kb(0,"app-navigation-instruction-slides",0,1),d.Wb("nextSlide",function(e){return t.onSlideChange(e)})("previousSlide",function(e){return t.onSlideChange(e)}),d.Jb(),d.Kb(2,"ion-content",2),d.mc(3,ue,1,0,"ion-progress-bar",3),d.Kb(4,"div",4),d.mc(5,he,10,1,"ion-text",5),d.Ib(6,"div",6),d.Jb(),d.Jb(),d.Kb(7,"app-ionic-bottom-drawer",7,8),d.Wb("stateChange",function(e){return t.onDrawerStateChange(e)}),d.Kb(9,"div",9),d.Kb(10,"div",10),d.Ib(11,"div",11),d.Ib(12,"div",12),d.Jb(),d.Kb(13,"app-search-input",13,14),d.Wb("discovery",function(e){return t.onSearch(e)})("route",function(e){return t.onRoute(e)})("searchBarFocus",function(e){return t.onSearchFocus(e)}),d.Jb(),d.Kb(15,"ion-content",null,15),d.mc(17,me,5,1,"ion-list",16),d.Kb(18,"ion-list",17),d.Kb(19,"ion-list-header"),d.Kb(20,"h2"),d.nc(21,"Choose a Campus"),d.Jb(),d.Jb(),d.mc(22,fe,6,3,"ion-item",18),d.Jb(),d.Ib(23,"div",19),d.Ib(24,"div",19),d.Ib(25,"div",19),d.Ib(26,"div",19),d.Ib(27,"div",19),d.Ib(28,"div",19),d.Jb(),d.Jb(),d.Jb(),d.Kb(29,"app-ionic-bottom-drawer",20,21),d.Kb(31,"div",9),d.Kb(32,"div",10),d.Ib(33,"div",11),d.Ib(34,"div",12),d.Ib(35,"div",22),d.Jb(),d.Kb(36,"ion-content"),d.Kb(37,"ion-grid",23),d.Kb(38,"ion-row",24),d.Kb(39,"ion-col"),d.Kb(40,"ion-label"),d.Kb(41,"h1"),d.nc(42),d.Jb(),d.Jb(),d.Kb(43,"ion-text"),d.nc(44),d.Jb(),d.Jb(),d.Kb(45,"ion-col",25),d.Kb(46,"ion-button",26),d.Wb("click",function(e){return t.onCloseLocationDrawer(e)}),d.Ib(47,"ion-icon",27),d.Jb(),d.Jb(),d.Jb(),d.Kb(48,"ion-row"),d.Kb(49,"ion-col"),d.Kb(50,"ion-button",28),d.Wb("click",function(){return t.detailsBtnClick()}),d.nc(51," Details "),d.Jb(),d.Jb(),d.Kb(52,"ion-col"),d.Kb(53,"ion-button",29),d.Wb("click",function(){return t.onRouteBtnClick()}),d.nc(54," Route "),d.Jb(),d.Jb(),d.Jb(),d.mc(55,pe,5,2,"ion-row",30),d.Jb(),d.Jb(),d.Jb(),d.Jb(),d.Kb(56,"app-ionic-bottom-drawer",31,32),d.Kb(58,"div",9),d.Kb(59,"div",10),d.Ib(60,"div",11),d.Ib(61,"div",12),d.Ib(62,"div",22),d.Kb(63,"ion-grid"),d.Kb(64,"ion-row",24),d.Kb(65,"ion-col"),d.Kb(66,"ion-label"),d.Kb(67,"h1"),d.nc(68),d.Jb(),d.Jb(),d.Kb(69,"ion-text"),d.nc(70,"From My Location"),d.Jb(),d.Jb(),d.Kb(71,"ion-col",25),d.Kb(72,"ion-button",26),d.Wb("click",function(e){return t.onCloseRouteDrawer(e)}),d.Ib(73,"ion-icon",27),d.Jb(),d.Jb(),d.Jb(),d.Kb(74,"ion-row"),d.Kb(75,"ion-col"),d.Kb(76,"ion-label"),d.Kb(77,"h2"),d.nc(78),d.Jb(),d.Jb(),d.Kb(79,"ion-text"),d.nc(80),d.Jb(),d.Jb(),d.Kb(81,"ion-col"),d.mc(82,ge,2,0,"ion-button",33),d.Jb(),d.Jb(),d.Jb(),d.Jb(),d.Kb(83,"ion-content"),d.Kb(84,"ion-list"),d.mc(85,ve,5,2,"ion-item",18),d.Jb(),d.Ib(86,"div",19),d.Ib(87,"div",19),d.Ib(88,"div",19),d.Ib(89,"div",19),d.Ib(90,"div",19),d.Ib(91,"div",19),d.Ib(92,"div",19),d.Ib(93,"div",19),d.Jb(),d.Jb(),d.Jb(),d.Kb(94,"app-ionic-bottom-drawer",34,35),d.Kb(96,"div",9),d.Kb(97,"div",10),d.Ib(98,"div",11),d.Ib(99,"div",12),d.Ib(100,"div",22),d.Kb(101,"ion-grid"),d.Kb(102,"ion-row"),d.Kb(103,"ion-col"),d.Kb(104,"ion-label"),d.Kb(105,"h2"),d.nc(106),d.Jb(),d.Jb(),d.Kb(107,"ion-text"),d.nc(108),d.Jb(),d.Jb(),d.Kb(109,"ion-col"),d.Kb(110,"ion-button",36),d.Wb("click",function(){return t.onEndRouteClick()}),d.nc(111," End Route "),d.Jb(),d.Jb(),d.Jb(),d.Jb(),d.Jb(),d.Jb(),d.Jb()),2&e&&(d.xb(3),d.dc("ngIf",t.progressIsVisible),d.xb(2),d.dc("ngIf",t.errorMessage),d.xb(12),d.dc("ngIf",t.model.recentSearches.length>0),d.xb(5),d.dc("ngForOf",t.availableCampus),d.xb(20),d.oc(t.model.latestSearchResult.Name),d.xb(2),d.oc(t.model.latestSearchResult.Description),d.xb(11),d.dc("ngForOf",t.model.latestSearchResult.Information),d.xb(13),d.pc("To ",t.model.latestSearchResult.Name,""),d.xb(10),d.pc("",t.model.Route.Time," min"),d.xb(2),d.pc("",t.model.Route.Distance," m"),d.xb(2),d.dc("ngIf",!t.UseDrawerForNavigation()),d.xb(3),d.dc("ngForOf",t.model.Route.NavigationInstructions),d.xb(21),d.pc("",t.model.Route.Time," min"),d.xb(2),d.pc("",t.model.Route.Distance," m"))},directives:[ne,o.p,r.j,J.a,D,o.B,o.C,r.i,o.u,o.I,o.o,o.A,o.R,o.h,o.w,o.E,o.y],styles:["#map-content[_ngcontent-%COMP%]{height:100%;width:100%;position:fixed}.error[_ngcontent-%COMP%]{color:red}#error-message[_ngcontent-%COMP%]{margin-left:20px}#leafletMap[_ngcontent-%COMP%]{height:100%;width:100%;z-index:0}#leafletMap[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}#available-floors-btn[_ngcontent-%COMP%]{position:fixed;bottom:0;display:block;z-index:10}.draggable[_ngcontent-%COMP%]{cursor:-webkit-grab;cursor:grab}.draggable[_ngcontent-%COMP%]:active{cursor:-webkit-grabbing;cursor:grabbing}.center[_ngcontent-%COMP%]{margin-left:auto;margin-right:auto;display:block}ion-progress-bar[_ngcontent-%COMP%]{position:absolute;z-index:9999}.vertical-line[_ngcontent-%COMP%]{border-left:2px solid #9d9fa6;height:38px}.nav-hbar[_ngcontent-%COMP%]{border-top:2px solid var(--ion-color-medium,#9d9fa6);border-bottom:2px solid var(--ion-color-medium,#9d9fa6);border-radius:2px;height:0;width:auto;margin:0 45%}.nav-bottom-drawer[_ngcontent-%COMP%]{background-color:var(--ion-color-white,#fff);border-top-left-radius:20px;border-top-right-radius:20px;box-shadow:0 4px 8px 0 rgba(0,0,0,.4),0 6px 20px 0 rgba(0,0,0,.29);height:inherit}.square-md[_ngcontent-%COMP%]{height:64px;width:64px}.square-sm[_ngcontent-%COMP%]{height:32px;width:32px}.square-xs[_ngcontent-%COMP%]{height:16px;width:16px}#locationdrawerContent[_ngcontent-%COMP%]{margin-left:30px;margin-right:30px;position:center}#locationdrawerName[_ngcontent-%COMP%]{font-weight:700}#inNavigationDrawer[_ngcontent-%COMP%]{z-index:1}#locationDrawer[_ngcontent-%COMP%]{z-index:2}#routeDrawer[_ngcontent-%COMP%]{z-index:3}#searchDrawer[_ngcontent-%COMP%]{z-index:4}"]}),e})(),xe=(()=>{class e{}return e.\u0275mod=d.Fb({type:e}),e.\u0275inj=d.Eb({factory:function(t){return new(t||e)},imports:[[o.V,r.b,a.a,i.i.forChild([{path:"detail",component:Y},{path:"",component:Se}]),Z]]}),e})();d.kc(Y,[o.v,o.U,o.i,o.f,o.g,o.p,r.j,o.E,o.R,x,J.a,D,o.u,o.C,o.I,o.o,o.h,o.w,o.B,r.i,o.y,o.A],[])},wyfB:function(e,t){function n(e){return e&&e.ownerSVGElement&&e.getCTM}e.exports=function(e,t){if(!n(e))throw new Error("svg element is required for svg.panzoom to work");var o=e.ownerSVGElement;if(!o)throw new Error("Do not apply panzoom to the root <svg> element. Use its child instead (e.g. <g></g>). As of March 2016 only FireFox supported transform on the root element");return t.disableKeyboardInteraction||o.setAttribute("tabindex",0),{getBBox:function(){var t=e.getBBox();return{left:t.x,top:t.y,width:t.width,height:t.height}},getScreenCTM:function(){return o.getCTM()||o.getScreenCTM()},getOwner:function(){return o},applyTransform:function(t){e.setAttribute("transform","matrix("+t.scale+" 0 0 "+t.scale+" "+t.x+" "+t.y+")")},initTransform:function(t){var n=e.getCTM();null===n&&(n=document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix()),t.x=n.e,t.y=n.f,t.scale=n.a,o.removeAttributeNS(null,"viewBox")}}},e.exports.canAttach=n}}]);