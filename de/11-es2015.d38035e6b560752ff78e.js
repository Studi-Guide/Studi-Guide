(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"0Tit":function(t,e){var n="function"==typeof Float32Array;function o(t,e){return 1-3*e+3*t}function i(t,e){return 3*e-6*t}function r(t){return 3*t}function a(t,e,n){return((o(e,n)*t+i(e,n))*t+r(e))*t}function s(t,e,n){return 3*o(e,n)*t*t+2*i(e,n)*t+r(e)}function c(t){return t}t.exports=function(t,e,o,i){if(!(0<=t&&t<=1&&0<=o&&o<=1))throw new Error("bezier x values must be in [0, 1] range");if(t===e&&o===i)return c;for(var r=n?new Float32Array(11):new Array(11),l=0;l<11;++l)r[l]=a(.1*l,t,o);return function(n){return 0===n?0:1===n?1:a(function(e){for(var n=0,i=1;10!==i&&r[i]<=e;++i)n+=.1;--i;var c=n+(e-r[i])/(r[i+1]-r[i])*.1,l=s(c,t,o);return l>=.001?function(t,e,n,o){for(var i=0;i<4;++i){var r=s(e,n,o);if(0===r)return e;e-=(a(e,n,o)-t)/r}return e}(e,c,t,o):0===l?c:function(t,e,n,o,i){var r,s,c=0;do{(r=a(s=e+(n-e)/2,o,i)-t)>0?n=s:e=s}while(Math.abs(r)>1e-7&&++c<10);return s}(e,n,n+.1,t,o)}(n),e,i)}}},"6f8I":function(t,e){function n(){return"function"==typeof cancelAnimationFrame?cancelAnimationFrame:clearTimeout}function o(){return"function"==typeof requestAnimationFrame?requestAnimationFrame:function(t){return setTimeout(t,16)}}t.exports=function(t,e,i){"object"!=typeof i&&(i={});var r,a,s,c,l,u,d,h,b,f,m="number"==typeof i.minVelocity?i.minVelocity:5,p="number"==typeof i.amplitude?i.amplitude:.25,g="function"==typeof i.cancelAnimationFrame?i.cancelAnimationFrame:n(),v="function"==typeof i.requestAnimationFrame?i.requestAnimationFrame:o();return{start:function(){r=t(),u=b=c=d=0,a=new Date,g(s),g(f),s=v(w)},stop:function(){g(s),g(f);var e=t();l=e.x,h=e.y,a=Date.now(),(c<-m||c>m)&&(l+=u=p*c),(d<-m||d>m)&&(h+=b=p*d),f=v(y)},cancel:function(){g(s),g(f)}};function w(){var e=Date.now(),n=e-a;a=e;var o=t(),i=o.x-r.x,l=o.y-r.y;r=o;var u=1e3/(1+n);c=.8*i*u+.2*c,d=.8*l*u+.2*d,s=v(w)}function y(){var t=Date.now()-a,n=!1,o=0,i=0;u&&((o=-u*Math.exp(-t/342))>.5||o<-.5?n=!0:o=u=0),b&&((i=-b*Math.exp(-t/342))>.5||i<-.5?n=!0:i=b=0),n&&(e(l+o,h+i),f=v(y))}}},AMdQ:function(t,e){t.exports=function(t){!function(t){if(!t)throw new Error("Eventify cannot use falsy object as events subject");for(var e=["on","fire","off"],n=0;n<e.length;++n)if(t.hasOwnProperty(e[n]))throw new Error("Subject cannot be eventified, since it already has property '"+e[n]+"'")}(t);var e=function(t){var e=Object.create(null);return{on:function(n,o,i){if("function"!=typeof o)throw new Error("callback is expected to be a function");var r=e[n];return r||(r=e[n]=[]),r.push({callback:o,ctx:i}),t},off:function(n,o){if(void 0===n)return e=Object.create(null),t;if(e[n])if("function"!=typeof o)delete e[n];else for(var i=e[n],r=0;r<i.length;++r)i[r].callback===o&&i.splice(r,1);return t},fire:function(n){var o,i=e[n];if(!i)return t;arguments.length>1&&(o=Array.prototype.splice.call(arguments,1));for(var r=0;r<i.length;++r){var a=i[r];a.callback.apply(a.ctx,o)}return t}}}(t);return t.on=e.on,t.off=e.off,t.fire=e.fire,t}},AgEI:function(t,e){function n(t){return t.stopPropagation(),!1}function o(){}t.exports=function(t){if(t)return{capture:o,release:o};var e,i,r,a=!1;return{capture:function(t){a=!0,i=window.document.onselectstart,r=window.document.ondragstart,window.document.onselectstart=n,(e=t).ondragstart=n},release:function(){a&&(a=!1,window.document.onselectstart=i,e&&(e.ondragstart=r))}}}},QIvw:function(t,e){t.exports=function(){this.x=0,this.y=0,this.scale=1}},Vkd7:function(t,e){function n(t){return t&&t.parentElement&&t.style}t.exports=function(t,e){if(!n(t))throw new Error("panzoom requires DOM element to be attached to the DOM tree");var o=t.parentElement;return t.scrollTop=0,e.disableKeyboardInteraction||o.setAttribute("tabindex",0),{getBBox:function(){return{left:0,top:0,width:t.clientWidth,height:t.clientHeight}},getOwner:function(){return o},applyTransform:function(e){t.style.transformOrigin="0 0 0",t.style.transform="matrix("+e.scale+", 0, 0, "+e.scale+", "+e.x+", "+e.y+")"}}},t.exports.canAttach=n},cQc6:function(t,e){t.exports=function(t,e){for(var n=t[0],o=t[1],i=!1,r=0,a=e.length-1;r<e.length;a=r++){var s=e[r][0],c=e[r][1],l=e[a][1];c>o!=l>o&&n<(e[a][0]-s)*(o-c)/(l-c)+s&&(i=!i)}return i}},dwjH:function(t,e,n){var o=n("0Tit"),i={ease:o(.25,.1,.25,1),easeIn:o(.42,0,1,1),easeOut:o(0,0,.58,1),easeInOut:o(.42,0,.58,1),linear:o(0,0,1,1)};function r(){}function a(){var t=new Set,e=new Set,n=0;return{next:o,cancel:o,clearAll:function(){t.clear(),e.clear(),cancelAnimationFrame(n),n=0}};function o(t){e.add(t),n||(n=requestAnimationFrame(i))}function i(){n=0;var o=e;e=t,(t=o).forEach(function(t){t()}),t.clear()}}t.exports=function(t,e,n){var o=Object.create(null),a=Object.create(null),s="function"==typeof(n=n||{}).easing?n.easing:i[n.easing];s||(n.easing&&console.warn("Unknown easing function in amator: "+n.easing),s=i.ease);var c="function"==typeof n.step?n.step:r,l="function"==typeof n.done?n.done:r,u=function(t){if(!t)return"undefined"!=typeof window&&window.requestAnimationFrame?{next:window.requestAnimationFrame.bind(window),cancel:window.cancelAnimationFrame.bind(window)}:{next:function(t){return setTimeout(t,1e3/60)},cancel:function(t){return clearTimeout(t)}};if("function"!=typeof t.next)throw new Error("Scheduler is supposed to have next(cb) function");if("function"!=typeof t.cancel)throw new Error("Scheduler is supposed to have cancel(handle) function");return t}(n.scheduler),d=Object.keys(e);d.forEach(function(n){o[n]=t[n],a[n]=e[n]-t[n]});var h,b=Math.max(1,.06*("number"==typeof n.duration?n.duration:400)),f=0;return h=u.next(function e(){var n=s(f/b);f+=1,function(e){d.forEach(function(n){t[n]=a[n]*e+o[n]})}(n),f<=b?(h=u.next(e),c(t)):(h=0,setTimeout(function(){l(t)},0))}),{cancel:function(){u.cancel(h),h=0}}},t.exports.makeAggregateRaf=a,t.exports.sharedScheduler=a()},fQX0:function(t,e,n){"use strict";var o=n("fWck"),i=n("dwjH"),r=n("AMdQ"),a=n("6f8I"),s=n("AgEI"),c=s(),l=s(!0),u=n("QIvw"),d=n("wyfB"),h=n("Vkd7");function b(t,e){var n=(e=e||{}).controller;if(n||(d.canAttach(t)?n=d(t,e):h.canAttach(t)&&(n=h(t,e))),!n)throw new Error("Cannot create panzoom for the current type of dom element");var s=n.getOwner(),b={x:0,y:0},m=!1,w=new u;n.initTransform&&n.initTransform(w);var y,S="function"==typeof e.filterKey?e.filterKey:p,C="number"==typeof e.pinchSpeed?e.pinchSpeed:1,x=e.bounds,I="number"==typeof e.maxZoom?e.maxZoom:Number.POSITIVE_INFINITY,R="number"==typeof e.minZoom?e.minZoom:0,M="number"==typeof e.boundsPadding?e.boundsPadding:.05,k="number"==typeof e.zoomDoubleClickSpeed?e.zoomDoubleClickSpeed:1.75,O=e.beforeWheel||p,L=e.beforeMouseDown||p,K="number"==typeof e.zoomSpeed?e.zoomSpeed:1,D=f(e.transformOrigin),F=e.enableTextSelection?l:c;!function(t){var e=typeof t;if("undefined"!==e&&"boolean"!==e&&!(g(t.left)&&g(t.top)&&g(t.bottom)&&g(t.right)))throw new Error("Bounds object is not valid. It can be: undefined, boolean (true|false) or an object {left, top, right, bottom}")}(x),e.autocenter&&function(){var t,e,o=0,i=0,r=Q();if(r)o=r.left,i=r.top,t=r.right-r.left,e=r.bottom-r.top;else{var a=s.getBoundingClientRect();t=a.width,e=a.height}var c=n.getBBox();if(0!==c.width&&0!==c.height){var l=Math.min(t/c.width,e/c.height);w.x=-(c.left+c.width/2)*l+t/2+o,w.y=-(c.top+c.height/2)*l+e/2+i,w.scale=l}}();var J,P,N,B,T,E,_,A,V=0,j=!1,z=!1;T="smoothScroll"in e&&!e.smoothScroll?{start:p,stop:p,cancel:p}:a(function(){return{x:w.x,y:w.y}},function(t,e){It(),Z(t,e)},e.smoothScroll);var W=!1;it();var X={dispose:function(){rt()},moveBy:ot,moveTo:Z,smoothMoveTo:function(t,e){ot(t-w.x,e-w.y,!0)},centerOn:function(t){var e=t.ownerSVGElement;if(!e)throw new Error("ui element is required to be within the scene");var n=t.getBoundingClientRect(),o=n.left+n.width/2,i=n.top+n.height/2,r=e.getBoundingClientRect();ot(r.width/2-o,r.height/2-i,!0)},zoomTo:xt,zoomAbs:nt,smoothZoom:St,smoothZoomAbs:function(t,e,n){var o={scale:w.scale},r={scale:n};T.cancel(),It(),_=i(o,r,{step:function(n){nt(t,e,n.scale)}})},showRectangle:function(t){var e=s.getBoundingClientRect(),n=q(e.width,e.height),o=t.right-t.left,i=t.bottom-t.top;if(!Number.isFinite(o)||!Number.isFinite(i))throw new Error("Invalid rectangle");var r=Math.min(n.x/o,n.y/i);w.x=-(t.left+o/2)*r+n.x/2,w.y=-(t.top+i/2)*r+n.y/2,w.scale=r},pause:function(){rt(),W=!0},resume:function(){W&&(it(),W=!1)},isPaused:function(){return W},getTransform:function(){return w},getMinZoom:function(){return R},setMinZoom:function(t){R=t},getMaxZoom:function(){return I},setMaxZoom:function(t){I=t},getTransformOrigin:function(){return D},setTransformOrigin:function(t){D=f(t)},getZoomSpeed:function(){return K},setZoomSpeed:function(t){if(!Number.isFinite(t))throw new Error("Zoom speed should be a number");K=t}};r(X);var H="number"==typeof e.initialX?e.initialX:w.x,Y="number"==typeof e.initialY?e.initialY:w.y,G="number"==typeof e.initialZoom?e.initialZoom:w.scale;return H==w.x&&Y==w.y&&G==w.Scale||nt(H,Y,G),X;function q(t,e){if(n.getScreenCTM){var o=n.getScreenCTM(),i=o.d,r=o.f;b.x=t*o.a-o.e,b.y=e*i-r}else b.x=t,b.y=e;return b}function Z(t,e){w.x=t,w.y=e,U(),Lt("pan"),tt()}function $(t,e){Z(w.x+t,w.y+e)}function U(){var t=Q();if(t){var e,o,i=!1,r={left:(o={x:(e=n.getBBox()).left*w.scale+w.x,y:e.top*w.scale+w.y}).x,top:o.y,right:e.width*w.scale+o.x,bottom:e.height*w.scale+o.y},a=t.left-r.right;return a>0&&(w.x+=a,i=!0),(a=t.right-r.left)<0&&(w.x+=a,i=!0),(a=t.top-r.bottom)>0&&(w.y+=a,i=!0),(a=t.bottom-r.top)<0&&(w.y+=a,i=!0),i}}function Q(){if(x){if("boolean"==typeof x){var t=s.getBoundingClientRect(),e=t.width,n=t.height;return{left:e*M,top:n*M,right:e*(1-M),bottom:n*(1-M)}}return x}}function tt(){m=!0,y=window.requestAnimationFrame(at)}function et(t,e,n){if(v(t)||v(e)||v(n))throw new Error("zoom requires valid numbers");var o=w.scale*n;if(o<R){if(w.scale===R)return;n=R/w.scale}if(o>I){if(w.scale===I)return;n=I/w.scale}var i=q(t,e);w.x=i.x-n*(i.x-w.x),w.y=i.y-n*(i.y-w.y),x&&1===M&&1===R?(w.scale*=n,U()):U()||(w.scale*=n),Lt("zoom"),tt()}function nt(t,e,n){et(t,e,n/w.scale)}function ot(t,e,n){if(!n)return $(t,e);E&&E.cancel();var o=0,r=0;E=i({x:0,y:0},{x:t,y:e},{step:function(t){$(t.x-o,t.y-r),o=t.x,r=t.y}})}function it(){s.addEventListener("mousedown",ft,{passive:!1}),s.addEventListener("dblclick",bt,{passive:!1}),s.addEventListener("touchstart",ct,{passive:!1}),s.addEventListener("keydown",st,{passive:!1}),o.addWheelListener(s,wt,{passive:!1}),tt()}function rt(){o.removeWheelListener(s,wt),s.removeEventListener("mousedown",ft),s.removeEventListener("keydown",st),s.removeEventListener("dblclick",bt),s.removeEventListener("touchstart",ct),y&&(window.cancelAnimationFrame(y),y=0),T.cancel(),gt(),vt(),F.release(),kt()}function at(){m&&(m=!1,n.applyTransform(w),Lt("transform"),y=0)}function st(t){var e=0,n=0,o=0;if(38===t.keyCode?n=1:40===t.keyCode?n=-1:37===t.keyCode?e=1:39===t.keyCode?e=-1:189===t.keyCode||109===t.keyCode?o=1:187!==t.keyCode&&107!==t.keyCode||(o=-1),!S(t,e,n,o)){if(e||n){t.preventDefault(),t.stopPropagation();var i=s.getBoundingClientRect();ot(.05*(r=Math.min(i.width,i.height))*e,.05*r*n)}if(o){var r,a=Rt(100*o);xt((r=D?Ct():{x:(c=s.getBoundingClientRect()).width/2,y:c.height/2}).x,r.y,a)}var c}}function ct(t){if(function(t){e.onTouch&&!e.onTouch(t)||(t.stopPropagation(),t.preventDefault())}(t),1===t.touches.length)return function(t){var e=yt(t.touches[0]);J=e;var n=q(e.x,e.y);P=n.x,N=n.y,T.cancel(),lt()}(t);2===t.touches.length&&(B=ht(t.touches[0],t.touches[1]),A=!0,lt())}function lt(){j||(j=!0,document.addEventListener("touchmove",ut),document.addEventListener("touchend",dt),document.addEventListener("touchcancel",dt))}function ut(t){if(1===t.touches.length){t.stopPropagation();var e=q((u=yt(t.touches[0])).x,u.y),n=e.x-P,o=e.y-N;0!==n&&0!==o&&Mt(),P=e.x,N=e.y,ot(n,o)}else if(2===t.touches.length){A=!0;var i=t.touches[0],r=t.touches[1],a=ht(i,r),s=1+(a/B-1)*C,c=yt(i),l=yt(r);if(P=(c.x+l.x)/2,N=(c.y+l.y)/2,D){var u=Ct();P=u.x,N=u.y}xt(P,N,s),B=a,t.stopPropagation(),t.preventDefault()}}function dt(t){if(t.touches.length>0){var e=q((n=yt(t.touches[0])).x,n.y);P=e.x,N=e.y}else{var n,o=new Date;o-V<300&&(D?St((n=Ct()).x,n.y,k):St(J.x,J.y,k)),V=o,kt(),vt()}}function ht(t,e){var n=t.clientX-e.clientX,o=t.clientY-e.clientY;return Math.sqrt(n*n+o*o)}function bt(t){!function(t){e.onDoubleClick&&!e.onDoubleClick(t)||(t.preventDefault(),t.stopPropagation())}(t);var n=yt(t);D&&(n=Ct()),St(n.x,n.y,k)}function ft(t){if(!L(t)){if(j)return t.stopPropagation(),!1;if(1===t.button&&null!==window.event||0===t.button){T.cancel();var e=yt(t),n=q(e.x,e.y);return P=n.x,N=n.y,document.addEventListener("mousemove",mt),document.addEventListener("mouseup",pt),F.capture(t.target||t.srcElement),!1}}}function mt(t){if(!j){Mt();var e=yt(t),n=q(e.x,e.y),o=n.x-P,i=n.y-N;P=n.x,N=n.y,ot(o,i)}}function pt(){F.release(),kt(),gt()}function gt(){document.removeEventListener("mousemove",mt),document.removeEventListener("mouseup",pt),z=!1}function vt(){document.removeEventListener("touchmove",ut),document.removeEventListener("touchend",dt),document.removeEventListener("touchcancel",dt),z=!1,A=!1,j=!1}function wt(t){if(!O(t)){T.cancel();var e=t.deltaY;t.deltaMode>0&&(e*=100);var n=Rt(e);if(1!==n){var o=D?Ct():yt(t);xt(o.x,o.y,n),t.preventDefault()}}}function yt(t){var e=s.getBoundingClientRect();return{x:t.clientX-e.left,y:t.clientY-e.top}}function St(t,e,n){var o=w.scale,r={scale:o},a={scale:n*o};T.cancel(),It(),_=i(r,a,{step:function(n){nt(t,e,n.scale)},done:Ot})}function Ct(){var t=s.getBoundingClientRect();return{x:t.width*D.x,y:t.height*D.y}}function xt(t,e,n){return T.cancel(),It(),et(t,e,n)}function It(){_&&(_.cancel(),_=null)}function Rt(t){return 1-Math.sign(t)*Math.min(.25,Math.abs(K*t/128))}function Mt(){z||(Lt("panstart"),z=!0,T.start())}function kt(){z&&(A||T.stop(),Lt("panend"))}function Ot(){Lt("zoomend")}function Lt(t){X.fire(t,X)}}function f(t){if(t)return"object"==typeof t?(g(t.x)&&g(t.y)||m(t),t):void m()}function m(t){throw console.error(t),new Error(["Cannot parse transform origin.","Some good examples:",'  "center center" can be achieved with {x: 0.5, y: 0.5}','  "top center" can be achieved with {x: 0.5, y: 0}','  "bottom right" can be achieved with {x: 1, y: 1}'].join("\n"))}function p(){}function g(t){return Number.isFinite(t)}function v(t){return Number.isNaN?Number.isNaN(t):t!=t}t.exports=b,function(){if("undefined"!=typeof document){var t=document.getElementsByTagName("script");if(t){for(var e,n=0;n<t.length;++n){var o=t[n];if(o.src&&o.src.match(/\bpanzoom(\.min)?\.js/)){e=o;break}}if(e){var i=e.getAttribute("query");if(i){var r=e.getAttribute("name")||"pz",a=Date.now();!function t(){var n=document.querySelector(i);if(!n)return Date.now()-a<2e3?void setTimeout(t,100):void console.error("Cannot find the panzoom element",r);var o=function(t){for(var e=t.attributes,n={},o=0;o<e.length;++o){var i=s(e[o]);i&&(n[i.name]=i.value)}return n}(e);console.log(o),window[r]=b(n,o)}()}}}}function s(t){if(t.name&&"p"===t.name[0]&&"z"===t.name[1]&&"-"===t.name[2])return{name:t.name.substr(3),value:JSON.parse(t.value)}}}()},fWck:function(t,e){function n(t,e,n){t.addEventListener("wheel",e,n)}t.exports=n,t.exports.addWheelListener=n,t.exports.removeWheelListener=function(t,e,n){t.removeEventListener("wheel",e,n)}},sO0u:function(t,e,n){"use strict";n.r(e),n.d(e,"NavigationPageModule",function(){return Bt});var o=n("TEn/"),i=n("tyNb"),r=n("ofXK"),a=n("3Pt+"),s=n("mrSG"),c=n("EnSQ"),l=n("WdNr"),u=n("fXoL");class d{constructor(t){this.icon=t}render(t,e,n,o,i){const r=new Image;r.onload=()=>{t.drawImage(r,e,n,o,i)},r.src="assets/"+this.icon}}var h=n("cQc6");class b{constructor(t){this.mapItem=t,this.doAnim=!1}get MapItem(){return this.mapItem}render(t){this.mapItem.Sections&&this.mapItem.Sections.length>0&&(t.beginPath(),this.renderSections(t),t.strokeStyle="#FFF",t.fillStyle=this.mapItem.Color,t.stroke(),t.fill(),t.closePath())}startAnimation(t,e){this.animationCallback=()=>{if(!0!==this.doAnim)return;t.save();const n=new Date;if(t.beginPath(),this.renderSections(t),t.lineWidth=1,t.strokeStyle=n.getSeconds()%2==0?"#FFF":"#000",t.fillStyle=n.getSeconds()%2==0?"#000":this.mapItem.Color,t.stroke(),t.fill(),t.closePath(),t.restore(),window.requestAnimationFrame(this.animationCallback),void 0!==e&&void 0!==e.renderer&&void 0!==e.floor)for(const o of e.renderer)o.render(t,e)},this.doAnim=!0,window.requestAnimationFrame(this.animationCallback)}stopAnimation(t){this.doAnim=!1,this.animationCallback=null}renderSections(t){t.moveTo(this.mapItem.Sections[0].Start.X,this.mapItem.Sections[0].Start.Y);for(let e=1;e<this.mapItem.Sections.length;e++)t.lineTo(this.mapItem.Sections[e].Start.X,this.mapItem.Sections[e].Start.Y);t.lineTo(this.mapItem.Sections[0].Start.X,this.mapItem.Sections[0].Start.Y)}}class f{constructor(t){this.location=t}get Location(){return this.location}render(t){t.font="12px Arial",t.textAlign="center",t.fillStyle="#000",t.fillText(this.location.Name,this.location.PathNode.Coordinate.X,this.location.PathNode.Coordinate.Y)}startAnimation(t){}stopAnimation(t){}}class m{constructor(t){this.route=t}get Route(){return this.route}render(t,e){const n=new d("pin-sharp.png");this.route.Start.Floor===e.floor&&n.render(t,this.route.Start.Node.Coordinate.X-15,this.route.Start.Node.Coordinate.Y-30,30,30);const o=new d("flag-sharp.png");this.route.End.Floor===e.floor&&o.render(t,this.route.End.Node.Coordinate.X-5,this.route.End.Node.Coordinate.Y-30,30,30);const i=this.route.RouteSections.filter(t=>t.Floor===e.floor);if(null!=i){for(const e of i){t.strokeStyle="#A00",t.lineWidth=3,t.beginPath(),t.moveTo(e.Route[0].Coordinate.X,e.Route[0].Coordinate.Y);for(let n=1;n<e.Route.length;n++)t.lineTo(e.Route[n].Coordinate.X,e.Route[n].Coordinate.Y);t.stroke(),t.closePath()}for(const e of i){const n=e.Route.length,o=e.Distance,i=e.Route[Math.round((n-1)/2)].Coordinate.X,r=e.Route[Math.round((n-1)/2)].Coordinate.Y,a="14px Arial",s=t.measureText(o.toString()).width+14,c=parseInt("14px Arial",10)+14;t.fillStyle="#A00",t.fillRect(i-s/2,r-c/2,s,20),t.font=a,t.fillStyle="#FFF",t.fillText(o.toString(),i,r)}}}startAnimation(t){}stopAnimation(t){}}class p{static GetMapItemRendererCanvas(...t){const e=[];for(const n of t)e.push(new b(n));return e}static GetLocationRendererCanvas(...t){const e=[];for(const n of t)e.push(new f(n));return e}static GetRouteRendererCanvas(...t){const e=[];for(const n of t)e.push(new m(n));return e}}var g=n("fQX0"),v=n.n(g);const w=["fab"];function y(t,e){if(1&t){const t=u.Lb();u.Kb(0,"ion-fab-button",4),u.Wb("click",function(){u.ic(t);const n=e.index;return u.Yb().emitAnotherFloorToShow(n)}),u.Ib(1,"span",5),u.Jb()}if(2&t){const t=e.$implicit;u.xb(1),u.dc("innerHTML",t,u.jc)}}let S=(()=>{class t{constructor(t){this._dataService=t,this.floorWithBuilding=new u.o}ngOnInit(){}ngOnChanges(t){return Object(s.a)(this,void 0,void 0,function*(){if(void 0!==t.currentBuilding&&void 0!==this.currentBuilding){const t=yield this._dataService.get_building(this.currentBuilding).toPromise();this.availableFloors=t.Floors}})}emitAnotherFloorToShow(t){return Object(s.a)(this,void 0,void 0,function*(){this.floorWithBuilding.emit({floor:this.availableFloors[t],building:this.currentBuilding}),this.currentFloor=this.availableFloors[t]})}}return t.\u0275fac=function(e){return new(e||t)(u.Hb(c.a))},t.\u0275cmp=u.Bb({type:t,selectors:[["app-floor-button"]],viewQuery:function(t,e){if(1&t&&u.sc(w,!0),2&t){let t;u.fc(t=u.Xb())&&(e.fab=t.first)}},inputs:{currentBuilding:"currentBuilding",currentFloor:"currentFloor"},outputs:{floorWithBuilding:"floorWithBuilding"},features:[u.vb],decls:7,vars:3,consts:[["vertical","top","horizontal","end","slot","fixed"],["fab",""],["side","bottom"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],[3,"innerHTML"]],template:function(t,e){1&t&&(u.Kb(0,"ion-fab",0,1),u.Kb(2,"ion-fab-button"),u.Kb(3,"span"),u.oc(4),u.Jb(),u.Jb(),u.Kb(5,"ion-fab-list",2),u.nc(6,y,2,1,"ion-fab-button",3),u.Jb(),u.Jb()),2&t&&(u.xb(4),u.rc("",e.currentBuilding,".",e.currentFloor,""),u.xb(2),u.dc("ngForOf",e.availableFloors))},directives:[o.q,o.r,o.s,r.i],styles:[""]}),t})(),C=(()=>{class t{constructor(t){this.dataService=t,this.clickThreshold=20,this.mapItemRenderer=[],this.locationRenderer=[],this.routeRenderer=[],this.locationClick=new u.o,this.mapScroll=new u.o}get CurrentRoute(){return this.currentRoute}get CurrentBuilding(){return this.currentBuilding}ngAfterViewInit(){const t=this;this.panZoomController||(this.panZoomController=v()(document.getElementById("map"),{maxZoom:2,minZoom:.25,initialZoom:.7,bounds:!0,boundsPadding:.1,onTouch(e){return Object(s.a)(this,void 0,void 0,function*(){return 1===e.touches.length&&(yield t.onElementClick(e.touches[0].clientX,e.touches[0].clientY,e.target)),!1})}}))}showRoute(t,e){return Object(s.a)(this,void 0,void 0,function*(){this.stopAllAnimations(),yield this.renderNavigationPage(t,e.Building,e.Floor)})}showDiscoveryLocation(t){return Object(s.a)(this,void 0,void 0,function*(){this.stopAllAnimations();const e=yield this.dataService.get_locations_search(t).toPromise();if(null===e||0===e.length)throw new Error("Studi-Guide can't find "+t);const n=e[0];this.currentBuilding=n.Building;const o=yield this.dataService.get_map_floor(this.currentBuilding,n.Floor).toPromise();this.mapItemRenderer=p.GetMapItemRendererCanvas(...o);const i=yield this.dataService.get_locations(n.Building,n.Floor).toPromise();return this.locationRenderer=p.GetLocationRendererCanvas(...i),this.clearMapCanvas(),this.createNewCanvasMap(),this.renderMapItems(),this.renderLocations(),this.displayPin(n.PathNode),this.currentFloor=n.Floor,this.CenterMap(n.PathNode.Coordinate.X,n.PathNode.Coordinate.Y),n})}showFloor(t,e){return Object(s.a)(this,void 0,void 0,function*(){if(this.stopAllAnimations(),null!=this.currentRoute)yield this.renderNavigationPage(this.currentRoute,this.currentBuilding,t);else{const n=yield this.dataService.get_map_items("",t,e).toPromise();this.mapItemRenderer=p.GetMapItemRendererCanvas(...n),this.createNewCanvasMap();const o=yield this.dataService.get_locations_items("",t,e).toPromise();this.locationRenderer=p.GetLocationRendererCanvas(...o),this.renderMapItems(),this.renderLocations()}this.currentFloor=t,this.currentBuilding=e,this.FitMap()})}showDiscoveryMap(t,e){return Object(s.a)(this,void 0,void 0,function*(){const n=yield this.dataService.get_map_items(t,e,"").toPromise();this.mapItemRenderer=p.GetMapItemRendererCanvas(...n);const o=yield this.dataService.get_locations_items(t,e,"").toPromise();this.locationRenderer=p.GetLocationRendererCanvas(...o),this.createNewCanvasMap(),this.renderMapItems(),this.renderLocations(),this.currentFloor=e,this.FitMap()})}clearMapCanvas(){const t=document.getElementById("map").getContext("2d");null!=t&&t.clearRect(0,0,t.canvas.width,t.canvas.height)}onClick(t){return Object(s.a)(this,void 0,void 0,function*(){yield this.onElementClick(t.clientX,t.clientY,t.target)})}onElementClick(t,e,n){return Object(s.a)(this,void 0,void 0,function*(){const o=this.panZoomController.getTransform(),i=class{static transformInOriginCoordinate(t,e,n){const o=n.getBoundingClientRect(),i=(t.x-o.left)/e,r=(t.y-o.top)/e;return console.log("Transform x:"+t.x+" y:"+t.y+"  to coordinate: x:"+i+" y:"+r),{x:i,y:r}}}.transformInOriginCoordinate({x:t,y:e},o.scale,n),r=[i.x,i.y];if(null!=this.currentRoute){const t=[];for(const e of this.getInteractiveStairWellMapItemRenderer(this.currentFloor))t.push(e.MapItem);for(const e of t){const t=[];for(const n of e.Sections)t.push([n.Start.X,n.Start.Y]);if(h(r,t))return void(yield this.showNextFloor(e))}}for(const t of this.locationRenderer){const e=t.Location;if(Math.abs(e.PathNode.Coordinate.X-r[0])<this.clickThreshold&&Math.abs(e.PathNode.Coordinate.Y-r[1])<this.clickThreshold)return void this.locationClick.emit(e)}})}renderNavigationPage(t,e,n){var o,i;return Object(s.a)(this,void 0,void 0,function*(){let r=null!==(o=yield this.dataService.get_map_floor(e,n).toPromise())&&void 0!==o?o:new Array,a=null!==(i=yield this.dataService.get_locations(e,n).toPromise())&&void 0!==i?i:new Array;for(const o of t.RouteSections)if(o.Floor===n&&o.Building!==e){const t=yield this.dataService.get_map_floor(o.Building,o.Floor).toPromise();r=r.concat(t);const e=yield this.dataService.get_locations(o.Building,o.Floor).toPromise();a=a.concat(e)}this.mapItemRenderer=p.GetMapItemRendererCanvas(...r),this.locationRenderer=p.GetLocationRendererCanvas(...a),this.routeRenderer=p.GetRouteRendererCanvas(t),this.createNewCanvasMap(),this.currentBuilding=e,this.renderMapItems(),this.renderLocations(),this.renderRoutes({floor:n});for(const t of this.getInteractiveStairWellMapItemRenderer(n))t.startAnimation(this.renderingContext,{renderer:this.routeRenderer,floor:n});this.currentRoute=t,this.currentFloor=n})}createNewCanvasMap(){const t=document.getElementById("map");let e=0,n=0;for(const o of this.mapItemRenderer){const t=o.MapItem;if(t.Sections)for(const o of t.Sections)o.End.X>n&&(n=o.End.X),o.End.Y>e&&(e=o.End.Y);if(t.PathNodes)for(const o of t.PathNodes)o.Coordinate.X>n&&(n=o.Coordinate.X),o.Coordinate.Y>e&&(e=o.Coordinate.Y)}this.renderingContext=class{static setup(t,e,n){const o=this.GetPixelRatio();return t.width=e*o,t.height=n*o,t.style.width=e+"px",t.style.height=n+"px",this.getContext(t)}static getContext(t){const e=this.GetPixelRatio(),n=t.getContext("2d");return n.scale(e,e),n}static GetPixelRatio(){return window.devicePixelRatio||1}}.setup(t,n,e)}displayPin(t){const e=t.Coordinate.X-15,n=t.Coordinate.Y-30;new d("pin-sharp.png").render(this.renderingContext,e,n,30,30)}showNextFloor(t){return Object(s.a)(this,void 0,void 0,function*(){for(let e=0;e<this.currentRoute.RouteSections.length-1;e++)if(this.currentRoute.RouteSections[e].Floor===t.Floor&&this.currentRoute.RouteSections[e].Building===t.Building)return this.currentFloor=this.currentRoute.RouteSections[e+1].Floor,this.currentBuilding=this.currentRoute.RouteSections[e+1].Building,void(yield this.showFloor(this.currentFloor,this.currentBuilding))})}getInteractiveStairWellMapItemRenderer(t){const e=[];for(const o of this.routeRenderer)for(let t=0;t<o.Route.RouteSections.length-1;t++)o.Route.RouteSections[t].Building===o.Route.RouteSections[t+1].Building&&e.push(o.Route.RouteSections[t].Route[o.Route.RouteSections[t].Route.length-1]);const n=[];for(const o of e)for(const e of this.mapItemRenderer)e.MapItem.Floor===t&&e.MapItem.PathNodes.filter(t=>t.Id===o.Id).length>0&&n.push(e);return n}stopAllAnimations(){for(const t of this.routeRenderer)t.stopAnimation(this.renderingContext);for(const t of this.mapItemRenderer)t.stopAnimation(this.renderingContext);for(const t of this.locationRenderer)t.stopAnimation(this.renderingContext)}renderMapItems(){for(const t of this.mapItemRenderer)t.render(this.renderingContext)}renderLocations(){for(const t of this.locationRenderer)t.render(this.renderingContext)}renderRoutes(t){for(const e of this.routeRenderer)e.render(this.renderingContext,t)}onFloorChangeByFloorButton(t){return Object(s.a)(this,void 0,void 0,function*(){yield this.showAnotherFloorOfCurrentBuilding(t.floor,t.building)})}showAnotherFloorOfCurrentBuilding(t,e){return Object(s.a)(this,void 0,void 0,function*(){G.progressIsVisible=!0,yield this.showFloor(t,e),G.progressIsVisible=!1})}CenterMap(t,e){const n=this.calulateMovePosition(t,e);this.panZoomController.smoothMoveTo(n.x,n.y)}calulateMovePosition(t,e){const n=document.getElementById("canvas-wrapper");return{x:n.clientWidth/2-t,y:n.parentElement.parentElement.clientHeight/2-e}}MapSize(){return document.getElementById("map").getBoundingClientRect()}FitMap(){const t=this.MapSize();this.CenterMap(t.width/2,t.height/2)}}return t.\u0275fac=function(e){return new(e||t)(u.Hb(c.a))},t.\u0275cmp=u.Bb({type:t,selectors:[["app-map-view"]],outputs:{locationClick:"locationClick",mapScroll:"mapScroll"},decls:4,vars:2,consts:[["id","canvas-wrapper",1,"draggable"],[3,"currentBuilding","currentFloor","floorWithBuilding"],["id","map",3,"click"],["map",""]],template:function(t,e){1&t&&(u.Kb(0,"div",0),u.Kb(1,"app-floor-button",1),u.Wb("floorWithBuilding",function(t){return e.onFloorChangeByFloorButton(t)}),u.Jb(),u.Kb(2,"canvas",2,3),u.Wb("click",function(t){return e.onClick(t)}),u.Jb(),u.Jb()),2&t&&(u.xb(1),u.dc("currentBuilding",e.CurrentBuilding)("currentFloor",e.currentFloor))},directives:[S],styles:["body[_ngcontent-%COMP%], html[_ngcontent-%COMP%]{height:100%;width:100%}#canvas-wrapper[_ngcontent-%COMP%]{padding:2px;overflow:hidden;scrollbar-width:none;-ms-overflow-style:none}#canvas-wrapper[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.draggable[_ngcontent-%COMP%]{cursor:-webkit-grab;cursor:grab}.draggable[_ngcontent-%COMP%]:active{cursor:-webkit-grabbing;cursor:grabbing}"]}),t})();var x=n("tk/3");const I=["destinationSearchbar"],R=["startSearchBar"];function M(t,e){if(1&t){const t=u.Lb();u.Kb(0,"ion-button",8),u.Wb("click",function(){return u.ic(t),u.Yb().emitDiscoveryEvent()}),u.Ib(1,"ion-icon",9),u.Jb()}}function k(t,e){1&t&&u.Ib(0,"span",10)}function O(t,e){if(1&t){const t=u.Lb();u.Kb(0,"ion-button",5),u.Wb("click",function(){return u.ic(t),u.Yb(2).hideRouteSearchBar()}),u.Ib(1,"ion-icon",14),u.Jb()}}function L(t,e){if(1&t){const t=u.Lb();u.Kb(0,"ion-item",0),u.Kb(1,"ion-searchbar",11,12),u.Wb("click",function(){return u.ic(t),u.Yb().onSearchBarHasFocus("startSearchBar")})("keydown",function(e){return u.ic(t),u.Yb().onKey(e,"startSearchBar")},!1,u.hc),u.Jb(),u.nc(3,O,2,0,"ion-button",13),u.Jb()}if(2&t){const t=u.Yb();u.xb(1),u.dc("value",t.startSearchBarValue),u.xb(2),u.dc("ngIf",t.closeRouteBtnIsVisible)}}let K=(()=>{class t{constructor(){this.discovery=new u.o,this.route=new u.o,this.searchBarFocus=new u.o,this.searchBtnIsVisible=!0,this.routeInputIsVisible=!1,this.closeRouteBtnIsVisible=!1}ngOnInit(){}showRouteSearchBar(){this.routeInputIsVisible=!0,this.searchBtnIsVisible=!1,this.closeRouteBtnIsVisible=!0}hideRouteSearchBar(){this.routeInputIsVisible&&(this.routeInputIsVisible=!1,this.searchBtnIsVisible=!0,this.closeRouteBtnIsVisible=!1)}routeBtnClick(){this.routeInputIsVisible?this.emitRouteEvent():this.showRouteSearchBar()}emitDiscoveryEvent(){let t=""===this.destinationSearchbar.value||void 0===this.destinationSearchbar.value;if(t=t||null===this.destinationSearchbar.value,!t){const t=document.activeElement;t&&t.blur&&t.blur(),this.discovery.emit(this.destinationSearchbar.value)}}emitRouteEvent(){let t=""===this.destinationSearchbar.value||void 0===this.destinationSearchbar.value;t=t||null===this.destinationSearchbar.value;let e=""===this.startSearchBar.value||void 0===this.startSearchBar.value;if(e=e||null===this.startSearchBar.value,!t&&!e){const t=[this.startSearchBar.value,this.destinationSearchbar.value],e=document.activeElement;e&&e.blur&&e.blur(),this.route.emit(t)}}clearDestinationInput(){this.destinationSearchbar.value=""}clearStartInput(){this.startSearchBar.value=""}setDiscoverySearchbarValue(t){this.destinationSearchbarValue=t}setStartSearchbarValue(t){this.startSearchBarValue=t}onSearchBarHasFocus(t){this.searchBarFocus.emit(t)}onKey(t,e){"Enter"===t.key&&("destinationSearchbar"===e&&this.emitDiscoveryEvent(),"startSearchBar"===e&&this.emitRouteEvent())}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=u.Bb({type:t,selectors:[["app-search-input"]],viewQuery:function(t,e){if(1&t&&(u.sc(I,!0),u.sc(R,!0)),2&t){let t;u.fc(t=u.Xb())&&(e.destinationSearchbar=t.first),u.fc(t=u.Xb())&&(e.startSearchBar=t.first)}},outputs:{discovery:"discovery",route:"route",searchBarFocus:"searchBarFocus"},decls:8,vars:4,consts:[["lines","none"],["search-icon","navigate-circle-outline","inputmode","text","mode","ios","placeholder","destination","color","","icon-color","dark",3,"value","click","keydown"],["destinationSearchbar",""],["size","default","mode","ios","color","medium",3,"click",4,"ngIf"],["class","vertical-line",4,"ngIf"],["size","default","mode","ios","color","primary",3,"click"],["size","large","slot","icon-only","src","assets/navigation-svgs/directions-24px.svg"],["lines","none",4,"ngIf"],["size","default","mode","ios","color","medium",3,"click"],["size","large","slot","icon-only","name","search","color",""],[1,"vertical-line"],["animated","true","color","","icon-color","dark","inputmode","text","mode","ios","placeholder","start","search-icon","locate-outline",3,"value","click","keydown"],["startSearchBar",""],["size","default","mode","ios","color","primary",3,"click",4,"ngIf"],["size","large","slot","icon-only","name","close-outline"]],template:function(t,e){1&t&&(u.Kb(0,"ion-item",0),u.Kb(1,"ion-searchbar",1,2),u.Wb("click",function(){return e.onSearchBarHasFocus("destinationSearchbar")})("keydown",function(t){return e.onKey(t,"destinationSearchbar")},!1,u.hc),u.Jb(),u.nc(3,M,2,0,"ion-button",3),u.nc(4,k,1,0,"span",4),u.Kb(5,"ion-button",5),u.Wb("click",function(){return e.routeBtnClick()}),u.Ib(6,"ion-icon",6),u.Jb(),u.Jb(),u.nc(7,L,4,2,"ion-item",7)),2&t&&(u.xb(1),u.dc("value",e.destinationSearchbarValue),u.xb(2),u.dc("ngIf",e.searchBtnIsVisible),u.xb(1),u.dc("ngIf",e.searchBtnIsVisible),u.xb(3),u.dc("ngIf",e.routeInputIsVisible))},directives:[o.y,o.K,o.eb,r.j,o.h,o.w],styles:["ion-searchbar[_ngcontent-%COMP%]{max-width:300px}"]}),t})();var D=n("+JbE"),F=n("YD5U");class J{constructor(t){this._campus=t,this._addressString=this.getAddressString(this._campus)}get Address(){return this._addressString}get Name(){return this._campus.Name}get ShortName(){return this._campus.ShortName}get LatLng(){return{lat:this._campus.Latitude,lng:this._campus.Longitude}}getAddressString(t){let e="";if(null!==t.edges.Address){const n=P(t.edges.Address,t=>t.Street);for(const t of Object.keys(n)){const o=n[t];""!==e&&(e+="; ");let i=o[0].Number;o.length>1&&(i+="-"+o[o.length-1].Number),e+=t+" "+i+", ",e+=n[t][0].PLZ+" "+n[t][0].City}}return e}}const P=(t,e)=>t.reduce((t,n)=>{const o=e(n);return t[o]||(t[o]=[]),t[o].push(n),t},{});var N=n("e8h1");let B=(()=>{class t{constructor(t){this.storage=t}addRecentSearch(e){return Object(s.a)(this,void 0,void 0,function*(){let n=yield this.readRecentSearches();null!==n&&0!==n.length||(n=[]);let o=-1;for(let t=0;t<n.length;t++)if(n[t].Name===e.Name){o=t;break}o>=0&&n.splice(o,1),n.unshift(e),n.length>3&&n.pop(),yield this.storage.set(t.recentSearchesKey,JSON.stringify([n])),console.log(n)})}readRecentSearches(){return Object(s.a)(this,void 0,void 0,function*(){const e=JSON.parse(yield this.storage.get(t.recentSearchesKey));return null!=e?e[0]:[]})}}return t.recentSearchesKey="searches",t.\u0275fac=function(e){return new(e||t)(u.Sb(N.b))},t.\u0275prov=u.Db({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),T=(()=>{class t{constructor(t){this.recentSearchesService=t,this.recentSearchesVar=[],this.availableCampus=[],this.Route={Start:{Name:"",LatLng:{lat:0,lng:0}},Destination:{Name:"",LatLng:{lat:0,lng:0}},Coordinates:[],Distance:0,NavigationInstructions:[],Time:0},this.recentSearchesService.readRecentSearches().then(t=>{this.recentSearchesVar=t})}get latestSearchResult(){return void 0!==this.recentSearches[0]?this.recentSearches[0]:{Name:"",Description:"",Information:[],DetailRouterParams:{},RouteRouterParams:{},LatLng:{lat:0,lng:0}}}get recentSearches(){return this.recentSearchesVar}addRecentSearch(t){return Object(s.a)(this,void 0,void 0,function*(){yield this.recentSearchesService.addRecentSearch(t),this.recentSearchesVar=yield this.recentSearchesService.readRecentSearches()})}addRecentSearchCampus(t){return Object(s.a)(this,void 0,void 0,function*(){const e={Name:t.Name,Description:t.ShortName,Information:[["ShortName: ",t.ShortName],["Longitude: ",t.Longitude],["Latitude: ",t.Latitude]],DetailRouterParams:{},RouteRouterParams:{},LatLng:{lat:t.Latitude,lng:t.Longitude}};yield this.addRecentSearch(e)})}addRecentSearchBuilding(t,e){return Object(s.a)(this,void 0,void 0,function*(){const n={Name:t.Name,Description:"Campus:"+t.Campus,Information:[],DetailRouterParams:{building:t.Name},RouteRouterParams:{},LatLng:e};yield this.addRecentSearch(n)})}addRecentSearchLocation(t,e){return Object(s.a)(this,void 0,void 0,function*(){const n=[["Building: ",t.Name]];t.Tags&&n.push(["Tags: ",t.Tags.join(", ")]);const o={Name:t.Name,Description:t.Description,Information:n,DetailRouterParams:{location:t.Name},RouteRouterParams:{start:t.Building+".Entrance",destination:t.Name},LatLng:e};yield this.addRecentSearch(o)})}SetOsmRouteAsRoute(t,e,n){const o=[];for(const i of t.Points.Coordinates)o.push([i.Lat,i.Lng]);this.Route={Start:e,Destination:n,Coordinates:o,Distance:Math.round(t.Distance),NavigationInstructions:t.Instructions,Time:Math.round(t.Time/1e3/60)}}ClearRoute(){this.Route={Start:{Name:"",LatLng:{lat:0,lng:0}},Destination:{Name:"",LatLng:{lat:0,lng:0}},Distance:0,Coordinates:[],NavigationInstructions:[],Time:0}}}return t.\u0275fac=function(e){return new(e||t)(u.Sb(B))},t.\u0275prov=u.Db({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var E=n("gcOT");const _=["drawerContent"],A=["searchDrawer"],V=["locationDrawer"];function j(t,e){1&t&&u.Ib(0,"ion-progress-bar",37)}function z(t,e){if(1&t&&(u.Kb(0,"ion-text",38),u.Kb(1,"h5"),u.Kb(2,"span",39),u.oc(3),u.Jb(),u.Jb(),u.Kb(4,"p"),u.Ob(5,40),u.Jb(),u.Kb(6,"p"),u.Rb(7,41),u.Ib(8,"br"),u.Ib(9,"a",42),u.Pb(),u.Jb(),u.Jb()),2&t){const t=u.Yb();u.xb(3),u.pc(t.errorMessage)}}function W(t,e){if(1&t){const t=u.Lb();u.Kb(0,"ion-item",43),u.Wb("click",function(){u.ic(t);const n=e.$implicit;return u.Yb().recentSearchClick(n)}),u.Kb(1,"ion-label"),u.Kb(2,"h2"),u.oc(3),u.Jb(),u.Jb(),u.Jb()}if(2&t){const t=e.$implicit;u.xb(3),u.pc(t)}}function X(t,e){if(1&t&&(u.Kb(0,"ion-item"),u.Kb(1,"ion-label"),u.Kb(2,"h2"),u.oc(3),u.Jb(),u.Kb(4,"h3"),u.oc(5),u.Jb(),u.Jb(),u.Jb()),2&t){const t=e.$implicit;u.xb(3),u.rc("",t.ShortName,": ",t.Name,""),u.xb(2),u.pc(t.Address)}}function H(t,e){if(1&t&&(u.Kb(0,"ion-row"),u.Kb(1,"ion-col"),u.oc(2),u.Jb(),u.Kb(3,"ion-col"),u.oc(4),u.Jb(),u.Jb()),2&t){const t=e.$implicit;u.xb(2),u.pc(t[0]),u.xb(2),u.pc(t[1])}}const{Keyboard:Y}=E.a;let G=(()=>{class t{constructor(t,e,n,o,i,r){this.dataService=t,this.modalCtrl=e,this.route=n,this.router=o,this.model=i,this.platform=r,this.availableCampus=[],this.isSubscripted=!1}ngAfterViewInit(){this.locationDrawer.SetState(D.a.Hidden),this.searchDrawer.SetState(F.a.GetRecommendedDrawerStateForDevice())}ionViewDidEnter(){!1===this.isSubscripted&&(this.isSubscripted=!0,this.route.queryParams.subscribe(t=>Object(s.a)(this,void 0,void 0,function*(){var e;if(null!=t&&null!=t.location&&t.location.length>0)return this.searchInput.setDiscoverySearchbarValue(t.location),void(yield this.onDiscovery(t.location));if(null!=t&&null!=t.start&&t.start.length>0&&null!=t.destination&&t.destination.length>0)yield this.showNavigation(t.start,t.destination);else if(null!=t&&null!=t.building&&t.building.length>0){const n=yield this.dataService.get_building(t.building).toPromise();null!==n&&(yield this.mapView.showFloor((null===(e=n.Floors)||void 0===e?void 0:e.includes("EG"))?"EG":n.Floors[0],n.Name))}else yield this.showDiscoveryMode()})))}ngOnInit(){return Object(s.a)(this,void 0,void 0,function*(){if(0===this.model.availableCampus.length){const t=yield this.dataService.get_campus_search().toPromise();for(const e of t)this.model.availableCampus.push(new J(e))}})}onDiscovery(e){return Object(s.a)(this,void 0,void 0,function*(){this.model.errorMessage="",t.progressIsVisible=!0;try{const n=yield this.mapView.showDiscoveryLocation(e);yield this.model.addRecentSearchLocation(n,{lat:0,lng:0}),yield this.showLocationDrawer(n)}catch(n){this.handleInputError(n,e)}finally{t.progressIsVisible=!1}})}onRoute(e){return Object(s.a)(this,void 0,void 0,function*(){this.errorMessage="",t.progressIsVisible=!0;try{const n=yield this.dataService.get_location(e[0]).toPromise(),o=yield this.dataService.get_route(e[0],e[1]).toPromise();yield this.mapView.showRoute(o,n),this.mapView.CenterMap(n.PathNode.Coordinate.X,n.PathNode.Coordinate.Y)}catch(n){let t="";if(n instanceof x.d){const o=n.error.message;o.includes(e[0])&&(t=e[0]),o.includes(e[1])&&(t.length>0&&(t+=" and "),t+=e[1])}this.handleInputError(n,0===t.length?e.toString():t)}finally{t.progressIsVisible=!1}})}onDrawerStateChange(t){void 0!==this.drawerContent&&(this.drawerContent.scrollY=t===D.a.Top)}showLocationDrawer(t){return Object(s.a)(this,void 0,void 0,function*(){yield this.locationDrawer.SetState(D.a.Hidden),this.model.latestSearchResult.Name=t.Name,this.model.latestSearchResult.Description=t.Description,this.model.latestSearchResult.Information=t.Tags?[["Tags: ",t.Tags.join(",")]]:[],this.platform.is("hybrid")&&(yield Y.hide()),yield this.searchDrawer.SetState(D.a.Hidden),yield this.locationDrawer.SetState(F.a.GetRecommendedDrawerStateForDevice())})}onCloseLocationDrawer(t){return Object(s.a)(this,void 0,void 0,function*(){yield this.locationDrawer.SetState(D.a.Hidden),yield this.searchDrawer.SetState(F.a.GetRecommendedDrawerStateForDevice())})}presentAvailableFloorModal(){return Object(s.a)(this,void 0,void 0,function*(){let t=new Array,e=yield this.dataService.get_buildings_search().toPromise();e=e.filter((t,n)=>e.indexOf(t)===n);for(const i of e){const e=yield this.dataService.get_building(i.Name).toPromise();t=t.concat(e.Floors)}t=t.filter((e,n)=>t.indexOf(e)===n);const n=yield this.modalCtrl.create({component:l.a,cssClass:"floor-modal",componentProps:{floors:t}});yield n.present();const o=yield n.onDidDismiss();o.data&&(yield this.mapView.showAnotherFloorOfCurrentBuilding(o.data,this.mapView.CurrentBuilding))})}handleInputError(t,e){if(console.log(t),t instanceof x.d){const n=t;this.errorMessage=400===n.status?"Studi-Guide can't find "+e:n.message}else this.errorMessage=t.message;null!=this.mapView&&this.mapView.clearMapCanvas()}navigationBtnClick(){return Object(s.a)(this,void 0,void 0,function*(){if(null!=this.model.latestSearchResult)try{const e=yield this.dataService.get_location(this.model.latestSearchResult.Name).toPromise();yield this.showNavigation(e.Building+".Entrance",e.Name)}catch(e){let t="";e instanceof x.d&&e.error.message.includes(this.model.latestSearchResult.Name)&&(t=this.model.latestSearchResult.Name),this.handleInputError(e,0===t.length?this.model.latestSearchResult.Name:t)}finally{t.progressIsVisible=!1}})}showNavigation(t,e){return Object(s.a)(this,void 0,void 0,function*(){this.searchInput.showRouteSearchBar(),this.searchInput.setDiscoverySearchbarValue(e),this.searchInput.setStartSearchbarValue(t),yield this.onCloseLocationDrawer(null),yield this.onRoute([t,e])})}showDiscoveryMode(){return Object(s.a)(this,void 0,void 0,function*(){null==this.mapView.CurrentRoute&&null==this.mapView.CurrentBuilding&&(yield this.mapView.showDiscoveryMap("","EG"),this.mapView.CenterMap(310,550))})}recentSearchClick(t){return Object(s.a)(this,void 0,void 0,function*(){yield this.router.navigate(["tabs/navigation/detail"],{queryParams:{location:t}})})}presentMapPage(){return Object(s.a)(this,void 0,void 0,function*(){yield this.router.navigate(["tabs/navigation/"])})}get ProgressIsVisible(){return t.progressIsVisible}}return t.progressIsVisible=!1,t.\u0275fac=function(e){return new(e||t)(u.Hb(c.a),u.Hb(o.Z),u.Hb(i.a),u.Hb(i.g),u.Hb(T),u.Hb(o.bb))},t.\u0275cmp=u.Bb({type:t,selectors:[["app-navigation"]],viewQuery:function(t,e){if(1&t&&(u.sc(C,!0),u.sc(K,!0),u.sc(_,!0),u.sc(A,!0),u.sc(V,!0)),2&t){let t;u.fc(t=u.Xb())&&(e.mapView=t.first),u.fc(t=u.Xb())&&(e.searchInput=t.first),u.fc(t=u.Xb())&&(e.drawerContent=t.first),u.fc(t=u.Xb())&&(e.searchDrawer=t.first),u.fc(t=u.Xb())&&(e.locationDrawer=t.first)}},decls:72,vars:7,consts:function(){let t,e;return t="\xDCberpr\xFCfe deine Eingabe auf Rechtschreibfehler.",e="Sollte dieser Ort im Studi-Guide sein?\n        " + "\ufffd#8\ufffd\ufffd/#8\ufffd" + "\n        " + "\ufffd#9\ufffd" + "F\xFCge den Ort hinzu" + "\ufffd/#9\ufffd" + "\n      ",[["translucent",""],["slot","start"],["id","close-open-map","defaultHref","/"],["data-tap-disabled","true","scroll-y","false"],["type","indeterminate","color","secondary",4,"ngIf"],["id","map-content"],["id","error-message",4,"ngIf"],[3,"locationClick"],[3,"stateChange"],["searchDrawer",""],[1,"nav-bottom-drawer"],[1,"drawer-grip"],[1,"ion-padding-top"],[1,"nav-hbar"],[3,"discovery","route"],["drawerContent",""],["shape","round",1,"square-md","ion-no-padding",3,"click"],["slot","icon-only","name","business-outline","size","large"],["shape","round","color","medium",1,"square-md","ion-no-padding",3,"click"],["slot","icon-only","name","layers-outline","size","large"],["shape","round","color","dark",1,"square-md","ion-no-padding"],["slot","icon-only","name","library-outline","size","large"],[1,"ion-no-padding"],["button","",3,"click",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[1,"ion-padding-vertical"],["state","DrawerState.Hidden"],["locationDrawer",""],[1,"ion-padding-bottom"],["id","locationdrawerContent"],[1,"ion-justify-content-between","ion-align-self-center"],["size","auto"],["id","locationdrawerName"],[1,"ion-justify-content-end","ion-padding-horizontal"],["shape","round","color","medium",1,"square-sm","ion-no-padding","ion-float-right",3,"click"],["slot","icon-only","name","close-outline","size","small"],["id","routeBtn","color","primary","expand","block",3,"click"],["type","indeterminate","color","secondary"],["id","error-message"],[1,"error"],t,e,["href","https://github.com/Studi-Guide/Studi-Guide/issues/new/choose"],["button","",3,"click"]]},template:function(t,e){1&t&&(u.Kb(0,"ion-header",0),u.Kb(1,"ion-toolbar"),u.Kb(2,"ion-buttons",1),u.Ib(3,"ion-back-button",2),u.Jb(),u.Jb(),u.Jb(),u.Kb(4,"ion-content",3),u.nc(5,j,1,0,"ion-progress-bar",4),u.Kb(6,"div",5),u.nc(7,z,10,1,"ion-text",6),u.Kb(8,"app-map-view",7),u.Wb("locationClick",function(t){return e.showLocationDrawer(t)}),u.Jb(),u.Jb(),u.Jb(),u.Kb(9,"app-ionic-bottom-drawer",8,9),u.Wb("stateChange",function(t){return e.onDrawerStateChange(t)}),u.Kb(11,"div",10),u.Kb(12,"div",11),u.Ib(13,"div",12),u.Ib(14,"div",13),u.Kb(15,"app-search-input",14),u.Wb("discovery",function(t){return e.onDiscovery(t)})("route",function(t){return e.onRoute(t)}),u.Jb(),u.Jb(),u.Kb(16,"ion-content",null,15),u.Kb(18,"ion-grid"),u.Kb(19,"ion-list-header"),u.oc(20,"Current Campus"),u.Jb(),u.Kb(21,"ion-row"),u.Kb(22,"ion-col"),u.Kb(23,"ion-button",16),u.Wb("click",function(){return e.presentMapPage()}),u.Ib(24,"ion-icon",17),u.Jb(),u.Jb(),u.Kb(25,"ion-col"),u.Kb(26,"ion-button",18),u.Wb("click",function(){return e.presentAvailableFloorModal()}),u.Ib(27,"ion-icon",19),u.Jb(),u.Jb(),u.Kb(28,"ion-col"),u.Kb(29,"ion-button",20),u.Ib(30,"ion-icon",21),u.Jb(),u.Jb(),u.Ib(31,"ion-col"),u.Jb(),u.Jb(),u.Kb(32,"ion-list",22),u.Kb(33,"ion-list-header"),u.oc(34," Recent Searches "),u.Jb(),u.nc(35,W,4,1,"ion-item",23),u.Jb(),u.Kb(36,"ion-list",22),u.Kb(37,"ion-list-header"),u.oc(38," Choose a Campus "),u.Jb(),u.nc(39,X,6,3,"ion-item",24),u.Jb(),u.Ib(40,"div",25),u.Ib(41,"div",25),u.Ib(42,"div",25),u.Ib(43,"div",25),u.Ib(44,"div",25),u.Ib(45,"div",25),u.Jb(),u.Jb(),u.Jb(),u.Kb(46,"app-ionic-bottom-drawer",26,27),u.Kb(48,"div",10),u.Kb(49,"div",11),u.Ib(50,"div",12),u.Ib(51,"div",13),u.Ib(52,"div",28),u.Jb(),u.Kb(53,"ion-content"),u.Kb(54,"ion-grid",29),u.Kb(55,"ion-row",30),u.Kb(56,"ion-col",31),u.Kb(57,"ion-text",32),u.oc(58),u.Jb(),u.Jb(),u.Kb(59,"ion-col",33),u.Kb(60,"ion-button",34),u.Wb("click",function(t){return e.onCloseLocationDrawer(t)}),u.Ib(61,"ion-icon",35),u.Jb(),u.Jb(),u.Jb(),u.Kb(62,"ion-row"),u.Kb(63,"ion-col"),u.Kb(64,"ion-button",36),u.Wb("click",function(){return e.navigationBtnClick()}),u.oc(65," Route "),u.Jb(),u.Jb(),u.Jb(),u.Kb(66,"ion-row"),u.Kb(67,"ion-col"),u.oc(68,"Description:"),u.Jb(),u.Kb(69,"ion-col"),u.oc(70),u.Jb(),u.Jb(),u.nc(71,H,5,2,"ion-row",24),u.Jb(),u.Jb(),u.Jb(),u.Jb()),2&t&&(u.xb(5),u.dc("ngIf",e.ProgressIsVisible),u.xb(2),u.dc("ngIf",e.errorMessage),u.xb(28),u.dc("ngForOf",e.model.recentSearches),u.xb(4),u.dc("ngForOf",e.availableCampus),u.xb(19),u.pc(e.model.latestSearchResult.Name),u.xb(12),u.pc(e.model.latestSearchResult.Description),u.xb(1),u.dc("ngForOf",e.model.latestSearchResult.Information))},styles:["#map-content[_ngcontent-%COMP%]{height:100%;width:100%;position:fixed}.error[_ngcontent-%COMP%]{color:red}#error-message[_ngcontent-%COMP%]{margin-left:20px}#available-floors-btn[_ngcontent-%COMP%]{position:fixed;bottom:0;display:block;z-index:10}.center[_ngcontent-%COMP%]{margin-left:auto;margin-right:auto;display:block}ion-progress-bar[_ngcontent-%COMP%]{position:absolute;z-index:9999}.vertical-line[_ngcontent-%COMP%]{border-left:2px solid #9d9fa6;height:38px}.nav-hbar[_ngcontent-%COMP%]{border-top:2px solid var(--ion-color-medium,#9d9fa6);border-bottom:2px solid var(--ion-color-medium,#9d9fa6);border-radius:2px;height:0;width:auto;margin:0 45%}.nav-bottom-drawer[_ngcontent-%COMP%]{background-color:#fff;border-top-left-radius:20px;border-top-right-radius:20px;box-shadow:0 4px 8px 0 rgba(0,0,0,.4),0 6px 20px 0 rgba(0,0,0,.29);height:inherit;z-index:1}.square-md[_ngcontent-%COMP%]{height:64px;width:64px}.square-sm[_ngcontent-%COMP%]{height:32px;width:32px}.square-xs[_ngcontent-%COMP%]{height:16px;width:16px}#locationdrawerContent[_ngcontent-%COMP%]{margin-left:30px;margin-right:30px;position:center}#locationdrawerName[_ngcontent-%COMP%]{font-weight:700}"]}),t})(),q=(()=>{class t{}return t.\u0275mod=u.Fb({type:t}),t.\u0275inj=u.Eb({factory:function(e){return new(e||t)},imports:[[r.b,o.W]]}),t})();var Z=n("4R65"),$=n("Bfh1"),U=n("AytR");let Q=(()=>{class t{constructor(t,e,n){this.locale=t,this.httpClient=e,this.env=n}GetRoute(e,n){return Object(s.a)(this,void 0,void 0,function*(){return yield this.httpClient.get(this.env.serverUrl+t.serverPathPrefix+t.routePath+"?start="+e.lat+","+e.lng+"&end="+n.lat+","+n.lng+"&locale="+this.locale).toPromise()})}GetBounds(){return Object(s.a)(this,void 0,void 0,function*(){return yield this.httpClient.get(this.env.serverUrl+t.serverPathPrefix+t.boundsPath).toPromise()})}}return t.serverPathPrefix="/osm",t.routePath="/route",t.boundsPath="/bounds",t.\u0275fac=function(e){return new(e||t)(u.Sb(u.v),u.Sb(x.b),u.Sb(U.a))},t.\u0275prov=u.Db({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const tt=["ionSlides"];function et(t,e){if(1&t&&(u.Kb(0,"ion-slide"),u.Kb(1,"ion-text"),u.Kb(2,"h2"),u.oc(3),u.Jb(),u.Kb(4,"p"),u.oc(5),u.Jb(),u.Jb(),u.Jb()),2&t){const t=e.$implicit;u.xb(3),u.pc(t.Text),u.xb(2),u.qc("",t.Distance,"m")}}let nt=(()=>{class t{constructor(t){this.element=t,this.nextSlide=new u.o,this.previousSlide=new u.o,this.slideOpts={initialSlide:0,speed:400}}ngOnInit(){this.hide()}onPrevSlide(){return Object(s.a)(this,void 0,void 0,function*(){this.previousSlide.emit(yield this.ionSlides.getActiveIndex())})}onNextSlide(){return Object(s.a)(this,void 0,void 0,function*(){this.nextSlide.emit(yield this.ionSlides.getActiveIndex())})}hide(){return Object(s.a)(this,void 0,void 0,function*(){this.element.nativeElement.hidden=!0})}show(){return Object(s.a)(this,void 0,void 0,function*(){this.element.nativeElement.hidden=!1})}}return t.\u0275fac=function(e){return new(e||t)(u.Hb(u.m))},t.\u0275cmp=u.Bb({type:t,selectors:[["app-navigation-instruction-slides"]],viewQuery:function(t,e){if(1&t&&u.sc(tt,!0),2&t){let t;u.fc(t=u.Xb())&&(e.ionSlides=t.first)}},inputs:{instructions:"instructions"},outputs:{nextSlide:"nextSlide",previousSlide:"previousSlide"},decls:3,vars:2,consts:[["pager","true",3,"options","ionSlideNextEnd","ionSlidePrevEnd"],["ionSlides",""],[4,"ngFor","ngForOf"]],template:function(t,e){1&t&&(u.Kb(0,"ion-slides",0,1),u.Wb("ionSlideNextEnd",function(){return e.onNextSlide()})("ionSlidePrevEnd",function(){return e.onPrevSlide()}),u.nc(2,et,6,2,"ion-slide",2),u.Jb()),2&t&&(u.dc("options",e.slideOpts),u.xb(2),u.dc("ngForOf",e.instructions))},directives:[o.O,r.i,o.N,o.S],styles:["[_nghost-%COMP%]{z-index:auto}ion-slide[_ngcontent-%COMP%]{height:100%;width:100%}@media (min-width:992px){ion-slide[_ngcontent-%COMP%]{padding-bottom:2em}}@media (max-width:991.98px){ion-slide[_ngcontent-%COMP%]{padding-bottom:.5em}}"]}),t})(),ot=(()=>{class t{static persist(t,e){return Object(s.a)(this,void 0,void 0,function*(){yield t.set(this.LAST_MAP_EVENT_KEY,e)})}load(e,n,o){return Object(s.a)(this,void 0,void 0,function*(){e.ready().then(()=>Object(s.a)(this,void 0,void 0,function*(){yield e.get(t.LAST_MAP_EVENT_KEY).then(t=>{n.setView([49.452368,11.093299],o),null!=t&&n.flyTo(t.center,t.zoom)})}))})}}return t.LAST_MAP_EVENT_KEY="lastOpenStreetMapEventTarget",t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=u.Db({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const it=["inputFrom"],rt=["inputTo"];function at(t,e){if(1&t){const t=u.Lb();u.Kb(0,"ion-item",10),u.Wb("click",function(){return u.ic(t),u.Yb().listMyLocationClick()}),u.Kb(1,"ion-text"),u.oc(2,"My Location"),u.Jb(),u.Jb()}}function st(t,e){if(1&t){const t=u.Lb();u.Kb(0,"ion-item",10),u.Wb("click",function(){u.ic(t);const n=e.$implicit;return u.Yb().listRecentSearchClick(n)}),u.Kb(1,"ion-text"),u.oc(2),u.Jb(),u.Jb()}if(2&t){const t=e.$implicit;u.xb(2),u.pc(t.Name)}}var ct=function(t){return t[t.No=0]="No",t[t.From=1]="From",t[t.To=2]="To",t}({});let lt=(()=>{class t{constructor(t,e){this.model=t,this.geolocation=e,this.inputToCurrentlyActive=!1,this.myLocationInInput=ct.From}ngOnInit(){}ngAfterViewInit(){return Object(s.a)(this,void 0,void 0,function*(){this.UpdateFromNavigationModel(),this.inputToCurrentlyActive=!1,yield this.inputFrom.setFocus()})}SetFocus(){return Object(s.a)(this,void 0,void 0,function*(){this.inputToCurrentlyActive?yield this.inputTo.setFocus():yield this.inputFrom.setFocus()})}toggleActiveInput(){return Object(s.a)(this,void 0,void 0,function*(){this.inputToCurrentlyActive=!this.inputToCurrentlyActive,yield this.SetFocus()})}updateInputValues(){this.inputFrom.value=this.routeLocationFrom.Name,this.inputTo.value=this.routeLocationTo.Name}UpdateFromNavigationModel(){this.routeLocationFrom=this.model.Route.Start,this.routeLocationTo=this.model.Route.Destination,this.updateInputValues()}showMyLocation(){return this.myLocationInInput===ct.No}onInputFromFocus(){this.inputToCurrentlyActive=!1}onInputToFocus(){this.inputToCurrentlyActive=!0}swapInputs(){const t=this.routeLocationFrom;this.routeLocationFrom=this.routeLocationTo,this.routeLocationTo=t,this.myLocationInInput!==ct.No&&(this.myLocationInInput=this.myLocationInInput===ct.From?ct.To:ct.From),this.updateInputValues()}listRecentSearchClick(t){return Object(s.a)(this,void 0,void 0,function*(){this.inputToCurrentlyActive?(this.routeLocationTo=t,this.myLocationInInput===ct.To&&(this.myLocationInInput=ct.No)):(this.routeLocationFrom=t,this.myLocationInInput===ct.From&&(this.myLocationInInput=ct.No)),this.updateInputValues(),yield this.toggleActiveInput()})}listMyLocationClick(){return Object(s.a)(this,void 0,void 0,function*(){const t=yield this.geolocation.getCurrentPosition(),e={Name:"My Location",LatLng:{lat:t.coords.latitude,lng:t.coords.longitude}};this.inputToCurrentlyActive?(this.routeLocationTo=e,this.myLocationInInput=ct.To):(this.routeLocationFrom=e,this.myLocationInInput=ct.From),this.updateInputValues(),yield this.toggleActiveInput()})}get From(){return this.routeLocationFrom}get To(){return this.routeLocationTo}}return t.\u0275fac=function(e){return new(e||t)(u.Hb(T),u.Hb($.a))},t.\u0275cmp=u.Bb({type:t,selectors:[["app-route-input"]],viewQuery:function(t,e){if(1&t&&(u.sc(it,!0),u.sc(rt,!0)),2&t){let t;u.fc(t=u.Xb())&&(e.inputFrom=t.first),u.fc(t=u.Xb())&&(e.inputTo=t.first)}},decls:21,vars:2,consts:[[1,"container"],["size","11"],[3,"ionFocus"],["inputFrom",""],["inputTo",""],["size","1",1,"swappicon","ion-activatable","ripple-parent",3,"click"],["size","large","name","swap-vertical-outline"],[1,"ion-no-padding"],["button","",3,"click",4,"ngIf"],["button","",3,"click",4,"ngFor","ngForOf"],["button","",3,"click"]],template:function(t,e){1&t&&(u.Kb(0,"div",0),u.Kb(1,"ion-grid"),u.Kb(2,"ion-row"),u.Kb(3,"ion-col",1),u.Kb(4,"ion-item"),u.Kb(5,"ion-label"),u.oc(6,"From"),u.Jb(),u.Kb(7,"ion-input",2,3),u.Wb("ionFocus",function(){return e.onInputFromFocus()}),u.Jb(),u.Jb(),u.Kb(9,"ion-item"),u.Kb(10,"ion-label"),u.oc(11,"To"),u.Jb(),u.Kb(12,"ion-input",2,4),u.Wb("ionFocus",function(){return e.onInputToFocus()}),u.Jb(),u.Jb(),u.Jb(),u.Kb(14,"ion-col",5),u.Wb("click",function(){return e.swapInputs()}),u.Ib(15,"ion-icon",6),u.Ib(16,"ion-ripple-effect"),u.Jb(),u.Jb(),u.Jb(),u.Jb(),u.Kb(17,"ion-content"),u.Kb(18,"ion-list",7),u.nc(19,at,3,0,"ion-item",8),u.nc(20,st,3,1,"ion-item",9),u.Jb(),u.Jb()),2&t&&(u.xb(19),u.dc("ngIf",e.showMyLocation()),u.xb(1),u.dc("ngForOf",e.model.recentSearches))},directives:[o.u,o.J,o.o,o.y,o.A,o.x,o.eb,o.w,o.H,o.p,o.B,r.j,r.i,o.S],styles:[".container[_ngcontent-%COMP%]{position:relative}.container[_ngcontent-%COMP%], .input-container[_ngcontent-%COMP%]{width:100%;height:-webkit-fit-content;height:-moz-fit-content;height:fit-content}.input-container[_ngcontent-%COMP%]{position:absolute;top:0;left:0}.swappicon[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.swappicon[_ngcontent-%COMP%]:hover{cursor:pointer}.ripple-parent[_ngcontent-%COMP%]{position:relative;overflow:hidden}"]}),t})();const ut=["drawerContent"],dt=["searchDrawer"],ht=["locationDrawer"],bt=["routeDrawer"],ft=["inNavigationDrawer"],mt=["changeRouteDrawer"],pt=["routeInput"];function gt(t,e){if(1&t){const t=u.Lb();u.Kb(0,"ion-item",38),u.Wb("click",function(){u.ic(t);const n=e.$implicit;return u.Yb(2).search.emit(n.Name)}),u.Kb(1,"ion-text"),u.oc(2),u.Jb(),u.Jb()}if(2&t){const t=e.$implicit;u.xb(2),u.pc(t.Name)}}function vt(t,e){if(1&t&&(u.Kb(0,"ion-list",10),u.Kb(1,"ion-list-header"),u.Kb(2,"h2"),u.oc(3,"Recent Searches"),u.Jb(),u.Jb(),u.nc(4,gt,3,1,"ion-item",11),u.Jb()),2&t){const t=u.Yb();u.xb(4),u.dc("ngForOf",t.model.recentSearches)}}function wt(t,e){if(1&t){const t=u.Lb();u.Kb(0,"ion-item",38),u.Wb("click",function(){u.ic(t);const n=e.$implicit;return u.Yb().campusClick.emit(n)}),u.Kb(1,"ion-label"),u.Kb(2,"h2"),u.oc(3),u.Jb(),u.Kb(4,"h3"),u.oc(5),u.Jb(),u.Jb(),u.Jb()}if(2&t){const t=e.$implicit;u.xb(3),u.rc("",t.ShortName,": ",t.Name,""),u.xb(2),u.pc(t.Address)}}function yt(t,e){if(1&t&&(u.Kb(0,"ion-row"),u.Kb(1,"ion-col"),u.oc(2),u.Jb(),u.Kb(3,"ion-col"),u.oc(4),u.Jb(),u.Jb()),2&t){const t=e.$implicit;u.xb(2),u.pc(t[0]),u.xb(2),u.pc(t[1])}}function St(t,e){1&t&&u.Ib(0,"ion-progress-bar",39)}function Ct(t,e){if(1&t){const t=u.Lb();u.Kb(0,"ion-button",41),u.Wb("click",function(){return u.ic(t),u.Yb(2).onLaunchNavigationClick()}),u.oc(1," Go "),u.Jb()}}function xt(t,e){if(1&t&&(u.Kb(0,"ion-row"),u.Kb(1,"ion-col"),u.Kb(2,"ion-label"),u.Kb(3,"h2"),u.oc(4),u.Jb(),u.Jb(),u.Kb(5,"ion-text"),u.oc(6),u.Jb(),u.Jb(),u.Kb(7,"ion-col"),u.nc(8,Ct,2,0,"ion-button",40),u.Jb(),u.Jb()),2&t){const t=u.Yb();u.xb(4),u.qc("",t.model.Route.Time," min"),u.xb(2),u.qc("",t.model.Route.Distance," m"),u.xb(2),u.dc("ngIf",!t.UseDrawerForNavigation())}}function It(t,e){if(1&t){const t=u.Lb();u.Kb(0,"ion-item",38),u.Wb("click",function(){u.ic(t);const n=e.$implicit;return u.Yb(2).navInstructionClick.emit(n)}),u.Kb(1,"ion-label"),u.oc(2),u.Jb(),u.Kb(3,"ion-text"),u.oc(4),u.Jb(),u.Jb()}if(2&t){const t=e.$implicit;u.xb(2),u.pc(t.Text),u.xb(2),u.qc("",t.Distance,"m")}}function Rt(t,e){if(1&t&&(u.Kb(0,"ion-list"),u.nc(1,It,5,2,"ion-item",11),u.Jb()),2&t){const t=u.Yb();u.xb(1),u.dc("ngForOf",t.model.Route.NavigationInstructions)}}var Mt=function(t){return t[t.SearchView=0]="SearchView",t[t.LocationView=1]="LocationView",t[t.RouteView=2]="RouteView",t[t.InNavigationView=3]="InNavigationView",t[t.ChangeRouteView=4]="ChangeRouteView",t}({});let kt=(()=>{class t{constructor(t,e){this.model=t,this.platform=e,this.state=Mt.SearchView,this.stateChange=new u.o,this.campusClick=new u.o,this.detailsClick=new u.o,this.navInstructionClick=new u.o,this.search=new u.o,this.newRoute=new u.o}ngAfterViewInit(){return Object(s.a)(this,void 0,void 0,function*(){yield Promise.all([this.searchDrawer.SetState(F.a.GetRecommendedDrawerStateForDevice()),this.locationDrawer.SetState(D.a.Hidden),this.routeDrawer.SetState(D.a.Hidden),this.inNavigationDrawer.SetState(D.a.Hidden),this.changeRouteDrawer.SetState(D.a.Hidden,!1)])})}ngOnChanges(t){return Object(s.a)(this,void 0,void 0,function*(){t.state&&(yield this.SetState(t.state.currentValue))})}SetState(t,e=!0){return Object(s.a)(this,void 0,void 0,function*(){switch(this.state){case Mt.SearchView:yield this.searchDrawer.SetState(D.a.Hidden);break;case Mt.LocationView:yield this.locationDrawer.SetState(D.a.Hidden);break;case Mt.RouteView:yield this.routeDrawer.SetState(D.a.Hidden);break;case Mt.InNavigationView:yield this.inNavigationDrawer.SetState(D.a.Hidden);break;case Mt.ChangeRouteView:yield this.changeRouteDrawer.SetState(D.a.Hidden,!1)}switch(this.state=t,this.state){case Mt.SearchView:yield this.searchDrawer.SetState(F.a.GetRecommendedDrawerStateForDevice());break;case Mt.LocationView:yield this.locationDrawer.SetState(F.a.GetRecommendedDrawerStateForDevice());break;case Mt.RouteView:yield this.routeDrawer.SetState(F.a.GetRecommendedDrawerStateForDevice());break;case Mt.InNavigationView:yield this.inNavigationDrawer.SetState(F.a.GetRecommendedDrawerStateForDevice());break;case Mt.ChangeRouteView:yield this.changeRouteDrawer.SetState(F.a.GetRecommendedDrawerStateForDevice())}e&&this.stateChange.emit(this.state)})}onRouteClick(){this.SetState(Mt.RouteView)}onLaunchNavigationClick(){this.SetState(Mt.InNavigationView)}onEndNavigationClick(){this.SetState(Mt.LocationView)}onSearchFocus(t){return Object(s.a)(this,void 0,void 0,function*(){this.platform.is("hybrid")&&(yield this.searchDrawer.SetState(D.a.Top))})}emitRoute(t){}onCloseLocationDrawer(){return Object(s.a)(this,void 0,void 0,function*(){yield this.SetState(Mt.SearchView)})}onCloseRouteDrawer(){return Object(s.a)(this,void 0,void 0,function*(){yield this.SetState(Mt.LocationView)})}onChangeRouteStartEndClick(){return Object(s.a)(this,void 0,void 0,function*(){this.routeInput.UpdateFromNavigationModel(),yield this.SetState(Mt.ChangeRouteView),yield this.routeInput.SetFocus()})}onSearchDrawerStateChange(t){void 0!==this.drawerContent&&(this.drawerContent.scrollY=t===D.a.Top)}onChangeRouteDrawerStateChange(t){return Object(s.a)(this,void 0,void 0,function*(){console.log(t),t===D.a.Hidden&&(yield this.SetState(Mt.RouteView))})}onCancelChangeRoute(){return Object(s.a)(this,void 0,void 0,function*(){yield this.SetState(Mt.RouteView,!1)})}UseDrawerForNavigation(){return!(F.a.GetRecommendedDrawerStateForDevice()===D.a.Bottom)}}return t.\u0275fac=function(e){return new(e||t)(u.Hb(T),u.Hb(o.bb))},t.\u0275cmp=u.Bb({type:t,selectors:[["app-nav-drawer-manager"]],viewQuery:function(t,e){if(1&t&&(u.sc(ut,!0),u.sc(dt,!0),u.sc(ht,!0),u.sc(bt,!0),u.sc(ft,!0),u.sc(mt,!0),u.sc(pt,!0)),2&t){let t;u.fc(t=u.Xb())&&(e.drawerContent=t.first),u.fc(t=u.Xb())&&(e.searchDrawer=t.first),u.fc(t=u.Xb())&&(e.locationDrawer=t.first),u.fc(t=u.Xb())&&(e.routeDrawer=t.first),u.fc(t=u.Xb())&&(e.inNavigationDrawer=t.first),u.fc(t=u.Xb())&&(e.changeRouteDrawer=t.first),u.fc(t=u.Xb())&&(e.routeInput=t.first)}},inputs:{state:"state"},outputs:{stateChange:"stateChange",campusClick:"campusClick",detailsClick:"detailsClick",navInstructionClick:"navInstructionClick",search:"search",newRoute:"newRoute"},features:[u.vb],decls:118,vars:14,consts:[["id","searchDrawer",3,"stateChange"],["searchDrawer",""],[1,"nav-bottom-drawer"],[1,"drawer-grip"],[1,"ion-padding-top"],[1,"nav-hbar"],[3,"discovery","route","searchBarFocus"],["searchInput",""],["drawerContent",""],["class","ion-no-padding",4,"ngIf"],[1,"ion-no-padding"],["button","",3,"click",4,"ngFor","ngForOf"],[1,"ion-padding-vertical"],["id","locationDrawer","state","DrawerState.Hidden"],["locationDrawer",""],[1,"ion-padding-bottom"],["id","locationdrawerContent"],[1,"ion-justify-content-between","ion-align-self-center"],[1,"ion-justify-content-end","ion-padding-horizontal"],["shape","round","color","medium",1,"square-sm","ion-no-padding","ion-float-right",3,"click"],["slot","icon-only","name","close-outline","size","small"],["color","primary","expand","block",3,"click"],["id","routeBtn","color","primary","expand","block",3,"click"],[4,"ngFor","ngForOf"],["id","routeDrawer","state","DrawerState.Hidden"],["routeDrawer",""],["type","indeterminate",4,"ngIf"],[1,"span-button",3,"click"],[4,"ngIf"],["id","inNavigationDrawer","state","DrawerState.Hidden"],["inNavigationDrawer",""],["color","danger","expand","block",3,"click"],["id","changeRouteDrawer","state","DrawerState.Hidden",3,"shouldDockBottom","shouldDockMiddle","stateChange"],["changeRouteDrawer",""],[1,"ion-align-items-baseline"],[1,"ion-text-center"],["size","6",1,"ion-text-center"],["routeInput",""],["button","",3,"click"],["type","indeterminate"],["color","success","expand","block",3,"click",4,"ngIf"],["color","success","expand","block",3,"click"]],template:function(t,e){if(1&t){const t=u.Lb();u.Kb(0,"app-ionic-bottom-drawer",0,1),u.Wb("stateChange",function(t){return e.onSearchDrawerStateChange(t)}),u.Kb(2,"div",2),u.Kb(3,"div",3),u.Ib(4,"div",4),u.Ib(5,"div",5),u.Jb(),u.Kb(6,"app-search-input",6,7),u.Wb("discovery",function(t){return e.search.emit(t)})("route",function(t){return e.emitRoute(t)})("searchBarFocus",function(t){return e.onSearchFocus(t)}),u.Jb(),u.Kb(8,"ion-content",null,8),u.nc(10,vt,5,1,"ion-list",9),u.Kb(11,"ion-list",10),u.Kb(12,"ion-list-header"),u.Kb(13,"h2"),u.oc(14,"Choose a Campus"),u.Jb(),u.Jb(),u.nc(15,wt,6,3,"ion-item",11),u.Jb(),u.Ib(16,"div",12),u.Ib(17,"div",12),u.Ib(18,"div",12),u.Ib(19,"div",12),u.Ib(20,"div",12),u.Ib(21,"div",12),u.Jb(),u.Jb(),u.Jb(),u.Kb(22,"app-ionic-bottom-drawer",13,14),u.Kb(24,"div",2),u.Kb(25,"div",3),u.Ib(26,"div",4),u.Ib(27,"div",5),u.Ib(28,"div",15),u.Jb(),u.Kb(29,"ion-content"),u.Kb(30,"ion-grid",16),u.Kb(31,"ion-row",17),u.Kb(32,"ion-col"),u.Kb(33,"ion-label"),u.Kb(34,"h1"),u.oc(35),u.Jb(),u.Jb(),u.Kb(36,"ion-text"),u.oc(37),u.Jb(),u.Jb(),u.Kb(38,"ion-col",18),u.Kb(39,"ion-button",19),u.Wb("click",function(){return e.onCloseLocationDrawer()}),u.Ib(40,"ion-icon",20),u.Jb(),u.Jb(),u.Jb(),u.Kb(41,"ion-row"),u.Kb(42,"ion-col"),u.Kb(43,"ion-button",21),u.Wb("click",function(){return e.detailsClick.emit()}),u.oc(44," Details "),u.Jb(),u.Jb(),u.Kb(45,"ion-col"),u.Kb(46,"ion-button",22),u.Wb("click",function(){return e.onRouteClick()}),u.oc(47," Route "),u.Jb(),u.Jb(),u.Jb(),u.nc(48,yt,5,2,"ion-row",23),u.Jb(),u.Jb(),u.Jb(),u.Jb(),u.Kb(49,"app-ionic-bottom-drawer",24,25),u.Kb(51,"div",2),u.Kb(52,"div",3),u.Ib(53,"div",4),u.Ib(54,"div",5),u.Ib(55,"div",15),u.nc(56,St,1,0,"ion-progress-bar",26),u.Kb(57,"ion-grid"),u.Kb(58,"ion-row",17),u.Kb(59,"ion-col"),u.Kb(60,"ion-label"),u.Kb(61,"h1"),u.oc(62),u.Jb(),u.Jb(),u.Kb(63,"ion-text"),u.oc(64,"From "),u.Kb(65,"span",27),u.Wb("click",function(){return e.onChangeRouteStartEndClick()}),u.oc(66),u.Jb(),u.Jb(),u.Jb(),u.Kb(67,"ion-col",18),u.Kb(68,"ion-button",19),u.Wb("click",function(){return e.onCloseRouteDrawer()}),u.Ib(69,"ion-icon",20),u.Jb(),u.Jb(),u.Jb(),u.nc(70,xt,9,3,"ion-row",28),u.Jb(),u.Jb(),u.Kb(71,"ion-content"),u.nc(72,Rt,2,1,"ion-list",28),u.Ib(73,"div",12),u.Ib(74,"div",12),u.Ib(75,"div",12),u.Ib(76,"div",12),u.Ib(77,"div",12),u.Ib(78,"div",12),u.Ib(79,"div",12),u.Ib(80,"div",12),u.Jb(),u.Jb(),u.Jb(),u.Kb(81,"app-ionic-bottom-drawer",29,30),u.Kb(83,"div",2),u.Kb(84,"div",3),u.Ib(85,"div",4),u.Ib(86,"div",5),u.Ib(87,"div",15),u.Kb(88,"ion-grid"),u.Kb(89,"ion-row"),u.Kb(90,"ion-col"),u.Kb(91,"ion-label"),u.Kb(92,"h2"),u.oc(93),u.Jb(),u.Jb(),u.Kb(94,"ion-text"),u.oc(95),u.Jb(),u.Jb(),u.Kb(96,"ion-col"),u.Kb(97,"ion-button",31),u.Wb("click",function(){return e.onEndNavigationClick()}),u.oc(98," End Route "),u.Jb(),u.Jb(),u.Jb(),u.Jb(),u.Jb(),u.Jb(),u.Jb(),u.Kb(99,"app-ionic-bottom-drawer",32,33),u.Wb("stateChange",function(t){return e.onChangeRouteDrawerStateChange(t)}),u.Kb(101,"div",2),u.Kb(102,"div",3),u.Ib(103,"div",4),u.Ib(104,"div",5),u.Kb(105,"ion-grid"),u.Kb(106,"ion-row",34),u.Kb(107,"ion-col",35),u.Kb(108,"span",27),u.Wb("click",function(){return e.onCancelChangeRoute()}),u.oc(109,"Cancel"),u.Jb(),u.Jb(),u.Kb(110,"ion-col",36),u.Kb(111,"h3"),u.oc(112,"Change Route"),u.Jb(),u.Jb(),u.Kb(113,"ion-col",35),u.Kb(114,"span",27),u.Wb("click",function(){u.ic(t);const n=u.gc(117);return e.newRoute.emit([n.From,n.To])}),u.oc(115,"Route"),u.Jb(),u.Jb(),u.Jb(),u.Jb(),u.Jb(),u.Ib(116,"app-route-input",null,37),u.Jb(),u.Jb()}2&t&&(u.xb(10),u.dc("ngIf",e.model.recentSearches.length>0),u.xb(5),u.dc("ngForOf",e.model.availableCampus),u.xb(20),u.pc(e.model.latestSearchResult.Name),u.xb(2),u.pc(e.model.latestSearchResult.Description),u.xb(11),u.dc("ngForOf",e.model.latestSearchResult.Information),u.xb(8),u.dc("ngIf",0===e.model.Route.Distance),u.xb(6),u.qc("To ",e.model.Route.Destination.Name,""),u.xb(4),u.pc(e.model.Route.Start.Name),u.xb(4),u.dc("ngIf",0!==e.model.Route.Distance),u.xb(2),u.dc("ngIf",0!==e.model.Route.Distance),u.xb(21),u.qc("",e.model.Route.Time," min"),u.xb(2),u.qc("",e.model.Route.Distance," m"),u.xb(4),u.dc("shouldDockBottom",!1)("shouldDockMiddle",!1))},directives:[F.a,K,o.p,r.j,o.B,o.C,r.i,o.u,o.J,o.o,o.A,o.S,o.h,o.w,lt,o.y,o.E],styles:[".vertical-line[_ngcontent-%COMP%]{border-left:2px solid #9d9fa6;height:38px}.span-button[_ngcontent-%COMP%]{color:var(--ion-color-primary,#3880ff)}.span-button[_ngcontent-%COMP%]:hover{cursor:pointer}.nav-hbar[_ngcontent-%COMP%]{border-top:2px solid var(--ion-color-medium,#9d9fa6);border-bottom:2px solid var(--ion-color-medium,#9d9fa6);border-radius:2px;height:0;width:auto;margin:0 45%}.nav-bottom-drawer[_ngcontent-%COMP%]{background-color:var(--ion-color-white,#fff);border-top-left-radius:20px;border-top-right-radius:20px;box-shadow:0 4px 8px 0 rgba(0,0,0,.4),0 6px 20px 0 rgba(0,0,0,.29);height:inherit}.square-md[_ngcontent-%COMP%]{height:64px;width:64px}.square-sm[_ngcontent-%COMP%]{height:32px;width:32px}.square-xs[_ngcontent-%COMP%]{height:16px;width:16px}#locationdrawerContent[_ngcontent-%COMP%]{margin-left:30px;margin-right:30px;position:center}#locationdrawerName[_ngcontent-%COMP%]{font-weight:700}#inNavigationDrawer[_ngcontent-%COMP%]{z-index:1}#locationDrawer[_ngcontent-%COMP%]{z-index:2}#routeDrawer[_ngcontent-%COMP%]{z-index:3}#searchDrawer[_ngcontent-%COMP%]{z-index:4}"]}),t})();const Ot=["searchInput"],Lt=["navSlides"],Kt=["drawerManager"];function Dt(t,e){1&t&&u.Ib(0,"ion-progress-bar",9)}function Ft(t,e){if(1&t&&(u.Kb(0,"ion-text",10),u.Kb(1,"h5"),u.Kb(2,"span",11),u.oc(3),u.Jb(),u.Jb(),u.Kb(4,"p"),u.Ob(5,12),u.Jb(),u.Kb(6,"p"),u.Rb(7,13),u.Ib(8,"br"),u.Ib(9,"a",14),u.Pb(),u.Jb(),u.Jb()),2&t){const t=u.Yb();u.xb(3),u.pc(t.errorMessage)}}const{Keyboard:Jt}=E.a,Pt=Z.icon({iconRetinaUrl:"leaflet/marker-icon-2x.png",iconUrl:"leaflet/marker-icon.png",shadowUrl:"leaflet/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]});Z.Marker.prototype.options.icon=Pt;let Nt=(()=>{class t{constructor(t,e,n,o,i,r,a,s){this.dataService=t,this.router=e,this.model=n,this.storage=o,this.geolocation=i,this.openStreetMapService=r,this.lastOpenStreetMapCenterPersistence=a,this.platform=s,this.searchMarker=[],this.routes=[],this.progressIsVisible=!1,this.currentPositionMarker=null,this.isInitialized=!1,this.DEFAULT_ZOOM=17,this.MAX_ZOOM=18,this.MIN_ZOOM=14,this.isHybridPlatform=this.platform.is("hybrid")}static convertToLeafLetCoordinates(t){const e=[];for(const n of t)e.push({lat:n.Latitude,lng:n.Longitude});return e}ngOnInit(){return Object(s.a)(this,void 0,void 0,function*(){if(!this.model.availableCampus||0===this.model.availableCampus.length){const t=yield this.dataService.get_campus_search().toPromise();for(const e of t)this.model.availableCampus.push(new J(e))}})}ionViewDidEnter(){return Object(s.a)(this,void 0,void 0,function*(){this.isInitialized||(yield this.initializeMap(this.router),this.isInitialized=!0);try{const t=yield this.geolocation.getCurrentPosition();null===this.currentPositionMarker?this.currentPositionMarker=Z.marker([t.coords.latitude,t.coords.longitude]).addTo(this.map).bindPopup("Position"):this.currentPositionMarker.setLatLng([t.coords.latitude,t.coords.longitude])}catch(t){console.log("Error getting location",t)}})}initializeMap(e){var n;return Object(s.a)(this,void 0,void 0,function*(){const o=yield this.openStreetMapService.GetBounds(),i=Z.latLng(o.SouthWest.Lat,o.SouthWest.Lng),r=Z.latLng(o.NorthEast.Lat,o.NorthEast.Lng),a=Z.latLngBounds(i,r);console.log(o,a),this.map=Z.map("leafletMap",{maxBounds:a,maxZoom:this.MAX_ZOOM,minZoom:this.MIN_ZOOM,zoomControl:!this.platform.is("hybrid")}),this.map.on("moveend",t=>{ot.persist(this.storage,{center:t.target.getCenter(),zoom:t.target.getZoom()})}),yield this.lastOpenStreetMapCenterPersistence.load(this.storage,this.map,this.DEFAULT_ZOOM),Z.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"edupala.com \xa9 Angular LeafLet"}).addTo(this.map),this.platform.is("hybrid")&&(yield this.delay(500),this.map.invalidateSize());const s=yield this.dataService.get_buildings_search().toPromise();function c(t){e.navigate(["tabs/navigation/detail"],{queryParams:{building:t.target.options.className}}).then(()=>console.log(t.latlng,t.target.options.className))}if(null!==s)for(const e of s)null!==e.Body&&e.Body.length>0&&Z.polygon(t.convertToLeafLetCoordinates(e.Body),{className:e.Name,color:null!==(n=e.Color)&&void 0!==n?n:"#0083C6"}).addTo(this.map).on("click",c)})}ngOnDestroy(){this.map.remove()}onSearch(t){return Object(s.a)(this,void 0,void 0,function*(){this.model.errorMessage="",this.progressIsVisible=!0;try{this.clearSearchMarkers();try{const e=yield this.dataService.get_location(t).toPromise();if(e){const t=yield this.dataService.get_building(e.Building).toPromise(),n=this.getCenterCoordinateFromBody(t.Body);return yield this.model.addRecentSearchLocation(e,{lat:n.Latitude,lng:n.Longitude}),this.searchMarker.push(this.showMarker(n.Latitude,n.Longitude,"Room "+e.Name,!0)),this.map.flyTo(this.model.latestSearchResult.LatLng,this.DEFAULT_ZOOM),void(yield this.showElementDrawer())}}catch(e){console.log(e)}try{const e=yield this.dataService.get_building(t,!1).toPromise();if(e){const t=this.getCenterCoordinateFromBody(e.Body);return yield this.model.addRecentSearchBuilding(e,{lat:t.Latitude,lng:t.Longitude}),this.map.flyTo(this.model.latestSearchResult.LatLng,this.DEFAULT_ZOOM),this.searchMarker.push(this.showMarker(t.Latitude,t.Longitude,"Building "+e.Name,!0)),void(yield this.showElementDrawer())}}catch(e){console.log(e)}try{const e=yield this.dataService.get_campus(t,!1).toPromise();if(e)return yield this.model.addRecentSearchCampus(e),this.searchMarker.push(this.showMarker(e.Latitude,e.Longitude,"Campus "+e.Name,!0)),this.map.flyTo([e.Latitude,e.Longitude],this.DEFAULT_ZOOM),void(yield this.showElementDrawer())}catch(e){console.log(e)}const n=yield this.dataService.get_buildings_search(t).toPromise();if(null!==n&&n.length>0)for(const t of n){const e=this.getCenterCoordinateFromBody(t.Body);this.searchMarker.push(this.showMarker(e.Latitude,e.Longitude,t.Name,!1))}else{const e=yield this.dataService.get_campus_search(t).toPromise();if(null!==e&&e.length>0)for(const t of e)this.searchMarker.push(this.showMarker(t.Latitude,t.Longitude,t.Name,!1))}}catch(n){this.handleInputError(n,t)}finally{this.progressIsVisible=!1}})}onRoute(t){return Object(s.a)(this,void 0,void 0,function*(){console.log(t),this.clearRoutes(),yield this.drawerManager.SetState(Mt.RouteView,!1);const e=yield this.openStreetMapService.GetRoute(t[0].LatLng,t[1].LatLng);this.model.SetOsmRouteAsRoute(e[0],t[0],t[1]);const n=Z.polyline(this.model.Route.Coordinates,{color:"red"}).addTo(this.map);this.map.flyTo(n.getCenter(),this.DEFAULT_ZOOM),yield this.map.fitBounds(n.getBounds()),this.routes.push(n)})}onCloseLocationDrawer(t){return Object(s.a)(this,void 0,void 0,function*(){this.searchInput.clearDestinationInput(),yield this.drawerManager.SetState(Mt.SearchView),this.clearSearchMarkers()})}onCloseRouteDrawer(t){return Object(s.a)(this,void 0,void 0,function*(){this.clearRoutes(),yield this.drawerManager.SetState(Mt.LocationView),this.map.flyTo(this.model.latestSearchResult.LatLng,this.DEFAULT_ZOOM)})}showElementDrawer(){return Object(s.a)(this,void 0,void 0,function*(){this.isHybridPlatform&&(yield Jt.hide()),yield this.drawerManager.SetState(Mt.LocationView)})}onCampusClick(t){this.map.flyTo(t.LatLng,this.DEFAULT_ZOOM)}onDrawerManagerStateChange(t){return Object(s.a)(this,void 0,void 0,function*(){switch(console.log(t),t){case Mt.SearchView:this.clearSearchMarkers();break;case Mt.LocationView:this.clearRoutes(),this.map.flyTo(this.model.latestSearchResult.LatLng,this.DEFAULT_ZOOM);break;case Mt.RouteView:yield this.onRouteBtnClick();break;case Mt.InNavigationView:yield this.onLaunchNavigation()}})}onDetailsClick(){return Object(s.a)(this,void 0,void 0,function*(){yield this.router.navigate(["tabs/navigation/detail"],{queryParams:0===this.routes.length?this.model.latestSearchResult.DetailRouterParams:this.model.latestSearchResult.RouteRouterParams})})}onRouteBtnClick(){return Object(s.a)(this,void 0,void 0,function*(){const e=yield this.geolocation.getCurrentPosition(),n={lat:e.coords.latitude,lng:e.coords.longitude},o=yield this.openStreetMapService.GetRoute(n,this.model.latestSearchResult.LatLng);this.model.SetOsmRouteAsRoute(o[0],{Name:t.MyLocation,LatLng:n},this.model.latestSearchResult);const i=Z.polyline(this.model.Route.Coordinates,{color:"red"}).addTo(this.map);this.map.flyTo(i.getCenter(),this.DEFAULT_ZOOM),yield this.map.fitBounds(i.getBounds()),this.routes.push(i)})}onLaunchNavigation(){return Object(s.a)(this,void 0,void 0,function*(){this.navSlides.instructions=this.model.Route.NavigationInstructions,yield this.navSlides.show(),this.map.flyTo(this.model.Route.Coordinates[this.model.Route.NavigationInstructions[0].Interval[0]],this.MAX_ZOOM)})}onSlideChange(t){this.onNavigationInstructionClick(this.model.Route.NavigationInstructions[t])}onNavigationInstructionClick(t){this.map.flyTo(this.model.Route.Coordinates[t.Interval[0]],this.MAX_ZOOM)}handleInputError(t,e){if(t instanceof x.d){const n=t;this.errorMessage=400===n.status?"Studi-Guide can't find "+e:n.message}else this.errorMessage=t.message}showMarker(t,e,n="",o){const i=Z.marker([t,e]).addTo(this.map);return n?o?i.bindPopup(n).openPopup():i.bindPopup(n):i}getCenterCoordinateFromBody(t){const e=[];for(const i of t)e.push([i.Latitude,i.Longitude]);const n=new Z.Polygon(e).addTo(this.map),o={Longitude:n.getCenter().lng,Latitude:n.getCenter().lat};return n.remove(),o}clearSearchMarkers(){for(const t of this.searchMarker)this.map.removeLayer(t)}clearRoutes(){for(const t of this.routes)t.remove();this.routes=[],this.model.ClearRoute(),this.navSlides.hide()}delay(t){return new Promise(e=>setTimeout(e,t))}}return t.MyLocation="My Location",t.\u0275fac=function(e){return new(e||t)(u.Hb(c.a),u.Hb(i.g),u.Hb(T),u.Hb(N.b),u.Hb($.a),u.Hb(Q),u.Hb(ot),u.Hb(o.bb))},t.\u0275cmp=u.Bb({type:t,selectors:[["app-map-page"]],viewQuery:function(t,e){if(1&t&&(u.sc(Ot,!0),u.sc(Lt,!0),u.sc(Kt,!0)),2&t){let t;u.fc(t=u.Xb())&&(e.searchInput=t.first),u.fc(t=u.Xb())&&(e.navSlides=t.first),u.fc(t=u.Xb())&&(e.drawerManager=t.first)}},decls:9,vars:2,consts:function(){let t,e;return t="\xDCberpr\xFCfe deine Eingabe auf Rechtschreibfehler.",e="Sollte dieser Ort im Studi-Guide sein?\n        " + "\ufffd#8\ufffd\ufffd/#8\ufffd" + "\n        " + "\ufffd#9\ufffd" + "F\xFCge den Ort hinzu" + "\ufffd/#9\ufffd" + "\n      ",[[3,"nextSlide","previousSlide"],["navSlides",""],[3,"campusClick","navInstructionClick","search","detailsClick","stateChange","newRoute"],["drawerManager",""],["data-tap-disabled","true","scroll-y","false"],["type","indeterminate","color","secondary",4,"ngIf"],["id","map-content"],["id","error-message",4,"ngIf"],["id","leafletMap"],["type","indeterminate","color","secondary"],["id","error-message"],[1,"error"],t,e,["href","https://github.com/Studi-Guide/Studi-Guide/issues/new/choose"]]},template:function(t,e){1&t&&(u.Kb(0,"app-navigation-instruction-slides",0,1),u.Wb("nextSlide",function(t){return e.onSlideChange(t)})("previousSlide",function(t){return e.onSlideChange(t)}),u.Jb(),u.Kb(2,"app-nav-drawer-manager",2,3),u.Wb("campusClick",function(t){return e.onCampusClick(t)})("navInstructionClick",function(t){return e.onNavigationInstructionClick(t)})("search",function(t){return e.onSearch(t)})("detailsClick",function(){return e.onDetailsClick()})("stateChange",function(t){return e.onDrawerManagerStateChange(t)})("newRoute",function(t){return e.onRoute(t)}),u.Jb(),u.Kb(4,"ion-content",4),u.nc(5,Dt,1,0,"ion-progress-bar",5),u.Kb(6,"div",6),u.nc(7,Ft,10,1,"ion-text",7),u.Ib(8,"div",8),u.Jb(),u.Jb()),2&t&&(u.xb(5),u.dc("ngIf",e.progressIsVisible),u.xb(2),u.dc("ngIf",e.errorMessage))},directives:[nt,kt,o.p,r.j,o.E,o.S],styles:["#map-content[_ngcontent-%COMP%]{height:100%;width:100%;position:fixed}.error[_ngcontent-%COMP%]{color:red}#error-message[_ngcontent-%COMP%]{margin-left:20px}#leafletMap[_ngcontent-%COMP%]{height:100%;width:100%;z-index:0}#leafletMap[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}#available-floors-btn[_ngcontent-%COMP%]{position:fixed;bottom:0;display:block;z-index:10}.draggable[_ngcontent-%COMP%]{cursor:-webkit-grab;cursor:grab}.draggable[_ngcontent-%COMP%]:active{cursor:-webkit-grabbing;cursor:grabbing}.center[_ngcontent-%COMP%]{margin-left:auto;margin-right:auto;display:block}ion-progress-bar[_ngcontent-%COMP%]{position:absolute;z-index:9999}"]}),t})(),Bt=(()=>{class t{}return t.\u0275mod=u.Fb({type:t}),t.\u0275inj=u.Eb({factory:function(e){return new(e||t)},imports:[[o.W,r.b,a.a,i.i.forChild([{path:"detail",component:G},{path:"",component:Nt}]),q]]}),t})();u.lc(G,[o.v,o.V,o.i,o.f,o.g,o.p,r.j,o.E,o.S,C,F.a,K,o.u,o.C,o.J,o.o,o.h,o.w,o.B,r.i,o.y,o.A],[])},wyfB:function(t,e){function n(t){return t&&t.ownerSVGElement&&t.getCTM}t.exports=function(t,e){if(!n(t))throw new Error("svg element is required for svg.panzoom to work");var o=t.ownerSVGElement;if(!o)throw new Error("Do not apply panzoom to the root <svg> element. Use its child instead (e.g. <g></g>). As of March 2016 only FireFox supported transform on the root element");return e.disableKeyboardInteraction||o.setAttribute("tabindex",0),{getBBox:function(){var e=t.getBBox();return{left:e.x,top:e.y,width:e.width,height:e.height}},getScreenCTM:function(){return o.getCTM()||o.getScreenCTM()},getOwner:function(){return o},applyTransform:function(e){t.setAttribute("transform","matrix("+e.scale+" 0 0 "+e.scale+" "+e.x+" "+e.y+")")},initTransform:function(e){var n=t.getCTM();null===n&&(n=document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix()),e.x=n.e,e.y=n.f,e.scale=n.a,o.removeAttributeNS(null,"viewBox")}}},t.exports.canAttach=n}}]);