(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"0Tit":function(t,e){var i="function"==typeof Float32Array;function n(t,e){return 1-3*e+3*t}function o(t,e){return 3*e-6*t}function r(t){return 3*t}function a(t,e,i){return((n(e,i)*t+o(e,i))*t+r(e))*t}function s(t,e,i){return 3*n(e,i)*t*t+2*o(e,i)*t+r(e)}function c(t){return t}t.exports=function(t,e,n,o){if(!(0<=t&&t<=1&&0<=n&&n<=1))throw new Error("bezier x values must be in [0, 1] range");if(t===e&&n===o)return c;for(var r=i?new Float32Array(11):new Array(11),l=0;l<11;++l)r[l]=a(.1*l,t,n);return function(i){return 0===i?0:1===i?1:a(function(e){for(var i=0,o=1;10!==o&&r[o]<=e;++o)i+=.1;--o;var c=i+(e-r[o])/(r[o+1]-r[o])*.1,l=s(c,t,n);return l>=.001?function(t,e,i,n){for(var o=0;o<4;++o){var r=s(e,i,n);if(0===r)return e;e-=(a(e,i,n)-t)/r}return e}(e,c,t,n):0===l?c:function(t,e,i,n,o){var r,s,c=0;do{(r=a(s=e+(i-e)/2,n,o)-t)>0?i=s:e=s}while(Math.abs(r)>1e-7&&++c<10);return s}(e,i,i+.1,t,n)}(i),e,o)}}},"6f8I":function(t,e){function i(){return"function"==typeof cancelAnimationFrame?cancelAnimationFrame:clearTimeout}function n(){return"function"==typeof requestAnimationFrame?requestAnimationFrame:function(t){return setTimeout(t,16)}}t.exports=function(t,e,o){"object"!=typeof o&&(o={});var r,a,s,c,l,u,d,h,b,p,f="number"==typeof o.minVelocity?o.minVelocity:5,m="number"==typeof o.amplitude?o.amplitude:.25,g="function"==typeof o.cancelAnimationFrame?o.cancelAnimationFrame:i(),v="function"==typeof o.requestAnimationFrame?o.requestAnimationFrame:n();return{start:function(){r=t(),u=b=c=d=0,a=new Date,g(s),g(p),s=v(w)},stop:function(){g(s),g(p);var e=t();l=e.x,h=e.y,a=Date.now(),(c<-f||c>f)&&(l+=u=m*c),(d<-f||d>f)&&(h+=b=m*d),p=v(y)},cancel:function(){g(s),g(p)}};function w(){var e=Date.now(),i=e-a;a=e;var n=t(),o=n.x-r.x,l=n.y-r.y;r=n;var u=1e3/(1+i);c=.8*o*u+.2*c,d=.8*l*u+.2*d,s=v(w)}function y(){var t=Date.now()-a,i=!1,n=0,o=0;u&&((n=-u*Math.exp(-t/342))>.5||n<-.5?i=!0:n=u=0),b&&((o=-b*Math.exp(-t/342))>.5||o<-.5?i=!0:o=b=0),i&&(e(l+n,h+o),p=v(y))}}},AMdQ:function(t,e){t.exports=function(t){!function(t){if(!t)throw new Error("Eventify cannot use falsy object as events subject");for(var e=["on","fire","off"],i=0;i<e.length;++i)if(t.hasOwnProperty(e[i]))throw new Error("Subject cannot be eventified, since it already has property '"+e[i]+"'")}(t);var e=function(t){var e=Object.create(null);return{on:function(i,n,o){if("function"!=typeof n)throw new Error("callback is expected to be a function");var r=e[i];return r||(r=e[i]=[]),r.push({callback:n,ctx:o}),t},off:function(i,n){if(void 0===i)return e=Object.create(null),t;if(e[i])if("function"!=typeof n)delete e[i];else for(var o=e[i],r=0;r<o.length;++r)o[r].callback===n&&o.splice(r,1);return t},fire:function(i){var n,o=e[i];if(!o)return t;arguments.length>1&&(n=Array.prototype.splice.call(arguments,1));for(var r=0;r<o.length;++r){var a=o[r];a.callback.apply(a.ctx,n)}return t}}}(t);return t.on=e.on,t.off=e.off,t.fire=e.fire,t}},AgEI:function(t,e){function i(t){return t.stopPropagation(),!1}function n(){}t.exports=function(t){if(t)return{capture:n,release:n};var e,o,r,a=!1;return{capture:function(t){a=!0,o=window.document.onselectstart,r=window.document.ondragstart,window.document.onselectstart=i,(e=t).ondragstart=i},release:function(){a&&(a=!1,window.document.onselectstart=o,e&&(e.ondragstart=r))}}}},EnSQ:function(t,e,i){"use strict";i.d(e,"a",function(){return O});var n=i("AytR"),o=i("EY2u"),r=i("XNiG"),a=i("quSY");class s extends a.a{constructor(t,e){super()}schedule(t,e=0){return this}}class c extends s{constructor(t,e){super(t,e),this.scheduler=t,this.work=e,this.pending=!1}schedule(t,e=0){if(this.closed)return this;this.state=t;const i=this.id,n=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(n,i,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(n,this.id,e),this}requestAsyncId(t,e,i=0){return setInterval(t.flush.bind(t,this),i)}recycleAsyncId(t,e,i=0){if(null!==i&&this.delay===i&&!1===this.pending)return e;clearInterval(e)}execute(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(t,e);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,e){let i=!1,n=void 0;try{this.work(t)}catch(o){i=!0,n=!!o&&o||new Error(o)}if(i)return this.unsubscribe(),n}_unsubscribe(){const t=this.id,e=this.scheduler,i=e.actions,n=i.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==n&&i.splice(n,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null}}class l extends c{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}schedule(t,e=0){return e>0?super.schedule(t,e):(this.delay=e,this.state=t,this.scheduler.flush(this),this)}execute(t,e){return e>0||this.closed?super.execute(t,e):this._execute(t,e)}requestAsyncId(t,e,i=0){return null!==i&&i>0||null===i&&this.delay>0?super.requestAsyncId(t,e,i):t.flush(this)}}let u=(()=>{class t{constructor(e,i=t.now){this.SchedulerAction=e,this.now=i}schedule(t,e=0,i){return new this.SchedulerAction(this,t).schedule(i,e)}}return t.now=()=>Date.now(),t})();class d extends u{constructor(t,e=u.now){super(t,()=>d.delegate&&d.delegate!==this?d.delegate.now():e()),this.actions=[],this.active=!1,this.scheduled=void 0}schedule(t,e=0,i){return d.delegate&&d.delegate!==this?d.delegate.schedule(t,e,i):super.schedule(t,e,i)}flush(t){const{actions:e}=this;if(this.active)return void e.push(t);let i;this.active=!0;do{if(i=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,i){for(;t=e.shift();)t.unsubscribe();throw i}}}class h extends d{}const b=new h(l);var p=i("7o/Q"),f=i("LRne"),m=i("HDdC");let g=(()=>{class t{constructor(t,e,i){this.kind=t,this.value=e,this.error=i,this.hasValue="N"===t}observe(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}}do(t,e,i){switch(this.kind){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return i&&i()}}accept(t,e,i){return t&&"function"==typeof t.next?this.observe(t):this.do(t,e,i)}toObservable(){switch(this.kind){case"N":return Object(f.a)(this.value);case"E":return t=this.error,new m.a(e=>e.error(t));case"C":return Object(o.b)()}var t;throw new Error("unexpected notification kind value")}static createNext(e){return void 0!==e?new t("N",e):t.undefinedValueNotification}static createError(e){return new t("E",void 0,e)}static createComplete(){return t.completeNotification}}return t.completeNotification=new t("C"),t.undefinedValueNotification=new t("N",void 0),t})();class v extends p.a{constructor(t,e,i=0){super(t),this.scheduler=e,this.delay=i}static dispatch(t){const{notification:e,destination:i}=t;e.observe(i),this.unsubscribe()}scheduleMessage(t){this.destination.add(this.scheduler.schedule(v.dispatch,this.delay,new w(t,this.destination)))}_next(t){this.scheduleMessage(g.createNext(t))}_error(t){this.scheduleMessage(g.createError(t)),this.unsubscribe()}_complete(){this.scheduleMessage(g.createComplete()),this.unsubscribe()}}class w{constructor(t,e){this.notification=t,this.destination=e}}var y=i("9ppp"),S=i("Ylt2");class C extends r.a{constructor(t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,i){super(),this.scheduler=i,this._events=[],this._infiniteTimeWindow=!1,this._bufferSize=t<1?1:t,this._windowTime=e<1?1:e,e===Number.POSITIVE_INFINITY?(this._infiniteTimeWindow=!0,this.next=this.nextInfiniteTimeWindow):this.next=this.nextTimeWindow}nextInfiniteTimeWindow(t){if(!this.isStopped){const e=this._events;e.push(t),e.length>this._bufferSize&&e.shift()}super.next(t)}nextTimeWindow(t){this.isStopped||(this._events.push(new L(this._getNow(),t)),this._trimBufferThenGetEvents()),super.next(t)}_subscribe(t){const e=this._infiniteTimeWindow,i=e?this._events:this._trimBufferThenGetEvents(),n=this.scheduler,o=i.length;let r;if(this.closed)throw new y.a;if(this.isStopped||this.hasError?r=a.a.EMPTY:(this.observers.push(t),r=new S.a(this,t)),n&&t.add(t=new v(t,n)),e)for(let a=0;a<o&&!t.closed;a++)t.next(i[a]);else for(let a=0;a<o&&!t.closed;a++)t.next(i[a].value);return this.hasError?t.error(this.thrownError):this.isStopped&&t.complete(),r}_getNow(){return(this.scheduler||b).now()}_trimBufferThenGetEvents(){const t=this._getNow(),e=this._bufferSize,i=this._windowTime,n=this._events,o=n.length;let r=0;for(;r<o&&!(t-n[r].time<i);)r++;return o>e&&(r=Math.max(r,o-e)),r>0&&n.splice(0,r),n}}class L{constructor(t,e){this.time=t,this.value=e}}var x=i("JIr8"),R=i("fXoL");let I=(()=>{class t{constructor(){this.cache={}}Get(t,e,i=!0){return this.cache[e]||(console.log("CacheService: Request received "+e),this.cache[e]=t.get(e).pipe(function(t,e,i){let n;return n={bufferSize:1,windowTime:void 0,refCount:!1,scheduler:void 0},t=>t.lift(function({bufferSize:t=Number.POSITIVE_INFINITY,windowTime:e=Number.POSITIVE_INFINITY,refCount:i,scheduler:n}){let o,r,a=0,s=!1,c=!1;return function(l){let u;a++,!o||s?(s=!1,o=new C(t,e,n),u=o.subscribe(this),r=l.subscribe({next(t){o.next(t)},error(t){s=!0,o.error(t)},complete(){c=!0,r=void 0,o.complete()}})):u=o.subscribe(this),this.add(()=>{a--,u.unsubscribe(),r&&!c&&i&&0===a&&(r.unsubscribe(),r=void 0,o=void 0)})}}(n))}(),Object(x.a)(t=>(i&&console.log(t),delete this.cache[e],o.a)))),this.cache[e]}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=R.Eb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var M=i("tk/3");let O=(()=>{class t{constructor(t,e,i){this.httpClient=t,this.env=e,this.cache=i,console.log("Using ",e.serverUrl),this.baseUrl=e.serverUrl}get_map_floor(t,e){return this.cache.Get(this.httpClient,this.baseUrl+"/maps/buildings/"+t+"/floors/"+e)}get_map_items(t,e,i){return this.cache.Get(this.httpClient,this.baseUrl+"/maps?floor="+(null!=e?e:"")+"&campus="+(null!=t?t:"")+"&building="+(null!=i?i:""))}get_locations_items(t,e,i){return this.cache.Get(this.httpClient,this.baseUrl+"/locations?floor="+(null!=e?e:"")+"&campus="+(null!=t?t:"")+"&building="+(null!=i?i:""))}get_route(t,e){return this.cache.Get(this.httpClient,this.baseUrl+"/navigation/dir?start="+encodeURI(t)+"&end="+encodeURI(e))}get_locations_all(){return this.cache.Get(this.httpClient,this.baseUrl+"/locations")}get_locations_search(t){return this.cache.Get(this.httpClient,this.baseUrl+"/locations?search="+encodeURI(t))}get_location(t){return this.cache.Get(this.httpClient,this.baseUrl+"/locations/"+encodeURI(t))}get_locations(t,e){return this.cache.Get(this.httpClient,this.baseUrl+"/buildings/"+t+"/floors/"+e+"/locations")}get_building(t,e=!0){return this.cache.Get(this.httpClient,this.baseUrl+"/buildings/"+encodeURI(t),e)}get_building_floor(t,e=!0){return this.cache.Get(this.httpClient,this.baseUrl+"/buildings/"+encodeURI(t)+"/floors",e)}get_buildings_search(t=""){return this.cache.Get(this.httpClient,this.baseUrl+"/buildings"+encodeURI(t?"?name="+t:""))}get_map_item(t){return this.cache.Get(this.httpClient,this.baseUrl+"/maps?pathnodeid="+t)}get_campus(t,e=!0){return this.cache.Get(this.httpClient,this.baseUrl+"/campus/"+encodeURI(t),e)}get_campus_search(t=""){return this.cache.Get(this.httpClient,this.baseUrl+"/campus"+encodeURI(t?"?search="+t:""))}get_rssFeed(t){return this.httpClient.get(this.baseUrl+"/rssfeed/"+t,{responseType:"text"})}}return t.\u0275fac=function(e){return new(e||t)(R.Tb(M.b),R.Tb(n.a),R.Tb(I))},t.\u0275prov=R.Eb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},QIvw:function(t,e){t.exports=function(){this.x=0,this.y=0,this.scale=1}},Vkd7:function(t,e){function i(t){return t&&t.parentElement&&t.style}t.exports=function(t,e){if(!i(t))throw new Error("panzoom requires DOM element to be attached to the DOM tree");var n=t.parentElement;return t.scrollTop=0,e.disableKeyboardInteraction||n.setAttribute("tabindex",0),{getBBox:function(){return{left:0,top:0,width:t.clientWidth,height:t.clientHeight}},getOwner:function(){return n},applyTransform:function(e){t.style.transformOrigin="0 0 0",t.style.transform="matrix("+e.scale+", 0, 0, "+e.scale+", "+e.x+", "+e.y+")"}}},t.exports.canAttach=i},cQc6:function(t,e){t.exports=function(t,e){for(var i=t[0],n=t[1],o=!1,r=0,a=e.length-1;r<e.length;a=r++){var s=e[r][0],c=e[r][1],l=e[a][1];c>n!=l>n&&i<(e[a][0]-s)*(n-c)/(l-c)+s&&(o=!o)}return o}},dwjH:function(t,e,i){var n=i("0Tit"),o={ease:n(.25,.1,.25,1),easeIn:n(.42,0,1,1),easeOut:n(0,0,.58,1),easeInOut:n(.42,0,.58,1),linear:n(0,0,1,1)};function r(){}function a(){var t=new Set,e=new Set,i=0;return{next:n,cancel:n,clearAll:function(){t.clear(),e.clear(),cancelAnimationFrame(i),i=0}};function n(t){e.add(t),i||(i=requestAnimationFrame(o))}function o(){i=0;var n=e;e=t,(t=n).forEach(function(t){t()}),t.clear()}}t.exports=function(t,e,i){var n=Object.create(null),a=Object.create(null),s="function"==typeof(i=i||{}).easing?i.easing:o[i.easing];s||(i.easing&&console.warn("Unknown easing function in amator: "+i.easing),s=o.ease);var c="function"==typeof i.step?i.step:r,l="function"==typeof i.done?i.done:r,u=function(t){if(!t)return"undefined"!=typeof window&&window.requestAnimationFrame?{next:window.requestAnimationFrame.bind(window),cancel:window.cancelAnimationFrame.bind(window)}:{next:function(t){return setTimeout(t,1e3/60)},cancel:function(t){return clearTimeout(t)}};if("function"!=typeof t.next)throw new Error("Scheduler is supposed to have next(cb) function");if("function"!=typeof t.cancel)throw new Error("Scheduler is supposed to have cancel(handle) function");return t}(i.scheduler),d=Object.keys(e);d.forEach(function(i){n[i]=t[i],a[i]=e[i]-t[i]});var h,b=Math.max(1,.06*("number"==typeof i.duration?i.duration:400)),p=0;return h=u.next(function e(){var i=s(p/b);p+=1,function(e){d.forEach(function(i){t[i]=a[i]*e+n[i]})}(i),p<=b?(h=u.next(e),c(t)):(h=0,setTimeout(function(){l(t)},0))}),{cancel:function(){u.cancel(h),h=0}}},t.exports.makeAggregateRaf=a,t.exports.sharedScheduler=a()},fQX0:function(t,e,i){"use strict";var n=i("fWck"),o=i("dwjH"),r=i("AMdQ"),a=i("6f8I"),s=i("AgEI"),c=s(),l=s(!0),u=i("QIvw"),d=i("wyfB"),h=i("Vkd7");function b(t,e){var i=(e=e||{}).controller;if(i||(d.canAttach(t)?i=d(t,e):h.canAttach(t)&&(i=h(t,e))),!i)throw new Error("Cannot create panzoom for the current type of dom element");var s=i.getOwner(),b={x:0,y:0},f=!1,w=new u;i.initTransform&&i.initTransform(w);var y,S="function"==typeof e.filterKey?e.filterKey:m,C="number"==typeof e.pinchSpeed?e.pinchSpeed:1,L=e.bounds,x="number"==typeof e.maxZoom?e.maxZoom:Number.POSITIVE_INFINITY,R="number"==typeof e.minZoom?e.minZoom:0,I="number"==typeof e.boundsPadding?e.boundsPadding:.05,M="number"==typeof e.zoomDoubleClickSpeed?e.zoomDoubleClickSpeed:1.75,O=e.beforeWheel||m,k=e.beforeMouseDown||m,D="number"==typeof e.zoomSpeed?e.zoomSpeed:1,K=p(e.transformOrigin),N=e.enableTextSelection?l:c;!function(t){var e=typeof t;if("undefined"!==e&&"boolean"!==e&&!(g(t.left)&&g(t.top)&&g(t.bottom)&&g(t.right)))throw new Error("Bounds object is not valid. It can be: undefined, boolean (true|false) or an object {left, top, right, bottom}")}(L),e.autocenter&&function(){var t,e,n=0,o=0,r=Q();if(r)n=r.left,o=r.top,t=r.right-r.left,e=r.bottom-r.top;else{var a=s.getBoundingClientRect();t=a.width,e=a.height}var c=i.getBBox();if(0!==c.width&&0!==c.height){var l=Math.min(t/c.width,e/c.height);w.x=-(c.left+c.width/2)*l+t/2+n,w.y=-(c.top+c.height/2)*l+e/2+o,w.scale=l}}();var P,F,_,T,E,A,B,j,V=0,J=!1,X=!1;E="smoothScroll"in e&&!e.smoothScroll?{start:m,stop:m,cancel:m}:a(function(){return{x:w.x,y:w.y}},function(t,e){xt(),H(t,e)},e.smoothScroll);var z=!1;ot();var G={dispose:function(){rt()},moveBy:nt,moveTo:H,smoothMoveTo:function(t,e){nt(t-w.x,e-w.y,!0)},centerOn:function(t){var e=t.ownerSVGElement;if(!e)throw new Error("ui element is required to be within the scene");var i=t.getBoundingClientRect(),n=i.left+i.width/2,o=i.top+i.height/2,r=e.getBoundingClientRect();nt(r.width/2-n,r.height/2-o,!0)},zoomTo:Lt,zoomAbs:it,smoothZoom:St,smoothZoomAbs:function(t,e,i){var n={scale:w.scale},r={scale:i};E.cancel(),xt(),B=o(n,r,{step:function(i){it(t,e,i.scale)}})},showRectangle:function(t){var e=s.getBoundingClientRect(),i=U(e.width,e.height),n=t.right-t.left,o=t.bottom-t.top;if(!Number.isFinite(n)||!Number.isFinite(o))throw new Error("Invalid rectangle");var r=Math.min(i.x/n,i.y/o);w.x=-(t.left+n/2)*r+i.x/2,w.y=-(t.top+o/2)*r+i.y/2,w.scale=r},pause:function(){rt(),z=!0},resume:function(){z&&(ot(),z=!1)},isPaused:function(){return z},getTransform:function(){return w},getMinZoom:function(){return R},setMinZoom:function(t){R=t},getMaxZoom:function(){return x},setMaxZoom:function(t){x=t},getTransformOrigin:function(){return K},setTransformOrigin:function(t){K=p(t)},getZoomSpeed:function(){return D},setZoomSpeed:function(t){if(!Number.isFinite(t))throw new Error("Zoom speed should be a number");D=t}};r(G);var Y="number"==typeof e.initialX?e.initialX:w.x,q="number"==typeof e.initialY?e.initialY:w.y,Z="number"==typeof e.initialZoom?e.initialZoom:w.scale;return Y==w.x&&q==w.y&&Z==w.Scale||it(Y,q,Z),G;function U(t,e){if(i.getScreenCTM){var n=i.getScreenCTM(),o=n.d,r=n.f;b.x=t*n.a-n.e,b.y=e*o-r}else b.x=t,b.y=e;return b}function H(t,e){w.x=t,w.y=e,W(),kt("pan"),tt()}function $(t,e){H(w.x+t,w.y+e)}function W(){var t=Q();if(t){var e,n,o=!1,r={left:(n={x:(e=i.getBBox()).left*w.scale+w.x,y:e.top*w.scale+w.y}).x,top:n.y,right:e.width*w.scale+n.x,bottom:e.height*w.scale+n.y},a=t.left-r.right;return a>0&&(w.x+=a,o=!0),(a=t.right-r.left)<0&&(w.x+=a,o=!0),(a=t.top-r.bottom)>0&&(w.y+=a,o=!0),(a=t.bottom-r.top)<0&&(w.y+=a,o=!0),o}}function Q(){if(L){if("boolean"==typeof L){var t=s.getBoundingClientRect(),e=t.width,i=t.height;return{left:e*I,top:i*I,right:e*(1-I),bottom:i*(1-I)}}return L}}function tt(){f=!0,y=window.requestAnimationFrame(at)}function et(t,e,i){if(v(t)||v(e)||v(i))throw new Error("zoom requires valid numbers");var n=w.scale*i;if(n<R){if(w.scale===R)return;i=R/w.scale}if(n>x){if(w.scale===x)return;i=x/w.scale}var o=U(t,e);w.x=o.x-i*(o.x-w.x),w.y=o.y-i*(o.y-w.y),L&&1===I&&1===R?(w.scale*=i,W()):W()||(w.scale*=i),kt("zoom"),tt()}function it(t,e,i){et(t,e,i/w.scale)}function nt(t,e,i){if(!i)return $(t,e);A&&A.cancel();var n=0,r=0;A=o({x:0,y:0},{x:t,y:e},{step:function(t){$(t.x-n,t.y-r),n=t.x,r=t.y}})}function ot(){s.addEventListener("mousedown",pt,{passive:!1}),s.addEventListener("dblclick",bt,{passive:!1}),s.addEventListener("touchstart",ct,{passive:!1}),s.addEventListener("keydown",st,{passive:!1}),n.addWheelListener(s,wt,{passive:!1}),tt()}function rt(){n.removeWheelListener(s,wt),s.removeEventListener("mousedown",pt),s.removeEventListener("keydown",st),s.removeEventListener("dblclick",bt),s.removeEventListener("touchstart",ct),y&&(window.cancelAnimationFrame(y),y=0),E.cancel(),gt(),vt(),N.release(),Mt()}function at(){f&&(f=!1,i.applyTransform(w),kt("transform"),y=0)}function st(t){var e=0,i=0,n=0;if(38===t.keyCode?i=1:40===t.keyCode?i=-1:37===t.keyCode?e=1:39===t.keyCode?e=-1:189===t.keyCode||109===t.keyCode?n=1:187!==t.keyCode&&107!==t.keyCode||(n=-1),!S(t,e,i,n)){if(e||i){t.preventDefault(),t.stopPropagation();var o=s.getBoundingClientRect();nt(.05*(r=Math.min(o.width,o.height))*e,.05*r*i)}if(n){var r,a=Rt(100*n);Lt((r=K?Ct():{x:(c=s.getBoundingClientRect()).width/2,y:c.height/2}).x,r.y,a)}var c}}function ct(t){if(function(t){e.onTouch&&!e.onTouch(t)||(t.stopPropagation(),t.preventDefault())}(t),1===t.touches.length)return function(t){var e=yt(t.touches[0]);P=e;var i=U(e.x,e.y);F=i.x,_=i.y,E.cancel(),lt()}(t);2===t.touches.length&&(T=ht(t.touches[0],t.touches[1]),j=!0,lt())}function lt(){J||(J=!0,document.addEventListener("touchmove",ut),document.addEventListener("touchend",dt),document.addEventListener("touchcancel",dt))}function ut(t){if(1===t.touches.length){t.stopPropagation();var e=U((u=yt(t.touches[0])).x,u.y),i=e.x-F,n=e.y-_;0!==i&&0!==n&&It(),F=e.x,_=e.y,nt(i,n)}else if(2===t.touches.length){j=!0;var o=t.touches[0],r=t.touches[1],a=ht(o,r),s=1+(a/T-1)*C,c=yt(o),l=yt(r);if(F=(c.x+l.x)/2,_=(c.y+l.y)/2,K){var u=Ct();F=u.x,_=u.y}Lt(F,_,s),T=a,t.stopPropagation(),t.preventDefault()}}function dt(t){if(t.touches.length>0){var e=U((i=yt(t.touches[0])).x,i.y);F=e.x,_=e.y}else{var i,n=new Date;n-V<300&&(K?St((i=Ct()).x,i.y,M):St(P.x,P.y,M)),V=n,Mt(),vt()}}function ht(t,e){var i=t.clientX-e.clientX,n=t.clientY-e.clientY;return Math.sqrt(i*i+n*n)}function bt(t){!function(t){e.onDoubleClick&&!e.onDoubleClick(t)||(t.preventDefault(),t.stopPropagation())}(t);var i=yt(t);K&&(i=Ct()),St(i.x,i.y,M)}function pt(t){if(!k(t)){if(J)return t.stopPropagation(),!1;if(1===t.button&&null!==window.event||0===t.button){E.cancel();var e=yt(t),i=U(e.x,e.y);return F=i.x,_=i.y,document.addEventListener("mousemove",ft),document.addEventListener("mouseup",mt),N.capture(t.target||t.srcElement),!1}}}function ft(t){if(!J){It();var e=yt(t),i=U(e.x,e.y),n=i.x-F,o=i.y-_;F=i.x,_=i.y,nt(n,o)}}function mt(){N.release(),Mt(),gt()}function gt(){document.removeEventListener("mousemove",ft),document.removeEventListener("mouseup",mt),X=!1}function vt(){document.removeEventListener("touchmove",ut),document.removeEventListener("touchend",dt),document.removeEventListener("touchcancel",dt),X=!1,j=!1,J=!1}function wt(t){if(!O(t)){E.cancel();var e=t.deltaY;t.deltaMode>0&&(e*=100);var i=Rt(e);if(1!==i){var n=K?Ct():yt(t);Lt(n.x,n.y,i),t.preventDefault()}}}function yt(t){var e=s.getBoundingClientRect();return{x:t.clientX-e.left,y:t.clientY-e.top}}function St(t,e,i){var n=w.scale,r={scale:n},a={scale:i*n};E.cancel(),xt(),B=o(r,a,{step:function(i){it(t,e,i.scale)},done:Ot})}function Ct(){var t=s.getBoundingClientRect();return{x:t.width*K.x,y:t.height*K.y}}function Lt(t,e,i){return E.cancel(),xt(),et(t,e,i)}function xt(){B&&(B.cancel(),B=null)}function Rt(t){return 1-Math.sign(t)*Math.min(.25,Math.abs(D*t/128))}function It(){X||(kt("panstart"),X=!0,E.start())}function Mt(){X&&(j||E.stop(),kt("panend"))}function Ot(){kt("zoomend")}function kt(t){G.fire(t,G)}}function p(t){if(t)return"object"==typeof t?(g(t.x)&&g(t.y)||f(t),t):void f()}function f(t){throw console.error(t),new Error(["Cannot parse transform origin.","Some good examples:",'  "center center" can be achieved with {x: 0.5, y: 0.5}','  "top center" can be achieved with {x: 0.5, y: 0}','  "bottom right" can be achieved with {x: 1, y: 1}'].join("\n"))}function m(){}function g(t){return Number.isFinite(t)}function v(t){return Number.isNaN?Number.isNaN(t):t!=t}t.exports=b,function(){if("undefined"!=typeof document){var t=document.getElementsByTagName("script");if(t){for(var e,i=0;i<t.length;++i){var n=t[i];if(n.src&&n.src.match(/\bpanzoom(\.min)?\.js/)){e=n;break}}if(e){var o=e.getAttribute("query");if(o){var r=e.getAttribute("name")||"pz",a=Date.now();!function t(){var i=document.querySelector(o);if(!i)return Date.now()-a<2e3?void setTimeout(t,100):void console.error("Cannot find the panzoom element",r);var n=function(t){for(var e=t.attributes,i={},n=0;n<e.length;++n){var o=s(e[n]);o&&(i[o.name]=o.value)}return i}(e);console.log(n),window[r]=b(i,n)}()}}}}function s(t){if(t.name&&"p"===t.name[0]&&"z"===t.name[1]&&"-"===t.name[2])return{name:t.name.substr(3),value:JSON.parse(t.value)}}}()},fWck:function(t,e){function i(t,e,i){t.addEventListener("wheel",e,i)}t.exports=i,t.exports.addWheelListener=i,t.exports.removeWheelListener=function(t,e,i){t.removeEventListener("wheel",e,i)}},sO0u:function(t,e,i){"use strict";i.r(e),i.d(e,"NavigationPageModule",function(){return Yt});var n=i("TEn/"),o=i("tyNb"),r=i("ofXK"),a=i("3Pt+"),s=i("mrSG"),c=i("EnSQ"),l=i("fXoL");class u{constructor(t){this.icon=t}render(t,e,i,n,o){const r=new Image;r.onload=()=>{t.drawImage(r,e,i,n,o)},r.src=this.icon}}var d=i("cQc6");class h{constructor(t){this.mapItem=t,this.doAnim=!1}get MapItem(){return this.mapItem}render(t){this.mapItem.Sections&&this.mapItem.Sections.length>0&&(t.beginPath(),this.renderSections(t),t.strokeStyle="#FFF",t.fillStyle=this.mapItem.Color,t.stroke(),t.fill(),t.closePath())}startAnimation(t,e){this.animationCallback=()=>{if(!0!==this.doAnim)return;t.save();const i=new Date;if(t.beginPath(),this.renderSections(t),t.lineWidth=1,t.strokeStyle=i.getSeconds()%2==0?"#FFF":"#000",t.fillStyle=i.getSeconds()%2==0?"#000":this.mapItem.Color,t.stroke(),t.fill(),t.closePath(),t.restore(),window.requestAnimationFrame(this.animationCallback),void 0!==e&&void 0!==e.renderer&&void 0!==e.floor)for(const n of e.renderer)n.render(t,e)},this.doAnim=!0,window.requestAnimationFrame(this.animationCallback)}stopAnimation(t){this.doAnim=!1,this.animationCallback=null}renderSections(t){t.moveTo(this.mapItem.Sections[0].Start.X,this.mapItem.Sections[0].Start.Y);for(let e=1;e<this.mapItem.Sections.length;e++)t.lineTo(this.mapItem.Sections[e].Start.X,this.mapItem.Sections[e].Start.Y);t.lineTo(this.mapItem.Sections[0].Start.X,this.mapItem.Sections[0].Start.Y)}}class b{constructor(t){this.location=t}get Location(){return this.location}render(t){this.location.Icon.length>0?new u("svg/"+this.location.Icon+".svg").render(t,this.location.PathNode.Coordinate.X,this.location.PathNode.Coordinate.Y,20,20):(t.font="12px Arial",t.textAlign="center",t.fillStyle="#000",t.fillText(this.location.Name,this.location.PathNode.Coordinate.X,this.location.PathNode.Coordinate.Y))}startAnimation(t){}stopAnimation(t){}}class p{constructor(t){this.route=t}get Route(){return this.route}render(t,e){const i=new u("assets/pin-sharp.png");this.route.Start.Floor===e.floor&&i.render(t,this.route.Start.Node.Coordinate.X-15,this.route.Start.Node.Coordinate.Y-30,30,30);const n=new u("assets/pin-red.png");this.route.End.Floor===e.floor&&n.render(t,this.route.End.Node.Coordinate.X-30,this.route.End.Node.Coordinate.Y-40,60,60);const o=this.route.RouteSections.filter(t=>t.Floor===e.floor);if(null!=o){for(const e of o){t.strokeStyle="#A00",t.lineWidth=3,t.beginPath(),t.moveTo(e.Route[0].Coordinate.X,e.Route[0].Coordinate.Y);for(let i=1;i<e.Route.length;i++)t.lineTo(e.Route[i].Coordinate.X,e.Route[i].Coordinate.Y);t.stroke(),t.closePath()}for(const e of o){const i=e.Route.length,n=e.Distance,o=e.Route[Math.round((i-1)/2)].Coordinate.X,r=e.Route[Math.round((i-1)/2)].Coordinate.Y,a="14px Arial",s=t.measureText(n.toString()).width+14,c=parseInt("14px Arial",10)+14;t.fillStyle="#A00",t.fillRect(o-s/2,r-c/2,s,20),t.font=a,t.fillStyle="#FFF",t.fillText(n.toString(),o,r)}}}startAnimation(t){}stopAnimation(t){}}class f{static GetMapItemRendererCanvas(...t){const e=[];for(const i of t)e.push(new h(i));return e}static GetLocationRendererCanvas(...t){const e=[];for(const i of t)e.push(new b(i));return e}static GetRouteRendererCanvas(...t){const e=[];for(const i of t)e.push(new p(i));return e}}var m=i("fQX0"),g=i.n(m);const v=["fab"];function w(t,e){if(1&t){const t=l.Mb();l.Lb(0,"a",5),l.Xb("click",function(){l.jc(t);const i=e.index;return l.Zb().emitAnotherFloorToShow(i)}),l.Jb(1,"span",6),l.Kb()}if(2&t){const t=e.$implicit,i=l.Zb();l.zb(t===i.currentFloor?"olu-level-control-button-lvl-current":"olu-level-control-button"),l.xb(1),l.ec("innerHTML",t,l.kc)}}let y=(()=>{class t{constructor(t){this.dataService=t,this.floorWithBuilding=new l.o}ngOnInit(){}ngOnChanges(t){return Object(s.a)(this,void 0,void 0,function*(){if(void 0!==t.currentBuilding&&void 0!==this.currentBuilding){const t=yield this.dataService.get_building(this.currentBuilding).toPromise(),e=yield this.dataService.get_building_floor(t.Name).toPromise();this.availableFloors=e.reverse()}})}emitAnotherFloorToShow(t){return Object(s.a)(this,void 0,void 0,function*(){this.floorWithBuilding.emit({floor:this.availableFloors[t],building:this.currentBuilding}),this.currentFloor=this.availableFloors[t]})}}return t.\u0275fac=function(e){return new(e||t)(l.Ib(c.a))},t.\u0275cmp=l.Cb({type:t,selectors:[["floors-bar"]],viewQuery:function(t,e){if(1&t&&l.tc(v,!0),2&t){let t;l.gc(t=l.Yb())&&(e.fab=t.first)}},inputs:{currentBuilding:"currentBuilding",currentFloor:"currentFloor"},outputs:{floorWithBuilding:"floorWithBuilding"},features:[l.vb],decls:6,vars:2,consts:[[1,"level-control-container","leaflet-control","leaflet-bar","olu-level-control-container-full","leaflet-control-layers-list"],[1,"olu-level-control-levels"],[1,"olu-control-levels-building-header"],["data-tooltip","Current Building","data-tooltip-pos","left top"],[3,"class","click",4,"ngFor","ngForOf"],[3,"click"],[3,"innerHTML"]],template:function(t,e){1&t&&(l.Lb(0,"div",0),l.Lb(1,"div",1),l.Lb(2,"a",2),l.Lb(3,"span",3),l.pc(4),l.Kb(),l.Kb(),l.oc(5,w,2,3,"a",4),l.Kb(),l.Kb()),2&t&&(l.xb(4),l.qc(e.currentBuilding),l.xb(1),l.ec("ngForOf",e.availableFloors))},directives:[r.i],styles:[".olu-level-control-levels[_ngcontent-%COMP%]{border-bottom:0;color:var(--ion-color-light,#f4f5f8)!important;line-height:150}.olu-level-control-levels[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{width:46px;padding-bottom:30px;padding-top:8px}.olu-control-levels-building-header[_ngcontent-%COMP%]{color:var(--ion-color-dark-contrast,#f4f5f8)!important;background-color:var(--ion-color-dark,#222428)!important;opacity:.7}.olu-level-control-button[_ngcontent-%COMP%]{background-color:var(--ion-color-primary,#3880ff)!important;color:var(--ion-color-light,#f4f5f8)!important;opacity:.7;cursor:pointer}.olu-level-control-button-lvl-current[_ngcontent-%COMP%]{background-color:var(--ion-color-secondary,#3dc2ff)!important;color:var(--ion-color-dark,#222428)!important;opacity:.7;cursor:pointer}"]}),t})(),S=(()=>{class t{constructor(t){this.dataService=t,this.clickThreshold=20,this.mapItemRenderer=[],this.locationRenderer=[],this.routeRenderer=[],this.locationClick=new l.o,this.mapScroll=new l.o,this.floorChanged=new l.o}get CurrentRoute(){return this.currentRoute}get CurrentBuilding(){return this.currentBuilding}static calculateMovePosition(t,e){const i=document.getElementById("canvas-wrapper"),n=i.parentElement.parentElement,o=window.matchMedia("(min-width: 1200px)").matches,r=o?n.clientHeight/2:2*n.clientHeight/5;return{x:i.clientWidth/(o?1.5:2)-t,y:o?r-e:r-Math.min(e,n.clientHeight)}}ngAfterViewInit(){const t=this;this.panZoomController||(this.panZoomController=g()(document.getElementById("map"),{maxZoom:2,minZoom:.25,initialZoom:.7,bounds:!0,boundsPadding:.1,onTouch(e){return Object(s.a)(this,void 0,void 0,function*(){return 1===e.touches.length&&(console.log(e.touches[0]),yield t.onElementClick(e.touches[0].clientX,e.touches[0].clientY,e.target)),!1})}}))}showRoute(t,e){return Object(s.a)(this,void 0,void 0,function*(){this.stopAllAnimations(),yield this.renderNavigationPage(t,e.Building,e.Floor)})}showDiscoveryLocation(t){return Object(s.a)(this,void 0,void 0,function*(){this.stopAllAnimations();const e=yield this.dataService.get_locations_search(t).toPromise();if(null===e||0===e.length)throw new Error("Studi-Guide can't find "+t);const i=e[0];this.currentBuilding=i.Building;const n=yield this.dataService.get_map_floor(this.currentBuilding,i.Floor).toPromise();this.mapItemRenderer=f.GetMapItemRendererCanvas(...n);const o=yield this.dataService.get_locations(i.Building,i.Floor).toPromise();return this.locationRenderer=f.GetLocationRendererCanvas(...o),this.clearMapCanvas(),this.RefreshMap(),this.displayPin(i.PathNode),this.currentFloor=i.Floor,this.CenterMap(i.PathNode.Coordinate.X,i.PathNode.Coordinate.Y),i})}showFloor(t,e){return Object(s.a)(this,void 0,void 0,function*(){if(this.stopAllAnimations(),null!=this.currentRoute)yield this.renderNavigationPage(this.currentRoute,this.currentBuilding,t);else{const i=yield this.dataService.get_map_items("",t,e).toPromise();this.mapItemRenderer=f.GetMapItemRendererCanvas(...i);const n=yield this.dataService.get_locations_items("",t,e).toPromise();this.locationRenderer=f.GetLocationRendererCanvas(...n),this.RefreshMap()}this.currentFloor=t,this.currentBuilding=e})}showDiscoveryMap(t,e){return Object(s.a)(this,void 0,void 0,function*(){const i=yield this.dataService.get_map_items(t,e,"").toPromise();this.mapItemRenderer=f.GetMapItemRendererCanvas(...i);const n=yield this.dataService.get_locations_items(t,e,"").toPromise();this.locationRenderer=f.GetLocationRendererCanvas(...n),this.RefreshMap(),this.currentFloor=e,this.FitMap()})}clearMapCanvas(){const t=document.getElementById("map").getContext("2d");null!=t&&t.clearRect(0,0,t.canvas.width,t.canvas.height)}onClick(t){return Object(s.a)(this,void 0,void 0,function*(){yield this.onElementClick(t.clientX,t.clientY,t.target)})}onElementClick(t,e,i){var n;return Object(s.a)(this,void 0,void 0,function*(){const o=this.panZoomController.getTransform(),r=class{static transformInOriginCoordinate(t,e,i){const n=i.getBoundingClientRect(),o=(t.x-n.left)/e,r=(t.y-n.top)/e;return console.log("Transform x:"+t.x+" y:"+t.y+"  to coordinate: x:"+o+" y:"+r),{x:o,y:r}}}.transformInOriginCoordinate({x:t,y:e},o.scale,i),a=[r.x,r.y];if(null!=this.currentRoute){const t=[];for(const e of this.getInteractiveStairWellMapItemRenderer(this.currentFloor))t.push(e.MapItem);for(const e of t){const t=[];for(const i of e.Sections)t.push([i.Start.X,i.Start.Y]);d(a,t)&&(yield this.showNextFloor(e))}return}const s=[];for(const t of this.locationRenderer){const e=t.Location;Math.abs(e.PathNode.Coordinate.X-a[0])<this.clickThreshold&&Math.abs(e.PathNode.Coordinate.Y-a[1])<this.clickThreshold&&s.push(e)}if(s.length>0){const t=1===s.length?s:s.sort((t,e)=>Math.abs(t.PathNode.Coordinate.X-a[0])+Math.abs(t.PathNode.Coordinate.Y-a[1])>Math.abs(e.PathNode.Coordinate.X-a[0])+Math.abs(e.PathNode.Coordinate.Y-a[1])?1:-1);(null===(n=t[0])||void 0===n?void 0:n.PathNode)&&(this.RefreshMap(),this.displayPin(t[0].PathNode)),this.locationClick.emit(t[0])}})}renderNavigationPage(t,e,i){var n,o;return Object(s.a)(this,void 0,void 0,function*(){let r=null!==(n=yield this.dataService.get_map_floor(e,i).toPromise())&&void 0!==n?n:new Array,a=null!==(o=yield this.dataService.get_locations(e,i).toPromise())&&void 0!==o?o:new Array;for(const n of t.RouteSections)if(n.Floor===i&&n.Building!==e){const t=yield this.dataService.get_map_floor(n.Building,n.Floor).toPromise();r=r.concat(t);const e=yield this.dataService.get_locations(n.Building,n.Floor).toPromise();a=a.concat(e)}this.mapItemRenderer=f.GetMapItemRendererCanvas(...r),this.locationRenderer=f.GetLocationRendererCanvas(...a),this.routeRenderer=f.GetRouteRendererCanvas(t),this.currentBuilding=e,this.RefreshMap(),this.renderRoutes({floor:i});for(const t of this.getInteractiveStairWellMapItemRenderer(i))t.startAnimation(this.renderingContext,{renderer:this.routeRenderer,floor:i});this.currentRoute=t,this.currentFloor=i})}createNewCanvasMap(){const t=document.getElementById("map");let e=0,i=0;for(const n of this.mapItemRenderer){const t=n.MapItem;if(t.Sections)for(const n of t.Sections)n.End.X>i&&(i=n.End.X),n.End.Y>e&&(e=n.End.Y);if(t.PathNodes)for(const n of t.PathNodes)n.Coordinate.X>i&&(i=n.Coordinate.X),n.Coordinate.Y>e&&(e=n.Coordinate.Y)}this.renderingContext=class{static setup(t,e,i){const n=this.GetPixelRatio();return t.width=e*n,t.height=i*n,t.style.width=e+"px",t.style.height=i+"px",this.getContext(t)}static getContext(t){const e=this.GetPixelRatio(),i=t.getContext("2d");return i.scale(e,e),i}static GetPixelRatio(){return window.devicePixelRatio||1}}.setup(t,i,e)}displayPin(t){const e=t.Coordinate.X-30,i=t.Coordinate.Y-40;new u("assets/pin-red.png").render(this.renderingContext,e,i,60,60)}showNextFloor(t){return Object(s.a)(this,void 0,void 0,function*(){for(let e=0;e<this.currentRoute.RouteSections.length-1;e++)if(this.currentRoute.RouteSections[e].Floor===t.Floor&&this.currentRoute.RouteSections[e].Building===t.Building)return this.currentFloor=this.currentRoute.RouteSections[e+1].Floor,this.currentBuilding=this.currentRoute.RouteSections[e+1].Building,void(yield this.showFloor(this.currentFloor,this.currentBuilding))})}getInteractiveStairWellMapItemRenderer(t){const e=[];for(const n of this.routeRenderer)for(let t=0;t<n.Route.RouteSections.length-1;t++)n.Route.RouteSections[t].Building===n.Route.RouteSections[t+1].Building&&e.push(n.Route.RouteSections[t].Route[n.Route.RouteSections[t].Route.length-1]);const i=[];for(const n of e)for(const e of this.mapItemRenderer)e.MapItem.Floor===t&&e.MapItem.PathNodes.filter(t=>t.Id===n.Id).length>0&&i.push(e);return i}stopAllAnimations(){for(const t of this.routeRenderer)t.stopAnimation(this.renderingContext);for(const t of this.mapItemRenderer)t.stopAnimation(this.renderingContext);for(const t of this.locationRenderer)t.stopAnimation(this.renderingContext)}renderMapItems(){for(const t of this.mapItemRenderer)t.render(this.renderingContext)}renderLocations(){for(const t of this.locationRenderer)t.render(this.renderingContext)}renderRoutes(t){for(const e of this.routeRenderer)e.render(this.renderingContext,t)}onFloorChangeByFloorButton(t){return Object(s.a)(this,void 0,void 0,function*(){yield this.showAnotherFloorOfCurrentBuilding(t.floor,t.building)})}showAnotherFloorOfCurrentBuilding(t,e,i=!0){return Object(s.a)(this,void 0,void 0,function*(){st.progressIsVisible=!0,yield this.showFloor(t,e),i&&this.FitMap(),st.progressIsVisible=!1,this.floorChanged.emit()})}CenterMap(e,i){const n=t.calculateMovePosition(e,i);this.panZoomController.smoothMoveTo(n.x,n.y)}MapSize(){return document.getElementById("map").getBoundingClientRect()}FitMap(){const t=this.MapSize();this.CenterMap(t.width/2,t.height/2)}ClearRoute(){this.stopAllAnimations(),this.currentRoute=null}RefreshMap(){this.createNewCanvasMap(),this.renderMapItems(),this.renderLocations()}}return t.DISTANCE_SCALAR=5,t.\u0275fac=function(e){return new(e||t)(l.Ib(c.a))},t.\u0275cmp=l.Cb({type:t,selectors:[["app-map-view"]],outputs:{locationClick:"locationClick",mapScroll:"mapScroll",floorChanged:"floorChanged"},decls:4,vars:2,consts:[["id","canvas-wrapper",1,"draggable"],["id","map",3,"click"],["map",""],[3,"currentBuilding","currentFloor","floorWithBuilding"]],template:function(t,e){1&t&&(l.Lb(0,"div",0),l.Lb(1,"canvas",1,2),l.Xb("click",function(t){return e.onClick(t)}),l.Kb(),l.Kb(),l.Lb(3,"floors-bar",3),l.Xb("floorWithBuilding",function(t){return e.onFloorChangeByFloorButton(t)}),l.Kb()),2&t&&(l.xb(3),l.ec("currentBuilding",e.CurrentBuilding)("currentFloor",e.currentFloor))},directives:[y],styles:["body[_ngcontent-%COMP%], html[_ngcontent-%COMP%]{height:100%;width:100%}#canvas-wrapper[_ngcontent-%COMP%]{padding:2px;overflow:hidden;scrollbar-width:none;-ms-overflow-style:none}#canvas-wrapper[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.draggable[_ngcontent-%COMP%]{cursor:-webkit-grab;cursor:grab}.draggable[_ngcontent-%COMP%]:active{cursor:-webkit-grabbing;cursor:grabbing}floors-bar[_ngcontent-%COMP%]{position:absolute;top:12px;right:0}"]}),t})();var C=i("tk/3"),L=i("e8h1");let x=(()=>{class t{constructor(t){this.storage=t}addRecentSearch(e){return Object(s.a)(this,void 0,void 0,function*(){let i=yield this.readRecentSearches();null!==i&&0!==i.length||(i=[]);let n=-1;for(let t=0;t<i.length;t++)if(i[t].Name===e.Name){n=t;break}n>=0&&i.splice(n,1),i.unshift(e),i.length>3&&i.pop(),yield this.storage.set(t.recentSearchesKey,JSON.stringify([i])),console.log(i)})}readRecentSearches(){return Object(s.a)(this,void 0,void 0,function*(){const e=JSON.parse(yield this.storage.get(t.recentSearchesKey));if(!e)return[];const i=[];for(const t of e[0])(null==t?void 0:t.Name)&&i.push(t);return i})}}return t.recentSearchesKey="searches",t.\u0275fac=function(e){return new(e||t)(l.Tb(L.b))},t.\u0275prov=l.Eb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),R=(()=>{class t{constructor(t){this.recentSearchesService=t,this.recentSearchesVar=[],this.availableCampus=[],this.Route={Start:{Name:"",LatLng:{lat:0,lng:0}},Destination:{Name:"",LatLng:{lat:0,lng:0}},Coordinates:[],Distance:0,NavigationInstructions:[],Time:0},this.recentSearchesService.readRecentSearches().then(t=>{this.recentSearchesVar=t})}get latestSearchResult(){return void 0!==this.recentSearches[0]?this.recentSearches[0]:{Name:"",Description:"",Information:[],DetailRouterParams:{},RouteRouterParams:{},LatLng:{lat:0,lng:0},Images:[]}}get recentSearches(){return this.recentSearchesVar}addRecentSearch(t){return Object(s.a)(this,void 0,void 0,function*(){yield this.recentSearchesService.addRecentSearch(t),this.recentSearchesVar=yield this.recentSearchesService.readRecentSearches()})}addRecentSearchCampus(t){return Object(s.a)(this,void 0,void 0,function*(){const e={Name:t.Name,Description:t.ShortName,Information:[["ShortName: ",t.ShortName],["Longitude: ",t.Longitude],["Latitude: ",t.Latitude]],DetailRouterParams:{},RouteRouterParams:{},LatLng:{lat:t.Latitude,lng:t.Longitude},Images:[]};yield this.addRecentSearch(e)})}addRecentSearchBuilding(t,e){return Object(s.a)(this,void 0,void 0,function*(){const i={Name:t.Name,Description:t.edges.Address.Street+" "+t.edges.Address.Number+", "+t.edges.Address.PLZ,Information:[["Campus: ",t.edges.Campus.Name]],DetailRouterParams:{building:t.Name},RouteRouterParams:{},LatLng:e,Images:[]};yield this.addRecentSearch(i)})}addRecentSearchLocation(t,e,i){return Object(s.a)(this,void 0,void 0,function*(){const n=[["Building: ",t.Name]];i&&n.push(["Address: ",i.edges.Address.Street+" "+i.edges.Address.Number]),t.Tags&&n.push(["Tags: ",t.Tags.join(", ")]);const o={Name:t.Name,Description:t.Description,Information:n,DetailRouterParams:{location:t.Name},RouteRouterParams:{start:t.Building+".Entrance",destination:t.Name},LatLng:e,Images:t.Images};yield this.addRecentSearch(o)})}SetOsmRouteAsRoute(t,e,i){const n=[];for(const o of t.Points.Coordinates)n.push([o.Lat,o.Lng]);this.Route={Start:e,Destination:i,Coordinates:n,Distance:Math.round(t.Distance),NavigationInstructions:t.Instructions,Time:Math.round(t.Time/1e3/60)}}ClearRoute(){this.Route={Start:{Name:"",LatLng:{lat:0,lng:0}},Destination:{Name:"",LatLng:{lat:0,lng:0}},Distance:0,Coordinates:[],NavigationInstructions:[],Time:0}}}return t.\u0275fac=function(e){return new(e||t)(l.Tb(x))},t.\u0275prov=l.Eb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const I=["destinationSearchbar"];function M(t,e){if(1&t){const t=l.Mb();l.Lb(0,"ion-button",6),l.Xb("click",function(){return l.jc(t),l.Zb().emitDiscoveryEvent()}),l.Jb(1,"ion-icon",7),l.Kb()}}function O(t,e){if(1&t){const t=l.Mb();l.Lb(0,"ion-item",8),l.Xb("click",function(){l.jc(t);const i=e.$implicit;return l.Zb().discovery.emit(i.Name)}),l.Lb(1,"ion-label"),l.Lb(2,"h2"),l.pc(3),l.Kb(),l.Lb(4,"p",9),l.pc(5),l.Kb(),l.Kb(),l.Kb()}if(2&t){const t=e.$implicit;l.xb(3),l.qc(t.Name),l.xb(2),l.qc(t.Description)}}let k=(()=>{class t{constructor(t,e){this.dataService=t,this.model=e,this.discovery=new l.o,this.route=new l.o,this.searchBarFocus=new l.o,this.searchBtnIsVisible=!0,this.closeRouteBtnIsVisible=!1}ngOnInit(){}onDestinationInputEvent(t){return Object(s.a)(this,void 0,void 0,function*(){const e=yield this.dataService.get_locations_all().toPromise(),i=t.target.value.toLowerCase();i.length<2?this.locations=[]:(this.locations=[],this.filterIListObjects(this.model.recentSearches,i,2),this.filterIListObjects(e,i,5))})}filterIListObjects(t,e,i){for(const n of t){let t=n.Name.toLowerCase().indexOf(e)>-1||n.Description.toLowerCase().indexOf(e)>-1;for(const e of this.locations)if(e.Name===n.Name){t=!1;break}if(t&&this.locations.push(n),this.locations.length>i)return}}emitDiscoveryEvent(){let t=""===this.destinationSearchbar.value||void 0===this.destinationSearchbar.value;if(t=t||null===this.destinationSearchbar.value,!t){const t=document.activeElement;t&&t.blur&&t.blur(),this.discovery.emit(this.destinationSearchbar.value)}}clearDestinationInput(){this.destinationSearchbarValue="",this.locations=[]}clearStartInput(){this.startSearchBarValue=""}setDiscoverySearchbarValue(t){this.destinationSearchbarValue=t}setStartSearchbarValue(t){this.startSearchBarValue=t}onSearchBarHasFocus(t){this.searchBarFocus.emit(t)}onKey(t,e){"Enter"===t.key&&"destinationSearchbar"===e&&this.emitDiscoveryEvent()}}return t.\u0275fac=function(e){return new(e||t)(l.Ib(c.a),l.Ib(R))},t.\u0275cmp=l.Cb({type:t,selectors:[["app-search-input"]],viewQuery:function(t,e){if(1&t&&l.tc(I,!0),2&t){let t;l.gc(t=l.Yb())&&(e.destinationSearchbar=t.first)}},outputs:{discovery:"discovery",route:"route",searchBarFocus:"searchBarFocus"},decls:7,vars:3,consts:[["lines","none"],["search-icon","navigate-circle-outline","inputmode","text","mode","ios","placeholder","destination","color","","icon-color","dark",3,"value","ionInput","click","keydown"],["destinationSearchbar",""],["slot","end","size","default","mode","ios","color","primary",3,"click",4,"ngIf"],["locationList",""],["button","",3,"click",4,"ngFor","ngForOf"],["slot","end","size","default","mode","ios","color","primary",3,"click"],["size","large","slot","icon-only","name","search","color",""],["button","",3,"click"],[1,"ion-text-wrap"]],template:function(t,e){1&t&&(l.Lb(0,"ion-item",0),l.Lb(1,"ion-searchbar",1,2),l.Xb("ionInput",function(t){return e.onDestinationInputEvent(t)})("click",function(){return e.onSearchBarHasFocus("destinationSearchbar")})("keydown",function(t){return e.onKey(t,"destinationSearchbar")},!1,l.ic),l.Kb(),l.oc(3,M,2,0,"ion-button",3),l.Kb(),l.Lb(4,"ion-list",null,4),l.oc(6,O,6,2,"ion-item",5),l.Kb()),2&t&&(l.xb(1),l.ec("value",e.destinationSearchbarValue),l.xb(2),l.ec("ngIf",e.searchBtnIsVisible),l.xb(3),l.ec("ngForOf",e.locations))},directives:[n.v,n.J,n.eb,r.j,n.y,r.i,n.h,n.t,n.x],styles:["ion-searchbar[_ngcontent-%COMP%]{max-width:300px}"]}),t})();var D=i("+JbE"),K=i("YD5U");class N{constructor(t){this.campus=t,this.addressString=this.getAddressString(this.campus)}get Address(){return this.addressString}get Name(){return this.campus.Name}get ShortName(){return this.campus.ShortName}get LatLng(){return{lat:this.campus.Latitude,lng:this.campus.Longitude}}getAddressString(t){let e="";if(null!==t.edges.Buildings){const i=t.edges.Buildings.map(t=>t.edges.Address),n=P(i,t=>t.Street);for(const t of Object.keys(n)){const i=n[t];""!==e&&(e+="; ");let o=i[0].Number;i.length>1&&i[i.length-1].Number!==o&&(o+="-"+i[i.length-1].Number),e+=t+" "+o+", ",e+=n[t][0].PLZ+" "+n[t][0].City}}return e}}const P=(t,e)=>t.reduce((t,i)=>{const n=e(i);return t[n]||(t[n]=[]),t[n].push(i),t},{});var F=i("gcOT"),_=i("Bfh1");const T=["inputFrom"],E=["inputTo"];function A(t,e){if(1&t){const t=l.Mb();l.Lb(0,"ion-item",12),l.Xb("click",function(){return l.jc(t),l.Zb().listMyLocationClick()}),l.Lb(1,"ion-text"),l.pc(2,"My Location"),l.Kb(),l.Kb()}}function B(t,e){if(1&t){const t=l.Mb();l.Lb(0,"ion-item",12),l.Xb("click",function(){l.jc(t);const i=e.$implicit;return l.Zb().listRecentSearchClick(i)}),l.Lb(1,"ion-text"),l.pc(2),l.Kb(),l.Kb()}if(2&t){const t=e.$implicit;l.xb(2),l.qc(t.Name)}}var j=function(t){return t[t.No=0]="No",t[t.From=1]="From",t[t.To=2]="To",t}({});let V=(()=>{class t{constructor(t,e){this.model=t,this.geolocation=e,this.inputToCurrentlyActive=!1,this.myLocationInInput=j.From,this.myLocationEnabled=!0}ngOnInit(){}ngAfterViewInit(){return Object(s.a)(this,void 0,void 0,function*(){this.UpdateFromNavigationModel(),this.inputToCurrentlyActive=!1,yield this.inputFrom.setFocus()})}SetFocus(){return Object(s.a)(this,void 0,void 0,function*(){this.inputToCurrentlyActive?yield this.inputTo.setFocus():yield this.inputFrom.setFocus()})}toggleActiveInput(){return Object(s.a)(this,void 0,void 0,function*(){this.inputToCurrentlyActive=!this.inputToCurrentlyActive,yield this.SetFocus()})}updateInputValues(){this.inputFrom.value=this.routeLocationFrom.Name,this.inputTo.value=this.routeLocationTo.Name}UpdateFromNavigationModel(){this.routeLocationFrom=this.model.Route.Start,this.routeLocationTo=this.model.Route.Destination,this.updateInputValues()}showMyLocation(){return this.myLocationInInput===j.No&&this.myLocationEnabled}onInputFromFocus(){this.inputToCurrentlyActive=!1}onInputToFocus(){this.inputToCurrentlyActive=!0}swapInputs(){const t=this.routeLocationFrom;this.routeLocationFrom=this.routeLocationTo,this.routeLocationTo=t,this.myLocationInInput!==j.No&&(this.myLocationInInput=this.myLocationInInput===j.From?j.To:j.From),this.updateInputValues()}listRecentSearchClick(t){return Object(s.a)(this,void 0,void 0,function*(){this.inputToCurrentlyActive?(this.routeLocationTo=t,this.myLocationInInput===j.To&&(this.myLocationInInput=j.No)):(this.routeLocationFrom=t,this.myLocationInInput===j.From&&(this.myLocationInInput=j.No)),this.updateInputValues(),yield this.toggleActiveInput()})}listMyLocationClick(){return Object(s.a)(this,void 0,void 0,function*(){const t=yield this.geolocation.getCurrentPosition(),e={Name:"My Location",LatLng:{lat:t.coords.latitude,lng:t.coords.longitude}};this.inputToCurrentlyActive?(this.routeLocationTo=e,this.myLocationInInput=j.To):(this.routeLocationFrom=e,this.myLocationInInput=j.From),this.updateInputValues(),yield this.toggleActiveInput()})}get From(){return this.routeLocationFrom}get To(){return this.routeLocationTo}}return t.\u0275fac=function(e){return new(e||t)(l.Ib(R),l.Ib(_.a))},t.\u0275cmp=l.Cb({type:t,selectors:[["app-route-input"]],viewQuery:function(t,e){if(1&t&&(l.tc(T,!0),l.tc(E,!0)),2&t){let t;l.gc(t=l.Yb())&&(e.inputFrom=t.first),l.gc(t=l.Yb())&&(e.inputTo=t.first)}},decls:22,vars:2,consts:[[1,"container"],[1,"ion-no-padding","ion-item-style"],["size","11"],[1,"ion-margin-end"],[3,"ionFocus"],["inputFrom",""],["inputTo",""],["size","1",1,"swappicon","ion-activatable","ripple-parent",3,"click"],["color","primary","size","large","name","swap-vertical-outline"],[1,"ion-no-padding"],["button","",3,"click",4,"ngIf"],["button","",3,"click",4,"ngFor","ngForOf"],["button","",3,"click"]],template:function(t,e){1&t&&(l.Lb(0,"div",0),l.Lb(1,"ion-item",1),l.Lb(2,"ion-grid"),l.Lb(3,"ion-row"),l.Lb(4,"ion-col",2),l.Lb(5,"ion-item"),l.Lb(6,"ion-label",3),l.pc(7,"From:"),l.Kb(),l.Lb(8,"ion-input",4,5),l.Xb("ionFocus",function(){return e.onInputFromFocus()}),l.Kb(),l.Kb(),l.Lb(10,"ion-item"),l.Lb(11,"ion-label",3),l.pc(12,"To:"),l.Kb(),l.Lb(13,"ion-input",4,6),l.Xb("ionFocus",function(){return e.onInputToFocus()}),l.Kb(),l.Kb(),l.Kb(),l.Lb(15,"ion-col",7),l.Xb("click",function(){return e.swapInputs()}),l.Jb(16,"ion-icon",8),l.Jb(17,"ion-ripple-effect"),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Lb(18,"ion-content"),l.Lb(19,"ion-list",9),l.oc(20,A,3,0,"ion-item",10),l.oc(21,B,3,1,"ion-item",11),l.Kb(),l.Kb()),2&t&&(l.xb(20),l.ec("ngIf",e.showMyLocation()),l.xb(1),l.ec("ngForOf",e.model.recentSearches))},directives:[n.v,n.r,n.I,n.o,n.x,n.u,n.eb,n.t,n.G,n.p,n.y,r.j,r.i,n.R],styles:[".container[_ngcontent-%COMP%]{position:relative}.container[_ngcontent-%COMP%], .input-container[_ngcontent-%COMP%]{width:100%;height:-webkit-fit-content;height:-moz-fit-content;height:fit-content}.input-container[_ngcontent-%COMP%]{position:absolute;top:0;left:0}.swappicon[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.swappicon[_ngcontent-%COMP%]:hover{cursor:pointer}.ripple-parent[_ngcontent-%COMP%]{position:relative;overflow:hidden}"]}),t})();const J=["drawerContent"],X=["searchDrawer"],z=["locationDrawer"],G=["routeDrawer"],Y=["changeRouteDrawer"],q=["routeInput"];function Z(t,e){1&t&&l.Jb(0,"ion-progress-bar",44)}function U(t,e){if(1&t&&(l.Lb(0,"ion-text",45),l.Lb(1,"ion-item"),l.Lb(2,"div"),l.Lb(3,"span",46),l.pc(4),l.Kb(),l.Lb(5,"p"),l.Pb(6,47),l.Kb(),l.Lb(7,"p"),l.Sb(8,48),l.Jb(9,"br"),l.Jb(10,"a",49),l.Qb(),l.Kb(),l.Kb(),l.Kb(),l.Kb()),2&t){const t=l.Zb();l.xb(4),l.qc(t.model.errorMessage)}}function H(t,e){if(1&t){const t=l.Mb();l.Lb(0,"ion-item",52),l.Xb("click",function(){l.jc(t);const i=e.$implicit;return l.Zb(2).recentSearchClick(i.Name)}),l.Lb(1,"ion-text"),l.pc(2),l.Kb(),l.Kb()}if(2&t){const t=e.$implicit;l.xb(2),l.qc(t.Name)}}function $(t,e){if(1&t&&(l.Lb(0,"ion-list",50),l.Lb(1,"ion-list-header"),l.Lb(2,"h2"),l.pc(3,"Recent Searches"),l.Kb(),l.Kb(),l.oc(4,H,3,1,"ion-item",51),l.Kb()),2&t){const t=l.Zb();l.xb(4),l.ec("ngForOf",t.model.recentSearches)}}function W(t,e){if(1&t&&(l.Lb(0,"ion-row"),l.Lb(1,"ion-col"),l.pc(2),l.Kb(),l.Lb(3,"ion-col"),l.pc(4),l.Kb(),l.Kb()),2&t){const t=e.$implicit;l.xb(2),l.qc(t[0]),l.xb(2),l.qc(t[1])}}function Q(t,e){if(1&t&&l.Jb(0,"img",53),2&t){const t=e.$implicit;l.fc("src",t.Path,l.lc),l.fc("alt",t.Name)}}function tt(t,e){if(1&t&&(l.Lb(0,"ion-row"),l.Lb(1,"ion-col"),l.Lb(2,"ion-text"),l.pc(3),l.Kb(),l.Kb(),l.Kb()),2&t){const t=l.Zb(2);l.xb(3),l.rc("",t.CurrentRoute.Distance," m")}}function et(t,e){if(1&t){const t=l.Mb();l.Lb(0,"ion-item",54),l.Lb(1,"ion-grid"),l.Lb(2,"ion-row",24),l.Lb(3,"ion-col"),l.Lb(4,"ion-label",55),l.Lb(5,"h1"),l.pc(6),l.Kb(),l.Kb(),l.Lb(7,"ion-text",55),l.pc(8,"From "),l.Lb(9,"span",41),l.Xb("click",function(){return l.jc(t),l.Zb().onChangeRouteStartEndClick()}),l.pc(10),l.Kb(),l.Kb(),l.Kb(),l.Lb(11,"ion-col",25),l.Lb(12,"ion-button",26),l.Xb("click",function(){return l.jc(t),l.Zb().onCloseRouteDrawer()}),l.Jb(13,"ion-icon",27),l.Kb(),l.Kb(),l.Kb(),l.oc(14,tt,4,1,"ion-row",35),l.Kb(),l.Kb()}if(2&t){const t=l.Zb();l.xb(6),l.rc("To ",t.CurrentRoute.End.Name,""),l.xb(4),l.qc(t.CurrentRoute.Start.Name),l.xb(4),l.ec("ngIf",0!==t.CurrentRoute.Distance)}}function it(t,e){if(1&t&&(l.Lb(0,"ion-text"),l.pc(1),l.Kb()),2&t){const t=l.Zb().$implicit;l.xb(1),l.sc("",t.Distance,"m on floor ",t.Floor,"")}}function nt(t,e){if(1&t&&(l.Lb(0,"ion-text"),l.pc(1),l.Kb()),2&t){const t=l.Zb().$implicit;l.xb(1),l.rc("Stairs through floor ",t.Floor,"")}}function ot(t,e){if(1&t){const t=l.Mb();l.Lb(0,"ion-item",52),l.Xb("click",function(){l.jc(t);const i=e.$implicit;return l.Zb(2).routeInstructionClick(i)}),l.oc(1,it,2,2,"ion-text",35),l.oc(2,nt,2,1,"ion-text",35),l.Kb()}if(2&t){const t=e.$implicit;l.xb(1),l.ec("ngIf",0!==t.Distance),l.xb(1),l.ec("ngIf",0===t.Distance)}}function rt(t,e){if(1&t&&(l.Lb(0,"ion-list"),l.oc(1,ot,3,2,"ion-item",51),l.Kb()),2&t){const t=l.Zb();l.xb(1),l.ec("ngForOf",t.CurrentRoute.RouteSections)}}const{Keyboard:at}=F.a;let st=(()=>{class t{constructor(t,e,i,n,o,r){this.dataService=t,this.modalCtrl=e,this.route=i,this.router=n,this.model=o,this.platform=r,this.availableCampus=[],this.isSubscribed=!1}get CurrentRoute(){var t;return null===(t=this.mapView)||void 0===t?void 0:t.CurrentRoute}ngAfterViewInit(){return Object(s.a)(this,void 0,void 0,function*(){yield Promise.all([this.locationDrawer.SetState(D.a.Hidden),this.routeDrawer.SetState(D.a.Hidden),this.changeRouteDrawer.SetState(D.a.Hidden),this.searchDrawer.SetState(K.a.GetRecommendedDrawerStateForDevice())])})}ionViewDidEnter(){!1===this.isSubscribed&&(this.isSubscribed=!0,this.route.queryParams.subscribe(t=>Object(s.a)(this,void 0,void 0,function*(){if(null!=t&&null!=t.location&&t.location.length>0)return this.searchInput.setDiscoverySearchbarValue(t.location),void(yield this.onDiscovery(t.location));if(null!=t&&null!=t.start&&t.start.length>0&&null!=t.destination&&t.destination.length>0)yield this.showNavigation(t.start,t.destination);else if(null!=t&&null!=t.building&&t.building.length>0){const e=yield this.dataService.get_building(t.building).toPromise();if(null!==e){const t=yield this.dataService.get_building_floor(e.Name).toPromise();yield this.mapView.showFloor((null==t?void 0:t.includes("EG"))?"EG":t[0],e.Name),this.mapView.FitMap()}}else yield this.showDiscoveryMode()})))}ngOnInit(){return Object(s.a)(this,void 0,void 0,function*(){if(0===this.model.availableCampus.length){const t=yield this.dataService.get_campus_search().toPromise();for(const e of t)this.model.availableCampus.push(new N(e))}})}onDiscovery(e){return Object(s.a)(this,void 0,void 0,function*(){this.model.errorMessage="",t.progressIsVisible=!0;try{const i=yield this.mapView.showDiscoveryLocation(e),n=yield this.dataService.get_building(i.Building).toPromise();yield this.model.addRecentSearchLocation(i,{lat:0,lng:0},n),yield this.showLocationDrawer(i)}catch(i){this.handleInputError(i,e)}finally{t.progressIsVisible=!1}})}onRoute(e){return Object(s.a)(this,void 0,void 0,function*(){this.model.errorMessage="",t.progressIsVisible=!0;try{const i=yield this.dataService.get_location(e[0]).toPromise(),n=yield this.dataService.get_route(e[0],e[1]).toPromise();n.Distance=Math.round(n.Distance/S.DISTANCE_SCALAR),n.Start.Name=i.Name,n.End.Name=e[1];for(const t of n.RouteSections)t.Distance=Math.round(t.Distance/S.DISTANCE_SCALAR);yield this.mapView.showRoute(n,i),this.mapView.CenterMap(i.PathNode.Coordinate.X,i.PathNode.Coordinate.Y)}catch(i){let t="";if(i instanceof C.d){const n=i.error.message;n.includes(e[0])&&(t=e[0]),n.includes(e[1])&&(t.length>0&&(t+=" and "),t+=e[1])}this.handleInputError(i,0===t.length?e.toString():t)}finally{t.progressIsVisible=!1}})}onDrawerStateChange(t){void 0!==this.drawerContent&&(this.drawerContent.scrollY=t===D.a.Top)}showLocationDrawer(t){return Object(s.a)(this,void 0,void 0,function*(){yield this.locationDrawer.SetState(D.a.Hidden),this.model.latestSearchResult.Name=t.Name,this.model.latestSearchResult.Description=t.Description,this.model.latestSearchResult.Information=t.Tags?[["Tags: ",t.Tags.join(",")]]:[],this.model.latestSearchResult.Images=t.Images,this.platform.is("hybrid")&&(yield at.hide()),yield this.searchDrawer.SetState(D.a.Hidden),yield this.locationDrawer.SetState(K.a.GetRecommendedDrawerStateForDevice())})}onCloseLocationDrawer(t){return Object(s.a)(this,void 0,void 0,function*(){this.mapView.RefreshMap(),yield this.locationDrawer.SetState(D.a.Hidden),this.CurrentRoute?yield this.routeDrawer.SetState(K.a.GetRecommendedDrawerStateForDevice()):yield this.searchDrawer.SetState(K.a.GetRecommendedDrawerStateForDevice())})}handleInputError(t,e){if(console.log(t),t instanceof C.d){const i=t;this.model.errorMessage=400===i.status?"Studi-Guide can't find "+e:i.message}else this.model.errorMessage=t.message;null!=this.mapView&&this.mapView.clearMapCanvas()}navigationBtnClick(){return Object(s.a)(this,void 0,void 0,function*(){if(null!=this.model.latestSearchResult)try{const e=yield this.dataService.get_location(this.model.latestSearchResult.Name).toPromise();yield this.showNavigation(e.Building+".Entrance",e.Name)}catch(e){let t="";e instanceof C.d&&e.error.message.includes(this.model.latestSearchResult.Name)&&(t=this.model.latestSearchResult.Name),this.handleInputError(e,0===t.length?this.model.latestSearchResult.Name:t)}finally{t.progressIsVisible=!1}})}showNavigation(t,e){return Object(s.a)(this,void 0,void 0,function*(){this.searchInput.setDiscoverySearchbarValue(e),this.searchInput.setStartSearchbarValue(t),yield this.onRoute([t,e]),yield this.onCloseLocationDrawer(null)})}showDiscoveryMode(){return Object(s.a)(this,void 0,void 0,function*(){null==this.mapView.CurrentRoute&&null==this.mapView.CurrentBuilding&&(yield this.mapView.showDiscoveryMap("","EG"),this.mapView.CenterMap(310,550))})}recentSearchClick(t){return Object(s.a)(this,void 0,void 0,function*(){yield this.router.navigate(["tabs/navigation/detail"],{queryParams:{location:t}})})}presentMapPage(){return Object(s.a)(this,void 0,void 0,function*(){yield this.router.navigate(["tabs/navigation/"])})}get ProgressIsVisible(){return t.progressIsVisible}onFloorChanged(t){return Object(s.a)(this,void 0,void 0,function*(){this.CurrentRoute||(this.searchInput.clearStartInput(),this.searchInput.clearDestinationInput(),yield this.onCloseLocationDrawer(null))})}onSearchFocus(t){return Object(s.a)(this,void 0,void 0,function*(){this.platform.is("hybrid")&&(yield this.searchDrawer.SetState(D.a.Top))})}onCloseRouteDrawer(){return Object(s.a)(this,void 0,void 0,function*(){this.mapView.ClearRoute(),this.mapView.RefreshMap(),this.mapView.FitMap(),yield this.searchDrawer.SetState(K.a.GetRecommendedDrawerStateForDevice()),yield this.routeDrawer.SetState(D.a.Hidden),yield this.locationDrawer.SetState(D.a.Hidden)})}onChangeRouteStartEndClick(){var t,e,i,n,o,r;return Object(s.a)(this,void 0,void 0,function*(){this.routeInput.myLocationEnabled=!1,this.routeInput.routeLocationFrom={Name:null!==(i=null===(e=null===(t=this.CurrentRoute)||void 0===t?void 0:t.Start)||void 0===e?void 0:e.Name)&&void 0!==i?i:"",LatLng:{lat:0,lng:0}},this.routeInput.routeLocationTo={Name:null!==(r=null===(o=null===(n=this.CurrentRoute)||void 0===n?void 0:n.End)||void 0===o?void 0:o.Name)&&void 0!==r?r:"",LatLng:{lat:0,lng:0}},this.routeInput.updateInputValues(),yield this.routeDrawer.SetState(D.a.Hidden),yield this.changeRouteDrawer.SetState(D.a.Top)})}onCancelChangeRoute(){return Object(s.a)(this,void 0,void 0,function*(){yield this.changeRouteDrawer.SetState(D.a.Hidden),yield this.routeDrawer.SetState(K.a.GetRecommendedDrawerStateForDevice())})}onChangeRoute(t){return Object(s.a)(this,void 0,void 0,function*(){yield this.onCancelChangeRoute(),yield this.onRoute([t[0].toString(),t[1].toString()])})}routeInstructionClick(t){return Object(s.a)(this,void 0,void 0,function*(){if((null==t?void 0:t.Floor)!==this.mapView.currentFloor&&(null==t?void 0:t.Building)===this.mapView.currentBuilding){yield this.mapView.showAnotherFloorOfCurrentBuilding(t.Floor,t.Building,!1);let e=0,i=0;for(const n of t.Route)e+=n.Coordinate.X,i+=n.Coordinate.Y;this.mapView.CenterMap(e/t.Route.length,i/t.Route.length)}})}}return t.progressIsVisible=!1,t.\u0275fac=function(e){return new(e||t)(l.Ib(c.a),l.Ib(n.Y),l.Ib(o.a),l.Ib(o.g),l.Ib(R),l.Ib(n.ab))},t.\u0275cmp=l.Cb({type:t,selectors:[["app-navigation"]],viewQuery:function(t,e){if(1&t&&(l.tc(S,!0),l.tc(k,!0),l.tc(J,!0),l.tc(X,!0),l.tc(z,!0),l.tc(G,!0),l.tc(Y,!0),l.tc(q,!0)),2&t){let t;l.gc(t=l.Yb())&&(e.mapView=t.first),l.gc(t=l.Yb())&&(e.searchInput=t.first),l.gc(t=l.Yb())&&(e.drawerContent=t.first),l.gc(t=l.Yb())&&(e.searchDrawer=t.first),l.gc(t=l.Yb())&&(e.locationDrawer=t.first),l.gc(t=l.Yb())&&(e.routeDrawer=t.first),l.gc(t=l.Yb())&&(e.changeRouteDrawer=t.first),l.gc(t=l.Yb())&&(e.routeInput=t.first)}},decls:95,vars:10,consts:function(){let t,e;return t="\xDCberpr\xFCfe deine Eingabe auf Rechtschreibfehler.",e="Sollte dieser Ort im Studi-Guide sein?\n               " + "\ufffd#9\ufffd\ufffd/#9\ufffd" + "\n               " + "\ufffd#10\ufffd" + "F\xFCge den Ort hinzu" + "\ufffd/#10\ufffd" + "\n             ",[["translucent",""],["slot","start"],["id","close-open-map","defaultHref","/"],["data-tap-disabled","true","scroll-y","false"],["type","indeterminate","color","secondary",4,"ngIf"],["id","map-content"],[3,"locationClick","floorChanged"],[3,"stateChange"],["searchDrawer",""],[1,"nav-bottom-drawer"],[1,"drawer-grip"],[1,"ion-padding-top"],[1,"nav-hbar"],[3,"discovery","route","searchBarFocus"],[1,"ion-item-style"],["drawerContent",""],["class","ion-wrap ion-margin","id","error-message",4,"ngIf"],["class","ion-no-padding",4,"ngIf"],[1,"ion-padding-vertical"],["state","DrawerState.Hidden"],["locationDrawer",""],[1,"nav-bottom-drawer","ion-background"],[1,"ion-padding-bottom"],["id","locationdrawerContent"],[1,"ion-justify-content-between","ion-align-self-center"],[1,"ion-justify-content-end","ion-padding-horizontal"],["shape","round","color","medium",1,"square-sm","ion-no-padding","ion-float-right",3,"click"],["slot","icon-only","name","close-outline","size","small"],["id","routeBtn","color","primary","expand","block",3,"click"],[4,"ngFor","ngForOf"],[1,"ion-padding-horizontal"],["class","ion-no-margin ion-padding-end ion-img",3,"src","alt",4,"ngFor","ngForOf"],["id","routeDrawer","state","DrawerState.Hidden"],["routeDrawer",""],["class","ion-no-margin",4,"ngIf"],[4,"ngIf"],["id","changeRouteDrawer","state","DrawerState.Hidden"],["changeRouteDrawer",""],[1,"ion-no-padding","ion-item-style"],[1,"ion-align-items-baseline"],[1,"ion-text-center"],[1,"span-button",3,"click"],["size","6",1,"ion-text-center"],["routeInput",""],["type","indeterminate","color","secondary"],["id","error-message",1,"ion-wrap","ion-margin"],[1,"error"],t,e,["href","https://github.com/Studi-Guide/Studi-Guide/issues/new/choose"],[1,"ion-no-padding"],["button","",3,"click",4,"ngFor","ngForOf"],["button","",3,"click"],[1,"ion-no-margin","ion-padding-end","ion-img",3,"src","alt"],[1,"ion-no-margin"],[1,"ion-text-wrap"]]},template:function(t,e){if(1&t){const t=l.Mb();l.Lb(0,"ion-header",0),l.Lb(1,"ion-toolbar"),l.Lb(2,"ion-buttons",1),l.Jb(3,"ion-back-button",2),l.Kb(),l.Kb(),l.Kb(),l.Lb(4,"ion-content",3),l.oc(5,Z,1,0,"ion-progress-bar",4),l.Lb(6,"div",5),l.Lb(7,"app-map-view",6),l.Xb("locationClick",function(t){return e.showLocationDrawer(t)})("floorChanged",function(t){return e.onFloorChanged(t)}),l.Kb(),l.Kb(),l.Kb(),l.Lb(8,"app-ionic-bottom-drawer",7,8),l.Xb("stateChange",function(t){return e.onDrawerStateChange(t)}),l.Lb(10,"div",9),l.Lb(11,"div",10),l.Jb(12,"div",11),l.Jb(13,"div",12),l.Lb(14,"app-search-input",13),l.Xb("discovery",function(t){return e.onDiscovery(t)})("route",function(t){return e.onRoute(t)})("searchBarFocus",function(t){return e.onSearchFocus(t)}),l.Kb(),l.Kb(),l.Lb(15,"ion-content",14,15),l.oc(17,U,11,1,"ion-text",16),l.oc(18,$,5,1,"ion-list",17),l.Jb(19,"div",18),l.Jb(20,"div",18),l.Jb(21,"div",18),l.Jb(22,"div",18),l.Jb(23,"div",18),l.Jb(24,"div",18),l.Kb(),l.Kb(),l.Kb(),l.Lb(25,"app-ionic-bottom-drawer",19,20),l.Lb(27,"div",21),l.Lb(28,"div",10),l.Jb(29,"div",11),l.Jb(30,"div",12),l.Jb(31,"div",22),l.Kb(),l.Lb(32,"ion-content",14),l.Lb(33,"ion-grid",23),l.Lb(34,"ion-row",24),l.Lb(35,"ion-col"),l.Lb(36,"ion-label"),l.Lb(37,"h1"),l.pc(38),l.Kb(),l.Kb(),l.Lb(39,"ion-text"),l.pc(40),l.Kb(),l.Kb(),l.Lb(41,"ion-col",25),l.Lb(42,"ion-button",26),l.Xb("click",function(t){return e.onCloseLocationDrawer(t)}),l.Jb(43,"ion-icon",27),l.Kb(),l.Kb(),l.Kb(),l.Lb(44,"ion-row"),l.Lb(45,"ion-col"),l.Lb(46,"ion-button",28),l.Xb("click",function(){return e.navigationBtnClick()}),l.pc(47," Route "),l.Kb(),l.Kb(),l.Kb(),l.Lb(48,"ion-row"),l.Lb(49,"ion-col"),l.pc(50,"Description:"),l.Kb(),l.Lb(51,"ion-col"),l.pc(52),l.Kb(),l.Kb(),l.oc(53,W,5,2,"ion-row",29),l.Lb(54,"div",30),l.Lb(55,"app-ionic-horizontal-scrollable"),l.oc(56,Q,1,2,"img",31),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Lb(57,"app-ionic-bottom-drawer",32,33),l.Lb(59,"div",9),l.Lb(60,"div",10),l.Jb(61,"div",11),l.Jb(62,"div",12),l.Jb(63,"div",22),l.oc(64,et,15,3,"ion-item",34),l.Kb(),l.Lb(65,"ion-content",14),l.oc(66,rt,2,1,"ion-list",35),l.Jb(67,"div",18),l.Jb(68,"div",18),l.Jb(69,"div",18),l.Jb(70,"div",18),l.Jb(71,"div",18),l.Jb(72,"div",18),l.Jb(73,"div",18),l.Jb(74,"div",18),l.Kb(),l.Kb(),l.Kb(),l.Lb(75,"app-ionic-bottom-drawer",36,37),l.Lb(77,"div",9),l.Lb(78,"div",10),l.Jb(79,"div",11),l.Jb(80,"div",12),l.Lb(81,"ion-item",38),l.Lb(82,"ion-grid"),l.Lb(83,"ion-row",39),l.Lb(84,"ion-col",40),l.Lb(85,"span",41),l.Xb("click",function(){return e.onCancelChangeRoute()}),l.pc(86,"Cancel"),l.Kb(),l.Kb(),l.Lb(87,"ion-col",42),l.Lb(88,"h3"),l.pc(89,"Change Route"),l.Kb(),l.Kb(),l.Lb(90,"ion-col",40),l.Lb(91,"span",41),l.Xb("click",function(){l.jc(t);const i=l.hc(94);return e.onChangeRoute([i.inputFrom.value,i.inputTo.value])}),l.pc(92,"Route"),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Jb(93,"app-route-input",null,43),l.Kb(),l.Kb()}2&t&&(l.xb(5),l.ec("ngIf",e.ProgressIsVisible),l.xb(12),l.ec("ngIf",e.model.errorMessage),l.xb(1),l.ec("ngIf",e.model.recentSearches.length>0),l.xb(20),l.qc(e.model.latestSearchResult.Name),l.xb(2),l.qc(e.model.latestSearchResult.Description),l.xb(12),l.qc(e.model.latestSearchResult.Description),l.xb(1),l.ec("ngForOf",e.model.latestSearchResult.Information),l.xb(3),l.ec("ngForOf",e.model.latestSearchResult.Images),l.xb(8),l.ec("ngIf",e.CurrentRoute),l.xb(2),l.ec("ngIf",(null==e.CurrentRoute?null:e.CurrentRoute.RouteSections)&&0!==e.CurrentRoute.Distance))},styles:["#map-content[_ngcontent-%COMP%]{height:100%;width:100%;position:fixed}.error[_ngcontent-%COMP%]{color:red}#available-floors-btn[_ngcontent-%COMP%]{position:fixed;bottom:0;display:block;z-index:10}.center[_ngcontent-%COMP%]{margin-left:auto;margin-right:auto;display:block}ion-progress-bar[_ngcontent-%COMP%]{position:absolute;z-index:9999}.vertical-line[_ngcontent-%COMP%]{border-left:2px solid #9d9fa6;height:38px}.nav-hbar[_ngcontent-%COMP%]{border-top:2px solid var(--ion-color-medium,#9d9fa6);border-bottom:2px solid var(--ion-color-medium,#9d9fa6);border-radius:2px;height:0;width:auto;margin:0 45%}.nav-bottom-drawer[_ngcontent-%COMP%]{z-index:1}.square-md[_ngcontent-%COMP%]{height:64px;width:64px}.square-sm[_ngcontent-%COMP%]{height:32px;width:32px}.square-xs[_ngcontent-%COMP%]{height:16px;width:16px}#locationdrawerContent[_ngcontent-%COMP%]{margin-left:30px;margin-right:30px;position:center}#locationdrawerName[_ngcontent-%COMP%]{font-weight:700}.ion-img[_ngcontent-%COMP%]{height:200px}#routeDrawer[_ngcontent-%COMP%]{z-index:4}#changeRouteDrawer[_ngcontent-%COMP%]{z-index:5}.nav-bottom-drawer[_ngcontent-%COMP%]{background-color:var(--ion-item-background,#fff);border-top-left-radius:20px;border-top-right-radius:20px;box-shadow:0 4px 8px 0 rgba(0,0,0,.4),0 6px 20px 0 rgba(0,0,0,.29);height:inherit}.span-button[_ngcontent-%COMP%]{color:var(--ion-color-primary,#3880ff);cursor:pointer}"]}),t})(),ct=(()=>{class t{}return t.\u0275mod=l.Gb({type:t}),t.\u0275inj=l.Fb({factory:function(e){return new(e||t)},imports:[[r.b,n.V]]}),t})();var lt=i("4R65"),ut=i("AytR");let dt=(()=>{class t{constructor(t,e,i){this.locale=t,this.httpClient=e,this.env=i}GetRoute(e,i){return Object(s.a)(this,void 0,void 0,function*(){return yield this.httpClient.get(this.env.serverUrl+t.serverPathPrefix+t.routePath+"?start="+e.lat+","+e.lng+"&end="+i.lat+","+i.lng+"&locale="+this.locale).toPromise()})}GetBounds(){return Object(s.a)(this,void 0,void 0,function*(){return yield this.httpClient.get(this.env.serverUrl+t.serverPathPrefix+t.boundsPath).toPromise()})}}return t.serverPathPrefix="/osm",t.routePath="/route",t.boundsPath="/bounds",t.\u0275fac=function(e){return new(e||t)(l.Tb(l.v),l.Tb(C.b),l.Tb(ut.a))},t.\u0275prov=l.Eb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const ht=["ionSlides"];function bt(t,e){if(1&t&&(l.Lb(0,"ion-slide"),l.Lb(1,"ion-text"),l.Lb(2,"h2"),l.pc(3),l.Kb(),l.Lb(4,"p"),l.pc(5),l.Kb(),l.Kb(),l.Kb()),2&t){const t=e.$implicit;l.xb(3),l.qc(t.Text),l.xb(2),l.rc("",t.Distance,"m")}}let pt=(()=>{class t{constructor(t){this.element=t,this.nextSlide=new l.o,this.previousSlide=new l.o,this.slideOpts={initialSlide:0,speed:400}}ngOnInit(){this.hide()}onPrevSlide(){return Object(s.a)(this,void 0,void 0,function*(){this.previousSlide.emit(yield this.ionSlides.getActiveIndex())})}onNextSlide(){return Object(s.a)(this,void 0,void 0,function*(){this.nextSlide.emit(yield this.ionSlides.getActiveIndex())})}hide(){return Object(s.a)(this,void 0,void 0,function*(){this.element.nativeElement.hidden=!0})}show(){return Object(s.a)(this,void 0,void 0,function*(){this.element.nativeElement.hidden=!1})}}return t.\u0275fac=function(e){return new(e||t)(l.Ib(l.m))},t.\u0275cmp=l.Cb({type:t,selectors:[["app-navigation-instruction-slides"]],viewQuery:function(t,e){if(1&t&&l.tc(ht,!0),2&t){let t;l.gc(t=l.Yb())&&(e.ionSlides=t.first)}},inputs:{instructions:"instructions"},outputs:{nextSlide:"nextSlide",previousSlide:"previousSlide"},decls:4,vars:2,consts:[["pager","true",3,"options","ionSlideNextEnd","ionSlidePrevEnd"],["ionSlides",""],[4,"ngFor","ngForOf"]],template:function(t,e){1&t&&(l.Lb(0,"ion-item"),l.Lb(1,"ion-slides",0,1),l.Xb("ionSlideNextEnd",function(){return e.onNextSlide()})("ionSlidePrevEnd",function(){return e.onPrevSlide()}),l.oc(3,bt,6,2,"ion-slide",2),l.Kb(),l.Kb()),2&t&&(l.xb(1),l.ec("options",e.slideOpts),l.xb(2),l.ec("ngForOf",e.instructions))},directives:[n.v,n.N,r.i,n.M,n.R],styles:["[_nghost-%COMP%]{z-index:auto}ion-slide[_ngcontent-%COMP%]{height:100%;width:100%}@media (min-width:992px){ion-slide[_ngcontent-%COMP%]{padding-bottom:2em}}@media (max-width:991.98px){ion-slide[_ngcontent-%COMP%]{padding-bottom:.5em}}"]}),t})(),ft=(()=>{class t{static persist(t,e){return Object(s.a)(this,void 0,void 0,function*(){yield t.set(this.LAST_MAP_EVENT_KEY,e)})}load(e,i,n){return Object(s.a)(this,void 0,void 0,function*(){e.ready().then(()=>Object(s.a)(this,void 0,void 0,function*(){yield e.get(t.LAST_MAP_EVENT_KEY).then(t=>{i.setView([49.452368,11.093299],n),null!=t&&i.flyTo(t.center,t.zoom)})}))})}}return t.LAST_MAP_EVENT_KEY="lastOpenStreetMapEventTarget",t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=l.Eb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const mt=["*"];let gt=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=l.Cb({type:t,selectors:[["app-ionic-horizontal-scrollable"]],ngContentSelectors:mt,decls:2,vars:0,consts:[[1,"scroll-x-container"]],template:function(t,e){1&t&&(l.dc(),l.Lb(0,"div",0),l.cc(1),l.Kb())},styles:["[_nghost-%COMP%]     .scroll-x-container>*{display:inline-block}.scroll-x-container[_ngcontent-%COMP%]{overflow-x:auto;white-space:nowrap}"]}),t})();const vt=["drawerContent"],wt=["searchDrawer"],yt=["locationDrawer"],St=["routeDrawer"],Ct=["inNavigationDrawer"],Lt=["changeRouteDrawer"],xt=["routeInput"];function Rt(t,e){if(1&t&&(l.Lb(0,"ion-text",45),l.Lb(1,"ion-item"),l.Lb(2,"div"),l.Lb(3,"span",46),l.pc(4),l.Kb(),l.Lb(5,"p"),l.Pb(6,47),l.Kb(),l.Lb(7,"p"),l.Sb(8,48),l.Jb(9,"br"),l.Jb(10,"a",49),l.Qb(),l.Kb(),l.Kb(),l.Kb(),l.Kb()),2&t){const t=l.Zb();l.xb(4),l.qc(t.model.errorMessage)}}function It(t,e){if(1&t){const t=l.Mb();l.Lb(0,"ion-item",50),l.Xb("click",function(){l.jc(t);const i=e.$implicit;return l.Zb(2).search.emit(i.Name)}),l.Lb(1,"ion-text"),l.pc(2),l.Kb(),l.Kb()}if(2&t){const t=e.$implicit;l.xb(2),l.qc(t.Name)}}function Mt(t,e){if(1&t&&(l.Lb(0,"ion-list",12),l.Lb(1,"ion-list-header"),l.Lb(2,"h2"),l.pc(3,"Recent Searches"),l.Kb(),l.Kb(),l.oc(4,It,3,1,"ion-item",13),l.Kb()),2&t){const t=l.Zb();l.xb(4),l.ec("ngForOf",t.model.recentSearches)}}function Ot(t,e){if(1&t){const t=l.Mb();l.Lb(0,"ion-item",50),l.Xb("click",function(){l.jc(t);const i=e.$implicit;return l.Zb().campusClick.emit(i)}),l.Lb(1,"ion-label"),l.Lb(2,"h2"),l.pc(3),l.Kb(),l.Lb(4,"h3"),l.pc(5),l.Kb(),l.Kb(),l.Kb()}if(2&t){const t=e.$implicit;l.xb(3),l.sc("",t.ShortName,": ",t.Name,""),l.xb(2),l.qc(t.Address)}}function kt(t,e){if(1&t&&(l.Lb(0,"ion-row"),l.Lb(1,"ion-col"),l.pc(2),l.Kb(),l.Lb(3,"ion-col"),l.pc(4),l.Kb(),l.Kb()),2&t){const t=e.$implicit;l.xb(2),l.qc(t[0]),l.xb(2),l.qc(t[1])}}function Dt(t,e){if(1&t&&l.Jb(0,"img",51),2&t){const t=e.$implicit;l.fc("src",t.Path,l.lc),l.fc("alt",t.Name)}}function Kt(t,e){1&t&&l.Jb(0,"ion-progress-bar",52)}function Nt(t,e){if(1&t){const t=l.Mb();l.Lb(0,"ion-button",54),l.Xb("click",function(){return l.jc(t),l.Zb(2).onLaunchNavigationClick()}),l.pc(1," Go "),l.Kb()}}function Pt(t,e){if(1&t&&(l.Lb(0,"ion-row"),l.Lb(1,"ion-col"),l.Lb(2,"ion-label"),l.Lb(3,"h2"),l.pc(4),l.Kb(),l.Kb(),l.Lb(5,"ion-text"),l.pc(6),l.Kb(),l.Kb(),l.Lb(7,"ion-col"),l.oc(8,Nt,2,0,"ion-button",53),l.Kb(),l.Kb()),2&t){const t=l.Zb();l.xb(4),l.rc("",t.model.Route.Time," min"),l.xb(2),l.rc("",t.model.Route.Distance," m"),l.xb(2),l.ec("ngIf",!t.UseDrawerForNavigation())}}function Ft(t,e){if(1&t){const t=l.Mb();l.Lb(0,"ion-item",50),l.Xb("click",function(){l.jc(t);const i=e.$implicit;return l.Zb(2).navInstructionClick.emit(i)}),l.Lb(1,"ion-label"),l.pc(2),l.Kb(),l.Lb(3,"ion-text"),l.pc(4),l.Kb(),l.Kb()}if(2&t){const t=e.$implicit;l.xb(2),l.qc(t.Text),l.xb(2),l.rc("",t.Distance,"m")}}function _t(t,e){if(1&t&&(l.Lb(0,"ion-list"),l.oc(1,Ft,5,2,"ion-item",13),l.Kb()),2&t){const t=l.Zb();l.xb(1),l.ec("ngForOf",t.model.Route.NavigationInstructions)}}var Tt=function(t){return t[t.SearchView=0]="SearchView",t[t.LocationView=1]="LocationView",t[t.RouteView=2]="RouteView",t[t.InNavigationView=3]="InNavigationView",t[t.ChangeRouteView=4]="ChangeRouteView",t}({});let Et=(()=>{class t{constructor(t,e){this.model=t,this.platform=e,this.state=Tt.SearchView,this.stateChange=new l.o,this.campusClick=new l.o,this.detailsClick=new l.o,this.navInstructionClick=new l.o,this.search=new l.o,this.newRoute=new l.o}ngAfterViewInit(){return Object(s.a)(this,void 0,void 0,function*(){yield Promise.all([this.locationDrawer.SetState(D.a.Hidden),this.routeDrawer.SetState(D.a.Hidden),this.inNavigationDrawer.SetState(D.a.Hidden),this.changeRouteDrawer.SetState(D.a.Hidden,!1),this.searchDrawer.SetState(D.a.Hidden)])})}SetState(t,e=!1){return Object(s.a)(this,void 0,void 0,function*(){switch(this.state){case Tt.SearchView:yield this.searchDrawer.SetState(D.a.Hidden);break;case Tt.LocationView:yield this.locationDrawer.SetState(D.a.Hidden);break;case Tt.RouteView:yield this.routeDrawer.SetState(D.a.Hidden);break;case Tt.InNavigationView:yield this.inNavigationDrawer.SetState(D.a.Hidden);break;case Tt.ChangeRouteView:yield this.changeRouteDrawer.SetState(D.a.Hidden,!1)}switch(this.state=t,this.state){case Tt.SearchView:yield this.searchDrawer.SetState(K.a.GetRecommendedDrawerStateForDevice());break;case Tt.LocationView:yield this.locationDrawer.SetState(K.a.GetRecommendedDrawerStateForDevice());break;case Tt.RouteView:yield this.routeDrawer.SetState(K.a.GetRecommendedDrawerStateForDevice());break;case Tt.InNavigationView:yield this.inNavigationDrawer.SetState(K.a.GetRecommendedDrawerStateForDevice());break;case Tt.ChangeRouteView:yield this.changeRouteDrawer.SetState(K.a.GetRecommendedDrawerStateForDevice())}e&&this.stateChange.emit(this.state)})}onRouteClick(){return Object(s.a)(this,void 0,void 0,function*(){this.stateChange.emit(Tt.RouteView)})}onLaunchNavigationClick(){return Object(s.a)(this,void 0,void 0,function*(){this.stateChange.emit(Tt.InNavigationView)})}onEndNavigationClick(){return Object(s.a)(this,void 0,void 0,function*(){this.stateChange.emit(Tt.LocationView)})}onSearchFocus(t){return Object(s.a)(this,void 0,void 0,function*(){this.platform.is("hybrid")&&(yield this.searchDrawer.SetState(D.a.Top))})}emitRoute(t){}onCloseLocationDrawer(){return Object(s.a)(this,void 0,void 0,function*(){this.stateChange.emit(Tt.SearchView)})}onCloseRouteDrawer(){return Object(s.a)(this,void 0,void 0,function*(){this.stateChange.emit(Tt.LocationView)})}onChangeRouteStartEndClick(){return Object(s.a)(this,void 0,void 0,function*(){this.routeInput.UpdateFromNavigationModel(),yield this.SetState(Tt.ChangeRouteView,!0),yield this.routeInput.SetFocus()})}onSearchDrawerStateChange(t){void 0!==this.drawerContent&&(this.drawerContent.scrollY=t===D.a.Top)}onChangeRouteDrawerStateChange(t){return Object(s.a)(this,void 0,void 0,function*(){console.log(t),t===D.a.Hidden&&(yield this.SetState(Tt.RouteView,!0))})}onCancelChangeRoute(){return Object(s.a)(this,void 0,void 0,function*(){yield this.SetState(Tt.RouteView,!1)})}UseDrawerForNavigation(){return!(K.a.GetRecommendedDrawerStateForDevice()===D.a.Docked)}}return t.\u0275fac=function(e){return new(e||t)(l.Ib(R),l.Ib(n.ab))},t.\u0275cmp=l.Cb({type:t,selectors:[["app-nav-drawer-manager"]],viewQuery:function(t,e){if(1&t&&(l.tc(vt,!0),l.tc(wt,!0),l.tc(yt,!0),l.tc(St,!0),l.tc(Ct,!0),l.tc(Lt,!0),l.tc(xt,!0)),2&t){let t;l.gc(t=l.Yb())&&(e.drawerContent=t.first),l.gc(t=l.Yb())&&(e.searchDrawer=t.first),l.gc(t=l.Yb())&&(e.locationDrawer=t.first),l.gc(t=l.Yb())&&(e.routeDrawer=t.first),l.gc(t=l.Yb())&&(e.inNavigationDrawer=t.first),l.gc(t=l.Yb())&&(e.changeRouteDrawer=t.first),l.gc(t=l.Yb())&&(e.routeInput=t.first)}},inputs:{state:"state"},outputs:{stateChange:"stateChange",campusClick:"campusClick",detailsClick:"detailsClick",navInstructionClick:"navInstructionClick",search:"search",newRoute:"newRoute"},decls:125,vars:17,consts:function(){let t,e;return t="\xDCberpr\xFCfe deine Eingabe auf Rechtschreibfehler.",e="Sollte dieser Ort im Studi-Guide sein?\n                " + "\ufffd#9\ufffd\ufffd/#9\ufffd" + "\n                " + "\ufffd#10\ufffd" + "F\xFCge den Ort hinzu" + "\ufffd/#10\ufffd" + "\n              ",[["id","searchDrawer",3,"stateChange"],["searchDrawer",""],[1,"nav-bottom-drawer"],[1,"drawer-grip"],[1,"ion-padding-top"],[1,"nav-hbar"],[3,"discovery","route","searchBarFocus"],["searchInput",""],[1,"ion-item-style"],["drawerContent",""],["class","ion-wrap ion-margin",4,"ngIf"],["class","ion-no-padding",4,"ngIf"],[1,"ion-no-padding"],["button","",3,"click",4,"ngFor","ngForOf"],[1,"ion-padding-vertical"],["id","locationDrawer","state","DrawerState.Hidden"],["locationDrawer",""],[1,"ion-padding-bottom"],["id","locationdrawerContent"],[1,"ion-justify-content-between","ion-align-self-center"],[1,"ion-justify-content-end","ion-padding-horizontal"],["shape","round","color","medium",1,"square-sm","ion-no-padding","ion-float-right",3,"click"],["slot","icon-only","name","close-outline","size","small"],["color","primary","expand","block",3,"click"],["id","routeBtn","color","primary","expand","block",3,"click"],[4,"ngFor","ngForOf"],[1,"ion-padding-horizontal"],["class","ion-no-margin ion-padding-end ion-img",3,"src","alt",4,"ngFor","ngForOf"],["id","routeDrawer","state","DrawerState.Hidden"],["routeDrawer",""],["type","indeterminate",4,"ngIf"],[1,"ion-no-margin"],[1,"ion-text-wrap"],[1,"span-button",3,"click"],[4,"ngIf"],["id","inNavigationDrawer","state","DrawerState.Hidden",3,"shouldDockTop"],["inNavigationDrawer",""],[1,"ion-no-padding","ion-item-style"],["color","danger","expand","block",3,"click"],["id","changeRouteDrawer","state","DrawerState.Hidden",3,"shouldDockBottom","shouldDockMiddle","stateChange"],["changeRouteDrawer",""],[1,"ion-align-items-baseline"],[1,"ion-text-center"],["size","6",1,"ion-text-center"],["routeInput",""],[1,"ion-wrap","ion-margin"],[1,"error"],t,e,["href","https://github.com/Studi-Guide/Studi-Guide/issues/new/choose"],["button","",3,"click"],[1,"ion-no-margin","ion-padding-end","ion-img",3,"src","alt"],["type","indeterminate"],["color","success","expand","block",3,"click",4,"ngIf"],["color","success","expand","block",3,"click"]]},template:function(t,e){if(1&t){const t=l.Mb();l.Lb(0,"app-ionic-bottom-drawer",0,1),l.Xb("stateChange",function(t){return e.onSearchDrawerStateChange(t)}),l.Lb(2,"div",2),l.Lb(3,"div",3),l.Jb(4,"div",4),l.Jb(5,"div",5),l.Lb(6,"app-search-input",6,7),l.Xb("discovery",function(t){return e.search.emit(t)})("route",function(t){return e.emitRoute(t)})("searchBarFocus",function(t){return e.onSearchFocus(t)}),l.Kb(),l.Kb(),l.Lb(8,"ion-content",8,9),l.oc(10,Rt,11,1,"ion-text",10),l.oc(11,Mt,5,1,"ion-list",11),l.Lb(12,"ion-list",12),l.Lb(13,"ion-list-header"),l.Lb(14,"h2"),l.pc(15,"Choose a Campus"),l.Kb(),l.Kb(),l.oc(16,Ot,6,3,"ion-item",13),l.Kb(),l.Jb(17,"div",14),l.Jb(18,"div",14),l.Jb(19,"div",14),l.Jb(20,"div",14),l.Jb(21,"div",14),l.Jb(22,"div",14),l.Kb(),l.Kb(),l.Kb(),l.Lb(23,"app-ionic-bottom-drawer",15,16),l.Lb(25,"div",2),l.Lb(26,"div",3),l.Jb(27,"div",4),l.Jb(28,"div",5),l.Jb(29,"div",17),l.Kb(),l.Lb(30,"ion-content",8),l.Lb(31,"ion-grid",18),l.Lb(32,"ion-row",19),l.Lb(33,"ion-col"),l.Lb(34,"ion-label"),l.Lb(35,"h1"),l.pc(36),l.Kb(),l.Kb(),l.Lb(37,"ion-text"),l.pc(38),l.Kb(),l.Kb(),l.Lb(39,"ion-col",20),l.Lb(40,"ion-button",21),l.Xb("click",function(){return e.onCloseLocationDrawer()}),l.Jb(41,"ion-icon",22),l.Kb(),l.Kb(),l.Kb(),l.Lb(42,"ion-row"),l.Lb(43,"ion-col"),l.Lb(44,"ion-button",23),l.Xb("click",function(){return e.detailsClick.emit()}),l.pc(45," Details "),l.Kb(),l.Kb(),l.Lb(46,"ion-col"),l.Lb(47,"ion-button",24),l.Xb("click",function(){return e.onRouteClick()}),l.pc(48," Route "),l.Kb(),l.Kb(),l.Kb(),l.oc(49,kt,5,2,"ion-row",25),l.Kb(),l.Lb(50,"div",26),l.Lb(51,"app-ionic-horizontal-scrollable"),l.oc(52,Dt,1,2,"img",27),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Lb(53,"app-ionic-bottom-drawer",28,29),l.Lb(55,"div",2),l.Lb(56,"div",3),l.Jb(57,"div",4),l.Jb(58,"div",5),l.Jb(59,"div",17),l.oc(60,Kt,1,0,"ion-progress-bar",30),l.Lb(61,"ion-item",31),l.Lb(62,"ion-grid"),l.Lb(63,"ion-row",19),l.Lb(64,"ion-col"),l.Lb(65,"ion-label",32),l.Lb(66,"h1"),l.pc(67),l.Kb(),l.Kb(),l.Lb(68,"ion-text"),l.pc(69,"From "),l.Lb(70,"span",33),l.Xb("click",function(){return e.onChangeRouteStartEndClick()}),l.pc(71),l.Kb(),l.Kb(),l.Kb(),l.Lb(72,"ion-col",20),l.Lb(73,"ion-button",21),l.Xb("click",function(){return e.onCloseRouteDrawer()}),l.Jb(74,"ion-icon",22),l.Kb(),l.Kb(),l.Kb(),l.oc(75,Pt,9,3,"ion-row",34),l.Kb(),l.Kb(),l.Kb(),l.Lb(76,"ion-content",8),l.oc(77,_t,2,1,"ion-list",34),l.Jb(78,"div",14),l.Jb(79,"div",14),l.Jb(80,"div",14),l.Jb(81,"div",14),l.Jb(82,"div",14),l.Jb(83,"div",14),l.Jb(84,"div",14),l.Jb(85,"div",14),l.Kb(),l.Kb(),l.Kb(),l.Lb(86,"app-ionic-bottom-drawer",35,36),l.Lb(88,"div",2),l.Lb(89,"div",3),l.Jb(90,"div",4),l.Jb(91,"div",5),l.Jb(92,"div",17),l.Lb(93,"ion-item",37),l.Lb(94,"ion-grid"),l.Lb(95,"ion-row"),l.Lb(96,"ion-col"),l.Lb(97,"ion-label"),l.Lb(98,"h2"),l.pc(99),l.Kb(),l.Kb(),l.Lb(100,"ion-text"),l.pc(101),l.Kb(),l.Kb(),l.Lb(102,"ion-col"),l.Lb(103,"ion-button",38),l.Xb("click",function(){return e.onEndNavigationClick()}),l.pc(104," End Route "),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Lb(105,"app-ionic-bottom-drawer",39,40),l.Xb("stateChange",function(t){return e.onChangeRouteDrawerStateChange(t)}),l.Lb(107,"div",2),l.Lb(108,"div",3),l.Jb(109,"div",4),l.Jb(110,"div",5),l.Lb(111,"ion-item",37),l.Lb(112,"ion-grid"),l.Lb(113,"ion-row",41),l.Lb(114,"ion-col",42),l.Lb(115,"span",33),l.Xb("click",function(){return e.onCancelChangeRoute()}),l.pc(116,"Cancel"),l.Kb(),l.Kb(),l.Lb(117,"ion-col",43),l.Lb(118,"h3"),l.pc(119,"Change Route"),l.Kb(),l.Kb(),l.Lb(120,"ion-col",42),l.Lb(121,"span",33),l.Xb("click",function(){l.jc(t);const i=l.hc(124);return e.newRoute.emit([i.From,i.To])}),l.pc(122,"Route"),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Jb(123,"app-route-input",null,44),l.Kb(),l.Kb()}2&t&&(l.xb(10),l.ec("ngIf",e.model.errorMessage),l.xb(1),l.ec("ngIf",e.model.recentSearches.length>0),l.xb(5),l.ec("ngForOf",e.model.availableCampus),l.xb(20),l.qc(e.model.latestSearchResult.Name),l.xb(2),l.qc(e.model.latestSearchResult.Description),l.xb(11),l.ec("ngForOf",e.model.latestSearchResult.Information),l.xb(3),l.ec("ngForOf",e.model.latestSearchResult.Images),l.xb(8),l.ec("ngIf",0===e.model.Route.Distance),l.xb(7),l.rc("To ",e.model.Route.Destination.Name,""),l.xb(4),l.qc(e.model.Route.Start.Name),l.xb(4),l.ec("ngIf",0!==e.model.Route.Distance),l.xb(2),l.ec("ngIf",0!==e.model.Route.Distance),l.xb(9),l.ec("shouldDockTop",!1),l.xb(13),l.rc("",e.model.Route.Time," min"),l.xb(2),l.rc("",e.model.Route.Distance," m"),l.xb(4),l.ec("shouldDockBottom",!1)("shouldDockMiddle",!1))},directives:[K.a,k,n.p,r.j,n.y,n.z,r.i,n.r,n.I,n.o,n.x,n.R,n.h,n.t,gt,n.v,V,n.B],styles:[".vertical-line[_ngcontent-%COMP%]{border-left:2px solid #9d9fa6;height:38px}.span-button[_ngcontent-%COMP%]{color:var(--ion-color-primary,#3880ff)}.span-button[_ngcontent-%COMP%]:hover{cursor:pointer}.error[_ngcontent-%COMP%]{color:red}.nav-hbar[_ngcontent-%COMP%]{border-top:2px solid var(--ion-color-medium,#9d9fa6);border-bottom:2px solid var(--ion-color-medium,#9d9fa6);border-radius:2px;height:0;width:auto;margin:0 45%}.nav-bottom-drawer[_ngcontent-%COMP%]{background-color:var(--ion-item-background,#fff);border-top-left-radius:20px;border-top-right-radius:20px;box-shadow:0 4px 8px 0 rgba(0,0,0,.4),0 6px 20px 0 rgba(0,0,0,.29);height:inherit}.square-md[_ngcontent-%COMP%]{height:64px;width:64px}.square-sm[_ngcontent-%COMP%]{height:32px;width:32px}.square-xs[_ngcontent-%COMP%]{height:16px;width:16px}#locationdrawerContent[_ngcontent-%COMP%]{margin-left:30px;margin-right:30px;position:center}#locationdrawerName[_ngcontent-%COMP%]{font-weight:700}#inNavigationDrawer[_ngcontent-%COMP%]{z-index:1}#locationDrawer[_ngcontent-%COMP%]{z-index:2}#routeDrawer[_ngcontent-%COMP%]{z-index:3}#searchDrawer[_ngcontent-%COMP%]{z-index:4}.ion-img[_ngcontent-%COMP%]{height:200px}"]}),t})();const At=["searchInput"],Bt=["navSlides"],jt=["drawerManager"];function Vt(t,e){1&t&&l.Jb(0,"ion-progress-bar",8)}const{Keyboard:Jt}=F.a,Xt=lt.icon({iconRetinaUrl:"leaflet/marker-icon-2x.png",iconUrl:"leaflet/marker-icon.png",shadowUrl:"leaflet/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]});lt.Marker.prototype.options.icon=Xt;let zt=(()=>{class t{constructor(t,e,i,n,o,r,a,s,c){this.dataService=t,this.route=e,this.router=i,this.model=n,this.storage=o,this.geolocation=r,this.openStreetMapService=a,this.lastOpenStreetMapCenterPersistence=s,this.platform=c,this.searchMarker=[],this.routes=[],this.progressIsVisible=!1,this.currentPositionMarker=null,this.isInitialized=!1,this.isSubscribed=!1,this.DEFAULT_ZOOM=17,this.MAX_ZOOM=18,this.MIN_ZOOM=14,this.isHybridPlatform=this.platform.is("hybrid")}static convertToLeafLetCoordinates(t){const e=[];for(const i of t)e.push({lat:i.Latitude,lng:i.Longitude});return e}ngOnInit(){return Object(s.a)(this,void 0,void 0,function*(){if(!this.model.availableCampus||0===this.model.availableCampus.length){const t=yield this.dataService.get_campus_search().toPromise();for(const e of t)this.model.availableCampus.push(new N(e))}})}ionViewDidEnter(){return Object(s.a)(this,void 0,void 0,function*(){this.isInitialized||(yield this.initializeMap(this.router),this.isInitialized=!0);try{const t=yield this.geolocation.getCurrentPosition();null===this.currentPositionMarker?this.currentPositionMarker=lt.marker([t.coords.latitude,t.coords.longitude]).addTo(this.map).bindPopup("Position"):this.currentPositionMarker.setLatLng([t.coords.latitude,t.coords.longitude])}catch(t){console.log("Error getting location",t)}!1===this.isSubscribed&&(this.isSubscribed=!0,this.route.queryParams.subscribe(t=>Object(s.a)(this,void 0,void 0,function*(){null!=t&&(null!=t.location?(yield this.execSearch(t.location),this.clearRoutes()):null!=t.destination?(yield this.drawerManager.SetState(Tt.RouteView),yield this.execDirectSearch(t.destination),yield this.routeToLatestSearchResult()):(yield this.drawerManager.SetState(Tt.SearchView),this.clearSearchMarkers(),this.clearRoutes()))})))})}initializeMap(e){var i;return Object(s.a)(this,void 0,void 0,function*(){const n=yield this.openStreetMapService.GetBounds(),o=lt.latLng(n.SouthWest.Lat,n.SouthWest.Lng),r=lt.latLng(n.NorthEast.Lat,n.NorthEast.Lng),a=lt.latLngBounds(o,r);console.log(n,a),this.map=lt.map("leafletMap",{maxBounds:a,maxZoom:this.MAX_ZOOM,minZoom:this.MIN_ZOOM,zoomControl:!this.platform.is("hybrid")}),this.map.on("moveend",t=>{ft.persist(this.storage,{center:t.target.getCenter(),zoom:t.target.getZoom()})}),yield this.lastOpenStreetMapCenterPersistence.load(this.storage,this.map,this.DEFAULT_ZOOM),lt.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"edupala.com \xa9 Angular LeafLet"}).addTo(this.map),this.platform.is("hybrid")&&(yield this.delay(500),this.map.invalidateSize());const s=yield this.dataService.get_buildings_search().toPromise();function c(t){e.navigate(["tabs/navigation"],{queryParams:{location:t.target.options.className}}).then(()=>console.log(t.latlng,t.target.options.className))}if(null!==s)for(const e of s)null!==e.edges.Body&&e.edges.Body.length>0&&lt.polygon(t.convertToLeafLetCoordinates(e.edges.Body),{className:e.Name,color:null!==(i=e.Color)&&void 0!==i?i:"#0083C6"}).addTo(this.map).on("click",c)})}ngOnDestroy(){this.map.remove()}onSearch(t){return Object(s.a)(this,void 0,void 0,function*(){yield this.router.navigate(["/tabs/navigation"],{queryParams:{location:t}})})}execSearch(t){return Object(s.a)(this,void 0,void 0,function*(){this.model.errorMessage="",this.progressIsVisible=!0;try{if(this.clearSearchMarkers(),yield this.execDirectSearch(t))return this.searchMarker.push(this.showMarker(this.model.latestSearchResult.LatLng.lat,this.model.latestSearchResult.LatLng.lng,this.model.latestSearchResult.Name,!0)),this.map.flyTo(this.model.latestSearchResult.LatLng,this.DEFAULT_ZOOM),void(yield this.showElementDrawer());const e=yield this.dataService.get_buildings_search(t).toPromise();if(e&&e.length>0){for(const t of e){const e=this.getCenterCoordinateFromBody(t.edges.Body);this.searchMarker.push(this.showMarker(e.Latitude,e.Longitude,t.Name,!1))}return}{const e=yield this.dataService.get_campus_search(t).toPromise();if(e&&e.length>0){for(const t of e)this.searchMarker.push(this.showMarker(t.Latitude,t.Longitude,t.Name,!1));return}}this.model.errorMessage="Studi-Guide can't find "+t}catch(e){this.handleInputError(e,t)}finally{this.progressIsVisible=!1}})}execDirectSearch(t){return Object(s.a)(this,void 0,void 0,function*(){try{const e=yield this.dataService.get_location(t).toPromise();if(e){const t=yield this.dataService.get_building(e.Building).toPromise(),i=this.getCenterCoordinateFromBody(t.edges.Body);return yield this.model.addRecentSearchLocation(e,{lat:i.Latitude,lng:i.Longitude},t),!0}}catch(e){console.log(e)}try{const e=yield this.dataService.get_building(t,!1).toPromise();if(e){const t=this.getCenterCoordinateFromBody(e.edges.Body);return yield this.model.addRecentSearchBuilding(e,{lat:t.Latitude,lng:t.Longitude}),!0}}catch(e){console.log(e)}try{const e=yield this.dataService.get_campus(t,!1).toPromise();if(e)return yield this.model.addRecentSearchCampus(e),!0}catch(e){console.log(e)}return!1})}onRoute(t){return Object(s.a)(this,void 0,void 0,function*(){console.log(t),this.clearRoutes(),yield this.drawerManager.SetState(Tt.RouteView,!1);const e=yield this.openStreetMapService.GetRoute(t[0].LatLng,t[1].LatLng);this.model.SetOsmRouteAsRoute(e[0],t[0],t[1]);const i=lt.polyline(this.model.Route.Coordinates,{color:"red"}).addTo(this.map);this.map.flyTo(i.getCenter(),this.DEFAULT_ZOOM),yield this.map.fitBounds(i.getBounds()),this.routes.push(i)})}showElementDrawer(){return Object(s.a)(this,void 0,void 0,function*(){this.isHybridPlatform&&(yield Jt.hide()),yield this.drawerManager.SetState(Tt.LocationView)})}onCampusClick(t){this.map.flyTo(t.LatLng,this.DEFAULT_ZOOM)}onDrawerManagerStateChange(t){return Object(s.a)(this,void 0,void 0,function*(){switch(console.log(t),t){case Tt.SearchView:yield this.router.navigate(["/tabs/navigation"]);break;case Tt.LocationView:yield this.router.navigate(["/tabs/navigation"],{queryParams:{location:this.model.latestSearchResult.Name}});break;case Tt.RouteView:yield this.router.navigate(["/tabs/navigation"],{queryParams:{destination:this.model.latestSearchResult.Name}});break;case Tt.InNavigationView:yield this.onLaunchNavigation()}})}onDetailsClick(){return Object(s.a)(this,void 0,void 0,function*(){yield this.router.navigate(["tabs/navigation/detail"],{queryParams:0===this.routes.length?this.model.latestSearchResult.DetailRouterParams:this.model.latestSearchResult.RouteRouterParams})})}routeToLatestSearchResult(){return Object(s.a)(this,void 0,void 0,function*(){const e=yield this.geolocation.getCurrentPosition(),i={lat:e.coords.latitude,lng:e.coords.longitude},n=yield this.openStreetMapService.GetRoute(i,this.model.latestSearchResult.LatLng);this.model.SetOsmRouteAsRoute(n[0],{Name:t.MyLocation,LatLng:i},this.model.latestSearchResult);const o=lt.polyline(this.model.Route.Coordinates,{color:"red"}).addTo(this.map);this.map.flyTo(o.getCenter(),this.DEFAULT_ZOOM),yield this.map.fitBounds(o.getBounds()),this.routes.push(o)})}onLaunchNavigation(){return Object(s.a)(this,void 0,void 0,function*(){this.navSlides.instructions=this.model.Route.NavigationInstructions,yield this.navSlides.show(),this.map.flyTo(this.model.Route.Coordinates[this.model.Route.NavigationInstructions[0].Interval[0]],this.MAX_ZOOM),yield this.drawerManager.SetState(Tt.InNavigationView)})}onSlideChange(t){this.onNavigationInstructionClick(this.model.Route.NavigationInstructions[t])}onNavigationInstructionClick(t){this.map.flyTo(this.model.Route.Coordinates[t.Interval[0]],this.MAX_ZOOM)}handleInputError(t,e){if(t instanceof C.d){const i=t;this.model.errorMessage=400===i.status?"Studi-Guide can't find "+e:i.message}else this.model.errorMessage=t.message}showMarker(t,e,i="",n){const o=lt.marker([t,e]).addTo(this.map);return i?n?o.bindPopup(i).openPopup():o.bindPopup(i):o}getCenterCoordinateFromBody(t){const e=[];for(const o of t)e.push([o.Latitude,o.Longitude]);const i=new lt.Polygon(e).addTo(this.map),n={Longitude:i.getCenter().lng,Latitude:i.getCenter().lat};return i.remove(),n}clearSearchMarkers(){for(const t of this.searchMarker)this.map.removeLayer(t)}clearRoutes(){for(const t of this.routes)t.remove();this.routes=[],this.model.ClearRoute(),this.navSlides.hide()}delay(t){return new Promise(e=>setTimeout(e,t))}}return t.MyLocation="My Location",t.\u0275fac=function(e){return new(e||t)(l.Ib(c.a),l.Ib(o.a),l.Ib(o.g),l.Ib(R),l.Ib(L.b),l.Ib(_.a),l.Ib(dt),l.Ib(ft),l.Ib(n.ab))},t.\u0275cmp=l.Cb({type:t,selectors:[["app-map-page"]],viewQuery:function(t,e){if(1&t&&(l.tc(At,!0),l.tc(Bt,!0),l.tc(jt,!0)),2&t){let t;l.gc(t=l.Yb())&&(e.searchInput=t.first),l.gc(t=l.Yb())&&(e.navSlides=t.first),l.gc(t=l.Yb())&&(e.drawerManager=t.first)}},decls:8,vars:1,consts:[[3,"campusClick","navInstructionClick","search","detailsClick","stateChange","newRoute"],["drawerManager",""],[3,"nextSlide","previousSlide"],["navSlides",""],["data-tap-disabled","true","scroll-y","false"],["type","indeterminate","color","secondary",4,"ngIf"],["id","map-content"],["id","leafletMap"],["type","indeterminate","color","secondary"]],template:function(t,e){1&t&&(l.Lb(0,"app-nav-drawer-manager",0,1),l.Xb("campusClick",function(t){return e.onCampusClick(t)})("navInstructionClick",function(t){return e.onNavigationInstructionClick(t)})("search",function(t){return e.onSearch(t)})("detailsClick",function(){return e.onDetailsClick()})("stateChange",function(t){return e.onDrawerManagerStateChange(t)})("newRoute",function(t){return e.onRoute(t)}),l.Kb(),l.Lb(2,"app-navigation-instruction-slides",2,3),l.Xb("nextSlide",function(t){return e.onSlideChange(t)})("previousSlide",function(t){return e.onSlideChange(t)}),l.Kb(),l.Lb(4,"ion-content",4),l.oc(5,Vt,1,0,"ion-progress-bar",5),l.Lb(6,"div",6),l.Jb(7,"div",7),l.Kb(),l.Kb()),2&t&&(l.xb(5),l.ec("ngIf",e.progressIsVisible))},directives:[Et,pt,n.p,r.j,n.B],styles:["#map-content[_ngcontent-%COMP%]{height:100%;width:100%;position:fixed}.error[_ngcontent-%COMP%]{color:red}#error-message[_ngcontent-%COMP%]{margin-left:20px}#leafletMap[_ngcontent-%COMP%]{height:100%;width:100%;z-index:0}#leafletMap[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}#available-floors-btn[_ngcontent-%COMP%]{position:fixed;bottom:0;display:block;z-index:10}.draggable[_ngcontent-%COMP%]{cursor:-webkit-grab;cursor:grab}.draggable[_ngcontent-%COMP%]:active{cursor:-webkit-grabbing;cursor:grabbing}.center[_ngcontent-%COMP%]{margin-left:auto;margin-right:auto;display:block}ion-progress-bar[_ngcontent-%COMP%]{position:absolute;z-index:9999}"]}),t})(),Gt=(()=>{class t{}return t.\u0275mod=l.Gb({type:t}),t.\u0275inj=l.Fb({factory:function(e){return new(e||t)},imports:[[r.b]]}),t})(),Yt=(()=>{class t{}return t.\u0275mod=l.Gb({type:t}),t.\u0275inj=l.Fb({factory:function(e){return new(e||t)},imports:[[n.V,r.b,a.a,o.i.forChild([{path:"detail",component:st},{path:"",component:zt}]),ct,Gt]]}),t})();l.mc(st,[n.s,n.U,n.i,n.f,n.g,n.p,r.j,n.B,S,K.a,k,n.R,n.v,n.y,n.z,r.i,n.r,n.I,n.o,n.x,n.h,n.t,gt,V],[])},wyfB:function(t,e){function i(t){return t&&t.ownerSVGElement&&t.getCTM}t.exports=function(t,e){if(!i(t))throw new Error("svg element is required for svg.panzoom to work");var n=t.ownerSVGElement;if(!n)throw new Error("Do not apply panzoom to the root <svg> element. Use its child instead (e.g. <g></g>). As of March 2016 only FireFox supported transform on the root element");return e.disableKeyboardInteraction||n.setAttribute("tabindex",0),{getBBox:function(){var e=t.getBBox();return{left:e.x,top:e.y,width:e.width,height:e.height}},getScreenCTM:function(){return n.getCTM()||n.getScreenCTM()},getOwner:function(){return n},applyTransform:function(e){t.setAttribute("transform","matrix("+e.scale+" 0 0 "+e.scale+" "+e.x+" "+e.y+")")},initTransform:function(e){var i=t.getCTM();null===i&&(i=document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix()),e.x=i.e,e.y=i.f,e.scale=i.a,n.removeAttributeNS(null,"viewBox")}}},t.exports.canAttach=i}}]);