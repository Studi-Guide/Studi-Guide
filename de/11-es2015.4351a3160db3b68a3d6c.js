(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"0Tit":function(t,e){var n="function"==typeof Float32Array;function i(t,e){return 1-3*e+3*t}function o(t,e){return 3*e-6*t}function r(t){return 3*t}function a(t,e,n){return((i(e,n)*t+o(e,n))*t+r(e))*t}function s(t,e,n){return 3*i(e,n)*t*t+2*o(e,n)*t+r(e)}function c(t){return t}t.exports=function(t,e,i,o){if(!(0<=t&&t<=1&&0<=i&&i<=1))throw new Error("bezier x values must be in [0, 1] range");if(t===e&&i===o)return c;for(var r=n?new Float32Array(11):new Array(11),l=0;l<11;++l)r[l]=a(.1*l,t,i);return function(n){return 0===n?0:1===n?1:a(function(e){for(var n=0,o=1;10!==o&&r[o]<=e;++o)n+=.1;--o;var c=n+(e-r[o])/(r[o+1]-r[o])*.1,l=s(c,t,i);return l>=.001?function(t,e,n,i){for(var o=0;o<4;++o){var r=s(e,n,i);if(0===r)return e;e-=(a(e,n,i)-t)/r}return e}(e,c,t,i):0===l?c:function(t,e,n,i,o){var r,s,c=0;do{(r=a(s=e+(n-e)/2,i,o)-t)>0?n=s:e=s}while(Math.abs(r)>1e-7&&++c<10);return s}(e,n,n+.1,t,i)}(n),e,o)}}},"6f8I":function(t,e){function n(){return"function"==typeof cancelAnimationFrame?cancelAnimationFrame:clearTimeout}function i(){return"function"==typeof requestAnimationFrame?requestAnimationFrame:function(t){return setTimeout(t,16)}}t.exports=function(t,e,o){"object"!=typeof o&&(o={});var r,a,s,c,l,u,d,h,b,p,m="number"==typeof o.minVelocity?o.minVelocity:5,f="number"==typeof o.amplitude?o.amplitude:.25,g="function"==typeof o.cancelAnimationFrame?o.cancelAnimationFrame:n(),v="function"==typeof o.requestAnimationFrame?o.requestAnimationFrame:i();return{start:function(){r=t(),u=b=c=d=0,a=new Date,g(s),g(p),s=v(w)},stop:function(){g(s),g(p);var e=t();l=e.x,h=e.y,a=Date.now(),(c<-m||c>m)&&(l+=u=f*c),(d<-m||d>m)&&(h+=b=f*d),p=v(y)},cancel:function(){g(s),g(p)}};function w(){var e=Date.now(),n=e-a;a=e;var i=t(),o=i.x-r.x,l=i.y-r.y;r=i;var u=1e3/(1+n);c=.8*o*u+.2*c,d=.8*l*u+.2*d,s=v(w)}function y(){var t=Date.now()-a,n=!1,i=0,o=0;u&&((i=-u*Math.exp(-t/342))>.5||i<-.5?n=!0:i=u=0),b&&((o=-b*Math.exp(-t/342))>.5||o<-.5?n=!0:o=b=0),n&&(e(l+i,h+o),p=v(y))}}},AMdQ:function(t,e){t.exports=function(t){!function(t){if(!t)throw new Error("Eventify cannot use falsy object as events subject");for(var e=["on","fire","off"],n=0;n<e.length;++n)if(t.hasOwnProperty(e[n]))throw new Error("Subject cannot be eventified, since it already has property '"+e[n]+"'")}(t);var e=function(t){var e=Object.create(null);return{on:function(n,i,o){if("function"!=typeof i)throw new Error("callback is expected to be a function");var r=e[n];return r||(r=e[n]=[]),r.push({callback:i,ctx:o}),t},off:function(n,i){if(void 0===n)return e=Object.create(null),t;if(e[n])if("function"!=typeof i)delete e[n];else for(var o=e[n],r=0;r<o.length;++r)o[r].callback===i&&o.splice(r,1);return t},fire:function(n){var i,o=e[n];if(!o)return t;arguments.length>1&&(i=Array.prototype.splice.call(arguments,1));for(var r=0;r<o.length;++r){var a=o[r];a.callback.apply(a.ctx,i)}return t}}}(t);return t.on=e.on,t.off=e.off,t.fire=e.fire,t}},AgEI:function(t,e){function n(t){return t.stopPropagation(),!1}function i(){}t.exports=function(t){if(t)return{capture:i,release:i};var e,o,r,a=!1;return{capture:function(t){a=!0,o=window.document.onselectstart,r=window.document.ondragstart,window.document.onselectstart=n,(e=t).ondragstart=n},release:function(){a&&(a=!1,window.document.onselectstart=o,e&&(e.ondragstart=r))}}}},EnSQ:function(t,e,n){"use strict";n.d(e,"a",function(){return O});var i=n("AytR"),o=n("EY2u"),r=n("XNiG"),a=n("quSY");class s extends a.a{constructor(t,e){super()}schedule(t,e=0){return this}}class c extends s{constructor(t,e){super(t,e),this.scheduler=t,this.work=e,this.pending=!1}schedule(t,e=0){if(this.closed)return this;this.state=t;const n=this.id,i=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(i,n,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(i,this.id,e),this}requestAsyncId(t,e,n=0){return setInterval(t.flush.bind(t,this),n)}recycleAsyncId(t,e,n=0){if(null!==n&&this.delay===n&&!1===this.pending)return e;clearInterval(e)}execute(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const n=this._execute(t,e);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,e){let n=!1,i=void 0;try{this.work(t)}catch(o){n=!0,i=!!o&&o||new Error(o)}if(n)return this.unsubscribe(),i}_unsubscribe(){const t=this.id,e=this.scheduler,n=e.actions,i=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==i&&n.splice(i,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null}}class l extends c{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}schedule(t,e=0){return e>0?super.schedule(t,e):(this.delay=e,this.state=t,this.scheduler.flush(this),this)}execute(t,e){return e>0||this.closed?super.execute(t,e):this._execute(t,e)}requestAsyncId(t,e,n=0){return null!==n&&n>0||null===n&&this.delay>0?super.requestAsyncId(t,e,n):t.flush(this)}}let u=(()=>{class t{constructor(e,n=t.now){this.SchedulerAction=e,this.now=n}schedule(t,e=0,n){return new this.SchedulerAction(this,t).schedule(n,e)}}return t.now=()=>Date.now(),t})();class d extends u{constructor(t,e=u.now){super(t,()=>d.delegate&&d.delegate!==this?d.delegate.now():e()),this.actions=[],this.active=!1,this.scheduled=void 0}schedule(t,e=0,n){return d.delegate&&d.delegate!==this?d.delegate.schedule(t,e,n):super.schedule(t,e,n)}flush(t){const{actions:e}=this;if(this.active)return void e.push(t);let n;this.active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,n){for(;t=e.shift();)t.unsubscribe();throw n}}}class h extends d{}const b=new h(l);var p=n("7o/Q"),m=n("LRne"),f=n("HDdC");let g=(()=>{class t{constructor(t,e,n){this.kind=t,this.value=e,this.error=n,this.hasValue="N"===t}observe(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}}do(t,e,n){switch(this.kind){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return n&&n()}}accept(t,e,n){return t&&"function"==typeof t.next?this.observe(t):this.do(t,e,n)}toObservable(){switch(this.kind){case"N":return Object(m.a)(this.value);case"E":return t=this.error,new f.a(e=>e.error(t));case"C":return Object(o.b)()}var t;throw new Error("unexpected notification kind value")}static createNext(e){return void 0!==e?new t("N",e):t.undefinedValueNotification}static createError(e){return new t("E",void 0,e)}static createComplete(){return t.completeNotification}}return t.completeNotification=new t("C"),t.undefinedValueNotification=new t("N",void 0),t})();class v extends p.a{constructor(t,e,n=0){super(t),this.scheduler=e,this.delay=n}static dispatch(t){const{notification:e,destination:n}=t;e.observe(n),this.unsubscribe()}scheduleMessage(t){this.destination.add(this.scheduler.schedule(v.dispatch,this.delay,new w(t,this.destination)))}_next(t){this.scheduleMessage(g.createNext(t))}_error(t){this.scheduleMessage(g.createError(t)),this.unsubscribe()}_complete(){this.scheduleMessage(g.createComplete()),this.unsubscribe()}}class w{constructor(t,e){this.notification=t,this.destination=e}}var y=n("9ppp"),S=n("Ylt2");class C extends r.a{constructor(t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,n){super(),this.scheduler=n,this._events=[],this._infiniteTimeWindow=!1,this._bufferSize=t<1?1:t,this._windowTime=e<1?1:e,e===Number.POSITIVE_INFINITY?(this._infiniteTimeWindow=!0,this.next=this.nextInfiniteTimeWindow):this.next=this.nextTimeWindow}nextInfiniteTimeWindow(t){if(!this.isStopped){const e=this._events;e.push(t),e.length>this._bufferSize&&e.shift()}super.next(t)}nextTimeWindow(t){this.isStopped||(this._events.push(new L(this._getNow(),t)),this._trimBufferThenGetEvents()),super.next(t)}_subscribe(t){const e=this._infiniteTimeWindow,n=e?this._events:this._trimBufferThenGetEvents(),i=this.scheduler,o=n.length;let r;if(this.closed)throw new y.a;if(this.isStopped||this.hasError?r=a.a.EMPTY:(this.observers.push(t),r=new S.a(this,t)),i&&t.add(t=new v(t,i)),e)for(let a=0;a<o&&!t.closed;a++)t.next(n[a]);else for(let a=0;a<o&&!t.closed;a++)t.next(n[a].value);return this.hasError?t.error(this.thrownError):this.isStopped&&t.complete(),r}_getNow(){return(this.scheduler||b).now()}_trimBufferThenGetEvents(){const t=this._getNow(),e=this._bufferSize,n=this._windowTime,i=this._events,o=i.length;let r=0;for(;r<o&&!(t-i[r].time<n);)r++;return o>e&&(r=Math.max(r,o-e)),r>0&&i.splice(0,r),i}}class L{constructor(t,e){this.time=t,this.value=e}}var x=n("JIr8"),I=n("fXoL");let R=(()=>{class t{constructor(){this.cache={}}Get(t,e,n=!0){return this.cache[e]||(console.log("CacheService: Request received "+e),this.cache[e]=t.get(e).pipe(function(t,e,n){let i;return i={bufferSize:1,windowTime:void 0,refCount:!1,scheduler:void 0},t=>t.lift(function({bufferSize:t=Number.POSITIVE_INFINITY,windowTime:e=Number.POSITIVE_INFINITY,refCount:n,scheduler:i}){let o,r,a=0,s=!1,c=!1;return function(l){let u;a++,!o||s?(s=!1,o=new C(t,e,i),u=o.subscribe(this),r=l.subscribe({next(t){o.next(t)},error(t){s=!0,o.error(t)},complete(){c=!0,r=void 0,o.complete()}})):u=o.subscribe(this),this.add(()=>{a--,u.unsubscribe(),r&&!c&&n&&0===a&&(r.unsubscribe(),r=void 0,o=void 0)})}}(i))}(),Object(x.a)(t=>(n&&console.log(t),delete this.cache[e],o.a)))),this.cache[e]}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=I.Eb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var M=n("tk/3");let O=(()=>{class t{constructor(t,e,n){this.httpClient=t,this.env=e,this.cache=n,console.log("Using ",e.serverUrl),this.baseUrl=e.serverUrl}get_map_floor(t,e){return this.cache.Get(this.httpClient,this.baseUrl+"/maps/buildings/"+t+"/floors/"+e)}get_map_items(t,e,n){return this.cache.Get(this.httpClient,this.baseUrl+"/maps?floor="+(null!=e?e:"")+"&campus="+(null!=t?t:"")+"&building="+(null!=n?n:""))}get_locations_items(t,e,n){return this.cache.Get(this.httpClient,this.baseUrl+"/locations?floor="+(null!=e?e:"")+"&campus="+(null!=t?t:"")+"&building="+(null!=n?n:""))}get_route(t,e){return this.cache.Get(this.httpClient,this.baseUrl+"/navigation/dir?start="+encodeURI(t)+"&end="+encodeURI(e))}get_locations_all(){return this.cache.Get(this.httpClient,this.baseUrl+"/locations")}get_locations_search(t){return this.cache.Get(this.httpClient,this.baseUrl+"/locations?search="+encodeURI(t))}get_location(t){return this.cache.Get(this.httpClient,this.baseUrl+"/locations/"+encodeURI(t))}get_locations(t,e){return this.cache.Get(this.httpClient,this.baseUrl+"/buildings/"+t+"/floors/"+e+"/locations")}get_building(t,e=!0){return this.cache.Get(this.httpClient,this.baseUrl+"/buildings/"+encodeURI(t),e)}get_building_floor(t,e=!0){return this.cache.Get(this.httpClient,this.baseUrl+"/buildings/"+encodeURI(t)+"/floors",e)}get_buildings_search(t=""){return this.cache.Get(this.httpClient,this.baseUrl+"/buildings"+encodeURI(t?"?name="+t:""))}get_map_item(t){return this.cache.Get(this.httpClient,this.baseUrl+"/maps?pathnodeid="+t)}get_campus(t,e=!0){return this.cache.Get(this.httpClient,this.baseUrl+"/campus/"+encodeURI(t),e)}get_campus_search(t=""){return this.cache.Get(this.httpClient,this.baseUrl+"/campus"+encodeURI(t?"?search="+t:""))}get_rssFeed(t){return this.httpClient.get(this.baseUrl+"/rssfeed/"+t,{responseType:"text"})}}return t.\u0275fac=function(e){return new(e||t)(I.Tb(M.b),I.Tb(i.a),I.Tb(R))},t.\u0275prov=I.Eb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},QIvw:function(t,e){t.exports=function(){this.x=0,this.y=0,this.scale=1}},Vkd7:function(t,e){function n(t){return t&&t.parentElement&&t.style}t.exports=function(t,e){if(!n(t))throw new Error("panzoom requires DOM element to be attached to the DOM tree");var i=t.parentElement;return t.scrollTop=0,e.disableKeyboardInteraction||i.setAttribute("tabindex",0),{getBBox:function(){return{left:0,top:0,width:t.clientWidth,height:t.clientHeight}},getOwner:function(){return i},applyTransform:function(e){t.style.transformOrigin="0 0 0",t.style.transform="matrix("+e.scale+", 0, 0, "+e.scale+", "+e.x+", "+e.y+")"}}},t.exports.canAttach=n},cQc6:function(t,e){t.exports=function(t,e){for(var n=t[0],i=t[1],o=!1,r=0,a=e.length-1;r<e.length;a=r++){var s=e[r][0],c=e[r][1],l=e[a][1];c>i!=l>i&&n<(e[a][0]-s)*(i-c)/(l-c)+s&&(o=!o)}return o}},dwjH:function(t,e,n){var i=n("0Tit"),o={ease:i(.25,.1,.25,1),easeIn:i(.42,0,1,1),easeOut:i(0,0,.58,1),easeInOut:i(.42,0,.58,1),linear:i(0,0,1,1)};function r(){}function a(){var t=new Set,e=new Set,n=0;return{next:i,cancel:i,clearAll:function(){t.clear(),e.clear(),cancelAnimationFrame(n),n=0}};function i(t){e.add(t),n||(n=requestAnimationFrame(o))}function o(){n=0;var i=e;e=t,(t=i).forEach(function(t){t()}),t.clear()}}t.exports=function(t,e,n){var i=Object.create(null),a=Object.create(null),s="function"==typeof(n=n||{}).easing?n.easing:o[n.easing];s||(n.easing&&console.warn("Unknown easing function in amator: "+n.easing),s=o.ease);var c="function"==typeof n.step?n.step:r,l="function"==typeof n.done?n.done:r,u=function(t){if(!t)return"undefined"!=typeof window&&window.requestAnimationFrame?{next:window.requestAnimationFrame.bind(window),cancel:window.cancelAnimationFrame.bind(window)}:{next:function(t){return setTimeout(t,1e3/60)},cancel:function(t){return clearTimeout(t)}};if("function"!=typeof t.next)throw new Error("Scheduler is supposed to have next(cb) function");if("function"!=typeof t.cancel)throw new Error("Scheduler is supposed to have cancel(handle) function");return t}(n.scheduler),d=Object.keys(e);d.forEach(function(n){i[n]=t[n],a[n]=e[n]-t[n]});var h,b=Math.max(1,.06*("number"==typeof n.duration?n.duration:400)),p=0;return h=u.next(function e(){var n=s(p/b);p+=1,function(e){d.forEach(function(n){t[n]=a[n]*e+i[n]})}(n),p<=b?(h=u.next(e),c(t)):(h=0,setTimeout(function(){l(t)},0))}),{cancel:function(){u.cancel(h),h=0}}},t.exports.makeAggregateRaf=a,t.exports.sharedScheduler=a()},fQX0:function(t,e,n){"use strict";var i=n("fWck"),o=n("dwjH"),r=n("AMdQ"),a=n("6f8I"),s=n("AgEI"),c=s(),l=s(!0),u=n("QIvw"),d=n("wyfB"),h=n("Vkd7");function b(t,e){var n=(e=e||{}).controller;if(n||(d.canAttach(t)?n=d(t,e):h.canAttach(t)&&(n=h(t,e))),!n)throw new Error("Cannot create panzoom for the current type of dom element");var s=n.getOwner(),b={x:0,y:0},m=!1,w=new u;n.initTransform&&n.initTransform(w);var y,S="function"==typeof e.filterKey?e.filterKey:f,C="number"==typeof e.pinchSpeed?e.pinchSpeed:1,L=e.bounds,x="number"==typeof e.maxZoom?e.maxZoom:Number.POSITIVE_INFINITY,I="number"==typeof e.minZoom?e.minZoom:0,R="number"==typeof e.boundsPadding?e.boundsPadding:.05,M="number"==typeof e.zoomDoubleClickSpeed?e.zoomDoubleClickSpeed:1.75,O=e.beforeWheel||f,k=e.beforeMouseDown||f,D="number"==typeof e.zoomSpeed?e.zoomSpeed:1,K=p(e.transformOrigin),N=e.enableTextSelection?l:c;!function(t){var e=typeof t;if("undefined"!==e&&"boolean"!==e&&!(g(t.left)&&g(t.top)&&g(t.bottom)&&g(t.right)))throw new Error("Bounds object is not valid. It can be: undefined, boolean (true|false) or an object {left, top, right, bottom}")}(L),e.autocenter&&function(){var t,e,i=0,o=0,r=Q();if(r)i=r.left,o=r.top,t=r.right-r.left,e=r.bottom-r.top;else{var a=s.getBoundingClientRect();t=a.width,e=a.height}var c=n.getBBox();if(0!==c.width&&0!==c.height){var l=Math.min(t/c.width,e/c.height);w.x=-(c.left+c.width/2)*l+t/2+i,w.y=-(c.top+c.height/2)*l+e/2+o,w.scale=l}}();var P,F,_,T,E,A,B,j,V=0,X=!1,z=!1;E="smoothScroll"in e&&!e.smoothScroll?{start:f,stop:f,cancel:f}:a(function(){return{x:w.x,y:w.y}},function(t,e){xt(),H(t,e)},e.smoothScroll);var G=!1;ot();var J={dispose:function(){rt()},moveBy:it,moveTo:H,smoothMoveTo:function(t,e){it(t-w.x,e-w.y,!0)},centerOn:function(t){var e=t.ownerSVGElement;if(!e)throw new Error("ui element is required to be within the scene");var n=t.getBoundingClientRect(),i=n.left+n.width/2,o=n.top+n.height/2,r=e.getBoundingClientRect();it(r.width/2-i,r.height/2-o,!0)},zoomTo:Lt,zoomAbs:nt,smoothZoom:St,smoothZoomAbs:function(t,e,n){var i={scale:w.scale},r={scale:n};E.cancel(),xt(),B=o(i,r,{step:function(n){nt(t,e,n.scale)}})},showRectangle:function(t){var e=s.getBoundingClientRect(),n=U(e.width,e.height),i=t.right-t.left,o=t.bottom-t.top;if(!Number.isFinite(i)||!Number.isFinite(o))throw new Error("Invalid rectangle");var r=Math.min(n.x/i,n.y/o);w.x=-(t.left+i/2)*r+n.x/2,w.y=-(t.top+o/2)*r+n.y/2,w.scale=r},pause:function(){rt(),G=!0},resume:function(){G&&(ot(),G=!1)},isPaused:function(){return G},getTransform:function(){return w},getMinZoom:function(){return I},setMinZoom:function(t){I=t},getMaxZoom:function(){return x},setMaxZoom:function(t){x=t},getTransformOrigin:function(){return K},setTransformOrigin:function(t){K=p(t)},getZoomSpeed:function(){return D},setZoomSpeed:function(t){if(!Number.isFinite(t))throw new Error("Zoom speed should be a number");D=t}};r(J);var Y="number"==typeof e.initialX?e.initialX:w.x,q="number"==typeof e.initialY?e.initialY:w.y,Z="number"==typeof e.initialZoom?e.initialZoom:w.scale;return Y==w.x&&q==w.y&&Z==w.Scale||nt(Y,q,Z),J;function U(t,e){if(n.getScreenCTM){var i=n.getScreenCTM(),o=i.d,r=i.f;b.x=t*i.a-i.e,b.y=e*o-r}else b.x=t,b.y=e;return b}function H(t,e){w.x=t,w.y=e,$(),kt("pan"),tt()}function W(t,e){H(w.x+t,w.y+e)}function $(){var t=Q();if(t){var e,i,o=!1,r={left:(i={x:(e=n.getBBox()).left*w.scale+w.x,y:e.top*w.scale+w.y}).x,top:i.y,right:e.width*w.scale+i.x,bottom:e.height*w.scale+i.y},a=t.left-r.right;return a>0&&(w.x+=a,o=!0),(a=t.right-r.left)<0&&(w.x+=a,o=!0),(a=t.top-r.bottom)>0&&(w.y+=a,o=!0),(a=t.bottom-r.top)<0&&(w.y+=a,o=!0),o}}function Q(){if(L){if("boolean"==typeof L){var t=s.getBoundingClientRect(),e=t.width,n=t.height;return{left:e*R,top:n*R,right:e*(1-R),bottom:n*(1-R)}}return L}}function tt(){m=!0,y=window.requestAnimationFrame(at)}function et(t,e,n){if(v(t)||v(e)||v(n))throw new Error("zoom requires valid numbers");var i=w.scale*n;if(i<I){if(w.scale===I)return;n=I/w.scale}if(i>x){if(w.scale===x)return;n=x/w.scale}var o=U(t,e);w.x=o.x-n*(o.x-w.x),w.y=o.y-n*(o.y-w.y),L&&1===R&&1===I?(w.scale*=n,$()):$()||(w.scale*=n),kt("zoom"),tt()}function nt(t,e,n){et(t,e,n/w.scale)}function it(t,e,n){if(!n)return W(t,e);A&&A.cancel();var i=0,r=0;A=o({x:0,y:0},{x:t,y:e},{step:function(t){W(t.x-i,t.y-r),i=t.x,r=t.y}})}function ot(){s.addEventListener("mousedown",pt,{passive:!1}),s.addEventListener("dblclick",bt,{passive:!1}),s.addEventListener("touchstart",ct,{passive:!1}),s.addEventListener("keydown",st,{passive:!1}),i.addWheelListener(s,wt,{passive:!1}),tt()}function rt(){i.removeWheelListener(s,wt),s.removeEventListener("mousedown",pt),s.removeEventListener("keydown",st),s.removeEventListener("dblclick",bt),s.removeEventListener("touchstart",ct),y&&(window.cancelAnimationFrame(y),y=0),E.cancel(),gt(),vt(),N.release(),Mt()}function at(){m&&(m=!1,n.applyTransform(w),kt("transform"),y=0)}function st(t){var e=0,n=0,i=0;if(38===t.keyCode?n=1:40===t.keyCode?n=-1:37===t.keyCode?e=1:39===t.keyCode?e=-1:189===t.keyCode||109===t.keyCode?i=1:187!==t.keyCode&&107!==t.keyCode||(i=-1),!S(t,e,n,i)){if(e||n){t.preventDefault(),t.stopPropagation();var o=s.getBoundingClientRect();it(.05*(r=Math.min(o.width,o.height))*e,.05*r*n)}if(i){var r,a=It(100*i);Lt((r=K?Ct():{x:(c=s.getBoundingClientRect()).width/2,y:c.height/2}).x,r.y,a)}var c}}function ct(t){if(function(t){e.onTouch&&!e.onTouch(t)||(t.stopPropagation(),t.preventDefault())}(t),1===t.touches.length)return function(t){var e=yt(t.touches[0]);P=e;var n=U(e.x,e.y);F=n.x,_=n.y,E.cancel(),lt()}(t);2===t.touches.length&&(T=ht(t.touches[0],t.touches[1]),j=!0,lt())}function lt(){X||(X=!0,document.addEventListener("touchmove",ut),document.addEventListener("touchend",dt),document.addEventListener("touchcancel",dt))}function ut(t){if(1===t.touches.length){t.stopPropagation();var e=U((u=yt(t.touches[0])).x,u.y),n=e.x-F,i=e.y-_;0!==n&&0!==i&&Rt(),F=e.x,_=e.y,it(n,i)}else if(2===t.touches.length){j=!0;var o=t.touches[0],r=t.touches[1],a=ht(o,r),s=1+(a/T-1)*C,c=yt(o),l=yt(r);if(F=(c.x+l.x)/2,_=(c.y+l.y)/2,K){var u=Ct();F=u.x,_=u.y}Lt(F,_,s),T=a,t.stopPropagation(),t.preventDefault()}}function dt(t){if(t.touches.length>0){var e=U((n=yt(t.touches[0])).x,n.y);F=e.x,_=e.y}else{var n,i=new Date;i-V<300&&(K?St((n=Ct()).x,n.y,M):St(P.x,P.y,M)),V=i,Mt(),vt()}}function ht(t,e){var n=t.clientX-e.clientX,i=t.clientY-e.clientY;return Math.sqrt(n*n+i*i)}function bt(t){!function(t){e.onDoubleClick&&!e.onDoubleClick(t)||(t.preventDefault(),t.stopPropagation())}(t);var n=yt(t);K&&(n=Ct()),St(n.x,n.y,M)}function pt(t){if(!k(t)){if(X)return t.stopPropagation(),!1;if(1===t.button&&null!==window.event||0===t.button){E.cancel();var e=yt(t),n=U(e.x,e.y);return F=n.x,_=n.y,document.addEventListener("mousemove",mt),document.addEventListener("mouseup",ft),N.capture(t.target||t.srcElement),!1}}}function mt(t){if(!X){Rt();var e=yt(t),n=U(e.x,e.y),i=n.x-F,o=n.y-_;F=n.x,_=n.y,it(i,o)}}function ft(){N.release(),Mt(),gt()}function gt(){document.removeEventListener("mousemove",mt),document.removeEventListener("mouseup",ft),z=!1}function vt(){document.removeEventListener("touchmove",ut),document.removeEventListener("touchend",dt),document.removeEventListener("touchcancel",dt),z=!1,j=!1,X=!1}function wt(t){if(!O(t)){E.cancel();var e=t.deltaY;t.deltaMode>0&&(e*=100);var n=It(e);if(1!==n){var i=K?Ct():yt(t);Lt(i.x,i.y,n),t.preventDefault()}}}function yt(t){var e=s.getBoundingClientRect();return{x:t.clientX-e.left,y:t.clientY-e.top}}function St(t,e,n){var i=w.scale,r={scale:i},a={scale:n*i};E.cancel(),xt(),B=o(r,a,{step:function(n){nt(t,e,n.scale)},done:Ot})}function Ct(){var t=s.getBoundingClientRect();return{x:t.width*K.x,y:t.height*K.y}}function Lt(t,e,n){return E.cancel(),xt(),et(t,e,n)}function xt(){B&&(B.cancel(),B=null)}function It(t){return 1-Math.sign(t)*Math.min(.25,Math.abs(D*t/128))}function Rt(){z||(kt("panstart"),z=!0,E.start())}function Mt(){z&&(j||E.stop(),kt("panend"))}function Ot(){kt("zoomend")}function kt(t){J.fire(t,J)}}function p(t){if(t)return"object"==typeof t?(g(t.x)&&g(t.y)||m(t),t):void m()}function m(t){throw console.error(t),new Error(["Cannot parse transform origin.","Some good examples:",'  "center center" can be achieved with {x: 0.5, y: 0.5}','  "top center" can be achieved with {x: 0.5, y: 0}','  "bottom right" can be achieved with {x: 1, y: 1}'].join("\n"))}function f(){}function g(t){return Number.isFinite(t)}function v(t){return Number.isNaN?Number.isNaN(t):t!=t}t.exports=b,function(){if("undefined"!=typeof document){var t=document.getElementsByTagName("script");if(t){for(var e,n=0;n<t.length;++n){var i=t[n];if(i.src&&i.src.match(/\bpanzoom(\.min)?\.js/)){e=i;break}}if(e){var o=e.getAttribute("query");if(o){var r=e.getAttribute("name")||"pz",a=Date.now();!function t(){var n=document.querySelector(o);if(!n)return Date.now()-a<2e3?void setTimeout(t,100):void console.error("Cannot find the panzoom element",r);var i=function(t){for(var e=t.attributes,n={},i=0;i<e.length;++i){var o=s(e[i]);o&&(n[o.name]=o.value)}return n}(e);console.log(i),window[r]=b(n,i)}()}}}}function s(t){if(t.name&&"p"===t.name[0]&&"z"===t.name[1]&&"-"===t.name[2])return{name:t.name.substr(3),value:JSON.parse(t.value)}}}()},fWck:function(t,e){function n(t,e,n){t.addEventListener("wheel",e,n)}t.exports=n,t.exports.addWheelListener=n,t.exports.removeWheelListener=function(t,e,n){t.removeEventListener("wheel",e,n)}},sO0u:function(t,e,n){"use strict";n.r(e),n.d(e,"NavigationPageModule",function(){return Xt});var i=n("TEn/"),o=n("tyNb"),r=n("ofXK"),a=n("3Pt+"),s=n("mrSG"),c=n("EnSQ"),l=n("fXoL");class u{constructor(t){this.icon=t}render(t,e,n,i,o){const r=new Image;r.onload=()=>{t.drawImage(r,e,n,i,o)},r.src=this.icon}}var d=n("cQc6");class h{constructor(t){this.mapItem=t,this.doAnim=!1}get MapItem(){return this.mapItem}render(t){this.mapItem.Sections&&this.mapItem.Sections.length>0&&(t.beginPath(),this.renderSections(t),t.strokeStyle="#FFF",t.fillStyle=this.mapItem.Color,t.stroke(),t.fill(),t.closePath())}startAnimation(t,e){this.animationCallback=()=>{if(!0!==this.doAnim)return;t.save();const n=new Date;if(t.beginPath(),this.renderSections(t),t.lineWidth=1,t.strokeStyle=n.getSeconds()%2==0?"#FFF":"#000",t.fillStyle=n.getSeconds()%2==0?"#000":this.mapItem.Color,t.stroke(),t.fill(),t.closePath(),t.restore(),window.requestAnimationFrame(this.animationCallback),void 0!==e&&void 0!==e.renderer&&void 0!==e.floor)for(const i of e.renderer)i.render(t,e)},this.doAnim=!0,window.requestAnimationFrame(this.animationCallback)}stopAnimation(t){this.doAnim=!1,this.animationCallback=null}renderSections(t){t.moveTo(this.mapItem.Sections[0].Start.X,this.mapItem.Sections[0].Start.Y);for(let e=1;e<this.mapItem.Sections.length;e++)t.lineTo(this.mapItem.Sections[e].Start.X,this.mapItem.Sections[e].Start.Y);t.lineTo(this.mapItem.Sections[0].Start.X,this.mapItem.Sections[0].Start.Y)}}class b{constructor(t){this.location=t}get Location(){return this.location}render(t){this.location.Icon.length>0?new u("svg/"+this.location.Icon+".svg").render(t,this.location.PathNode.Coordinate.X,this.location.PathNode.Coordinate.Y,20,20):(t.font="12px Arial",t.textAlign="center",t.fillStyle="#000",t.fillText(this.location.Name,this.location.PathNode.Coordinate.X,this.location.PathNode.Coordinate.Y))}startAnimation(t){}stopAnimation(t){}}class p{constructor(t){this.route=t}get Route(){return this.route}render(t,e){const n=new u("assets/pin-sharp.png");this.route.Start.Floor===e.floor&&n.render(t,this.route.Start.Node.Coordinate.X-15,this.route.Start.Node.Coordinate.Y-30,30,30);const i=new u("assets/pin-red.png");this.route.End.Floor===e.floor&&i.render(t,this.route.End.Node.Coordinate.X-30,this.route.End.Node.Coordinate.Y-40,60,60);const o=this.route.RouteSections.filter(t=>t.Floor===e.floor);if(null!=o){for(const e of o){t.strokeStyle="#A00",t.lineWidth=3,t.beginPath(),t.moveTo(e.Route[0].Coordinate.X,e.Route[0].Coordinate.Y);for(let n=1;n<e.Route.length;n++)t.lineTo(e.Route[n].Coordinate.X,e.Route[n].Coordinate.Y);t.stroke(),t.closePath()}for(const e of o){const n=e.Route.length,i=Math.round(e.Distance/S.DISTANCE_SCALAR),o=e.Route[Math.round((n-1)/2)].Coordinate.X,r=e.Route[Math.round((n-1)/2)].Coordinate.Y,a="14px Arial",s=t.measureText(i.toString()).width+14,c=parseInt("14px Arial",10)+14;t.fillStyle="#A00",t.fillRect(o-s/2,r-c/2,s,20),t.font=a,t.fillStyle="#FFF",t.fillText(i.toString(),o,r)}}}startAnimation(t){}stopAnimation(t){}}class m{static GetMapItemRendererCanvas(...t){const e=[];for(const n of t)e.push(new h(n));return e}static GetLocationRendererCanvas(...t){const e=[];for(const n of t)e.push(new b(n));return e}static GetRouteRendererCanvas(...t){const e=[];for(const n of t)e.push(new p(n));return e}}var f=n("fQX0"),g=n.n(f);const v=["fab"];function w(t,e){if(1&t){const t=l.Mb();l.Lb(0,"a",5),l.Xb("click",function(){l.jc(t);const n=e.index;return l.Zb().emitAnotherFloorToShow(n)}),l.Jb(1,"span",6),l.Kb()}if(2&t){const t=e.$implicit,n=l.Zb();l.zb(t===n.currentFloor?"olu-level-control-button-lvl-current":"olu-level-control-button"),l.xb(1),l.ec("innerHTML",t,l.kc)}}let y=(()=>{class t{constructor(t){this.dataService=t,this.floorWithBuilding=new l.o}ngOnInit(){}ngOnChanges(t){return Object(s.a)(this,void 0,void 0,function*(){if(void 0!==t.currentBuilding&&void 0!==this.currentBuilding){const t=yield this.dataService.get_building(this.currentBuilding).toPromise(),e=yield this.dataService.get_building_floor(t.Name).toPromise();this.availableFloors=e.reverse()}})}emitAnotherFloorToShow(t){return Object(s.a)(this,void 0,void 0,function*(){this.floorWithBuilding.emit({floor:this.availableFloors[t],building:this.currentBuilding}),this.currentFloor=this.availableFloors[t]})}}return t.\u0275fac=function(e){return new(e||t)(l.Ib(c.a))},t.\u0275cmp=l.Cb({type:t,selectors:[["floors-bar"]],viewQuery:function(t,e){if(1&t&&l.tc(v,!0),2&t){let t;l.gc(t=l.Yb())&&(e.fab=t.first)}},inputs:{currentBuilding:"currentBuilding",currentFloor:"currentFloor"},outputs:{floorWithBuilding:"floorWithBuilding"},features:[l.vb],decls:6,vars:2,consts:[[1,"level-control-container","leaflet-control","leaflet-bar","olu-level-control-container-full","leaflet-control-layers-list"],[1,"olu-level-control-levels"],[1,"olu-control-levels-building-header"],["data-tooltip","Current Building","data-tooltip-pos","left top"],[3,"class","click",4,"ngFor","ngForOf"],[3,"click"],[3,"innerHTML"]],template:function(t,e){1&t&&(l.Lb(0,"div",0),l.Lb(1,"div",1),l.Lb(2,"a",2),l.Lb(3,"span",3),l.pc(4),l.Kb(),l.Kb(),l.oc(5,w,2,3,"a",4),l.Kb(),l.Kb()),2&t&&(l.xb(4),l.qc(e.currentBuilding),l.xb(1),l.ec("ngForOf",e.availableFloors))},directives:[r.i],styles:[".olu-level-control-levels[_ngcontent-%COMP%]{border-bottom:0;color:var(--ion-color-light,#f4f5f8)!important;line-height:150}.olu-level-control-levels[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{width:46px;padding-bottom:30px;padding-top:8px}.olu-control-levels-building-header[_ngcontent-%COMP%]{color:var(--ion-color-dark-contrast,#f4f5f8)!important;background-color:var(--ion-color-dark,#222428)!important;opacity:.7}.olu-level-control-button[_ngcontent-%COMP%]{background-color:var(--ion-color-primary,#3880ff)!important;color:var(--ion-color-light,#f4f5f8)!important;opacity:.7;cursor:pointer}.olu-level-control-button-lvl-current[_ngcontent-%COMP%]{background-color:var(--ion-color-secondary,#3dc2ff)!important;color:var(--ion-color-dark,#222428)!important;opacity:.7;cursor:pointer}"]}),t})(),S=(()=>{class t{constructor(t){this.dataService=t,this.clickThreshold=20,this.mapItemRenderer=[],this.locationRenderer=[],this.routeRenderer=[],this.locationClick=new l.o,this.mapScroll=new l.o,this.floorChanged=new l.o}get CurrentRoute(){return this.currentRoute}get CurrentBuilding(){return this.currentBuilding}static calculateMovePosition(t,e){const n=document.getElementById("canvas-wrapper"),i=n.parentElement.parentElement,o=window.matchMedia("(min-width: 1200px)").matches,r=o?i.clientHeight/2:2*i.clientHeight/5;return{x:n.clientWidth/(o?1.5:2)-t,y:o?r-e:r-Math.min(e,i.clientHeight)}}ngAfterViewInit(){const t=this;this.panZoomController||(this.panZoomController=g()(document.getElementById("map"),{maxZoom:2,minZoom:.25,initialZoom:.7,bounds:!0,boundsPadding:.1,onTouch(e){return Object(s.a)(this,void 0,void 0,function*(){return 1===e.touches.length&&(console.log(e.touches[0]),yield t.onElementClick(e.touches[0].clientX,e.touches[0].clientY,e.target)),!1})}}))}showRoute(t,e){return Object(s.a)(this,void 0,void 0,function*(){this.stopAllAnimations(),yield this.renderNavigationPage(t,e.Building,e.Floor)})}showDiscoveryLocation(t){return Object(s.a)(this,void 0,void 0,function*(){this.stopAllAnimations();const e=yield this.dataService.get_locations_search(t).toPromise();if(null===e||0===e.length)throw new Error("Studi-Guide can't find "+t);const n=e[0];this.currentBuilding=n.Building;const i=yield this.dataService.get_map_floor(this.currentBuilding,n.Floor).toPromise();this.mapItemRenderer=m.GetMapItemRendererCanvas(...i);const o=yield this.dataService.get_locations(n.Building,n.Floor).toPromise();return this.locationRenderer=m.GetLocationRendererCanvas(...o),this.clearMapCanvas(),this.RefreshMap(),this.displayPin(n.PathNode),this.currentFloor=n.Floor,this.CenterMap(n.PathNode.Coordinate.X,n.PathNode.Coordinate.Y),n})}showFloor(t,e){return Object(s.a)(this,void 0,void 0,function*(){if(this.stopAllAnimations(),null!=this.currentRoute)yield this.renderNavigationPage(this.currentRoute,this.currentBuilding,t);else{const n=yield this.dataService.get_map_items("",t,e).toPromise();this.mapItemRenderer=m.GetMapItemRendererCanvas(...n);const i=yield this.dataService.get_locations_items("",t,e).toPromise();this.locationRenderer=m.GetLocationRendererCanvas(...i),this.RefreshMap()}this.currentFloor=t,this.currentBuilding=e})}showDiscoveryMap(t,e){return Object(s.a)(this,void 0,void 0,function*(){const n=yield this.dataService.get_map_items(t,e,"").toPromise();this.mapItemRenderer=m.GetMapItemRendererCanvas(...n);const i=yield this.dataService.get_locations_items(t,e,"").toPromise();this.locationRenderer=m.GetLocationRendererCanvas(...i),this.RefreshMap(),this.currentFloor=e,this.FitMap()})}clearMapCanvas(){const t=document.getElementById("map").getContext("2d");null!=t&&t.clearRect(0,0,t.canvas.width,t.canvas.height)}onClick(t){return Object(s.a)(this,void 0,void 0,function*(){yield this.onElementClick(t.clientX,t.clientY,t.target)})}onElementClick(t,e,n){var i;return Object(s.a)(this,void 0,void 0,function*(){const o=this.panZoomController.getTransform(),r=class{static transformInOriginCoordinate(t,e,n){const i=n.getBoundingClientRect(),o=(t.x-i.left)/e,r=(t.y-i.top)/e;return console.log("Transform x:"+t.x+" y:"+t.y+"  to coordinate: x:"+o+" y:"+r),{x:o,y:r}}}.transformInOriginCoordinate({x:t,y:e},o.scale,n),a=[r.x,r.y];if(null!=this.currentRoute){const t=[];for(const e of this.getInteractiveStairWellMapItemRenderer(this.currentFloor))t.push(e.MapItem);for(const e of t){const t=[];for(const n of e.Sections)t.push([n.Start.X,n.Start.Y]);if(d(a,t))return void(yield this.showNextFloor(e,!1))}}const s=[];for(const t of this.locationRenderer){const e=t.Location;Math.abs(e.PathNode.Coordinate.X-a[0])<this.clickThreshold&&Math.abs(e.PathNode.Coordinate.Y-a[1])<this.clickThreshold&&s.push(e)}if(s.length>0){const t=1===s.length?s:s.sort((t,e)=>Math.abs(t.PathNode.Coordinate.X-a[0])+Math.abs(t.PathNode.Coordinate.Y-a[1])>Math.abs(e.PathNode.Coordinate.X-a[0])+Math.abs(e.PathNode.Coordinate.Y-a[1])?1:-1);(null===(i=t[0])||void 0===i?void 0:i.PathNode)&&(this.RefreshMap(),this.displayPin(t[0].PathNode)),this.locationClick.emit(t[0])}})}renderNavigationPage(t,e,n){var i,o;return Object(s.a)(this,void 0,void 0,function*(){let r=null!==(i=yield this.dataService.get_map_floor(e,n).toPromise())&&void 0!==i?i:new Array,a=null!==(o=yield this.dataService.get_locations(e,n).toPromise())&&void 0!==o?o:new Array;for(const i of t.RouteSections)if(i.Floor===n&&i.Building!==e){const t=yield this.dataService.get_map_floor(i.Building,i.Floor).toPromise();r=r.concat(t);const e=yield this.dataService.get_locations(i.Building,i.Floor).toPromise();a=a.concat(e)}this.mapItemRenderer=m.GetMapItemRendererCanvas(...r),this.locationRenderer=m.GetLocationRendererCanvas(...a),this.routeRenderer=m.GetRouteRendererCanvas(t),this.currentBuilding=e,this.RefreshMap(),this.renderRoutes({floor:n});for(const t of this.getInteractiveStairWellMapItemRenderer(n))t.startAnimation(this.renderingContext,{renderer:this.routeRenderer,floor:n});this.currentRoute=t,this.currentFloor=n})}createNewCanvasMap(){const t=document.getElementById("map");let e=0,n=0;for(const i of this.mapItemRenderer){const t=i.MapItem;if(t.Sections)for(const i of t.Sections)i.End.X>n&&(n=i.End.X),i.End.Y>e&&(e=i.End.Y);if(t.PathNodes)for(const i of t.PathNodes)i.Coordinate.X>n&&(n=i.Coordinate.X),i.Coordinate.Y>e&&(e=i.Coordinate.Y)}this.renderingContext=class{static setup(t,e,n){const i=this.GetPixelRatio();return t.width=e*i,t.height=n*i,t.style.width=e+"px",t.style.height=n+"px",this.getContext(t)}static getContext(t){const e=this.GetPixelRatio(),n=t.getContext("2d");return n.scale(e,e),n}static GetPixelRatio(){return window.devicePixelRatio||1}}.setup(t,n,e)}displayPin(t){const e=t.Coordinate.X-30,n=t.Coordinate.Y-40;new u("assets/pin-red.png").render(this.renderingContext,e,n,60,60)}showNextFloor(t,e){return Object(s.a)(this,void 0,void 0,function*(){for(let e=0;e<this.currentRoute.RouteSections.length-1;e++)if(this.currentRoute.RouteSections[e].Floor===t.Floor&&this.currentRoute.RouteSections[e].Building===t.Building)return this.currentFloor=this.currentRoute.RouteSections[e+1].Floor,this.currentBuilding=this.currentRoute.RouteSections[e+1].Building,void(yield this.showFloor(this.currentFloor,this.currentBuilding))})}getInteractiveStairWellMapItemRenderer(t){const e=[];for(const i of this.routeRenderer)for(let t=0;t<i.Route.RouteSections.length-1;t++)i.Route.RouteSections[t].Building===i.Route.RouteSections[t+1].Building&&e.push(i.Route.RouteSections[t].Route[i.Route.RouteSections[t].Route.length-1]);const n=[];for(const i of e)for(const e of this.mapItemRenderer)e.MapItem.Floor===t&&e.MapItem.PathNodes.filter(t=>t.Id===i.Id).length>0&&n.push(e);return n}stopAllAnimations(){for(const t of this.routeRenderer)t.stopAnimation(this.renderingContext);for(const t of this.mapItemRenderer)t.stopAnimation(this.renderingContext);for(const t of this.locationRenderer)t.stopAnimation(this.renderingContext)}renderMapItems(){for(const t of this.mapItemRenderer)t.render(this.renderingContext)}renderLocations(){for(const t of this.locationRenderer)t.render(this.renderingContext)}renderRoutes(t){for(const e of this.routeRenderer)e.render(this.renderingContext,t)}onFloorChangeByFloorButton(t){return Object(s.a)(this,void 0,void 0,function*(){yield this.showAnotherFloorOfCurrentBuilding(t.floor,t.building)})}showAnotherFloorOfCurrentBuilding(t,e){return Object(s.a)(this,void 0,void 0,function*(){it.progressIsVisible=!0,yield this.showFloor(t,e),this.FitMap(),it.progressIsVisible=!1,this.floorChanged.emit()})}CenterMap(e,n){const i=t.calculateMovePosition(e,n);this.panZoomController.smoothMoveTo(i.x,i.y)}MapSize(){return document.getElementById("map").getBoundingClientRect()}FitMap(){const t=this.MapSize();this.CenterMap(t.width/2,t.height/2)}ClearRoute(){this.stopAllAnimations(),this.currentRoute=null}RefreshMap(){this.createNewCanvasMap(),this.renderMapItems(),this.renderLocations()}}return t.DISTANCE_SCALAR=5,t.\u0275fac=function(e){return new(e||t)(l.Ib(c.a))},t.\u0275cmp=l.Cb({type:t,selectors:[["app-map-view"]],outputs:{locationClick:"locationClick",mapScroll:"mapScroll",floorChanged:"floorChanged"},decls:4,vars:2,consts:[["id","canvas-wrapper",1,"draggable"],["id","map",3,"click"],["map",""],[3,"currentBuilding","currentFloor","floorWithBuilding"]],template:function(t,e){1&t&&(l.Lb(0,"div",0),l.Lb(1,"canvas",1,2),l.Xb("click",function(t){return e.onClick(t)}),l.Kb(),l.Kb(),l.Lb(3,"floors-bar",3),l.Xb("floorWithBuilding",function(t){return e.onFloorChangeByFloorButton(t)}),l.Kb()),2&t&&(l.xb(3),l.ec("currentBuilding",e.CurrentBuilding)("currentFloor",e.currentFloor))},directives:[y],styles:["body[_ngcontent-%COMP%], html[_ngcontent-%COMP%]{height:100%;width:100%}#canvas-wrapper[_ngcontent-%COMP%]{padding:2px;overflow:hidden;scrollbar-width:none;-ms-overflow-style:none}#canvas-wrapper[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.draggable[_ngcontent-%COMP%]{cursor:-webkit-grab;cursor:grab}.draggable[_ngcontent-%COMP%]:active{cursor:-webkit-grabbing;cursor:grabbing}floors-bar[_ngcontent-%COMP%]{position:absolute;top:12px;right:0}"]}),t})();var C=n("tk/3"),L=n("e8h1");let x=(()=>{class t{constructor(t){this.storage=t}addRecentSearch(e){return Object(s.a)(this,void 0,void 0,function*(){let n=yield this.readRecentSearches();null!==n&&0!==n.length||(n=[]);let i=-1;for(let t=0;t<n.length;t++)if(n[t].Name===e.Name){i=t;break}i>=0&&n.splice(i,1),n.unshift(e),n.length>3&&n.pop(),yield this.storage.set(t.recentSearchesKey,JSON.stringify([n])),console.log(n)})}readRecentSearches(){return Object(s.a)(this,void 0,void 0,function*(){const e=JSON.parse(yield this.storage.get(t.recentSearchesKey));if(!e)return[];const n=[];for(const t of e[0])(null==t?void 0:t.Name)&&n.push(t);return n})}}return t.recentSearchesKey="searches",t.\u0275fac=function(e){return new(e||t)(l.Tb(L.b))},t.\u0275prov=l.Eb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),I=(()=>{class t{constructor(t){this.recentSearchesService=t,this.recentSearchesVar=[],this.availableCampus=[],this.Route={Start:{Name:"",LatLng:{lat:0,lng:0}},Destination:{Name:"",LatLng:{lat:0,lng:0}},Coordinates:[],Distance:0,NavigationInstructions:[],Time:0},this.recentSearchesService.readRecentSearches().then(t=>{this.recentSearchesVar=t})}get latestSearchResult(){return void 0!==this.recentSearches[0]?this.recentSearches[0]:{Name:"",Description:"",Information:[],DetailRouterParams:{},RouteRouterParams:{},LatLng:{lat:0,lng:0},Images:[]}}get recentSearches(){return this.recentSearchesVar}addRecentSearch(t){return Object(s.a)(this,void 0,void 0,function*(){yield this.recentSearchesService.addRecentSearch(t),this.recentSearchesVar=yield this.recentSearchesService.readRecentSearches()})}addRecentSearchCampus(t){return Object(s.a)(this,void 0,void 0,function*(){const e={Name:t.Name,Description:t.ShortName,Information:[["ShortName: ",t.ShortName],["Longitude: ",t.Longitude],["Latitude: ",t.Latitude]],DetailRouterParams:{},RouteRouterParams:{},LatLng:{lat:t.Latitude,lng:t.Longitude},Images:[]};yield this.addRecentSearch(e)})}addRecentSearchBuilding(t,e){return Object(s.a)(this,void 0,void 0,function*(){const n={Name:t.Name,Description:t.edges.Address.Street+" "+t.edges.Address.Number+", "+t.edges.Address.PLZ,Information:[["Campus: ",t.edges.Campus.Name]],DetailRouterParams:{building:t.Name},RouteRouterParams:{},LatLng:e,Images:[]};yield this.addRecentSearch(n)})}addRecentSearchLocation(t,e,n){return Object(s.a)(this,void 0,void 0,function*(){const i=[["Building: ",t.Name]];n&&i.push(["Address: ",n.edges.Address.Street+" "+n.edges.Address.Number]),t.Tags&&i.push(["Tags: ",t.Tags.join(", ")]);const o={Name:t.Name,Description:t.Description,Information:i,DetailRouterParams:{location:t.Name},RouteRouterParams:{start:t.Building+".Entrance",destination:t.Name},LatLng:e,Images:t.Images};yield this.addRecentSearch(o)})}SetOsmRouteAsRoute(t,e,n){const i=[];for(const o of t.Points.Coordinates)i.push([o.Lat,o.Lng]);this.Route={Start:e,Destination:n,Coordinates:i,Distance:Math.round(t.Distance),NavigationInstructions:t.Instructions,Time:Math.round(t.Time/1e3/60)}}ClearRoute(){this.Route={Start:{Name:"",LatLng:{lat:0,lng:0}},Destination:{Name:"",LatLng:{lat:0,lng:0}},Distance:0,Coordinates:[],NavigationInstructions:[],Time:0}}}return t.\u0275fac=function(e){return new(e||t)(l.Tb(x))},t.\u0275prov=l.Eb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const R=["destinationSearchbar"];function M(t,e){if(1&t){const t=l.Mb();l.Lb(0,"ion-button",6),l.Xb("click",function(){return l.jc(t),l.Zb().emitDiscoveryEvent()}),l.Jb(1,"ion-icon",7),l.Kb()}}function O(t,e){if(1&t){const t=l.Mb();l.Lb(0,"ion-item",8),l.Xb("click",function(){l.jc(t);const n=e.$implicit;return l.Zb().discovery.emit(n.Name)}),l.Lb(1,"ion-label"),l.Lb(2,"h2"),l.pc(3),l.Kb(),l.Lb(4,"p",9),l.pc(5),l.Kb(),l.Kb(),l.Kb()}if(2&t){const t=e.$implicit;l.xb(3),l.qc(t.Name),l.xb(2),l.qc(t.Description)}}let k=(()=>{class t{constructor(t,e){this.dataService=t,this.model=e,this.discovery=new l.o,this.route=new l.o,this.searchBarFocus=new l.o,this.searchBtnIsVisible=!0,this.closeRouteBtnIsVisible=!1}ngOnInit(){}onDestinationInputEvent(t){return Object(s.a)(this,void 0,void 0,function*(){const e=yield this.dataService.get_locations_all().toPromise(),n=t.target.value.toLowerCase();n.length<2?this.locations=[]:(this.locations=[],this.filterIListObjects(this.model.recentSearches,n,2),this.filterIListObjects(e,n,5))})}filterIListObjects(t,e,n){for(const i of t){let t=i.Name.toLowerCase().indexOf(e)>-1||i.Description.toLowerCase().indexOf(e)>-1;for(const e of this.locations)if(e.Name===i.Name){t=!1;break}if(t&&this.locations.push(i),this.locations.length>n)return}}emitDiscoveryEvent(){let t=""===this.destinationSearchbar.value||void 0===this.destinationSearchbar.value;if(t=t||null===this.destinationSearchbar.value,!t){const t=document.activeElement;t&&t.blur&&t.blur(),this.discovery.emit(this.destinationSearchbar.value)}}clearDestinationInput(){this.destinationSearchbarValue="",this.locations=[]}clearStartInput(){this.startSearchBarValue=""}setDiscoverySearchbarValue(t){this.destinationSearchbarValue=t}setStartSearchbarValue(t){this.startSearchBarValue=t}onSearchBarHasFocus(t){this.searchBarFocus.emit(t)}onKey(t,e){"Enter"===t.key&&"destinationSearchbar"===e&&this.emitDiscoveryEvent()}}return t.\u0275fac=function(e){return new(e||t)(l.Ib(c.a),l.Ib(I))},t.\u0275cmp=l.Cb({type:t,selectors:[["app-search-input"]],viewQuery:function(t,e){if(1&t&&l.tc(R,!0),2&t){let t;l.gc(t=l.Yb())&&(e.destinationSearchbar=t.first)}},outputs:{discovery:"discovery",route:"route",searchBarFocus:"searchBarFocus"},decls:7,vars:3,consts:[["lines","none"],["search-icon","navigate-circle-outline","inputmode","text","mode","ios","placeholder","destination","color","","icon-color","dark",3,"value","ionInput","click","keydown"],["destinationSearchbar",""],["slot","end","size","default","mode","ios","color","primary",3,"click",4,"ngIf"],["locationList",""],["button","",3,"click",4,"ngFor","ngForOf"],["slot","end","size","default","mode","ios","color","primary",3,"click"],["size","large","slot","icon-only","name","search","color",""],["button","",3,"click"],[1,"ion-text-wrap"]],template:function(t,e){1&t&&(l.Lb(0,"ion-item",0),l.Lb(1,"ion-searchbar",1,2),l.Xb("ionInput",function(t){return e.onDestinationInputEvent(t)})("click",function(){return e.onSearchBarHasFocus("destinationSearchbar")})("keydown",function(t){return e.onKey(t,"destinationSearchbar")},!1,l.ic),l.Kb(),l.oc(3,M,2,0,"ion-button",3),l.Kb(),l.Lb(4,"ion-list",null,4),l.oc(6,O,6,2,"ion-item",5),l.Kb()),2&t&&(l.xb(1),l.ec("value",e.destinationSearchbarValue),l.xb(2),l.ec("ngIf",e.searchBtnIsVisible),l.xb(3),l.ec("ngForOf",e.locations))},directives:[i.v,i.J,i.eb,r.j,i.y,r.i,i.h,i.t,i.x],styles:["ion-searchbar[_ngcontent-%COMP%]{max-width:300px}"]}),t})();var D=n("+JbE"),K=n("YD5U");class N{constructor(t){this.campus=t,this.addressString=this.getAddressString(this.campus)}get Address(){return this.addressString}get Name(){return this.campus.Name}get ShortName(){return this.campus.ShortName}get LatLng(){return{lat:this.campus.Latitude,lng:this.campus.Longitude}}getAddressString(t){let e="";if(null!==t.edges.Buildings){const n=t.edges.Buildings.map(t=>t.edges.Address),i=P(n,t=>t.Street);for(const t of Object.keys(i)){const n=i[t];""!==e&&(e+="; ");let o=n[0].Number;n.length>1&&n[n.length-1].Number!==o&&(o+="-"+n[n.length-1].Number),e+=t+" "+o+", ",e+=i[t][0].PLZ+" "+i[t][0].City}}return e}}const P=(t,e)=>t.reduce((t,n)=>{const i=e(n);return t[i]||(t[i]=[]),t[i].push(n),t},{});var F=n("gcOT"),_=n("Bfh1");const T=["inputFrom"],E=["inputTo"];function A(t,e){if(1&t){const t=l.Mb();l.Lb(0,"ion-item",12),l.Xb("click",function(){return l.jc(t),l.Zb().listMyLocationClick()}),l.Lb(1,"ion-text"),l.pc(2,"My Location"),l.Kb(),l.Kb()}}function B(t,e){if(1&t){const t=l.Mb();l.Lb(0,"ion-item",12),l.Xb("click",function(){l.jc(t);const n=e.$implicit;return l.Zb().listRecentSearchClick(n)}),l.Lb(1,"ion-text"),l.pc(2),l.Kb(),l.Kb()}if(2&t){const t=e.$implicit;l.xb(2),l.qc(t.Name)}}var j=function(t){return t[t.No=0]="No",t[t.From=1]="From",t[t.To=2]="To",t}({});let V=(()=>{class t{constructor(t,e){this.model=t,this.geolocation=e,this.inputToCurrentlyActive=!1,this.myLocationInInput=j.From,this.myLocationEnabled=!0}ngOnInit(){}ngAfterViewInit(){return Object(s.a)(this,void 0,void 0,function*(){this.UpdateFromNavigationModel(),this.inputToCurrentlyActive=!1,yield this.inputFrom.setFocus()})}SetFocus(){return Object(s.a)(this,void 0,void 0,function*(){this.inputToCurrentlyActive?yield this.inputTo.setFocus():yield this.inputFrom.setFocus()})}toggleActiveInput(){return Object(s.a)(this,void 0,void 0,function*(){this.inputToCurrentlyActive=!this.inputToCurrentlyActive,yield this.SetFocus()})}updateInputValues(){this.inputFrom.value=this.routeLocationFrom.Name,this.inputTo.value=this.routeLocationTo.Name}UpdateFromNavigationModel(){this.routeLocationFrom=this.model.Route.Start,this.routeLocationTo=this.model.Route.Destination,this.updateInputValues()}showMyLocation(){return this.myLocationInInput===j.No&&this.myLocationEnabled}onInputFromFocus(){this.inputToCurrentlyActive=!1}onInputToFocus(){this.inputToCurrentlyActive=!0}swapInputs(){const t=this.routeLocationFrom;this.routeLocationFrom=this.routeLocationTo,this.routeLocationTo=t,this.myLocationInInput!==j.No&&(this.myLocationInInput=this.myLocationInInput===j.From?j.To:j.From),this.updateInputValues()}listRecentSearchClick(t){return Object(s.a)(this,void 0,void 0,function*(){this.inputToCurrentlyActive?(this.routeLocationTo=t,this.myLocationInInput===j.To&&(this.myLocationInInput=j.No)):(this.routeLocationFrom=t,this.myLocationInInput===j.From&&(this.myLocationInInput=j.No)),this.updateInputValues(),yield this.toggleActiveInput()})}listMyLocationClick(){return Object(s.a)(this,void 0,void 0,function*(){const t=yield this.geolocation.getCurrentPosition(),e={Name:"My Location",LatLng:{lat:t.coords.latitude,lng:t.coords.longitude}};this.inputToCurrentlyActive?(this.routeLocationTo=e,this.myLocationInInput=j.To):(this.routeLocationFrom=e,this.myLocationInInput=j.From),this.updateInputValues(),yield this.toggleActiveInput()})}get From(){return this.routeLocationFrom}get To(){return this.routeLocationTo}}return t.\u0275fac=function(e){return new(e||t)(l.Ib(I),l.Ib(_.a))},t.\u0275cmp=l.Cb({type:t,selectors:[["app-route-input"]],viewQuery:function(t,e){if(1&t&&(l.tc(T,!0),l.tc(E,!0)),2&t){let t;l.gc(t=l.Yb())&&(e.inputFrom=t.first),l.gc(t=l.Yb())&&(e.inputTo=t.first)}},decls:22,vars:2,consts:[[1,"container"],[1,"ion-no-padding","ion-item-style"],["size","11"],[1,"ion-margin-end"],[3,"ionFocus"],["inputFrom",""],["inputTo",""],["size","1",1,"swappicon","ion-activatable","ripple-parent",3,"click"],["color","primary","size","large","name","swap-vertical-outline"],[1,"ion-no-padding"],["button","",3,"click",4,"ngIf"],["button","",3,"click",4,"ngFor","ngForOf"],["button","",3,"click"]],template:function(t,e){1&t&&(l.Lb(0,"div",0),l.Lb(1,"ion-item",1),l.Lb(2,"ion-grid"),l.Lb(3,"ion-row"),l.Lb(4,"ion-col",2),l.Lb(5,"ion-item"),l.Lb(6,"ion-label",3),l.pc(7,"From:"),l.Kb(),l.Lb(8,"ion-input",4,5),l.Xb("ionFocus",function(){return e.onInputFromFocus()}),l.Kb(),l.Kb(),l.Lb(10,"ion-item"),l.Lb(11,"ion-label",3),l.pc(12,"To:"),l.Kb(),l.Lb(13,"ion-input",4,6),l.Xb("ionFocus",function(){return e.onInputToFocus()}),l.Kb(),l.Kb(),l.Kb(),l.Lb(15,"ion-col",7),l.Xb("click",function(){return e.swapInputs()}),l.Jb(16,"ion-icon",8),l.Jb(17,"ion-ripple-effect"),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Lb(18,"ion-content"),l.Lb(19,"ion-list",9),l.oc(20,A,3,0,"ion-item",10),l.oc(21,B,3,1,"ion-item",11),l.Kb(),l.Kb()),2&t&&(l.xb(20),l.ec("ngIf",e.showMyLocation()),l.xb(1),l.ec("ngForOf",e.model.recentSearches))},directives:[i.v,i.r,i.I,i.o,i.x,i.u,i.eb,i.t,i.G,i.p,i.y,r.j,r.i,i.R],styles:[".container[_ngcontent-%COMP%]{position:relative}.container[_ngcontent-%COMP%], .input-container[_ngcontent-%COMP%]{width:100%;height:-webkit-fit-content;height:-moz-fit-content;height:fit-content}.input-container[_ngcontent-%COMP%]{position:absolute;top:0;left:0}.swappicon[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.swappicon[_ngcontent-%COMP%]:hover{cursor:pointer}.ripple-parent[_ngcontent-%COMP%]{position:relative;overflow:hidden}"]}),t})();const X=["drawerContent"],z=["searchDrawer"],G=["locationDrawer"],J=["routeDrawer"],Y=["changeRouteDrawer"],q=["routeInput"];function Z(t,e){1&t&&l.Jb(0,"ion-progress-bar",43)}function U(t,e){if(1&t&&(l.Lb(0,"ion-text",44),l.Lb(1,"ion-item"),l.Lb(2,"div"),l.Lb(3,"span",45),l.pc(4),l.Kb(),l.Lb(5,"p"),l.Pb(6,46),l.Kb(),l.Lb(7,"p"),l.Sb(8,47),l.Jb(9,"br"),l.Jb(10,"a",48),l.Qb(),l.Kb(),l.Kb(),l.Kb(),l.Kb()),2&t){const t=l.Zb();l.xb(4),l.qc(t.model.errorMessage)}}function H(t,e){if(1&t){const t=l.Mb();l.Lb(0,"ion-item",51),l.Xb("click",function(){l.jc(t);const n=e.$implicit;return l.Zb(2).recentSearchClick(n.Name)}),l.Lb(1,"ion-text"),l.pc(2),l.Kb(),l.Kb()}if(2&t){const t=e.$implicit;l.xb(2),l.qc(t.Name)}}function W(t,e){if(1&t&&(l.Lb(0,"ion-list",49),l.Lb(1,"ion-list-header"),l.Lb(2,"h2"),l.pc(3,"Recent Searches"),l.Kb(),l.Kb(),l.oc(4,H,3,1,"ion-item",50),l.Kb()),2&t){const t=l.Zb();l.xb(4),l.ec("ngForOf",t.model.recentSearches)}}function $(t,e){if(1&t&&(l.Lb(0,"ion-row"),l.Lb(1,"ion-col"),l.pc(2),l.Kb(),l.Lb(3,"ion-col"),l.pc(4),l.Kb(),l.Kb()),2&t){const t=e.$implicit;l.xb(2),l.qc(t[0]),l.xb(2),l.qc(t[1])}}function Q(t,e){if(1&t&&l.Jb(0,"img",52),2&t){const t=e.$implicit;l.fc("src",t.Path,l.lc),l.fc("alt",t.Name)}}function tt(t,e){if(1&t&&(l.Lb(0,"ion-row"),l.Lb(1,"ion-col"),l.Lb(2,"ion-text"),l.pc(3),l.Kb(),l.Kb(),l.Kb()),2&t){const t=l.Zb(2);l.xb(3),l.rc("",t.CurrentRoute.Distance," m")}}function et(t,e){if(1&t){const t=l.Mb();l.Lb(0,"ion-item",53),l.Lb(1,"ion-grid"),l.Lb(2,"ion-row",24),l.Lb(3,"ion-col"),l.Lb(4,"ion-label",54),l.Lb(5,"h1"),l.pc(6),l.Kb(),l.Kb(),l.Lb(7,"ion-text",54),l.pc(8,"From "),l.Lb(9,"span",40),l.Xb("click",function(){return l.jc(t),l.Zb().onChangeRouteStartEndClick()}),l.pc(10),l.Kb(),l.Kb(),l.Kb(),l.Lb(11,"ion-col",25),l.Lb(12,"ion-button",26),l.Xb("click",function(){return l.jc(t),l.Zb().onCloseRouteDrawer()}),l.Jb(13,"ion-icon",27),l.Kb(),l.Kb(),l.Kb(),l.oc(14,tt,4,1,"ion-row",55),l.Kb(),l.Kb()}if(2&t){const t=l.Zb();l.xb(6),l.rc("To ",t.CurrentRoute.End.Name,""),l.xb(4),l.qc(t.CurrentRoute.Start.Name),l.xb(4),l.ec("ngIf",0!==t.CurrentRoute.Distance)}}const{Keyboard:nt}=F.a;let it=(()=>{class t{constructor(t,e,n,i,o,r){this.dataService=t,this.modalCtrl=e,this.route=n,this.router=i,this.model=o,this.platform=r,this.availableCampus=[],this.isSubscribed=!1}get CurrentRoute(){var t;return null===(t=this.mapView)||void 0===t?void 0:t.CurrentRoute}ngAfterViewInit(){return Object(s.a)(this,void 0,void 0,function*(){yield Promise.all([this.locationDrawer.SetState(D.a.Hidden),this.routeDrawer.SetState(D.a.Hidden),this.changeRouteDrawer.SetState(D.a.Hidden),this.searchDrawer.SetState(K.a.GetRecommendedDrawerStateForDevice())])})}ionViewDidEnter(){!1===this.isSubscribed&&(this.isSubscribed=!0,this.route.queryParams.subscribe(t=>Object(s.a)(this,void 0,void 0,function*(){if(null!=t&&null!=t.location&&t.location.length>0)return this.searchInput.setDiscoverySearchbarValue(t.location),void(yield this.onDiscovery(t.location));if(null!=t&&null!=t.start&&t.start.length>0&&null!=t.destination&&t.destination.length>0)yield this.showNavigation(t.start,t.destination);else if(null!=t&&null!=t.building&&t.building.length>0){const e=yield this.dataService.get_building(t.building).toPromise();if(null!==e){const t=yield this.dataService.get_building_floor(e.Name).toPromise();yield this.mapView.showFloor((null==t?void 0:t.includes("EG"))?"EG":t[0],e.Name),this.mapView.FitMap()}}else yield this.showDiscoveryMode()})))}ngOnInit(){return Object(s.a)(this,void 0,void 0,function*(){if(0===this.model.availableCampus.length){const t=yield this.dataService.get_campus_search().toPromise();for(const e of t)this.model.availableCampus.push(new N(e))}})}onDiscovery(e){return Object(s.a)(this,void 0,void 0,function*(){this.model.errorMessage="",t.progressIsVisible=!0;try{const n=yield this.mapView.showDiscoveryLocation(e),i=yield this.dataService.get_building(n.Building).toPromise();yield this.model.addRecentSearchLocation(n,{lat:0,lng:0},i),yield this.showLocationDrawer(n)}catch(n){this.handleInputError(n,e)}finally{t.progressIsVisible=!1}})}onRoute(e){return Object(s.a)(this,void 0,void 0,function*(){this.model.errorMessage="",t.progressIsVisible=!0;try{const n=yield this.dataService.get_location(e[0]).toPromise(),i=yield this.dataService.get_route(e[0],e[1]).toPromise();i.Distance=Math.round(i.Distance/S.DISTANCE_SCALAR),i.Start.Name=n.Name,i.End.Name=e[1],yield this.mapView.showRoute(i,n),this.mapView.CenterMap(n.PathNode.Coordinate.X,n.PathNode.Coordinate.Y)}catch(n){let t="";if(n instanceof C.d){const i=n.error.message;i.includes(e[0])&&(t=e[0]),i.includes(e[1])&&(t.length>0&&(t+=" and "),t+=e[1])}this.handleInputError(n,0===t.length?e.toString():t)}finally{t.progressIsVisible=!1}})}onDrawerStateChange(t){void 0!==this.drawerContent&&(this.drawerContent.scrollY=t===D.a.Top)}showLocationDrawer(t){return Object(s.a)(this,void 0,void 0,function*(){yield this.locationDrawer.SetState(D.a.Hidden),this.model.latestSearchResult.Name=t.Name,this.model.latestSearchResult.Description=t.Description,this.model.latestSearchResult.Information=t.Tags?[["Tags: ",t.Tags.join(",")]]:[],this.model.latestSearchResult.Images=t.Images,this.platform.is("hybrid")&&(yield nt.hide()),yield this.searchDrawer.SetState(D.a.Docked),yield this.locationDrawer.SetState(K.a.GetRecommendedDrawerStateForDevice())})}onCloseLocationDrawer(t){return Object(s.a)(this,void 0,void 0,function*(){this.mapView.RefreshMap(),yield this.locationDrawer.SetState(D.a.Hidden),this.CurrentRoute?yield this.routeDrawer.SetState(K.a.GetRecommendedDrawerStateForDevice()):yield this.searchDrawer.SetState(K.a.GetRecommendedDrawerStateForDevice())})}handleInputError(t,e){if(console.log(t),t instanceof C.d){const n=t;this.model.errorMessage=400===n.status?"Studi-Guide can't find "+e:n.message}else this.model.errorMessage=t.message;null!=this.mapView&&this.mapView.clearMapCanvas()}navigationBtnClick(){return Object(s.a)(this,void 0,void 0,function*(){if(null!=this.model.latestSearchResult)try{const e=yield this.dataService.get_location(this.model.latestSearchResult.Name).toPromise();yield this.showNavigation(e.Building+".Entrance",e.Name)}catch(e){let t="";e instanceof C.d&&e.error.message.includes(this.model.latestSearchResult.Name)&&(t=this.model.latestSearchResult.Name),this.handleInputError(e,0===t.length?this.model.latestSearchResult.Name:t)}finally{t.progressIsVisible=!1}})}showNavigation(t,e){return Object(s.a)(this,void 0,void 0,function*(){this.searchInput.setDiscoverySearchbarValue(e),this.searchInput.setStartSearchbarValue(t),yield this.onRoute([t,e]),yield this.onCloseLocationDrawer(null)})}showDiscoveryMode(){return Object(s.a)(this,void 0,void 0,function*(){null==this.mapView.CurrentRoute&&null==this.mapView.CurrentBuilding&&(yield this.mapView.showDiscoveryMap("","EG"),this.mapView.CenterMap(310,550))})}recentSearchClick(t){return Object(s.a)(this,void 0,void 0,function*(){yield this.router.navigate(["tabs/navigation/detail"],{queryParams:{location:t}})})}presentMapPage(){return Object(s.a)(this,void 0,void 0,function*(){yield this.router.navigate(["tabs/navigation/"])})}get ProgressIsVisible(){return t.progressIsVisible}onFloorChanged(t){return Object(s.a)(this,void 0,void 0,function*(){this.searchInput.clearStartInput(),this.searchInput.clearDestinationInput(),yield this.onCloseLocationDrawer(null)})}onSearchFocus(t){return Object(s.a)(this,void 0,void 0,function*(){this.platform.is("hybrid")&&(yield this.searchDrawer.SetState(D.a.Top))})}onCloseRouteDrawer(){return Object(s.a)(this,void 0,void 0,function*(){this.mapView.ClearRoute(),this.mapView.RefreshMap(),yield this.searchDrawer.SetState(K.a.GetRecommendedDrawerStateForDevice()),yield this.routeDrawer.SetState(D.a.Hidden),yield this.locationDrawer.SetState(D.a.Hidden)})}onChangeRouteStartEndClick(){var t,e,n,i,o,r;return Object(s.a)(this,void 0,void 0,function*(){this.routeInput.myLocationEnabled=!1,this.routeInput.routeLocationFrom={Name:null!==(n=null===(e=null===(t=this.CurrentRoute)||void 0===t?void 0:t.Start)||void 0===e?void 0:e.Name)&&void 0!==n?n:"",LatLng:{lat:0,lng:0}},this.routeInput.routeLocationTo={Name:null!==(r=null===(o=null===(i=this.CurrentRoute)||void 0===i?void 0:i.End)||void 0===o?void 0:o.Name)&&void 0!==r?r:"",LatLng:{lat:0,lng:0}},this.routeInput.updateInputValues(),yield this.routeDrawer.SetState(D.a.Hidden),yield this.changeRouteDrawer.SetState(D.a.Top)})}onCancelChangeRoute(){return Object(s.a)(this,void 0,void 0,function*(){yield this.changeRouteDrawer.SetState(D.a.Hidden),yield this.routeDrawer.SetState(K.a.GetRecommendedDrawerStateForDevice())})}onChangeRoute(t){return Object(s.a)(this,void 0,void 0,function*(){yield this.onCancelChangeRoute(),yield this.onRoute([t[0].toString(),t[1].toString()])})}}return t.progressIsVisible=!1,t.\u0275fac=function(e){return new(e||t)(l.Ib(c.a),l.Ib(i.Y),l.Ib(o.a),l.Ib(o.g),l.Ib(I),l.Ib(i.ab))},t.\u0275cmp=l.Cb({type:t,selectors:[["app-navigation"]],viewQuery:function(t,e){if(1&t&&(l.tc(S,!0),l.tc(k,!0),l.tc(X,!0),l.tc(z,!0),l.tc(G,!0),l.tc(J,!0),l.tc(Y,!0),l.tc(q,!0)),2&t){let t;l.gc(t=l.Yb())&&(e.mapView=t.first),l.gc(t=l.Yb())&&(e.searchInput=t.first),l.gc(t=l.Yb())&&(e.drawerContent=t.first),l.gc(t=l.Yb())&&(e.searchDrawer=t.first),l.gc(t=l.Yb())&&(e.locationDrawer=t.first),l.gc(t=l.Yb())&&(e.routeDrawer=t.first),l.gc(t=l.Yb())&&(e.changeRouteDrawer=t.first),l.gc(t=l.Yb())&&(e.routeInput=t.first)}},decls:85,vars:9,consts:function(){let t,e;return t="\xDCberpr\xFCfe deine Eingabe auf Rechtschreibfehler.",e="Sollte dieser Ort im Studi-Guide sein?\n               " + "\ufffd#9\ufffd\ufffd/#9\ufffd" + "\n               " + "\ufffd#10\ufffd" + "F\xFCge den Ort hinzu" + "\ufffd/#10\ufffd" + "\n             ",[["translucent",""],["slot","start"],["id","close-open-map","defaultHref","/"],["data-tap-disabled","true","scroll-y","false"],["type","indeterminate","color","secondary",4,"ngIf"],["id","map-content"],[3,"locationClick","floorChanged"],[3,"stateChange"],["searchDrawer",""],[1,"nav-bottom-drawer"],[1,"drawer-grip"],[1,"ion-padding-top"],[1,"nav-hbar"],[3,"discovery","route","searchBarFocus"],[1,"ion-item-style"],["drawerContent",""],["class","ion-wrap ion-margin","id","error-message",4,"ngIf"],["class","ion-no-padding",4,"ngIf"],[1,"ion-padding-vertical"],["state","DrawerState.Hidden"],["locationDrawer",""],[1,"nav-bottom-drawer","ion-background"],[1,"ion-padding-bottom"],["id","locationdrawerContent"],[1,"ion-justify-content-between","ion-align-self-center"],[1,"ion-justify-content-end","ion-padding-horizontal"],["shape","round","color","medium",1,"square-sm","ion-no-padding","ion-float-right",3,"click"],["slot","icon-only","name","close-outline","size","small"],["id","routeBtn","color","primary","expand","block",3,"click"],[4,"ngFor","ngForOf"],[1,"ion-padding-horizontal"],["class","ion-no-margin ion-padding-end ion-img",3,"src","alt",4,"ngFor","ngForOf"],["id","routeDrawer","state","DrawerState.Hidden"],["routeDrawer",""],["class","ion-no-margin",4,"ngIf"],["id","changeRouteDrawer","state","DrawerState.Hidden"],["changeRouteDrawer",""],[1,"ion-no-padding","ion-item-style"],[1,"ion-align-items-baseline"],[1,"ion-text-center"],[1,"span-button",3,"click"],["size","6",1,"ion-text-center"],["routeInput",""],["type","indeterminate","color","secondary"],["id","error-message",1,"ion-wrap","ion-margin"],[1,"error"],t,e,["href","https://github.com/Studi-Guide/Studi-Guide/issues/new/choose"],[1,"ion-no-padding"],["button","",3,"click",4,"ngFor","ngForOf"],["button","",3,"click"],[1,"ion-no-margin","ion-padding-end","ion-img",3,"src","alt"],[1,"ion-no-margin"],[1,"ion-text-wrap"],[4,"ngIf"]]},template:function(t,e){if(1&t){const t=l.Mb();l.Lb(0,"ion-header",0),l.Lb(1,"ion-toolbar"),l.Lb(2,"ion-buttons",1),l.Jb(3,"ion-back-button",2),l.Kb(),l.Kb(),l.Kb(),l.Lb(4,"ion-content",3),l.oc(5,Z,1,0,"ion-progress-bar",4),l.Lb(6,"div",5),l.Lb(7,"app-map-view",6),l.Xb("locationClick",function(t){return e.showLocationDrawer(t)})("floorChanged",function(t){return e.onFloorChanged(t)}),l.Kb(),l.Kb(),l.Kb(),l.Lb(8,"app-ionic-bottom-drawer",7,8),l.Xb("stateChange",function(t){return e.onDrawerStateChange(t)}),l.Lb(10,"div",9),l.Lb(11,"div",10),l.Jb(12,"div",11),l.Jb(13,"div",12),l.Lb(14,"app-search-input",13),l.Xb("discovery",function(t){return e.onDiscovery(t)})("route",function(t){return e.onRoute(t)})("searchBarFocus",function(t){return e.onSearchFocus(t)}),l.Kb(),l.Kb(),l.Lb(15,"ion-content",14,15),l.oc(17,U,11,1,"ion-text",16),l.oc(18,W,5,1,"ion-list",17),l.Jb(19,"div",18),l.Jb(20,"div",18),l.Jb(21,"div",18),l.Jb(22,"div",18),l.Jb(23,"div",18),l.Jb(24,"div",18),l.Kb(),l.Kb(),l.Kb(),l.Lb(25,"app-ionic-bottom-drawer",19,20),l.Lb(27,"div",21),l.Lb(28,"div",10),l.Jb(29,"div",11),l.Jb(30,"div",12),l.Jb(31,"div",22),l.Kb(),l.Lb(32,"ion-content",14),l.Lb(33,"ion-grid",23),l.Lb(34,"ion-row",24),l.Lb(35,"ion-col"),l.Lb(36,"ion-label"),l.Lb(37,"h1"),l.pc(38),l.Kb(),l.Kb(),l.Lb(39,"ion-text"),l.pc(40),l.Kb(),l.Kb(),l.Lb(41,"ion-col",25),l.Lb(42,"ion-button",26),l.Xb("click",function(t){return e.onCloseLocationDrawer(t)}),l.Jb(43,"ion-icon",27),l.Kb(),l.Kb(),l.Kb(),l.Lb(44,"ion-row"),l.Lb(45,"ion-col"),l.Lb(46,"ion-button",28),l.Xb("click",function(){return e.navigationBtnClick()}),l.pc(47," Route "),l.Kb(),l.Kb(),l.Kb(),l.Lb(48,"ion-row"),l.Lb(49,"ion-col"),l.pc(50,"Description:"),l.Kb(),l.Lb(51,"ion-col"),l.pc(52),l.Kb(),l.Kb(),l.oc(53,$,5,2,"ion-row",29),l.Lb(54,"div",30),l.Lb(55,"app-ionic-horizontal-scrollable"),l.oc(56,Q,1,2,"img",31),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Lb(57,"app-ionic-bottom-drawer",32,33),l.Lb(59,"div",9),l.Lb(60,"div",10),l.Jb(61,"div",11),l.Jb(62,"div",12),l.Jb(63,"div",22),l.oc(64,et,15,3,"ion-item",34),l.Kb(),l.Kb(),l.Kb(),l.Lb(65,"app-ionic-bottom-drawer",35,36),l.Lb(67,"div",9),l.Lb(68,"div",10),l.Jb(69,"div",11),l.Jb(70,"div",12),l.Lb(71,"ion-item",37),l.Lb(72,"ion-grid"),l.Lb(73,"ion-row",38),l.Lb(74,"ion-col",39),l.Lb(75,"span",40),l.Xb("click",function(){return e.onCancelChangeRoute()}),l.pc(76,"Cancel"),l.Kb(),l.Kb(),l.Lb(77,"ion-col",41),l.Lb(78,"h3"),l.pc(79,"Change Route"),l.Kb(),l.Kb(),l.Lb(80,"ion-col",39),l.Lb(81,"span",40),l.Xb("click",function(){l.jc(t);const n=l.hc(84);return e.onChangeRoute([n.inputFrom.value,n.inputTo.value])}),l.pc(82,"Route"),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Jb(83,"app-route-input",null,42),l.Kb(),l.Kb()}2&t&&(l.xb(5),l.ec("ngIf",e.ProgressIsVisible),l.xb(12),l.ec("ngIf",e.model.errorMessage),l.xb(1),l.ec("ngIf",e.model.recentSearches.length>0),l.xb(20),l.qc(e.model.latestSearchResult.Name),l.xb(2),l.qc(e.model.latestSearchResult.Description),l.xb(12),l.qc(e.model.latestSearchResult.Description),l.xb(1),l.ec("ngForOf",e.model.latestSearchResult.Information),l.xb(3),l.ec("ngForOf",e.model.latestSearchResult.Images),l.xb(8),l.ec("ngIf",e.CurrentRoute))},styles:["#map-content[_ngcontent-%COMP%]{height:100%;width:100%;position:fixed}.error[_ngcontent-%COMP%]{color:red}#available-floors-btn[_ngcontent-%COMP%]{position:fixed;bottom:0;display:block;z-index:10}.center[_ngcontent-%COMP%]{margin-left:auto;margin-right:auto;display:block}ion-progress-bar[_ngcontent-%COMP%]{position:absolute;z-index:9999}.vertical-line[_ngcontent-%COMP%]{border-left:2px solid #9d9fa6;height:38px}.nav-hbar[_ngcontent-%COMP%]{border-top:2px solid var(--ion-color-medium,#9d9fa6);border-bottom:2px solid var(--ion-color-medium,#9d9fa6);border-radius:2px;height:0;width:auto;margin:0 45%}.nav-bottom-drawer[_ngcontent-%COMP%]{z-index:1}.square-md[_ngcontent-%COMP%]{height:64px;width:64px}.square-sm[_ngcontent-%COMP%]{height:32px;width:32px}.square-xs[_ngcontent-%COMP%]{height:16px;width:16px}#locationdrawerContent[_ngcontent-%COMP%]{margin-left:30px;margin-right:30px;position:center}#locationdrawerName[_ngcontent-%COMP%]{font-weight:700}.ion-img[_ngcontent-%COMP%]{height:200px}#routeDrawer[_ngcontent-%COMP%]{z-index:3}#changeRouteDrawer[_ngcontent-%COMP%]{z-index:4}.nav-bottom-drawer[_ngcontent-%COMP%]{background-color:var(--ion-item-background,#fff);border-top-left-radius:20px;border-top-right-radius:20px;box-shadow:0 4px 8px 0 rgba(0,0,0,.4),0 6px 20px 0 rgba(0,0,0,.29);height:inherit}.span-button[_ngcontent-%COMP%]{color:var(--ion-color-primary,#3880ff);cursor:pointer}"]}),t})(),ot=(()=>{class t{}return t.\u0275mod=l.Gb({type:t}),t.\u0275inj=l.Fb({factory:function(e){return new(e||t)},imports:[[r.b,i.V]]}),t})();var rt=n("4R65"),at=n("AytR");let st=(()=>{class t{constructor(t,e,n){this.locale=t,this.httpClient=e,this.env=n}GetRoute(e,n){return Object(s.a)(this,void 0,void 0,function*(){return yield this.httpClient.get(this.env.serverUrl+t.serverPathPrefix+t.routePath+"?start="+e.lat+","+e.lng+"&end="+n.lat+","+n.lng+"&locale="+this.locale).toPromise()})}GetBounds(){return Object(s.a)(this,void 0,void 0,function*(){return yield this.httpClient.get(this.env.serverUrl+t.serverPathPrefix+t.boundsPath).toPromise()})}}return t.serverPathPrefix="/osm",t.routePath="/route",t.boundsPath="/bounds",t.\u0275fac=function(e){return new(e||t)(l.Tb(l.v),l.Tb(C.b),l.Tb(at.a))},t.\u0275prov=l.Eb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const ct=["ionSlides"];function lt(t,e){if(1&t&&(l.Lb(0,"ion-slide"),l.Lb(1,"ion-text"),l.Lb(2,"h2"),l.pc(3),l.Kb(),l.Lb(4,"p"),l.pc(5),l.Kb(),l.Kb(),l.Kb()),2&t){const t=e.$implicit;l.xb(3),l.qc(t.Text),l.xb(2),l.rc("",t.Distance,"m")}}let ut=(()=>{class t{constructor(t){this.element=t,this.nextSlide=new l.o,this.previousSlide=new l.o,this.slideOpts={initialSlide:0,speed:400}}ngOnInit(){this.hide()}onPrevSlide(){return Object(s.a)(this,void 0,void 0,function*(){this.previousSlide.emit(yield this.ionSlides.getActiveIndex())})}onNextSlide(){return Object(s.a)(this,void 0,void 0,function*(){this.nextSlide.emit(yield this.ionSlides.getActiveIndex())})}hide(){return Object(s.a)(this,void 0,void 0,function*(){this.element.nativeElement.hidden=!0})}show(){return Object(s.a)(this,void 0,void 0,function*(){this.element.nativeElement.hidden=!1})}}return t.\u0275fac=function(e){return new(e||t)(l.Ib(l.m))},t.\u0275cmp=l.Cb({type:t,selectors:[["app-navigation-instruction-slides"]],viewQuery:function(t,e){if(1&t&&l.tc(ct,!0),2&t){let t;l.gc(t=l.Yb())&&(e.ionSlides=t.first)}},inputs:{instructions:"instructions"},outputs:{nextSlide:"nextSlide",previousSlide:"previousSlide"},decls:4,vars:2,consts:[["pager","true",3,"options","ionSlideNextEnd","ionSlidePrevEnd"],["ionSlides",""],[4,"ngFor","ngForOf"]],template:function(t,e){1&t&&(l.Lb(0,"ion-item"),l.Lb(1,"ion-slides",0,1),l.Xb("ionSlideNextEnd",function(){return e.onNextSlide()})("ionSlidePrevEnd",function(){return e.onPrevSlide()}),l.oc(3,lt,6,2,"ion-slide",2),l.Kb(),l.Kb()),2&t&&(l.xb(1),l.ec("options",e.slideOpts),l.xb(2),l.ec("ngForOf",e.instructions))},directives:[i.v,i.N,r.i,i.M,i.R],styles:["[_nghost-%COMP%]{z-index:auto}ion-slide[_ngcontent-%COMP%]{height:100%;width:100%}@media (min-width:992px){ion-slide[_ngcontent-%COMP%]{padding-bottom:2em}}@media (max-width:991.98px){ion-slide[_ngcontent-%COMP%]{padding-bottom:.5em}}"]}),t})(),dt=(()=>{class t{static persist(t,e){return Object(s.a)(this,void 0,void 0,function*(){yield t.set(this.LAST_MAP_EVENT_KEY,e)})}load(e,n,i){return Object(s.a)(this,void 0,void 0,function*(){e.ready().then(()=>Object(s.a)(this,void 0,void 0,function*(){yield e.get(t.LAST_MAP_EVENT_KEY).then(t=>{n.setView([49.452368,11.093299],i),null!=t&&n.flyTo(t.center,t.zoom)})}))})}}return t.LAST_MAP_EVENT_KEY="lastOpenStreetMapEventTarget",t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=l.Eb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const ht=["*"];let bt=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=l.Cb({type:t,selectors:[["app-ionic-horizontal-scrollable"]],ngContentSelectors:ht,decls:2,vars:0,consts:[[1,"scroll-x-container"]],template:function(t,e){1&t&&(l.dc(),l.Lb(0,"div",0),l.cc(1),l.Kb())},styles:["[_nghost-%COMP%]     .scroll-x-container>*{display:inline-block}.scroll-x-container[_ngcontent-%COMP%]{overflow-x:auto;white-space:nowrap}"]}),t})();const pt=["drawerContent"],mt=["searchDrawer"],ft=["locationDrawer"],gt=["routeDrawer"],vt=["inNavigationDrawer"],wt=["changeRouteDrawer"],yt=["routeInput"];function St(t,e){if(1&t&&(l.Lb(0,"ion-text",45),l.Lb(1,"ion-item"),l.Lb(2,"div"),l.Lb(3,"span",46),l.pc(4),l.Kb(),l.Lb(5,"p"),l.Pb(6,47),l.Kb(),l.Lb(7,"p"),l.Sb(8,48),l.Jb(9,"br"),l.Jb(10,"a",49),l.Qb(),l.Kb(),l.Kb(),l.Kb(),l.Kb()),2&t){const t=l.Zb();l.xb(4),l.qc(t.model.errorMessage)}}function Ct(t,e){if(1&t){const t=l.Mb();l.Lb(0,"ion-item",50),l.Xb("click",function(){l.jc(t);const n=e.$implicit;return l.Zb(2).search.emit(n.Name)}),l.Lb(1,"ion-text"),l.pc(2),l.Kb(),l.Kb()}if(2&t){const t=e.$implicit;l.xb(2),l.qc(t.Name)}}function Lt(t,e){if(1&t&&(l.Lb(0,"ion-list",12),l.Lb(1,"ion-list-header"),l.Lb(2,"h2"),l.pc(3,"Recent Searches"),l.Kb(),l.Kb(),l.oc(4,Ct,3,1,"ion-item",13),l.Kb()),2&t){const t=l.Zb();l.xb(4),l.ec("ngForOf",t.model.recentSearches)}}function xt(t,e){if(1&t){const t=l.Mb();l.Lb(0,"ion-item",50),l.Xb("click",function(){l.jc(t);const n=e.$implicit;return l.Zb().campusClick.emit(n)}),l.Lb(1,"ion-label"),l.Lb(2,"h2"),l.pc(3),l.Kb(),l.Lb(4,"h3"),l.pc(5),l.Kb(),l.Kb(),l.Kb()}if(2&t){const t=e.$implicit;l.xb(3),l.sc("",t.ShortName,": ",t.Name,""),l.xb(2),l.qc(t.Address)}}function It(t,e){if(1&t&&(l.Lb(0,"ion-row"),l.Lb(1,"ion-col"),l.pc(2),l.Kb(),l.Lb(3,"ion-col"),l.pc(4),l.Kb(),l.Kb()),2&t){const t=e.$implicit;l.xb(2),l.qc(t[0]),l.xb(2),l.qc(t[1])}}function Rt(t,e){if(1&t&&l.Jb(0,"img",51),2&t){const t=e.$implicit;l.fc("src",t.Path,l.lc),l.fc("alt",t.Name)}}function Mt(t,e){1&t&&l.Jb(0,"ion-progress-bar",52)}function Ot(t,e){if(1&t){const t=l.Mb();l.Lb(0,"ion-button",54),l.Xb("click",function(){return l.jc(t),l.Zb(2).onLaunchNavigationClick()}),l.pc(1," Go "),l.Kb()}}function kt(t,e){if(1&t&&(l.Lb(0,"ion-row"),l.Lb(1,"ion-col"),l.Lb(2,"ion-label"),l.Lb(3,"h2"),l.pc(4),l.Kb(),l.Kb(),l.Lb(5,"ion-text"),l.pc(6),l.Kb(),l.Kb(),l.Lb(7,"ion-col"),l.oc(8,Ot,2,0,"ion-button",53),l.Kb(),l.Kb()),2&t){const t=l.Zb();l.xb(4),l.rc("",t.model.Route.Time," min"),l.xb(2),l.rc("",t.model.Route.Distance," m"),l.xb(2),l.ec("ngIf",!t.UseDrawerForNavigation())}}function Dt(t,e){if(1&t){const t=l.Mb();l.Lb(0,"ion-item",50),l.Xb("click",function(){l.jc(t);const n=e.$implicit;return l.Zb(2).navInstructionClick.emit(n)}),l.Lb(1,"ion-label"),l.pc(2),l.Kb(),l.Lb(3,"ion-text"),l.pc(4),l.Kb(),l.Kb()}if(2&t){const t=e.$implicit;l.xb(2),l.qc(t.Text),l.xb(2),l.rc("",t.Distance,"m")}}function Kt(t,e){if(1&t&&(l.Lb(0,"ion-list"),l.oc(1,Dt,5,2,"ion-item",13),l.Kb()),2&t){const t=l.Zb();l.xb(1),l.ec("ngForOf",t.model.Route.NavigationInstructions)}}var Nt=function(t){return t[t.SearchView=0]="SearchView",t[t.LocationView=1]="LocationView",t[t.RouteView=2]="RouteView",t[t.InNavigationView=3]="InNavigationView",t[t.ChangeRouteView=4]="ChangeRouteView",t}({});let Pt=(()=>{class t{constructor(t,e){this.model=t,this.platform=e,this.state=Nt.SearchView,this.stateChange=new l.o,this.campusClick=new l.o,this.detailsClick=new l.o,this.navInstructionClick=new l.o,this.search=new l.o,this.newRoute=new l.o}ngAfterViewInit(){return Object(s.a)(this,void 0,void 0,function*(){yield Promise.all([this.locationDrawer.SetState(D.a.Hidden),this.routeDrawer.SetState(D.a.Hidden),this.inNavigationDrawer.SetState(D.a.Hidden),this.changeRouteDrawer.SetState(D.a.Hidden,!1),this.searchDrawer.SetState(D.a.Hidden)])})}SetState(t,e=!1){return Object(s.a)(this,void 0,void 0,function*(){switch(this.state){case Nt.SearchView:yield this.searchDrawer.SetState(D.a.Hidden);break;case Nt.LocationView:yield this.locationDrawer.SetState(D.a.Hidden);break;case Nt.RouteView:yield this.routeDrawer.SetState(D.a.Hidden);break;case Nt.InNavigationView:yield this.inNavigationDrawer.SetState(D.a.Hidden);break;case Nt.ChangeRouteView:yield this.changeRouteDrawer.SetState(D.a.Hidden,!1)}switch(this.state=t,this.state){case Nt.SearchView:yield this.searchDrawer.SetState(K.a.GetRecommendedDrawerStateForDevice());break;case Nt.LocationView:yield this.locationDrawer.SetState(K.a.GetRecommendedDrawerStateForDevice());break;case Nt.RouteView:yield this.routeDrawer.SetState(K.a.GetRecommendedDrawerStateForDevice());break;case Nt.InNavigationView:yield this.inNavigationDrawer.SetState(K.a.GetRecommendedDrawerStateForDevice());break;case Nt.ChangeRouteView:yield this.changeRouteDrawer.SetState(K.a.GetRecommendedDrawerStateForDevice())}e&&this.stateChange.emit(this.state)})}onRouteClick(){return Object(s.a)(this,void 0,void 0,function*(){this.stateChange.emit(Nt.RouteView)})}onLaunchNavigationClick(){return Object(s.a)(this,void 0,void 0,function*(){this.stateChange.emit(Nt.InNavigationView)})}onEndNavigationClick(){return Object(s.a)(this,void 0,void 0,function*(){this.stateChange.emit(Nt.LocationView)})}onSearchFocus(t){return Object(s.a)(this,void 0,void 0,function*(){this.platform.is("hybrid")&&(yield this.searchDrawer.SetState(D.a.Top))})}emitRoute(t){}onCloseLocationDrawer(){return Object(s.a)(this,void 0,void 0,function*(){this.stateChange.emit(Nt.SearchView)})}onCloseRouteDrawer(){return Object(s.a)(this,void 0,void 0,function*(){this.stateChange.emit(Nt.LocationView)})}onChangeRouteStartEndClick(){return Object(s.a)(this,void 0,void 0,function*(){this.routeInput.UpdateFromNavigationModel(),yield this.SetState(Nt.ChangeRouteView,!0),yield this.routeInput.SetFocus()})}onSearchDrawerStateChange(t){void 0!==this.drawerContent&&(this.drawerContent.scrollY=t===D.a.Top)}onChangeRouteDrawerStateChange(t){return Object(s.a)(this,void 0,void 0,function*(){console.log(t),t===D.a.Hidden&&(yield this.SetState(Nt.RouteView,!0))})}onCancelChangeRoute(){return Object(s.a)(this,void 0,void 0,function*(){yield this.SetState(Nt.RouteView,!1)})}UseDrawerForNavigation(){return!(K.a.GetRecommendedDrawerStateForDevice()===D.a.Docked)}}return t.\u0275fac=function(e){return new(e||t)(l.Ib(I),l.Ib(i.ab))},t.\u0275cmp=l.Cb({type:t,selectors:[["app-nav-drawer-manager"]],viewQuery:function(t,e){if(1&t&&(l.tc(pt,!0),l.tc(mt,!0),l.tc(ft,!0),l.tc(gt,!0),l.tc(vt,!0),l.tc(wt,!0),l.tc(yt,!0)),2&t){let t;l.gc(t=l.Yb())&&(e.drawerContent=t.first),l.gc(t=l.Yb())&&(e.searchDrawer=t.first),l.gc(t=l.Yb())&&(e.locationDrawer=t.first),l.gc(t=l.Yb())&&(e.routeDrawer=t.first),l.gc(t=l.Yb())&&(e.inNavigationDrawer=t.first),l.gc(t=l.Yb())&&(e.changeRouteDrawer=t.first),l.gc(t=l.Yb())&&(e.routeInput=t.first)}},inputs:{state:"state"},outputs:{stateChange:"stateChange",campusClick:"campusClick",detailsClick:"detailsClick",navInstructionClick:"navInstructionClick",search:"search",newRoute:"newRoute"},decls:125,vars:17,consts:function(){let t,e;return t="\xDCberpr\xFCfe deine Eingabe auf Rechtschreibfehler.",e="Sollte dieser Ort im Studi-Guide sein?\n                " + "\ufffd#9\ufffd\ufffd/#9\ufffd" + "\n                " + "\ufffd#10\ufffd" + "F\xFCge den Ort hinzu" + "\ufffd/#10\ufffd" + "\n              ",[["id","searchDrawer",3,"stateChange"],["searchDrawer",""],[1,"nav-bottom-drawer"],[1,"drawer-grip"],[1,"ion-padding-top"],[1,"nav-hbar"],[3,"discovery","route","searchBarFocus"],["searchInput",""],[1,"ion-item-style"],["drawerContent",""],["class","ion-wrap ion-margin",4,"ngIf"],["class","ion-no-padding",4,"ngIf"],[1,"ion-no-padding"],["button","",3,"click",4,"ngFor","ngForOf"],[1,"ion-padding-vertical"],["id","locationDrawer","state","DrawerState.Hidden"],["locationDrawer",""],[1,"ion-padding-bottom"],["id","locationdrawerContent"],[1,"ion-justify-content-between","ion-align-self-center"],[1,"ion-justify-content-end","ion-padding-horizontal"],["shape","round","color","medium",1,"square-sm","ion-no-padding","ion-float-right",3,"click"],["slot","icon-only","name","close-outline","size","small"],["color","primary","expand","block",3,"click"],["id","routeBtn","color","primary","expand","block",3,"click"],[4,"ngFor","ngForOf"],[1,"ion-padding-horizontal"],["class","ion-no-margin ion-padding-end ion-img",3,"src","alt",4,"ngFor","ngForOf"],["id","routeDrawer","state","DrawerState.Hidden"],["routeDrawer",""],["type","indeterminate",4,"ngIf"],[1,"ion-no-margin"],[1,"ion-text-wrap"],[1,"span-button",3,"click"],[4,"ngIf"],["id","inNavigationDrawer","state","DrawerState.Hidden",3,"shouldDockTop"],["inNavigationDrawer",""],[1,"ion-no-padding","ion-item-style"],["color","danger","expand","block",3,"click"],["id","changeRouteDrawer","state","DrawerState.Hidden",3,"shouldDockBottom","shouldDockMiddle","stateChange"],["changeRouteDrawer",""],[1,"ion-align-items-baseline"],[1,"ion-text-center"],["size","6",1,"ion-text-center"],["routeInput",""],[1,"ion-wrap","ion-margin"],[1,"error"],t,e,["href","https://github.com/Studi-Guide/Studi-Guide/issues/new/choose"],["button","",3,"click"],[1,"ion-no-margin","ion-padding-end","ion-img",3,"src","alt"],["type","indeterminate"],["color","success","expand","block",3,"click",4,"ngIf"],["color","success","expand","block",3,"click"]]},template:function(t,e){if(1&t){const t=l.Mb();l.Lb(0,"app-ionic-bottom-drawer",0,1),l.Xb("stateChange",function(t){return e.onSearchDrawerStateChange(t)}),l.Lb(2,"div",2),l.Lb(3,"div",3),l.Jb(4,"div",4),l.Jb(5,"div",5),l.Lb(6,"app-search-input",6,7),l.Xb("discovery",function(t){return e.search.emit(t)})("route",function(t){return e.emitRoute(t)})("searchBarFocus",function(t){return e.onSearchFocus(t)}),l.Kb(),l.Kb(),l.Lb(8,"ion-content",8,9),l.oc(10,St,11,1,"ion-text",10),l.oc(11,Lt,5,1,"ion-list",11),l.Lb(12,"ion-list",12),l.Lb(13,"ion-list-header"),l.Lb(14,"h2"),l.pc(15,"Choose a Campus"),l.Kb(),l.Kb(),l.oc(16,xt,6,3,"ion-item",13),l.Kb(),l.Jb(17,"div",14),l.Jb(18,"div",14),l.Jb(19,"div",14),l.Jb(20,"div",14),l.Jb(21,"div",14),l.Jb(22,"div",14),l.Kb(),l.Kb(),l.Kb(),l.Lb(23,"app-ionic-bottom-drawer",15,16),l.Lb(25,"div",2),l.Lb(26,"div",3),l.Jb(27,"div",4),l.Jb(28,"div",5),l.Jb(29,"div",17),l.Kb(),l.Lb(30,"ion-content",8),l.Lb(31,"ion-grid",18),l.Lb(32,"ion-row",19),l.Lb(33,"ion-col"),l.Lb(34,"ion-label"),l.Lb(35,"h1"),l.pc(36),l.Kb(),l.Kb(),l.Lb(37,"ion-text"),l.pc(38),l.Kb(),l.Kb(),l.Lb(39,"ion-col",20),l.Lb(40,"ion-button",21),l.Xb("click",function(){return e.onCloseLocationDrawer()}),l.Jb(41,"ion-icon",22),l.Kb(),l.Kb(),l.Kb(),l.Lb(42,"ion-row"),l.Lb(43,"ion-col"),l.Lb(44,"ion-button",23),l.Xb("click",function(){return e.detailsClick.emit()}),l.pc(45," Details "),l.Kb(),l.Kb(),l.Lb(46,"ion-col"),l.Lb(47,"ion-button",24),l.Xb("click",function(){return e.onRouteClick()}),l.pc(48," Route "),l.Kb(),l.Kb(),l.Kb(),l.oc(49,It,5,2,"ion-row",25),l.Kb(),l.Lb(50,"div",26),l.Lb(51,"app-ionic-horizontal-scrollable"),l.oc(52,Rt,1,2,"img",27),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Lb(53,"app-ionic-bottom-drawer",28,29),l.Lb(55,"div",2),l.Lb(56,"div",3),l.Jb(57,"div",4),l.Jb(58,"div",5),l.Jb(59,"div",17),l.oc(60,Mt,1,0,"ion-progress-bar",30),l.Lb(61,"ion-item",31),l.Lb(62,"ion-grid"),l.Lb(63,"ion-row",19),l.Lb(64,"ion-col"),l.Lb(65,"ion-label",32),l.Lb(66,"h1"),l.pc(67),l.Kb(),l.Kb(),l.Lb(68,"ion-text"),l.pc(69,"From "),l.Lb(70,"span",33),l.Xb("click",function(){return e.onChangeRouteStartEndClick()}),l.pc(71),l.Kb(),l.Kb(),l.Kb(),l.Lb(72,"ion-col",20),l.Lb(73,"ion-button",21),l.Xb("click",function(){return e.onCloseRouteDrawer()}),l.Jb(74,"ion-icon",22),l.Kb(),l.Kb(),l.Kb(),l.oc(75,kt,9,3,"ion-row",34),l.Kb(),l.Kb(),l.Kb(),l.Lb(76,"ion-content",8),l.oc(77,Kt,2,1,"ion-list",34),l.Jb(78,"div",14),l.Jb(79,"div",14),l.Jb(80,"div",14),l.Jb(81,"div",14),l.Jb(82,"div",14),l.Jb(83,"div",14),l.Jb(84,"div",14),l.Jb(85,"div",14),l.Kb(),l.Kb(),l.Kb(),l.Lb(86,"app-ionic-bottom-drawer",35,36),l.Lb(88,"div",2),l.Lb(89,"div",3),l.Jb(90,"div",4),l.Jb(91,"div",5),l.Jb(92,"div",17),l.Lb(93,"ion-item",37),l.Lb(94,"ion-grid"),l.Lb(95,"ion-row"),l.Lb(96,"ion-col"),l.Lb(97,"ion-label"),l.Lb(98,"h2"),l.pc(99),l.Kb(),l.Kb(),l.Lb(100,"ion-text"),l.pc(101),l.Kb(),l.Kb(),l.Lb(102,"ion-col"),l.Lb(103,"ion-button",38),l.Xb("click",function(){return e.onEndNavigationClick()}),l.pc(104," End Route "),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Lb(105,"app-ionic-bottom-drawer",39,40),l.Xb("stateChange",function(t){return e.onChangeRouteDrawerStateChange(t)}),l.Lb(107,"div",2),l.Lb(108,"div",3),l.Jb(109,"div",4),l.Jb(110,"div",5),l.Lb(111,"ion-item",37),l.Lb(112,"ion-grid"),l.Lb(113,"ion-row",41),l.Lb(114,"ion-col",42),l.Lb(115,"span",33),l.Xb("click",function(){return e.onCancelChangeRoute()}),l.pc(116,"Cancel"),l.Kb(),l.Kb(),l.Lb(117,"ion-col",43),l.Lb(118,"h3"),l.pc(119,"Change Route"),l.Kb(),l.Kb(),l.Lb(120,"ion-col",42),l.Lb(121,"span",33),l.Xb("click",function(){l.jc(t);const n=l.hc(124);return e.newRoute.emit([n.From,n.To])}),l.pc(122,"Route"),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Jb(123,"app-route-input",null,44),l.Kb(),l.Kb()}2&t&&(l.xb(10),l.ec("ngIf",e.model.errorMessage),l.xb(1),l.ec("ngIf",e.model.recentSearches.length>0),l.xb(5),l.ec("ngForOf",e.model.availableCampus),l.xb(20),l.qc(e.model.latestSearchResult.Name),l.xb(2),l.qc(e.model.latestSearchResult.Description),l.xb(11),l.ec("ngForOf",e.model.latestSearchResult.Information),l.xb(3),l.ec("ngForOf",e.model.latestSearchResult.Images),l.xb(8),l.ec("ngIf",0===e.model.Route.Distance),l.xb(7),l.rc("To ",e.model.Route.Destination.Name,""),l.xb(4),l.qc(e.model.Route.Start.Name),l.xb(4),l.ec("ngIf",0!==e.model.Route.Distance),l.xb(2),l.ec("ngIf",0!==e.model.Route.Distance),l.xb(9),l.ec("shouldDockTop",!1),l.xb(13),l.rc("",e.model.Route.Time," min"),l.xb(2),l.rc("",e.model.Route.Distance," m"),l.xb(4),l.ec("shouldDockBottom",!1)("shouldDockMiddle",!1))},directives:[K.a,k,i.p,r.j,i.y,i.z,r.i,i.r,i.I,i.o,i.x,i.R,i.h,i.t,bt,i.v,V,i.B],styles:[".vertical-line[_ngcontent-%COMP%]{border-left:2px solid #9d9fa6;height:38px}.span-button[_ngcontent-%COMP%]{color:var(--ion-color-primary,#3880ff)}.span-button[_ngcontent-%COMP%]:hover{cursor:pointer}.error[_ngcontent-%COMP%]{color:red}.nav-hbar[_ngcontent-%COMP%]{border-top:2px solid var(--ion-color-medium,#9d9fa6);border-bottom:2px solid var(--ion-color-medium,#9d9fa6);border-radius:2px;height:0;width:auto;margin:0 45%}.nav-bottom-drawer[_ngcontent-%COMP%]{background-color:var(--ion-item-background,#fff);border-top-left-radius:20px;border-top-right-radius:20px;box-shadow:0 4px 8px 0 rgba(0,0,0,.4),0 6px 20px 0 rgba(0,0,0,.29);height:inherit}.square-md[_ngcontent-%COMP%]{height:64px;width:64px}.square-sm[_ngcontent-%COMP%]{height:32px;width:32px}.square-xs[_ngcontent-%COMP%]{height:16px;width:16px}#locationdrawerContent[_ngcontent-%COMP%]{margin-left:30px;margin-right:30px;position:center}#locationdrawerName[_ngcontent-%COMP%]{font-weight:700}#inNavigationDrawer[_ngcontent-%COMP%]{z-index:1}#locationDrawer[_ngcontent-%COMP%]{z-index:2}#routeDrawer[_ngcontent-%COMP%]{z-index:3}#searchDrawer[_ngcontent-%COMP%]{z-index:4}.ion-img[_ngcontent-%COMP%]{height:200px}"]}),t})();const Ft=["searchInput"],_t=["navSlides"],Tt=["drawerManager"];function Et(t,e){1&t&&l.Jb(0,"ion-progress-bar",8)}const{Keyboard:At}=F.a,Bt=rt.icon({iconRetinaUrl:"leaflet/marker-icon-2x.png",iconUrl:"leaflet/marker-icon.png",shadowUrl:"leaflet/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]});rt.Marker.prototype.options.icon=Bt;let jt=(()=>{class t{constructor(t,e,n,i,o,r,a,s,c){this.dataService=t,this.route=e,this.router=n,this.model=i,this.storage=o,this.geolocation=r,this.openStreetMapService=a,this.lastOpenStreetMapCenterPersistence=s,this.platform=c,this.searchMarker=[],this.routes=[],this.progressIsVisible=!1,this.currentPositionMarker=null,this.isInitialized=!1,this.isSubscribed=!1,this.DEFAULT_ZOOM=17,this.MAX_ZOOM=18,this.MIN_ZOOM=14,this.isHybridPlatform=this.platform.is("hybrid")}static convertToLeafLetCoordinates(t){const e=[];for(const n of t)e.push({lat:n.Latitude,lng:n.Longitude});return e}ngOnInit(){return Object(s.a)(this,void 0,void 0,function*(){if(!this.model.availableCampus||0===this.model.availableCampus.length){const t=yield this.dataService.get_campus_search().toPromise();for(const e of t)this.model.availableCampus.push(new N(e))}})}ionViewDidEnter(){return Object(s.a)(this,void 0,void 0,function*(){this.isInitialized||(yield this.initializeMap(this.router),this.isInitialized=!0);try{const t=yield this.geolocation.getCurrentPosition();null===this.currentPositionMarker?this.currentPositionMarker=rt.marker([t.coords.latitude,t.coords.longitude]).addTo(this.map).bindPopup("Position"):this.currentPositionMarker.setLatLng([t.coords.latitude,t.coords.longitude])}catch(t){console.log("Error getting location",t)}!1===this.isSubscribed&&(this.isSubscribed=!0,this.route.queryParams.subscribe(t=>Object(s.a)(this,void 0,void 0,function*(){null!=t&&(null!=t.location?(yield this.execSearch(t.location),this.clearRoutes()):null!=t.destination?(yield this.drawerManager.SetState(Nt.RouteView),yield this.execDirectSearch(t.destination),yield this.routeToLatestSearchResult()):(yield this.drawerManager.SetState(Nt.SearchView),this.clearSearchMarkers(),this.clearRoutes()))})))})}initializeMap(e){var n;return Object(s.a)(this,void 0,void 0,function*(){const i=yield this.openStreetMapService.GetBounds(),o=rt.latLng(i.SouthWest.Lat,i.SouthWest.Lng),r=rt.latLng(i.NorthEast.Lat,i.NorthEast.Lng),a=rt.latLngBounds(o,r);console.log(i,a),this.map=rt.map("leafletMap",{maxBounds:a,maxZoom:this.MAX_ZOOM,minZoom:this.MIN_ZOOM,zoomControl:!this.platform.is("hybrid")}),this.map.on("moveend",t=>{dt.persist(this.storage,{center:t.target.getCenter(),zoom:t.target.getZoom()})}),yield this.lastOpenStreetMapCenterPersistence.load(this.storage,this.map,this.DEFAULT_ZOOM),rt.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"edupala.com \xa9 Angular LeafLet"}).addTo(this.map),this.platform.is("hybrid")&&(yield this.delay(500),this.map.invalidateSize());const s=yield this.dataService.get_buildings_search().toPromise();function c(t){e.navigate(["tabs/navigation"],{queryParams:{location:t.target.options.className}}).then(()=>console.log(t.latlng,t.target.options.className))}if(null!==s)for(const e of s)null!==e.edges.Body&&e.edges.Body.length>0&&rt.polygon(t.convertToLeafLetCoordinates(e.edges.Body),{className:e.Name,color:null!==(n=e.Color)&&void 0!==n?n:"#0083C6"}).addTo(this.map).on("click",c)})}ngOnDestroy(){this.map.remove()}onSearch(t){return Object(s.a)(this,void 0,void 0,function*(){yield this.router.navigate(["/tabs/navigation"],{queryParams:{location:t}})})}execSearch(t){return Object(s.a)(this,void 0,void 0,function*(){this.model.errorMessage="",this.progressIsVisible=!0;try{if(this.clearSearchMarkers(),yield this.execDirectSearch(t))return this.searchMarker.push(this.showMarker(this.model.latestSearchResult.LatLng.lat,this.model.latestSearchResult.LatLng.lng,this.model.latestSearchResult.Name,!0)),this.map.flyTo(this.model.latestSearchResult.LatLng,this.DEFAULT_ZOOM),void(yield this.showElementDrawer());const e=yield this.dataService.get_buildings_search(t).toPromise();if(e&&e.length>0){for(const t of e){const e=this.getCenterCoordinateFromBody(t.edges.Body);this.searchMarker.push(this.showMarker(e.Latitude,e.Longitude,t.Name,!1))}return}{const e=yield this.dataService.get_campus_search(t).toPromise();if(e&&e.length>0){for(const t of e)this.searchMarker.push(this.showMarker(t.Latitude,t.Longitude,t.Name,!1));return}}this.model.errorMessage="Studi-Guide can't find "+t}catch(e){this.handleInputError(e,t)}finally{this.progressIsVisible=!1}})}execDirectSearch(t){return Object(s.a)(this,void 0,void 0,function*(){try{const e=yield this.dataService.get_location(t).toPromise();if(e){const t=yield this.dataService.get_building(e.Building).toPromise(),n=this.getCenterCoordinateFromBody(t.edges.Body);return yield this.model.addRecentSearchLocation(e,{lat:n.Latitude,lng:n.Longitude},t),!0}}catch(e){console.log(e)}try{const e=yield this.dataService.get_building(t,!1).toPromise();if(e){const t=this.getCenterCoordinateFromBody(e.edges.Body);return yield this.model.addRecentSearchBuilding(e,{lat:t.Latitude,lng:t.Longitude}),!0}}catch(e){console.log(e)}try{const e=yield this.dataService.get_campus(t,!1).toPromise();if(e)return yield this.model.addRecentSearchCampus(e),!0}catch(e){console.log(e)}return!1})}onRoute(t){return Object(s.a)(this,void 0,void 0,function*(){console.log(t),this.clearRoutes(),yield this.drawerManager.SetState(Nt.RouteView,!1);const e=yield this.openStreetMapService.GetRoute(t[0].LatLng,t[1].LatLng);this.model.SetOsmRouteAsRoute(e[0],t[0],t[1]);const n=rt.polyline(this.model.Route.Coordinates,{color:"red"}).addTo(this.map);this.map.flyTo(n.getCenter(),this.DEFAULT_ZOOM),yield this.map.fitBounds(n.getBounds()),this.routes.push(n)})}showElementDrawer(){return Object(s.a)(this,void 0,void 0,function*(){this.isHybridPlatform&&(yield At.hide()),yield this.drawerManager.SetState(Nt.LocationView)})}onCampusClick(t){this.map.flyTo(t.LatLng,this.DEFAULT_ZOOM)}onDrawerManagerStateChange(t){return Object(s.a)(this,void 0,void 0,function*(){switch(console.log(t),t){case Nt.SearchView:yield this.router.navigate(["/tabs/navigation"]);break;case Nt.LocationView:yield this.router.navigate(["/tabs/navigation"],{queryParams:{location:this.model.latestSearchResult.Name}});break;case Nt.RouteView:yield this.router.navigate(["/tabs/navigation"],{queryParams:{destination:this.model.latestSearchResult.Name}});break;case Nt.InNavigationView:yield this.onLaunchNavigation()}})}onDetailsClick(){return Object(s.a)(this,void 0,void 0,function*(){yield this.router.navigate(["tabs/navigation/detail"],{queryParams:0===this.routes.length?this.model.latestSearchResult.DetailRouterParams:this.model.latestSearchResult.RouteRouterParams})})}routeToLatestSearchResult(){return Object(s.a)(this,void 0,void 0,function*(){const e=yield this.geolocation.getCurrentPosition(),n={lat:e.coords.latitude,lng:e.coords.longitude},i=yield this.openStreetMapService.GetRoute(n,this.model.latestSearchResult.LatLng);this.model.SetOsmRouteAsRoute(i[0],{Name:t.MyLocation,LatLng:n},this.model.latestSearchResult);const o=rt.polyline(this.model.Route.Coordinates,{color:"red"}).addTo(this.map);this.map.flyTo(o.getCenter(),this.DEFAULT_ZOOM),yield this.map.fitBounds(o.getBounds()),this.routes.push(o)})}onLaunchNavigation(){return Object(s.a)(this,void 0,void 0,function*(){this.navSlides.instructions=this.model.Route.NavigationInstructions,yield this.navSlides.show(),this.map.flyTo(this.model.Route.Coordinates[this.model.Route.NavigationInstructions[0].Interval[0]],this.MAX_ZOOM),yield this.drawerManager.SetState(Nt.InNavigationView)})}onSlideChange(t){this.onNavigationInstructionClick(this.model.Route.NavigationInstructions[t])}onNavigationInstructionClick(t){this.map.flyTo(this.model.Route.Coordinates[t.Interval[0]],this.MAX_ZOOM)}handleInputError(t,e){if(t instanceof C.d){const n=t;this.model.errorMessage=400===n.status?"Studi-Guide can't find "+e:n.message}else this.model.errorMessage=t.message}showMarker(t,e,n="",i){const o=rt.marker([t,e]).addTo(this.map);return n?i?o.bindPopup(n).openPopup():o.bindPopup(n):o}getCenterCoordinateFromBody(t){const e=[];for(const o of t)e.push([o.Latitude,o.Longitude]);const n=new rt.Polygon(e).addTo(this.map),i={Longitude:n.getCenter().lng,Latitude:n.getCenter().lat};return n.remove(),i}clearSearchMarkers(){for(const t of this.searchMarker)this.map.removeLayer(t)}clearRoutes(){for(const t of this.routes)t.remove();this.routes=[],this.model.ClearRoute(),this.navSlides.hide()}delay(t){return new Promise(e=>setTimeout(e,t))}}return t.MyLocation="My Location",t.\u0275fac=function(e){return new(e||t)(l.Ib(c.a),l.Ib(o.a),l.Ib(o.g),l.Ib(I),l.Ib(L.b),l.Ib(_.a),l.Ib(st),l.Ib(dt),l.Ib(i.ab))},t.\u0275cmp=l.Cb({type:t,selectors:[["app-map-page"]],viewQuery:function(t,e){if(1&t&&(l.tc(Ft,!0),l.tc(_t,!0),l.tc(Tt,!0)),2&t){let t;l.gc(t=l.Yb())&&(e.searchInput=t.first),l.gc(t=l.Yb())&&(e.navSlides=t.first),l.gc(t=l.Yb())&&(e.drawerManager=t.first)}},decls:8,vars:1,consts:[[3,"campusClick","navInstructionClick","search","detailsClick","stateChange","newRoute"],["drawerManager",""],[3,"nextSlide","previousSlide"],["navSlides",""],["data-tap-disabled","true","scroll-y","false"],["type","indeterminate","color","secondary",4,"ngIf"],["id","map-content"],["id","leafletMap"],["type","indeterminate","color","secondary"]],template:function(t,e){1&t&&(l.Lb(0,"app-nav-drawer-manager",0,1),l.Xb("campusClick",function(t){return e.onCampusClick(t)})("navInstructionClick",function(t){return e.onNavigationInstructionClick(t)})("search",function(t){return e.onSearch(t)})("detailsClick",function(){return e.onDetailsClick()})("stateChange",function(t){return e.onDrawerManagerStateChange(t)})("newRoute",function(t){return e.onRoute(t)}),l.Kb(),l.Lb(2,"app-navigation-instruction-slides",2,3),l.Xb("nextSlide",function(t){return e.onSlideChange(t)})("previousSlide",function(t){return e.onSlideChange(t)}),l.Kb(),l.Lb(4,"ion-content",4),l.oc(5,Et,1,0,"ion-progress-bar",5),l.Lb(6,"div",6),l.Jb(7,"div",7),l.Kb(),l.Kb()),2&t&&(l.xb(5),l.ec("ngIf",e.progressIsVisible))},directives:[Pt,ut,i.p,r.j,i.B],styles:["#map-content[_ngcontent-%COMP%]{height:100%;width:100%;position:fixed}.error[_ngcontent-%COMP%]{color:red}#error-message[_ngcontent-%COMP%]{margin-left:20px}#leafletMap[_ngcontent-%COMP%]{height:100%;width:100%;z-index:0}#leafletMap[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}#available-floors-btn[_ngcontent-%COMP%]{position:fixed;bottom:0;display:block;z-index:10}.draggable[_ngcontent-%COMP%]{cursor:-webkit-grab;cursor:grab}.draggable[_ngcontent-%COMP%]:active{cursor:-webkit-grabbing;cursor:grabbing}.center[_ngcontent-%COMP%]{margin-left:auto;margin-right:auto;display:block}ion-progress-bar[_ngcontent-%COMP%]{position:absolute;z-index:9999}"]}),t})(),Vt=(()=>{class t{}return t.\u0275mod=l.Gb({type:t}),t.\u0275inj=l.Fb({factory:function(e){return new(e||t)},imports:[[r.b]]}),t})(),Xt=(()=>{class t{}return t.\u0275mod=l.Gb({type:t}),t.\u0275inj=l.Fb({factory:function(e){return new(e||t)},imports:[[i.V,r.b,a.a,o.i.forChild([{path:"detail",component:it},{path:"",component:jt}]),ot,Vt]]}),t})();l.mc(it,[i.s,i.U,i.i,i.f,i.g,i.p,r.j,i.B,S,K.a,k,i.R,i.v,i.y,i.z,r.i,i.r,i.I,i.o,i.x,i.h,i.t,bt,V],[])},wyfB:function(t,e){function n(t){return t&&t.ownerSVGElement&&t.getCTM}t.exports=function(t,e){if(!n(t))throw new Error("svg element is required for svg.panzoom to work");var i=t.ownerSVGElement;if(!i)throw new Error("Do not apply panzoom to the root <svg> element. Use its child instead (e.g. <g></g>). As of March 2016 only FireFox supported transform on the root element");return e.disableKeyboardInteraction||i.setAttribute("tabindex",0),{getBBox:function(){var e=t.getBBox();return{left:e.x,top:e.y,width:e.width,height:e.height}},getScreenCTM:function(){return i.getCTM()||i.getScreenCTM()},getOwner:function(){return i},applyTransform:function(e){t.setAttribute("transform","matrix("+e.scale+" 0 0 "+e.scale+" "+e.x+" "+e.y+")")},initTransform:function(e){var n=t.getCTM();null===n&&(n=document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix()),e.x=n.e,e.y=n.f,e.scale=n.a,i.removeAttributeNS(null,"viewBox")}}},t.exports.canAttach=n}}]);