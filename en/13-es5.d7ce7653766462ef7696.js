!function(){function e(e,t){var i;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"==typeof e)return n(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return n(e,t)}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,c=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return a=e.done,e},e:function(e){c=!0,s=e},f:function(){try{a||null==i.return||i.return()}finally{if(c)throw s}}}}function n(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,i=new Array(n);t<n;t++)i[t]=e[t];return i}function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function i(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,n,t){return n&&i(e.prototype,n),t&&i(e,t),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{L0xO:function(n,i,o){"use strict";o.r(i),o.d(i,"SchedulePageModule",function(){return M});var s=o("TEn/"),a=o("tyNb"),c=o("ofXK"),u=o("3Pt+"),l=o("mrSG"),d=o("AnxF"),f=o("fXoL"),b=o("e8h1"),h=["userNameInput"],g=["passwordInput"];function v(e,n){if(1&e){var t=f.Lb();f.Kb(0,"div"),f.Kb(1,"ion-header"),f.Kb(2,"ion-toolbar"),f.Kb(3,"ion-title"),f.oc(4," Moodle Login "),f.Jb(),f.Jb(),f.Jb(),f.Kb(5,"ion-grid",1),f.Kb(6,"ion-row"),f.Kb(7,"ion-col",2),f.Kb(8,"ion-item"),f.Kb(9,"ion-label",3),f.oc(10,"user name"),f.Jb(),f.Kb(11,"ion-input",4,5),f.Wb("ionChange",function(){return f.ic(t),f.Yb().clearInvalidCredentialsMsg()}),f.Ib(13,"ion-icon",6),f.Jb(),f.Jb(),f.Kb(14,"ion-item"),f.Kb(15,"ion-label",3),f.oc(16,"password"),f.Jb(),f.Kb(17,"ion-input",7,8),f.Wb("ionChange",function(){return f.ic(t),f.Yb().clearInvalidCredentialsMsg()}),f.Ib(19,"ion-icon",9),f.Jb(),f.Jb(),f.Kb(20,"ion-button",10),f.Wb("click",function(){return f.ic(t),f.Yb().fetchAndPersistMoodleToken()}),f.Kb(21,"h4"),f.oc(22,"sign in"),f.Jb(),f.Jb(),f.Jb(),f.Jb(),f.Kb(23,"ion-row"),f.Ib(24,"ion-col",11),f.Jb(),f.Jb(),f.Jb()}if(2&e){var i=f.Yb();f.xb(24),f.dc("innerHTML",i.invalidCredentialsMessage,f.jc)}}var m,p=((m=function(){function e(n,i){t(this,e),this.storage=n,this.moodleService=i,this.isSignedIn=new f.o,this.moodleToken=new f.o,this.isUserLoggedIn=!0,this.MOODLE_TOKEN="moodle_token",this.MOODLE_USER="moodle_user"}return r(e,[{key:"ngOnInit",value:function(){}},{key:"checkMoodleLoginState",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.storage.ready().then(function(){return Object(l.a)(n,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPersistedToken();case 2:this.isUserLoggedIn=null!=this.token,this.isSignedIn.emit(this.isUserLoggedIn),this.isUserLoggedIn&&this.moodleToken.emit(this.token);case 5:case"end":return e.stop()}},e,this)}))});case 1:case"end":return e.stop()}},e,this)}))}},{key:"fetchAndPersistMoodleToken",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var n,t,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.userNameInput.value,t=this.passwordInput.value,e.next=4,this.moodleService.getLoginToken(n,t).toPromise();case 4:if(i=e.sent,!this.moodleService.containsToken(i)){e.next=15;break}return this.isUserLoggedIn=!0,this.moodleToken.emit(i),this.isSignedIn.emit(this.isUserLoggedIn),e.next=11,this.storage.set(this.MOODLE_USER,n);case 11:return e.next=13,this.storage.set(this.MOODLE_TOKEN,i);case 13:e.next=16;break;case 15:this.isUserLoggedIn=!1,this.isSignedIn.emit(this.isUserLoggedIn),this.invalidCredentialsMessage="Invalid credentials";case 16:case"end":return e.stop()}},e,this)}))}},{key:"clearInvalidCredentialsMsg",value:function(){this.invalidCredentialsMessage=""}},{key:"getPersistedToken",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storage.get(this.MOODLE_TOKEN).then(function(e){n.token=e});case 2:case"end":return e.stop()}},e,this)}))}}]),e}()).\u0275fac=function(e){return new(e||m)(f.Hb(b.b),f.Hb(d.a))},m.\u0275cmp=f.Bb({type:m,selectors:[["app-login"]],viewQuery:function(e,n){var t;1&e&&(f.sc(h,!0),f.sc(g,!0)),2&e&&(f.fc(t=f.Xb())&&(n.userNameInput=t.first),f.fc(t=f.Xb())&&(n.passwordInput=t.first))},outputs:{isSignedIn:"isSignedIn",moodleToken:"moodleToken"},decls:1,vars:1,consts:[[4,"ngIf"],["fixed","md"],["size","12"],["position","stacked"],["type","text","clear-input","","value","admin",1,"ion-text-center",3,"ionChange"],["userNameInput",""],["name","person-outline"],["type","password","clear-input","","value","administrator",1,"ion-text-center",3,"ionChange"],["passwordInput",""],["name","key-outline"],["size","default","expand","full","mode","ios","color","secondary",3,"click"],["size","12","id","invalid-credentials",1,"ion-text-center",3,"innerHTML"]],template:function(e,n){1&e&&f.nc(0,v,25,1,"div",0),2&e&&f.dc("ngIf",!n.isUserLoggedIn)},directives:[c.j,s.v,s.V,s.T,s.u,s.J,s.o,s.y,s.A,s.x,s.eb,s.w,s.h],styles:["ion-button[_ngcontent-%COMP%]{width:calc(100% - 22px);margin:12px}#invalid-credentials[_ngcontent-%COMP%]{color:#eb445a;font-size:20px}"]}),m);function k(e,n){if(1&e&&(f.Kb(0,"ion-card-subtitle"),f.oc(1),f.Jb()),2&e){var t=f.Yb().$implicit;f.xb(1),f.pc(t.course.fullname)}}function y(e,n){if(1&e){var t=f.Lb();f.Kb(0,"ion-item-sliding"),f.Kb(1,"ion-item"),f.Kb(2,"ion-card"),f.Kb(3,"ion-card-header"),f.Ib(4,"ion-card-title",5),f.nc(5,k,2,1,"ion-card-subtitle",1),f.Jb(),f.Kb(6,"ion-card-content"),f.Ib(7,"div",5),f.Kb(8,"ion-text",6),f.Wb("click",function(){f.ic(t);var e=n.$implicit;return f.Yb(2).onLocationClick(e.location)}),f.oc(9),f.Jb(),f.Jb(),f.Jb(),f.Jb(),f.Jb()}if(2&e){var i=n.$implicit;f.xb(4),f.dc("innerHTML",i.name,f.jc),f.xb(1),f.dc("ngIf",i.course),f.xb(2),f.dc("innerHTML",i.description,f.jc),f.xb(2),f.qc("Location: ",i.location,"")}}function w(e,n){if(1&e){var t=f.Lb();f.Kb(0,"div"),f.Kb(1,"ion-refresher",2),f.Wb("ionRefresh",function(e){return f.ic(t),f.Yb().doRefreshEvents(e)}),f.Ib(2,"ion-refresher-content"),f.Jb(),f.Kb(3,"ion-list",3),f.nc(4,y,10,4,"ion-item-sliding",4),f.Jb(),f.Jb()}if(2&e){var i=f.Yb();f.xb(4),f.dc("ngForOf",i.calenderEvents)}}var I,x,S=((x=function(){function n(e,i,r){t(this,n),this.moodleService=e,this.loadingController=i,this.router=r,this.calenderEvents=[]}return r(n,[{key:"ionViewWillEnter",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.login.checkMoodleLoginState();case 2:case"end":return e.stop()}},e,this)}))}},{key:"onSignIn",value:function(e){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:this.isMoodleUserSignedIn=!!e;case 1:case"end":return n.stop()}},n,this)}))}},{key:"fetchMoodleData",value:function(n){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var i,r,o,s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loadingController.create({message:"Collecting moodle data..."});case 2:return i=t.sent,t.next=5,i.present();case 5:return this.token=n,t.next=8,this.moodleService.getCalenderEventsWeek(n).toPromise();case 8:if(r=t.sent,!this.moodleService.containsEvents(r)){t.next=17;break}this.calenderEvents=r.events,o=e(this.calenderEvents);try{for(o.s();!(s=o.n()).done;)s.value.location="KA.206"}catch(a){o.e(a)}finally{o.f()}return t.next=15,i.dismiss();case 15:t.next=21;break;case 17:return this.isMoodleUserSignedIn=!1,this.login.isUserLoggedIn=!1,t.next=21,i.dismiss();case 21:case"end":return t.stop()}},t,this)}))}},{key:"doRefreshEvents",value:function(n){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var i,r,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isMoodleUserSignedIn){t.next=5;break}return t.next=3,this.moodleService.getCalenderEventsWeek(this.token).toPromise();case 3:if(i=t.sent,this.moodleService.containsEvents(i)){this.calenderEvents=i.events,r=e(this.calenderEvents);try{for(r.s();!(o=r.n()).done;)o.value.location="KA.206"}catch(s){r.e(s)}finally{r.f()}n.target.complete()}else this.isMoodleUserSignedIn=!1;case 5:case"end":return t.stop()}},t,this)}))}},{key:"onLocationClick",value:function(e){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.router.navigate(["tabs/navigation/detail"],{queryParams:{location:e}});case 2:case"end":return n.stop()}},n,this)}))}},{key:"ngAfterViewInit",value:function(){}}]),n}()).\u0275fac=function(e){return new(e||x)(f.Hb(d.a),f.Hb(s.Y),f.Hb(a.g))},x.\u0275cmp=f.Bb({type:x,selectors:[["app-schedule"]],viewQuery:function(e,n){var t;1&e&&f.sc(p,!0),2&e&&f.fc(t=f.Xb())&&(n.login=t.first)},decls:3,vars:1,consts:[[3,"isSignedIn","moodleToken"],[4,"ngIf"],["slot","fixed",3,"ionRefresh"],["lines","none"],[4,"ngFor","ngForOf"],[3,"innerHTML"],["id","location-entry",3,"click"]],template:function(e,n){1&e&&(f.Kb(0,"ion-content"),f.Kb(1,"app-login",0),f.Wb("isSignedIn",function(e){return n.onSignIn(e)})("moodleToken",function(e){return n.fetchMoodleData(e)}),f.Jb(),f.nc(2,w,5,1,"div",1),f.Jb()),2&e&&(f.xb(2),f.dc("ngIf",n.isMoodleUserSignedIn))},directives:[s.p,p,c.j,s.F,s.G,s.B,c.i,s.z,s.y,s.j,s.l,s.n,s.k,s.S,s.m],styles:[".welcome-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:35vh;overflow:hidden}#location-entry[_ngcontent-%COMP%]{color:#1e90ff;font-weight:700;cursor:pointer}"]}),x),M=((I=function e(){t(this,e)}).\u0275mod=f.Fb({type:I}),I.\u0275inj=f.Eb({factory:function(e){return new(e||I)},imports:[[s.W,c.b,u.a,a.i.forChild([{path:"",component:S},{path:"login/",component:S}])]]}),I)}}])}();