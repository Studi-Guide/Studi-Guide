(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{L0xO:function(e,n,i){"use strict";i.r(n),i.d(n,"SchedulePageModule",function(){return L});var t=i("TEn/"),o=i("tyNb"),s=i("ofXK"),r=i("3Pt+"),c=i("mrSG"),d=i("AnxF"),l=i("fXoL"),a=i("e8h1");const b=["userNameInput"],g=["passwordInput"];function h(e,n){if(1&e){const e=l.Mb();l.Lb(0,"div"),l.Lb(1,"ion-header"),l.Lb(2,"ion-toolbar"),l.Lb(3,"ion-title"),l.pc(4," Moodle Login "),l.Kb(),l.Kb(),l.Kb(),l.Lb(5,"ion-grid",1),l.Lb(6,"ion-row"),l.Lb(7,"ion-col",2),l.Lb(8,"ion-item"),l.Lb(9,"ion-label",3),l.pc(10,"user name"),l.Kb(),l.Lb(11,"ion-input",4,5),l.Xb("ionChange",function(){return l.jc(e),l.Zb().clearInvalidCredentialsMsg()}),l.Jb(13,"ion-icon",6),l.Kb(),l.Kb(),l.Lb(14,"ion-item"),l.Lb(15,"ion-label",3),l.pc(16,"password"),l.Kb(),l.Lb(17,"ion-input",7,8),l.Xb("ionChange",function(){return l.jc(e),l.Zb().clearInvalidCredentialsMsg()}),l.Jb(19,"ion-icon",9),l.Kb(),l.Kb(),l.Lb(20,"ion-button",10),l.Xb("click",function(){return l.jc(e),l.Zb().fetchAndPersistMoodleToken()}),l.Lb(21,"h4"),l.pc(22,"sign in"),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Lb(23,"ion-row"),l.Jb(24,"ion-col",11),l.Kb(),l.Kb(),l.Kb()}if(2&e){const e=l.Zb();l.xb(24),l.ec("innerHTML",e.invalidCredentialsMessage,l.kc)}}let u=(()=>{class e{constructor(e,n){this.storage=e,this.moodleService=n,this.isSignedIn=new l.o,this.moodleToken=new l.o,this.isUserLoggedIn=!0,this.MOODLE_TOKEN="moodle_token",this.MOODLE_USER="moodle_user"}ngOnInit(){}checkMoodleLoginState(){return Object(c.a)(this,void 0,void 0,function*(){this.storage.ready().then(()=>Object(c.a)(this,void 0,void 0,function*(){yield this.getPersistedToken(),this.isUserLoggedIn=null!=this.token,this.isSignedIn.emit(this.isUserLoggedIn),this.isUserLoggedIn&&this.moodleToken.emit(this.token)}))})}fetchAndPersistMoodleToken(){return Object(c.a)(this,void 0,void 0,function*(){const e=this.userNameInput.value,n=this.passwordInput.value,i=yield this.moodleService.getLoginToken(e,n).toPromise();this.moodleService.containsToken(i)?(this.isUserLoggedIn=!0,this.moodleToken.emit(i),this.isSignedIn.emit(this.isUserLoggedIn),yield this.storage.set(this.MOODLE_USER,e),yield this.storage.set(this.MOODLE_TOKEN,i)):(this.isUserLoggedIn=!1,this.isSignedIn.emit(this.isUserLoggedIn),this.invalidCredentialsMessage="Invalid credentials")})}clearInvalidCredentialsMsg(){this.invalidCredentialsMessage=""}getPersistedToken(){return Object(c.a)(this,void 0,void 0,function*(){yield this.storage.get(this.MOODLE_TOKEN).then(e=>{this.token=e})})}}return e.\u0275fac=function(n){return new(n||e)(l.Ib(a.b),l.Ib(d.a))},e.\u0275cmp=l.Cb({type:e,selectors:[["app-login"]],viewQuery:function(e,n){if(1&e&&(l.tc(b,!0),l.tc(g,!0)),2&e){let e;l.gc(e=l.Yb())&&(n.userNameInput=e.first),l.gc(e=l.Yb())&&(n.passwordInput=e.first)}},outputs:{isSignedIn:"isSignedIn",moodleToken:"moodleToken"},decls:1,vars:1,consts:[[4,"ngIf"],["fixed","md"],["size","12"],["position","stacked"],["type","text","clear-input","","value","admin",1,"ion-text-center",3,"ionChange"],["userNameInput",""],["name","person-outline"],["type","password","clear-input","","value","administrator",1,"ion-text-center",3,"ionChange"],["passwordInput",""],["name","key-outline"],["size","default","expand","full","mode","ios","color","secondary",3,"click"],["size","12","id","invalid-credentials",1,"ion-text-center",3,"innerHTML"]],template:function(e,n){1&e&&l.oc(0,h,25,1,"div",0),2&e&&l.ec("ngIf",!n.isUserLoggedIn)},directives:[s.j,t.s,t.U,t.S,t.r,t.I,t.o,t.v,t.x,t.u,t.eb,t.t,t.h],styles:["ion-button[_ngcontent-%COMP%]{width:calc(100% - 22px);margin:12px}#invalid-credentials[_ngcontent-%COMP%]{color:#eb445a;font-size:20px}"]}),e})();function f(e,n){if(1&e&&(l.Lb(0,"ion-card-title"),l.pc(1),l.Kb()),2&e){const e=l.Zb().$implicit;l.xb(1),l.qc(e.course.fullname)}}function p(e,n){if(1&e){const e=l.Mb();l.Lb(0,"ion-item-sliding"),l.Lb(1,"ion-item",6),l.Lb(2,"ion-card"),l.Lb(3,"ion-card-header"),l.oc(4,f,2,1,"ion-card-title",2),l.Jb(5,"ion-card-subtitle",7),l.Kb(),l.Lb(6,"ion-card-content"),l.Jb(7,"div",7),l.Lb(8,"ion-text",8),l.Xb("click",function(){l.jc(e);const i=n.$implicit;return l.Zb(2).onLocationClick(i.location)}),l.pc(9),l.Kb(),l.Kb(),l.Kb(),l.Kb(),l.Kb()}if(2&e){const e=n.$implicit;l.xb(4),l.ec("ngIf",e.course),l.xb(1),l.ec("innerHTML",e.name,l.kc),l.xb(2),l.ec("innerHTML",e.description,l.kc),l.xb(2),l.rc("Location: ",e.location,"")}}function v(e,n){if(1&e){const e=l.Mb();l.Lb(0,"div"),l.Lb(1,"ion-refresher",3),l.Xb("ionRefresh",function(n){return l.jc(e),l.Zb().doRefreshEvents(n)}),l.Jb(2,"ion-refresher-content"),l.Kb(),l.Lb(3,"ion-list",4),l.oc(4,p,10,4,"ion-item-sliding",5),l.Kb(),l.Kb()}if(2&e){const e=l.Zb();l.xb(4),l.ec("ngForOf",e.calenderEvents)}}let m=(()=>{class e{constructor(e,n,i){this.moodleService=e,this.loadingController=n,this.router=i,this.calenderEvents=[]}ionViewWillEnter(){return Object(c.a)(this,void 0,void 0,function*(){yield this.login.checkMoodleLoginState()})}onSignIn(e){return Object(c.a)(this,void 0,void 0,function*(){this.isMoodleUserSignedIn=!!e})}fetchMoodleData(e){return Object(c.a)(this,void 0,void 0,function*(){const n=yield this.loadingController.create({message:"Collecting moodle data..."});yield n.present(),this.token=e;const i=yield this.moodleService.getCalenderEventsWeek(e).toPromise();if(this.moodleService.containsEvents(i)){this.calenderEvents=this.CleanupEvents(i.events);for(const e of this.calenderEvents)e.location="KA.206";yield n.dismiss()}else this.isMoodleUserSignedIn=!1,this.login.isUserLoggedIn=!1,yield n.dismiss()})}doRefreshEvents(e){return Object(c.a)(this,void 0,void 0,function*(){if(this.isMoodleUserSignedIn){const n=yield this.moodleService.getCalenderEventsWeek(this.token).toPromise();if(this.moodleService.containsEvents(n)){this.calenderEvents=n.events;for(const e of this.calenderEvents)e.location="KA.206";e.target.complete()}else this.isMoodleUserSignedIn=!1}})}onLocationClick(e){return Object(c.a)(this,void 0,void 0,function*(){yield this.router.navigate(["tabs/navigation/detail"],{queryParams:{location:e}})})}ngAfterViewInit(){}CleanupEvents(e){const n=new RegExp("<img[^>]*?>","g");for(const i of e)if(n.test(i.description))for(const e of i.description.match(n))i.description=i.description.replace(e,"");return e}}return e.\u0275fac=function(n){return new(n||e)(l.Ib(d.a),l.Ib(t.X),l.Ib(o.g))},e.\u0275cmp=l.Cb({type:e,selectors:[["app-schedule"]],viewQuery:function(e,n){if(1&e&&l.tc(u,!0),2&e){let e;l.gc(e=l.Yb())&&(n.login=e.first)}},decls:4,vars:1,consts:[["fixed",""],[3,"isSignedIn","moodleToken"],[4,"ngIf"],["slot","fixed",3,"ionRefresh"],["lines","none"],[4,"ngFor","ngForOf"],[1,"ion-no-padding"],[3,"innerHTML"],["id","location-entry",3,"click"]],template:function(e,n){1&e&&(l.Lb(0,"ion-content"),l.Lb(1,"ion-grid",0),l.Lb(2,"app-login",1),l.Xb("isSignedIn",function(e){return n.onSignIn(e)})("moodleToken",function(e){return n.fetchMoodleData(e)}),l.Kb(),l.oc(3,v,5,1,"div",2),l.Kb(),l.Kb()),2&e&&(l.xb(3),l.ec("ngIf",n.isMoodleUserSignedIn))},directives:[t.p,t.r,u,s.j,t.E,t.F,t.y,s.i,t.w,t.v,t.j,t.l,t.m,t.k,t.R,t.n],styles:[".welcome-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:35vh;overflow:hidden}#location-entry[_ngcontent-%COMP%]{color:#1e90ff;font-weight:700;cursor:pointer}"]}),e})(),L=(()=>{class e{}return e.\u0275mod=l.Gb({type:e}),e.\u0275inj=l.Fb({factory:function(n){return new(n||e)},imports:[[t.V,s.b,r.a,o.i.forChild([{path:"",component:m},{path:"login/",component:m}])]]}),e})()}}]);