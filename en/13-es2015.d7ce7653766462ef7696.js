(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{L0xO:function(e,n,i){"use strict";i.r(n),i.d(n,"SchedulePageModule",function(){return I});var t=i("TEn/"),o=i("tyNb"),s=i("ofXK"),c=i("3Pt+"),r=i("mrSG"),d=i("AnxF"),l=i("fXoL"),a=i("e8h1");const b=["userNameInput"],h=["passwordInput"];function u(e,n){if(1&e){const e=l.Lb();l.Kb(0,"div"),l.Kb(1,"ion-header"),l.Kb(2,"ion-toolbar"),l.Kb(3,"ion-title"),l.oc(4," Moodle Login "),l.Jb(),l.Jb(),l.Jb(),l.Kb(5,"ion-grid",1),l.Kb(6,"ion-row"),l.Kb(7,"ion-col",2),l.Kb(8,"ion-item"),l.Kb(9,"ion-label",3),l.oc(10,"user name"),l.Jb(),l.Kb(11,"ion-input",4,5),l.Wb("ionChange",function(){return l.ic(e),l.Yb().clearInvalidCredentialsMsg()}),l.Ib(13,"ion-icon",6),l.Jb(),l.Jb(),l.Kb(14,"ion-item"),l.Kb(15,"ion-label",3),l.oc(16,"password"),l.Jb(),l.Kb(17,"ion-input",7,8),l.Wb("ionChange",function(){return l.ic(e),l.Yb().clearInvalidCredentialsMsg()}),l.Ib(19,"ion-icon",9),l.Jb(),l.Jb(),l.Kb(20,"ion-button",10),l.Wb("click",function(){return l.ic(e),l.Yb().fetchAndPersistMoodleToken()}),l.Kb(21,"h4"),l.oc(22,"sign in"),l.Jb(),l.Jb(),l.Jb(),l.Jb(),l.Kb(23,"ion-row"),l.Ib(24,"ion-col",11),l.Jb(),l.Jb(),l.Jb()}if(2&e){const e=l.Yb();l.xb(24),l.dc("innerHTML",e.invalidCredentialsMessage,l.jc)}}let g=(()=>{class e{constructor(e,n){this.storage=e,this.moodleService=n,this.isSignedIn=new l.o,this.moodleToken=new l.o,this.isUserLoggedIn=!0,this.MOODLE_TOKEN="moodle_token",this.MOODLE_USER="moodle_user"}ngOnInit(){}checkMoodleLoginState(){return Object(r.a)(this,void 0,void 0,function*(){this.storage.ready().then(()=>Object(r.a)(this,void 0,void 0,function*(){yield this.getPersistedToken(),this.isUserLoggedIn=null!=this.token,this.isSignedIn.emit(this.isUserLoggedIn),this.isUserLoggedIn&&this.moodleToken.emit(this.token)}))})}fetchAndPersistMoodleToken(){return Object(r.a)(this,void 0,void 0,function*(){const e=this.userNameInput.value,n=this.passwordInput.value,i=yield this.moodleService.getLoginToken(e,n).toPromise();this.moodleService.containsToken(i)?(this.isUserLoggedIn=!0,this.moodleToken.emit(i),this.isSignedIn.emit(this.isUserLoggedIn),yield this.storage.set(this.MOODLE_USER,e),yield this.storage.set(this.MOODLE_TOKEN,i)):(this.isUserLoggedIn=!1,this.isSignedIn.emit(this.isUserLoggedIn),this.invalidCredentialsMessage="Invalid credentials")})}clearInvalidCredentialsMsg(){this.invalidCredentialsMessage=""}getPersistedToken(){return Object(r.a)(this,void 0,void 0,function*(){yield this.storage.get(this.MOODLE_TOKEN).then(e=>{this.token=e})})}}return e.\u0275fac=function(n){return new(n||e)(l.Hb(a.b),l.Hb(d.a))},e.\u0275cmp=l.Bb({type:e,selectors:[["app-login"]],viewQuery:function(e,n){if(1&e&&(l.sc(b,!0),l.sc(h,!0)),2&e){let e;l.fc(e=l.Xb())&&(n.userNameInput=e.first),l.fc(e=l.Xb())&&(n.passwordInput=e.first)}},outputs:{isSignedIn:"isSignedIn",moodleToken:"moodleToken"},decls:1,vars:1,consts:[[4,"ngIf"],["fixed","md"],["size","12"],["position","stacked"],["type","text","clear-input","","value","admin",1,"ion-text-center",3,"ionChange"],["userNameInput",""],["name","person-outline"],["type","password","clear-input","","value","administrator",1,"ion-text-center",3,"ionChange"],["passwordInput",""],["name","key-outline"],["size","default","expand","full","mode","ios","color","secondary",3,"click"],["size","12","id","invalid-credentials",1,"ion-text-center",3,"innerHTML"]],template:function(e,n){1&e&&l.nc(0,u,25,1,"div",0),2&e&&l.dc("ngIf",!n.isUserLoggedIn)},directives:[s.j,t.v,t.V,t.T,t.u,t.J,t.o,t.y,t.A,t.x,t.eb,t.w,t.h],styles:["ion-button[_ngcontent-%COMP%]{width:calc(100% - 22px);margin:12px}#invalid-credentials[_ngcontent-%COMP%]{color:#eb445a;font-size:20px}"]}),e})();function f(e,n){if(1&e&&(l.Kb(0,"ion-card-subtitle"),l.oc(1),l.Jb()),2&e){const e=l.Yb().$implicit;l.xb(1),l.pc(e.course.fullname)}}function v(e,n){if(1&e){const e=l.Lb();l.Kb(0,"ion-item-sliding"),l.Kb(1,"ion-item"),l.Kb(2,"ion-card"),l.Kb(3,"ion-card-header"),l.Ib(4,"ion-card-title",5),l.nc(5,f,2,1,"ion-card-subtitle",1),l.Jb(),l.Kb(6,"ion-card-content"),l.Ib(7,"div",5),l.Kb(8,"ion-text",6),l.Wb("click",function(){l.ic(e);const i=n.$implicit;return l.Yb(2).onLocationClick(i.location)}),l.oc(9),l.Jb(),l.Jb(),l.Jb(),l.Jb(),l.Jb()}if(2&e){const e=n.$implicit;l.xb(4),l.dc("innerHTML",e.name,l.jc),l.xb(1),l.dc("ngIf",e.course),l.xb(2),l.dc("innerHTML",e.description,l.jc),l.xb(2),l.qc("Location: ",e.location,"")}}function m(e,n){if(1&e){const e=l.Lb();l.Kb(0,"div"),l.Kb(1,"ion-refresher",2),l.Wb("ionRefresh",function(n){return l.ic(e),l.Yb().doRefreshEvents(n)}),l.Ib(2,"ion-refresher-content"),l.Jb(),l.Kb(3,"ion-list",3),l.nc(4,v,10,4,"ion-item-sliding",4),l.Jb(),l.Jb()}if(2&e){const e=l.Yb();l.xb(4),l.dc("ngForOf",e.calenderEvents)}}let p=(()=>{class e{constructor(e,n,i){this.moodleService=e,this.loadingController=n,this.router=i,this.calenderEvents=[]}ionViewWillEnter(){return Object(r.a)(this,void 0,void 0,function*(){yield this.login.checkMoodleLoginState()})}onSignIn(e){return Object(r.a)(this,void 0,void 0,function*(){this.isMoodleUserSignedIn=!!e})}fetchMoodleData(e){return Object(r.a)(this,void 0,void 0,function*(){const n=yield this.loadingController.create({message:"Collecting moodle data..."});yield n.present(),this.token=e;const i=yield this.moodleService.getCalenderEventsWeek(e).toPromise();if(this.moodleService.containsEvents(i)){this.calenderEvents=i.events;for(const e of this.calenderEvents)e.location="KA.206";yield n.dismiss()}else this.isMoodleUserSignedIn=!1,this.login.isUserLoggedIn=!1,yield n.dismiss()})}doRefreshEvents(e){return Object(r.a)(this,void 0,void 0,function*(){if(this.isMoodleUserSignedIn){const n=yield this.moodleService.getCalenderEventsWeek(this.token).toPromise();if(this.moodleService.containsEvents(n)){this.calenderEvents=n.events;for(const e of this.calenderEvents)e.location="KA.206";e.target.complete()}else this.isMoodleUserSignedIn=!1}})}onLocationClick(e){return Object(r.a)(this,void 0,void 0,function*(){yield this.router.navigate(["tabs/navigation/detail"],{queryParams:{location:e}})})}ngAfterViewInit(){}}return e.\u0275fac=function(n){return new(n||e)(l.Hb(d.a),l.Hb(t.Y),l.Hb(o.g))},e.\u0275cmp=l.Bb({type:e,selectors:[["app-schedule"]],viewQuery:function(e,n){if(1&e&&l.sc(g,!0),2&e){let e;l.fc(e=l.Xb())&&(n.login=e.first)}},decls:3,vars:1,consts:[[3,"isSignedIn","moodleToken"],[4,"ngIf"],["slot","fixed",3,"ionRefresh"],["lines","none"],[4,"ngFor","ngForOf"],[3,"innerHTML"],["id","location-entry",3,"click"]],template:function(e,n){1&e&&(l.Kb(0,"ion-content"),l.Kb(1,"app-login",0),l.Wb("isSignedIn",function(e){return n.onSignIn(e)})("moodleToken",function(e){return n.fetchMoodleData(e)}),l.Jb(),l.nc(2,m,5,1,"div",1),l.Jb()),2&e&&(l.xb(2),l.dc("ngIf",n.isMoodleUserSignedIn))},directives:[t.p,g,s.j,t.F,t.G,t.B,s.i,t.z,t.y,t.j,t.l,t.n,t.k,t.S,t.m],styles:[".welcome-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:35vh;overflow:hidden}#location-entry[_ngcontent-%COMP%]{color:#1e90ff;font-weight:700;cursor:pointer}"]}),e})(),I=(()=>{class e{}return e.\u0275mod=l.Fb({type:e}),e.\u0275inj=l.Eb({factory:function(n){return new(n||e)},imports:[[t.W,s.b,c.a,o.i.forChild([{path:"",component:p},{path:"login/",component:p}])]]}),e})()}}]);