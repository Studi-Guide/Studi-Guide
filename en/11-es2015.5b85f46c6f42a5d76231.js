(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"0Tit":function(t,e){var i="function"==typeof Float32Array;function n(t,e){return 1-3*e+3*t}function o(t,e){return 3*e-6*t}function r(t){return 3*t}function a(t,e,i){return((n(e,i)*t+o(e,i))*t+r(e))*t}function s(t,e,i){return 3*n(e,i)*t*t+2*o(e,i)*t+r(e)}function c(t){return t}t.exports=function(t,e,n,o){if(!(0<=t&&t<=1&&0<=n&&n<=1))throw new Error("bezier x values must be in [0, 1] range");if(t===e&&n===o)return c;for(var r=i?new Float32Array(11):new Array(11),l=0;l<11;++l)r[l]=a(.1*l,t,n);return function(i){return 0===i?0:1===i?1:a(function(e){for(var i=0,o=1;10!==o&&r[o]<=e;++o)i+=.1;--o;var c=i+(e-r[o])/(r[o+1]-r[o])*.1,l=s(c,t,n);return l>=.001?function(t,e,i,n){for(var o=0;o<4;++o){var r=s(e,i,n);if(0===r)return e;e-=(a(e,i,n)-t)/r}return e}(e,c,t,n):0===l?c:function(t,e,i,n,o){var r,s,c=0;do{(r=a(s=e+(i-e)/2,n,o)-t)>0?i=s:e=s}while(Math.abs(r)>1e-7&&++c<10);return s}(e,i,i+.1,t,n)}(i),e,o)}}},"6f8I":function(t,e){function i(){return"function"==typeof cancelAnimationFrame?cancelAnimationFrame:clearTimeout}function n(){return"function"==typeof requestAnimationFrame?requestAnimationFrame:function(t){return setTimeout(t,16)}}t.exports=function(t,e,o){"object"!=typeof o&&(o={});var r,a,s,c,l,u,d,h,b,f,p="number"==typeof o.minVelocity?o.minVelocity:5,m="number"==typeof o.amplitude?o.amplitude:.25,g="function"==typeof o.cancelAnimationFrame?o.cancelAnimationFrame:i(),v="function"==typeof o.requestAnimationFrame?o.requestAnimationFrame:n();return{start:function(){r=t(),u=b=c=d=0,a=new Date,g(s),g(f),s=v(w)},stop:function(){g(s),g(f);var e=t();l=e.x,h=e.y,a=Date.now(),(c<-p||c>p)&&(l+=u=m*c),(d<-p||d>p)&&(h+=b=m*d),f=v(y)},cancel:function(){g(s),g(f)}};function w(){var e=Date.now(),i=e-a;a=e;var n=t(),o=n.x-r.x,l=n.y-r.y;r=n;var u=1e3/(1+i);c=.8*o*u+.2*c,d=.8*l*u+.2*d,s=v(w)}function y(){var t=Date.now()-a,i=!1,n=0,o=0;u&&((n=-u*Math.exp(-t/342))>.5||n<-.5?i=!0:n=u=0),b&&((o=-b*Math.exp(-t/342))>.5||o<-.5?i=!0:o=b=0),i&&(e(l+n,h+o),f=v(y))}}},AMdQ:function(t,e){t.exports=function(t){!function(t){if(!t)throw new Error("Eventify cannot use falsy object as events subject");for(var e=["on","fire","off"],i=0;i<e.length;++i)if(t.hasOwnProperty(e[i]))throw new Error("Subject cannot be eventified, since it already has property '"+e[i]+"'")}(t);var e=function(t){var e=Object.create(null);return{on:function(i,n,o){if("function"!=typeof n)throw new Error("callback is expected to be a function");var r=e[i];return r||(r=e[i]=[]),r.push({callback:n,ctx:o}),t},off:function(i,n){if(void 0===i)return e=Object.create(null),t;if(e[i])if("function"!=typeof n)delete e[i];else for(var o=e[i],r=0;r<o.length;++r)o[r].callback===n&&o.splice(r,1);return t},fire:function(i){var n,o=e[i];if(!o)return t;arguments.length>1&&(n=Array.prototype.splice.call(arguments,1));for(var r=0;r<o.length;++r){var a=o[r];a.callback.apply(a.ctx,n)}return t}}}(t);return t.on=e.on,t.off=e.off,t.fire=e.fire,t}},AgEI:function(t,e){function i(t){return t.stopPropagation(),!1}function n(){}t.exports=function(t){if(t)return{capture:n,release:n};var e,o,r,a=!1;return{capture:function(t){a=!0,o=window.document.onselectstart,r=window.document.ondragstart,window.document.onselectstart=i,(e=t).ondragstart=i},release:function(){a&&(a=!1,window.document.onselectstart=o,e&&(e.ondragstart=r))}}}},EnSQ:function(t,e,i){"use strict";i.d(e,"a",function(){return k});var n=i("AytR"),o=i("EY2u"),r=i("XNiG"),a=i("quSY");class s extends a.a{constructor(t,e){super()}schedule(t,e=0){return this}}class c extends s{constructor(t,e){super(t,e),this.scheduler=t,this.work=e,this.pending=!1}schedule(t,e=0){if(this.closed)return this;this.state=t;const i=this.id,n=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(n,i,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(n,this.id,e),this}requestAsyncId(t,e,i=0){return setInterval(t.flush.bind(t,this),i)}recycleAsyncId(t,e,i=0){if(null!==i&&this.delay===i&&!1===this.pending)return e;clearInterval(e)}execute(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(t,e);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,e){let i=!1,n=void 0;try{this.work(t)}catch(o){i=!0,n=!!o&&o||new Error(o)}if(i)return this.unsubscribe(),n}_unsubscribe(){const t=this.id,e=this.scheduler,i=e.actions,n=i.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==n&&i.splice(n,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null}}class l extends c{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}schedule(t,e=0){return e>0?super.schedule(t,e):(this.delay=e,this.state=t,this.scheduler.flush(this),this)}execute(t,e){return e>0||this.closed?super.execute(t,e):this._execute(t,e)}requestAsyncId(t,e,i=0){return null!==i&&i>0||null===i&&this.delay>0?super.requestAsyncId(t,e,i):t.flush(this)}}let u=(()=>{class t{constructor(e,i=t.now){this.SchedulerAction=e,this.now=i}schedule(t,e=0,i){return new this.SchedulerAction(this,t).schedule(i,e)}}return t.now=()=>Date.now(),t})();class d extends u{constructor(t,e=u.now){super(t,()=>d.delegate&&d.delegate!==this?d.delegate.now():e()),this.actions=[],this.active=!1,this.scheduled=void 0}schedule(t,e=0,i){return d.delegate&&d.delegate!==this?d.delegate.schedule(t,e,i):super.schedule(t,e,i)}flush(t){const{actions:e}=this;if(this.active)return void e.push(t);let i;this.active=!0;do{if(i=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,i){for(;t=e.shift();)t.unsubscribe();throw i}}}class h extends d{}const b=new h(l);var f=i("7o/Q"),p=i("LRne"),m=i("HDdC");let g=(()=>{class t{constructor(t,e,i){this.kind=t,this.value=e,this.error=i,this.hasValue="N"===t}observe(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}}do(t,e,i){switch(this.kind){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return i&&i()}}accept(t,e,i){return t&&"function"==typeof t.next?this.observe(t):this.do(t,e,i)}toObservable(){switch(this.kind){case"N":return Object(p.a)(this.value);case"E":return t=this.error,new m.a(e=>e.error(t));case"C":return Object(o.b)()}var t;throw new Error("unexpected notification kind value")}static createNext(e){return void 0!==e?new t("N",e):t.undefinedValueNotification}static createError(e){return new t("E",void 0,e)}static createComplete(){return t.completeNotification}}return t.completeNotification=new t("C"),t.undefinedValueNotification=new t("N",void 0),t})();class v extends f.a{constructor(t,e,i=0){super(t),this.scheduler=e,this.delay=i}static dispatch(t){const{notification:e,destination:i}=t;e.observe(i),this.unsubscribe()}scheduleMessage(t){this.destination.add(this.scheduler.schedule(v.dispatch,this.delay,new w(t,this.destination)))}_next(t){this.scheduleMessage(g.createNext(t))}_error(t){this.scheduleMessage(g.createError(t)),this.unsubscribe()}_complete(){this.scheduleMessage(g.createComplete()),this.unsubscribe()}}class w{constructor(t,e){this.notification=t,this.destination=e}}var y=i("9ppp"),S=i("Ylt2");class C extends r.a{constructor(t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,i){super(),this.scheduler=i,this._events=[],this._infiniteTimeWindow=!1,this._bufferSize=t<1?1:t,this._windowTime=e<1?1:e,e===Number.POSITIVE_INFINITY?(this._infiniteTimeWindow=!0,this.next=this.nextInfiniteTimeWindow):this.next=this.nextTimeWindow}nextInfiniteTimeWindow(t){if(!this.isStopped){const e=this._events;e.push(t),e.length>this._bufferSize&&e.shift()}super.next(t)}nextTimeWindow(t){this.isStopped||(this._events.push(new L(this._getNow(),t)),this._trimBufferThenGetEvents()),super.next(t)}_subscribe(t){const e=this._infiniteTimeWindow,i=e?this._events:this._trimBufferThenGetEvents(),n=this.scheduler,o=i.length;let r;if(this.closed)throw new y.a;if(this.isStopped||this.hasError?r=a.a.EMPTY:(this.observers.push(t),r=new S.a(this,t)),n&&t.add(t=new v(t,n)),e)for(let a=0;a<o&&!t.closed;a++)t.next(i[a]);else for(let a=0;a<o&&!t.closed;a++)t.next(i[a].value);return this.hasError?t.error(this.thrownError):this.isStopped&&t.complete(),r}_getNow(){return(this.scheduler||b).now()}_trimBufferThenGetEvents(){const t=this._getNow(),e=this._bufferSize,i=this._windowTime,n=this._events,o=n.length;let r=0;for(;r<o&&!(t-n[r].time<i);)r++;return o>e&&(r=Math.max(r,o-e)),r>0&&n.splice(0,r),n}}class L{constructor(t,e){this.time=t,this.value=e}}var x=i("JIr8"),I=i("fXoL");let R=(()=>{class t{constructor(){this.cache={}}Get(t,e,i=!0){return this.cache[e]||(console.log("CacheService: Request received "+e),this.cache[e]=t.get(e).pipe(function(t,e,i){let n;return n={bufferSize:1,windowTime:void 0,refCount:!1,scheduler:void 0},t=>t.lift(function({bufferSize:t=Number.POSITIVE_INFINITY,windowTime:e=Number.POSITIVE_INFINITY,refCount:i,scheduler:n}){let o,r,a=0,s=!1,c=!1;return function(l){let u;a++,!o||s?(s=!1,o=new C(t,e,n),u=o.subscribe(this),r=l.subscribe({next(t){o.next(t)},error(t){s=!0,o.error(t)},complete(){c=!0,r=void 0,o.complete()}})):u=o.subscribe(this),this.add(()=>{a--,u.unsubscribe(),r&&!c&&i&&0===a&&(r.unsubscribe(),r=void 0,o=void 0)})}}(n))}(),Object(x.a)(t=>(i&&console.log(t),delete this.cache[e],o.a)))),this.cache[e]}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=I.Eb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var M=i("tk/3");let k=(()=>{class t{constructor(t,e,i){this.httpClient=t,this.env=e,this.cache=i,console.log("Using ",e.serverUrl),this.baseUrl=e.serverUrl}get_map_floor(t,e){return this.cache.Get(this.httpClient,this.baseUrl+"/buildings/"+t+"/floors/"+e+"/maps")}get_map_items(t,e,i){return this.cache.Get(this.httpClient,this.baseUrl+"/maps?floor="+(null!=e?e:"")+"&campus="+(null!=t?t:"")+"&building="+(null!=i?i:""))}get_locations_items(t,e,i){return this.cache.Get(this.httpClient,this.baseUrl+"/locations?floor="+(null!=e?e:"")+"&campus="+(null!=t?t:"")+"&building="+(null!=i?i:""))}get_route(t,e){return this.cache.Get(this.httpClient,this.baseUrl+"/navigation/dir?start="+t+"&end="+e)}get_locations_search(t){return this.cache.Get(this.httpClient,this.baseUrl+"/locations?search="+t)}get_location(t){return this.cache.Get(this.httpClient,this.baseUrl+"/locations/"+t)}get_locations(t,e){return this.cache.Get(this.httpClient,this.baseUrl+"/buildings/"+t+"/floors/"+e+"/locations")}get_building(t,e=!0){return this.cache.Get(this.httpClient,this.baseUrl+"/buildings/"+t,e)}get_buildings_search(t=""){return this.cache.Get(this.httpClient,this.baseUrl+"/buildings"+(t?"?name="+t:""))}get_map_item(t){return this.cache.Get(this.httpClient,this.baseUrl+"/maps?pathnodeid="+t)}get_campus(t,e=!0){return this.cache.Get(this.httpClient,this.baseUrl+"/campus/"+t,e)}get_campus_search(t=""){return this.cache.Get(this.httpClient,this.baseUrl+"/campus"+(t?"?search="+t:""))}get_rssFeed(t){return this.httpClient.get(this.baseUrl+"/rssfeed/"+t,{responseType:"text"})}}return t.\u0275fac=function(e){return new(e||t)(I.Tb(M.b),I.Tb(n.a),I.Tb(R))},t.\u0275prov=I.Eb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},QIvw:function(t,e){t.exports=function(){this.x=0,this.y=0,this.scale=1}},Vkd7:function(t,e){function i(t){return t&&t.parentElement&&t.style}t.exports=function(t,e){if(!i(t))throw new Error("panzoom requires DOM element to be attached to the DOM tree");var n=t.parentElement;return t.scrollTop=0,e.disableKeyboardInteraction||n.setAttribute("tabindex",0),{getBBox:function(){return{left:0,top:0,width:t.clientWidth,height:t.clientHeight}},getOwner:function(){return n},applyTransform:function(e){t.style.transformOrigin="0 0 0",t.style.transform="matrix("+e.scale+", 0, 0, "+e.scale+", "+e.x+", "+e.y+")"}}},t.exports.canAttach=i},cQc6:function(t,e){t.exports=function(t,e){for(var i=t[0],n=t[1],o=!1,r=0,a=e.length-1;r<e.length;a=r++){var s=e[r][0],c=e[r][1],l=e[a][1];c>n!=l>n&&i<(e[a][0]-s)*(n-c)/(l-c)+s&&(o=!o)}return o}},dwjH:function(t,e,i){var n=i("0Tit"),o={ease:n(.25,.1,.25,1),easeIn:n(.42,0,1,1),easeOut:n(0,0,.58,1),easeInOut:n(.42,0,.58,1),linear:n(0,0,1,1)};function r(){}function a(){var t=new Set,e=new Set,i=0;return{next:n,cancel:n,clearAll:function(){t.clear(),e.clear(),cancelAnimationFrame(i),i=0}};function n(t){e.add(t),i||(i=requestAnimationFrame(o))}function o(){i=0;var n=e;e=t,(t=n).forEach(function(t){t()}),t.clear()}}t.exports=function(t,e,i){var n=Object.create(null),a=Object.create(null),s="function"==typeof(i=i||{}).easing?i.easing:o[i.easing];s||(i.easing&&console.warn("Unknown easing function in amator: "+i.easing),s=o.ease);var c="function"==typeof i.step?i.step:r,l="function"==typeof i.done?i.done:r,u=function(t){if(!t)return"undefined"!=typeof window&&window.requestAnimationFrame?{next:window.requestAnimationFrame.bind(window),cancel:window.cancelAnimationFrame.bind(window)}:{next:function(t){return setTimeout(t,1e3/60)},cancel:function(t){return clearTimeout(t)}};if("function"!=typeof t.next)throw new Error("Scheduler is supposed to have next(cb) function");if("function"!=typeof t.cancel)throw new Error("Scheduler is supposed to have cancel(handle) function");return t}(i.scheduler),d=Object.keys(e);d.forEach(function(i){n[i]=t[i],a[i]=e[i]-t[i]});var h,b=Math.max(1,.06*("number"==typeof i.duration?i.duration:400)),f=0;return h=u.next(function e(){var i=s(f/b);f+=1,function(e){d.forEach(function(i){t[i]=a[i]*e+n[i]})}(i),f<=b?(h=u.next(e),c(t)):(h=0,setTimeout(function(){l(t)},0))}),{cancel:function(){u.cancel(h),h=0}}},t.exports.makeAggregateRaf=a,t.exports.sharedScheduler=a()},fQX0:function(t,e,i){"use strict";var n=i("fWck"),o=i("dwjH"),r=i("AMdQ"),a=i("6f8I"),s=i("AgEI"),c=s(),l=s(!0),u=i("QIvw"),d=i("wyfB"),h=i("Vkd7");function b(t,e){var i=(e=e||{}).controller;if(i||(d.canAttach(t)?i=d(t,e):h.canAttach(t)&&(i=h(t,e))),!i)throw new Error("Cannot create panzoom for the current type of dom element");var s=i.getOwner(),b={x:0,y:0},p=!1,w=new u;i.initTransform&&i.initTransform(w);var y,S="function"==typeof e.filterKey?e.filterKey:m,C="number"==typeof e.pinchSpeed?e.pinchSpeed:1,L=e.bounds,x="number"==typeof e.maxZoom?e.maxZoom:Number.POSITIVE_INFINITY,I="number"==typeof e.minZoom?e.minZoom:0,R="number"==typeof e.boundsPadding?e.boundsPadding:.05,M="number"==typeof e.zoomDoubleClickSpeed?e.zoomDoubleClickSpeed:1.75,k=e.beforeWheel||m,O=e.beforeMouseDown||m,N="number"==typeof e.zoomSpeed?e.zoomSpeed:1,F=f(e.transformOrigin),P=e.enableTextSelection?l:c;!function(t){var e=typeof t;if("undefined"!==e&&"boolean"!==e&&!(g(t.left)&&g(t.top)&&g(t.bottom)&&g(t.right)))throw new Error("Bounds object is not valid. It can be: undefined, boolean (true|false) or an object {left, top, right, bottom}")}(L),e.autocenter&&function(){var t,e,n=0,o=0,r=Q();if(r)n=r.left,o=r.top,t=r.right-r.left,e=r.bottom-r.top;else{var a=s.getBoundingClientRect();t=a.width,e=a.height}var c=i.getBBox();if(0!==c.width&&0!==c.height){var l=Math.min(t/c.width,e/c.height);w.x=-(c.left+c.width/2)*l+t/2+n,w.y=-(c.top+c.height/2)*l+e/2+o,w.scale=l}}();var D,_,K,T,E,B,A,V,j=0,z=!1,X=!1;E="smoothScroll"in e&&!e.smoothScroll?{start:m,stop:m,cancel:m}:a(function(){return{x:w.x,y:w.y}},function(t,e){xt(),H(t,e)},e.smoothScroll);var G=!1;ot();var J={dispose:function(){rt()},moveBy:nt,moveTo:H,smoothMoveTo:function(t,e){nt(t-w.x,e-w.y,!0)},centerOn:function(t){var e=t.ownerSVGElement;if(!e)throw new Error("ui element is required to be within the scene");var i=t.getBoundingClientRect(),n=i.left+i.width/2,o=i.top+i.height/2,r=e.getBoundingClientRect();nt(r.width/2-n,r.height/2-o,!0)},zoomTo:Lt,zoomAbs:it,smoothZoom:St,smoothZoomAbs:function(t,e,i){var n={scale:w.scale},r={scale:i};E.cancel(),xt(),A=o(n,r,{step:function(i){it(t,e,i.scale)}})},showRectangle:function(t){var e=s.getBoundingClientRect(),i=U(e.width,e.height),n=t.right-t.left,o=t.bottom-t.top;if(!Number.isFinite(n)||!Number.isFinite(o))throw new Error("Invalid rectangle");var r=Math.min(i.x/n,i.y/o);w.x=-(t.left+n/2)*r+i.x/2,w.y=-(t.top+o/2)*r+i.y/2,w.scale=r},pause:function(){rt(),G=!0},resume:function(){G&&(ot(),G=!1)},isPaused:function(){return G},getTransform:function(){return w},getMinZoom:function(){return I},setMinZoom:function(t){I=t},getMaxZoom:function(){return x},setMaxZoom:function(t){x=t},getTransformOrigin:function(){return F},setTransformOrigin:function(t){F=f(t)},getZoomSpeed:function(){return N},setZoomSpeed:function(t){if(!Number.isFinite(t))throw new Error("Zoom speed should be a number");N=t}};r(J);var Y="number"==typeof e.initialX?e.initialX:w.x,Z="number"==typeof e.initialY?e.initialY:w.y,q="number"==typeof e.initialZoom?e.initialZoom:w.scale;return Y==w.x&&Z==w.y&&q==w.Scale||it(Y,Z,q),J;function U(t,e){if(i.getScreenCTM){var n=i.getScreenCTM(),o=n.d,r=n.f;b.x=t*n.a-n.e,b.y=e*o-r}else b.x=t,b.y=e;return b}function H(t,e){w.x=t,w.y=e,$(),Ot("pan"),tt()}function W(t,e){H(w.x+t,w.y+e)}function $(){var t=Q();if(t){var e,n,o=!1,r={left:(n={x:(e=i.getBBox()).left*w.scale+w.x,y:e.top*w.scale+w.y}).x,top:n.y,right:e.width*w.scale+n.x,bottom:e.height*w.scale+n.y},a=t.left-r.right;return a>0&&(w.x+=a,o=!0),(a=t.right-r.left)<0&&(w.x+=a,o=!0),(a=t.top-r.bottom)>0&&(w.y+=a,o=!0),(a=t.bottom-r.top)<0&&(w.y+=a,o=!0),o}}function Q(){if(L){if("boolean"==typeof L){var t=s.getBoundingClientRect(),e=t.width,i=t.height;return{left:e*R,top:i*R,right:e*(1-R),bottom:i*(1-R)}}return L}}function tt(){p=!0,y=window.requestAnimationFrame(at)}function et(t,e,i){if(v(t)||v(e)||v(i))throw new Error("zoom requires valid numbers");var n=w.scale*i;if(n<I){if(w.scale===I)return;i=I/w.scale}if(n>x){if(w.scale===x)return;i=x/w.scale}var o=U(t,e);w.x=o.x-i*(o.x-w.x),w.y=o.y-i*(o.y-w.y),L&&1===R&&1===I?(w.scale*=i,$()):$()||(w.scale*=i),Ot("zoom"),tt()}function it(t,e,i){et(t,e,i/w.scale)}function nt(t,e,i){if(!i)return W(t,e);B&&B.cancel();var n=0,r=0;B=o({x:0,y:0},{x:t,y:e},{step:function(t){W(t.x-n,t.y-r),n=t.x,r=t.y}})}function ot(){s.addEventListener("mousedown",ft,{passive:!1}),s.addEventListener("dblclick",bt,{passive:!1}),s.addEventListener("touchstart",ct,{passive:!1}),s.addEventListener("keydown",st,{passive:!1}),n.addWheelListener(s,wt,{passive:!1}),tt()}function rt(){n.removeWheelListener(s,wt),s.removeEventListener("mousedown",ft),s.removeEventListener("keydown",st),s.removeEventListener("dblclick",bt),s.removeEventListener("touchstart",ct),y&&(window.cancelAnimationFrame(y),y=0),E.cancel(),gt(),vt(),P.release(),Mt()}function at(){p&&(p=!1,i.applyTransform(w),Ot("transform"),y=0)}function st(t){var e=0,i=0,n=0;if(38===t.keyCode?i=1:40===t.keyCode?i=-1:37===t.keyCode?e=1:39===t.keyCode?e=-1:189===t.keyCode||109===t.keyCode?n=1:187!==t.keyCode&&107!==t.keyCode||(n=-1),!S(t,e,i,n)){if(e||i){t.preventDefault(),t.stopPropagation();var o=s.getBoundingClientRect();nt(.05*(r=Math.min(o.width,o.height))*e,.05*r*i)}if(n){var r,a=It(100*n);Lt((r=F?Ct():{x:(c=s.getBoundingClientRect()).width/2,y:c.height/2}).x,r.y,a)}var c}}function ct(t){if(function(t){e.onTouch&&!e.onTouch(t)||(t.stopPropagation(),t.preventDefault())}(t),1===t.touches.length)return function(t){var e=yt(t.touches[0]);D=e;var i=U(e.x,e.y);_=i.x,K=i.y,E.cancel(),lt()}(t);2===t.touches.length&&(T=ht(t.touches[0],t.touches[1]),V=!0,lt())}function lt(){z||(z=!0,document.addEventListener("touchmove",ut),document.addEventListener("touchend",dt),document.addEventListener("touchcancel",dt))}function ut(t){if(1===t.touches.length){t.stopPropagation();var e=U((u=yt(t.touches[0])).x,u.y),i=e.x-_,n=e.y-K;0!==i&&0!==n&&Rt(),_=e.x,K=e.y,nt(i,n)}else if(2===t.touches.length){V=!0;var o=t.touches[0],r=t.touches[1],a=ht(o,r),s=1+(a/T-1)*C,c=yt(o),l=yt(r);if(_=(c.x+l.x)/2,K=(c.y+l.y)/2,F){var u=Ct();_=u.x,K=u.y}Lt(_,K,s),T=a,t.stopPropagation(),t.preventDefault()}}function dt(t){if(t.touches.length>0){var e=U((i=yt(t.touches[0])).x,i.y);_=e.x,K=e.y}else{var i,n=new Date;n-j<300&&(F?St((i=Ct()).x,i.y,M):St(D.x,D.y,M)),j=n,Mt(),vt()}}function ht(t,e){var i=t.clientX-e.clientX,n=t.clientY-e.clientY;return Math.sqrt(i*i+n*n)}function bt(t){!function(t){e.onDoubleClick&&!e.onDoubleClick(t)||(t.preventDefault(),t.stopPropagation())}(t);var i=yt(t);F&&(i=Ct()),St(i.x,i.y,M)}function ft(t){if(!O(t)){if(z)return t.stopPropagation(),!1;if(1===t.button&&null!==window.event||0===t.button){E.cancel();var e=yt(t),i=U(e.x,e.y);return _=i.x,K=i.y,document.addEventListener("mousemove",pt),document.addEventListener("mouseup",mt),P.capture(t.target||t.srcElement),!1}}}function pt(t){if(!z){Rt();var e=yt(t),i=U(e.x,e.y),n=i.x-_,o=i.y-K;_=i.x,K=i.y,nt(n,o)}}function mt(){P.release(),Mt(),gt()}function gt(){document.removeEventListener("mousemove",pt),document.removeEventListener("mouseup",mt),X=!1}function vt(){document.removeEventListener("touchmove",ut),document.removeEventListener("touchend",dt),document.removeEventListener("touchcancel",dt),X=!1,V=!1,z=!1}function wt(t){if(!k(t)){E.cancel();var e=t.deltaY;t.deltaMode>0&&(e*=100);var i=It(e);if(1!==i){var n=F?Ct():yt(t);Lt(n.x,n.y,i),t.preventDefault()}}}function yt(t){var e=s.getBoundingClientRect();return{x:t.clientX-e.left,y:t.clientY-e.top}}function St(t,e,i){var n=w.scale,r={scale:n},a={scale:i*n};E.cancel(),xt(),A=o(r,a,{step:function(i){it(t,e,i.scale)},done:kt})}function Ct(){var t=s.getBoundingClientRect();return{x:t.width*F.x,y:t.height*F.y}}function Lt(t,e,i){return E.cancel(),xt(),et(t,e,i)}function xt(){A&&(A.cancel(),A=null)}function It(t){return 1-Math.sign(t)*Math.min(.25,Math.abs(N*t/128))}function Rt(){X||(Ot("panstart"),X=!0,E.start())}function Mt(){X&&(V||E.stop(),Ot("panend"))}function kt(){Ot("zoomend")}function Ot(t){J.fire(t,J)}}function f(t){if(t)return"object"==typeof t?(g(t.x)&&g(t.y)||p(t),t):void p()}function p(t){throw console.error(t),new Error(["Cannot parse transform origin.","Some good examples:",'  "center center" can be achieved with {x: 0.5, y: 0.5}','  "top center" can be achieved with {x: 0.5, y: 0}','  "bottom right" can be achieved with {x: 1, y: 1}'].join("\n"))}function m(){}function g(t){return Number.isFinite(t)}function v(t){return Number.isNaN?Number.isNaN(t):t!=t}t.exports=b,function(){if("undefined"!=typeof document){var t=document.getElementsByTagName("script");if(t){for(var e,i=0;i<t.length;++i){var n=t[i];if(n.src&&n.src.match(/\bpanzoom(\.min)?\.js/)){e=n;break}}if(e){var o=e.getAttribute("query");if(o){var r=e.getAttribute("name")||"pz",a=Date.now();!function t(){var i=document.querySelector(o);if(!i)return Date.now()-a<2e3?void setTimeout(t,100):void console.error("Cannot find the panzoom element",r);var n=function(t){for(var e=t.attributes,i={},n=0;n<e.length;++n){var o=s(e[n]);o&&(i[o.name]=o.value)}return i}(e);console.log(n),window[r]=b(i,n)}()}}}}function s(t){if(t.name&&"p"===t.name[0]&&"z"===t.name[1]&&"-"===t.name[2])return{name:t.name.substr(3),value:JSON.parse(t.value)}}}()},fWck:function(t,e){function i(t,e,i){t.addEventListener("wheel",e,i)}t.exports=i,t.exports.addWheelListener=i,t.exports.removeWheelListener=function(t,e,i){t.removeEventListener("wheel",e,i)}},sO0u:function(t,e,i){"use strict";i.r(e),i.d(e,"NavigationPageModule",function(){return Tt});var n=i("TEn/"),o=i("tyNb"),r=i("ofXK"),a=i("3Pt+"),s=i("mrSG"),c=i("EnSQ"),l=i("WdNr"),u=i("fXoL");class d{constructor(t){this.icon=t}render(t,e,i,n,o){const r=new Image;r.onload=()=>{t.drawImage(r,e,i,n,o)},r.src="assets/"+this.icon}}var h=i("cQc6");class b{constructor(t){this.mapItem=t,this.doAnim=!1}get MapItem(){return this.mapItem}render(t){this.mapItem.Sections&&this.mapItem.Sections.length>0&&(t.beginPath(),this.renderSections(t),t.strokeStyle="#FFF",t.fillStyle=this.mapItem.Color,t.stroke(),t.fill(),t.closePath())}startAnimation(t,e){this.animationCallback=()=>{if(!0!==this.doAnim)return;t.save();const i=new Date;if(t.beginPath(),this.renderSections(t),t.lineWidth=1,t.strokeStyle=i.getSeconds()%2==0?"#FFF":"#000",t.fillStyle=i.getSeconds()%2==0?"#000":this.mapItem.Color,t.stroke(),t.fill(),t.closePath(),t.restore(),window.requestAnimationFrame(this.animationCallback),void 0!==e&&void 0!==e.renderer&&void 0!==e.floor)for(const n of e.renderer)n.render(t,e)},this.doAnim=!0,window.requestAnimationFrame(this.animationCallback)}stopAnimation(t){this.doAnim=!1,this.animationCallback=null}renderSections(t){t.moveTo(this.mapItem.Sections[0].Start.X,this.mapItem.Sections[0].Start.Y);for(let e=1;e<this.mapItem.Sections.length;e++)t.lineTo(this.mapItem.Sections[e].Start.X,this.mapItem.Sections[e].Start.Y);t.lineTo(this.mapItem.Sections[0].Start.X,this.mapItem.Sections[0].Start.Y)}}class f{constructor(t){this.location=t}get Location(){return this.location}render(t){t.font="12px Arial",t.textAlign="center",t.fillStyle="#000",t.fillText(this.location.Name,this.location.PathNode.Coordinate.X,this.location.PathNode.Coordinate.Y)}startAnimation(t){}stopAnimation(t){}}class p{constructor(t){this.route=t}get Route(){return this.route}render(t,e){const i=new d("pin-sharp.png");this.route.Start.Floor===e.floor&&i.render(t,this.route.Start.Node.Coordinate.X-15,this.route.Start.Node.Coordinate.Y-30,30,30);const n=new d("flag-sharp.png");this.route.End.Floor===e.floor&&n.render(t,this.route.End.Node.Coordinate.X-5,this.route.End.Node.Coordinate.Y-30,30,30);const o=this.route.RouteSections.filter(t=>t.Floor===e.floor);if(null!=o){for(const e of o){t.strokeStyle="#A00",t.lineWidth=3,t.beginPath(),t.moveTo(e.Route[0].Coordinate.X,e.Route[0].Coordinate.Y);for(let i=1;i<e.Route.length;i++)t.lineTo(e.Route[i].Coordinate.X,e.Route[i].Coordinate.Y);t.stroke(),t.closePath()}for(const e of o){const i=e.Route.length,n=e.Distance,o=e.Route[Math.round((i-1)/2)].Coordinate.X,r=e.Route[Math.round((i-1)/2)].Coordinate.Y,a="14px Arial",s=t.measureText(n.toString()).width+14,c=parseInt("14px Arial",10)+14;t.fillStyle="#A00",t.fillRect(o-s/2,r-c/2,s,20),t.font=a,t.fillStyle="#FFF",t.fillText(n.toString(),o,r)}}}startAnimation(t){}stopAnimation(t){}}class m{static GetMapItemRendererCanvas(...t){const e=[];for(const i of t)e.push(new b(i));return e}static GetLocationRendererCanvas(...t){const e=[];for(const i of t)e.push(new f(i));return e}static GetRouteRendererCanvas(...t){const e=[];for(const i of t)e.push(new p(i));return e}}var g=i("fQX0"),v=i.n(g);const w=["fab"];function y(t,e){if(1&t){const t=u.Mb();u.Lb(0,"a",5),u.Xb("click",function(){u.jc(t);const i=e.index;return u.Zb().emitAnotherFloorToShow(i)}),u.Jb(1,"span",6),u.Kb()}if(2&t){const t=e.$implicit,i=u.Zb();u.zb(t===i.currentFloor?"olu-level-control-button-lvl-current":"olu-level-control-button"),u.xb(1),u.ec("innerHTML",t,u.kc)}}let S=(()=>{class t{constructor(t){this.dataService=t,this.floorWithBuilding=new u.o}ngOnInit(){}ngOnChanges(t){return Object(s.a)(this,void 0,void 0,function*(){if(void 0!==t.currentBuilding&&void 0!==this.currentBuilding){const t=yield this.dataService.get_building(this.currentBuilding).toPromise();this.availableFloors=t.Floors.reverse()}})}emitAnotherFloorToShow(t){return Object(s.a)(this,void 0,void 0,function*(){this.floorWithBuilding.emit({floor:this.availableFloors[t],building:this.currentBuilding}),this.currentFloor=this.availableFloors[t]})}}return t.\u0275fac=function(e){return new(e||t)(u.Ib(c.a))},t.\u0275cmp=u.Cb({type:t,selectors:[["floors-bar"]],viewQuery:function(t,e){if(1&t&&u.tc(w,!0),2&t){let t;u.gc(t=u.Yb())&&(e.fab=t.first)}},inputs:{currentBuilding:"currentBuilding",currentFloor:"currentFloor"},outputs:{floorWithBuilding:"floorWithBuilding"},features:[u.vb],decls:6,vars:2,consts:[[1,"level-control-container","leaflet-control","leaflet-bar","olu-level-control-container-full","leaflet-control-layers-list"],[1,"olu-level-control-levels"],[1,"olu-control-levels-building-header"],["data-tooltip","Current Building","data-tooltip-pos","left top"],[3,"class","click",4,"ngFor","ngForOf"],[3,"click"],[3,"innerHTML"]],template:function(t,e){1&t&&(u.Lb(0,"div",0),u.Lb(1,"div",1),u.Lb(2,"a",2),u.Lb(3,"span",3),u.pc(4),u.Kb(),u.Kb(),u.oc(5,y,2,3,"a",4),u.Kb(),u.Kb()),2&t&&(u.xb(4),u.qc(e.currentBuilding),u.xb(1),u.ec("ngForOf",e.availableFloors))},directives:[r.i],styles:[".olu-level-control-levels[_ngcontent-%COMP%]{border-bottom:0;color:var(--ion-color-light,#f4f5f8)!important;line-height:150}.olu-level-control-levels[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{width:46px;padding-bottom:30px;padding-top:8px}.olu-control-levels-building-header[_ngcontent-%COMP%]{color:var(--ion-color-dark-contrast,#f4f5f8)!important;background-color:var(--ion-color-dark,#222428)!important;opacity:.7}.olu-level-control-button[_ngcontent-%COMP%]{background-color:var(--ion-color-primary,#3880ff)!important;color:var(--ion-color-light,#f4f5f8)!important;opacity:.7;cursor:pointer}.olu-level-control-button-lvl-current[_ngcontent-%COMP%]{background-color:var(--ion-color-secondary,#3dc2ff)!important;color:var(--ion-color-dark,#222428)!important;opacity:.7;cursor:pointer}"]}),t})(),C=(()=>{class t{constructor(t){this.dataService=t,this.clickThreshold=20,this.mapItemRenderer=[],this.locationRenderer=[],this.routeRenderer=[],this.locationClick=new u.o,this.mapScroll=new u.o}get CurrentRoute(){return this.currentRoute}get CurrentBuilding(){return this.currentBuilding}ngAfterViewInit(){const t=this;this.panZoomController||(this.panZoomController=v()(document.getElementById("map"),{maxZoom:2,minZoom:.25,initialZoom:.7,bounds:!0,boundsPadding:.1,onTouch(e){return Object(s.a)(this,void 0,void 0,function*(){return 1===e.touches.length&&(yield t.onElementClick(e.touches[0].clientX,e.touches[0].clientY,e.target)),!1})}}))}showRoute(t,e){return Object(s.a)(this,void 0,void 0,function*(){this.stopAllAnimations(),yield this.renderNavigationPage(t,e.Building,e.Floor)})}showDiscoveryLocation(t){return Object(s.a)(this,void 0,void 0,function*(){this.stopAllAnimations();const e=yield this.dataService.get_locations_search(t).toPromise();if(null===e||0===e.length)throw new Error("Studi-Guide can't find "+t);const i=e[0];this.currentBuilding=i.Building;const n=yield this.dataService.get_map_floor(this.currentBuilding,i.Floor).toPromise();this.mapItemRenderer=m.GetMapItemRendererCanvas(...n);const o=yield this.dataService.get_locations(i.Building,i.Floor).toPromise();return this.locationRenderer=m.GetLocationRendererCanvas(...o),this.clearMapCanvas(),this.createNewCanvasMap(),this.renderMapItems(),this.renderLocations(),this.displayPin(i.PathNode),this.currentFloor=i.Floor,this.CenterMap(i.PathNode.Coordinate.X,i.PathNode.Coordinate.Y),i})}showFloor(t,e){return Object(s.a)(this,void 0,void 0,function*(){if(this.stopAllAnimations(),null!=this.currentRoute)yield this.renderNavigationPage(this.currentRoute,this.currentBuilding,t);else{const i=yield this.dataService.get_map_items("",t,e).toPromise();this.mapItemRenderer=m.GetMapItemRendererCanvas(...i),this.createNewCanvasMap();const n=yield this.dataService.get_locations_items("",t,e).toPromise();this.locationRenderer=m.GetLocationRendererCanvas(...n),this.renderMapItems(),this.renderLocations()}this.currentFloor=t,this.currentBuilding=e,this.FitMap()})}showDiscoveryMap(t,e){return Object(s.a)(this,void 0,void 0,function*(){const i=yield this.dataService.get_map_items(t,e,"").toPromise();this.mapItemRenderer=m.GetMapItemRendererCanvas(...i);const n=yield this.dataService.get_locations_items(t,e,"").toPromise();this.locationRenderer=m.GetLocationRendererCanvas(...n),this.createNewCanvasMap(),this.renderMapItems(),this.renderLocations(),this.currentFloor=e,this.FitMap()})}clearMapCanvas(){const t=document.getElementById("map").getContext("2d");null!=t&&t.clearRect(0,0,t.canvas.width,t.canvas.height)}onClick(t){return Object(s.a)(this,void 0,void 0,function*(){yield this.onElementClick(t.clientX,t.clientY,t.target)})}onElementClick(t,e,i){return Object(s.a)(this,void 0,void 0,function*(){const n=this.panZoomController.getTransform(),o=class{static transformInOriginCoordinate(t,e,i){const n=i.getBoundingClientRect(),o=(t.x-n.left)/e,r=(t.y-n.top)/e;return console.log("Transform x:"+t.x+" y:"+t.y+"  to coordinate: x:"+o+" y:"+r),{x:o,y:r}}}.transformInOriginCoordinate({x:t,y:e},n.scale,i),r=[o.x,o.y];if(null!=this.currentRoute){const t=[];for(const e of this.getInteractiveStairWellMapItemRenderer(this.currentFloor))t.push(e.MapItem);for(const e of t){const t=[];for(const i of e.Sections)t.push([i.Start.X,i.Start.Y]);if(h(r,t))return void(yield this.showNextFloor(e))}}for(const t of this.locationRenderer){const e=t.Location;if(Math.abs(e.PathNode.Coordinate.X-r[0])<this.clickThreshold&&Math.abs(e.PathNode.Coordinate.Y-r[1])<this.clickThreshold)return void this.locationClick.emit(e)}})}renderNavigationPage(t,e,i){var n,o;return Object(s.a)(this,void 0,void 0,function*(){let r=null!==(n=yield this.dataService.get_map_floor(e,i).toPromise())&&void 0!==n?n:new Array,a=null!==(o=yield this.dataService.get_locations(e,i).toPromise())&&void 0!==o?o:new Array;for(const n of t.RouteSections)if(n.Floor===i&&n.Building!==e){const t=yield this.dataService.get_map_floor(n.Building,n.Floor).toPromise();r=r.concat(t);const e=yield this.dataService.get_locations(n.Building,n.Floor).toPromise();a=a.concat(e)}this.mapItemRenderer=m.GetMapItemRendererCanvas(...r),this.locationRenderer=m.GetLocationRendererCanvas(...a),this.routeRenderer=m.GetRouteRendererCanvas(t),this.createNewCanvasMap(),this.currentBuilding=e,this.renderMapItems(),this.renderLocations(),this.renderRoutes({floor:i});for(const t of this.getInteractiveStairWellMapItemRenderer(i))t.startAnimation(this.renderingContext,{renderer:this.routeRenderer,floor:i});this.currentRoute=t,this.currentFloor=i})}createNewCanvasMap(){const t=document.getElementById("map");let e=0,i=0;for(const n of this.mapItemRenderer){const t=n.MapItem;if(t.Sections)for(const n of t.Sections)n.End.X>i&&(i=n.End.X),n.End.Y>e&&(e=n.End.Y);if(t.PathNodes)for(const n of t.PathNodes)n.Coordinate.X>i&&(i=n.Coordinate.X),n.Coordinate.Y>e&&(e=n.Coordinate.Y)}this.renderingContext=class{static setup(t,e,i){const n=this.GetPixelRatio();return t.width=e*n,t.height=i*n,t.style.width=e+"px",t.style.height=i+"px",this.getContext(t)}static getContext(t){const e=this.GetPixelRatio(),i=t.getContext("2d");return i.scale(e,e),i}static GetPixelRatio(){return window.devicePixelRatio||1}}.setup(t,i,e)}displayPin(t){const e=t.Coordinate.X-15,i=t.Coordinate.Y-30;new d("pin-sharp.png").render(this.renderingContext,e,i,30,30)}showNextFloor(t){return Object(s.a)(this,void 0,void 0,function*(){for(let e=0;e<this.currentRoute.RouteSections.length-1;e++)if(this.currentRoute.RouteSections[e].Floor===t.Floor&&this.currentRoute.RouteSections[e].Building===t.Building)return this.currentFloor=this.currentRoute.RouteSections[e+1].Floor,this.currentBuilding=this.currentRoute.RouteSections[e+1].Building,void(yield this.showFloor(this.currentFloor,this.currentBuilding))})}getInteractiveStairWellMapItemRenderer(t){const e=[];for(const n of this.routeRenderer)for(let t=0;t<n.Route.RouteSections.length-1;t++)n.Route.RouteSections[t].Building===n.Route.RouteSections[t+1].Building&&e.push(n.Route.RouteSections[t].Route[n.Route.RouteSections[t].Route.length-1]);const i=[];for(const n of e)for(const e of this.mapItemRenderer)e.MapItem.Floor===t&&e.MapItem.PathNodes.filter(t=>t.Id===n.Id).length>0&&i.push(e);return i}stopAllAnimations(){for(const t of this.routeRenderer)t.stopAnimation(this.renderingContext);for(const t of this.mapItemRenderer)t.stopAnimation(this.renderingContext);for(const t of this.locationRenderer)t.stopAnimation(this.renderingContext)}renderMapItems(){for(const t of this.mapItemRenderer)t.render(this.renderingContext)}renderLocations(){for(const t of this.locationRenderer)t.render(this.renderingContext)}renderRoutes(t){for(const e of this.routeRenderer)e.render(this.renderingContext,t)}onFloorChangeByFloorButton(t){return Object(s.a)(this,void 0,void 0,function*(){yield this.showAnotherFloorOfCurrentBuilding(t.floor,t.building)})}showAnotherFloorOfCurrentBuilding(t,e){return Object(s.a)(this,void 0,void 0,function*(){q.progressIsVisible=!0,yield this.showFloor(t,e),q.progressIsVisible=!1})}CenterMap(t,e){const i=this.calulateMovePosition(t,e);this.panZoomController.smoothMoveTo(i.x,i.y)}calulateMovePosition(t,e){const i=document.getElementById("canvas-wrapper");return{x:i.clientWidth/2-t,y:i.parentElement.parentElement.clientHeight/2-e}}MapSize(){return document.getElementById("map").getBoundingClientRect()}FitMap(){const t=this.MapSize();this.CenterMap(t.width/2,t.height/2)}}return t.\u0275fac=function(e){return new(e||t)(u.Ib(c.a))},t.\u0275cmp=u.Cb({type:t,selectors:[["app-map-view"]],outputs:{locationClick:"locationClick",mapScroll:"mapScroll"},decls:4,vars:2,consts:[["id","canvas-wrapper",1,"draggable"],["id","map",3,"click"],["map",""],[3,"currentBuilding","currentFloor","floorWithBuilding"]],template:function(t,e){1&t&&(u.Lb(0,"div",0),u.Lb(1,"canvas",1,2),u.Xb("click",function(t){return e.onClick(t)}),u.Kb(),u.Kb(),u.Lb(3,"floors-bar",3),u.Xb("floorWithBuilding",function(t){return e.onFloorChangeByFloorButton(t)}),u.Kb()),2&t&&(u.xb(3),u.ec("currentBuilding",e.CurrentBuilding)("currentFloor",e.currentFloor))},directives:[S],styles:["body[_ngcontent-%COMP%], html[_ngcontent-%COMP%]{height:100%;width:100%}#canvas-wrapper[_ngcontent-%COMP%]{padding:2px;overflow:hidden;scrollbar-width:none;-ms-overflow-style:none}#canvas-wrapper[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.draggable[_ngcontent-%COMP%]{cursor:-webkit-grab;cursor:grab}.draggable[_ngcontent-%COMP%]:active{cursor:-webkit-grabbing;cursor:grabbing}floors-bar[_ngcontent-%COMP%]{position:absolute;top:12px;right:0}"]}),t})();var L=i("tk/3");const x=["destinationSearchbar"],I=["startSearchBar"];function R(t,e){if(1&t){const t=u.Mb();u.Lb(0,"ion-button",8),u.Xb("click",function(){return u.jc(t),u.Zb().emitDiscoveryEvent()}),u.Jb(1,"ion-icon",9),u.Kb()}}function M(t,e){1&t&&u.Jb(0,"span",10)}function k(t,e){if(1&t){const t=u.Mb();u.Lb(0,"ion-button",5),u.Xb("click",function(){return u.jc(t),u.Zb(2).hideRouteSearchBar()}),u.Jb(1,"ion-icon",14),u.Kb()}}function O(t,e){if(1&t){const t=u.Mb();u.Lb(0,"ion-item",0),u.Lb(1,"ion-searchbar",11,12),u.Xb("click",function(){return u.jc(t),u.Zb().onSearchBarHasFocus("startSearchBar")})("keydown",function(e){return u.jc(t),u.Zb().onKey(e,"startSearchBar")},!1,u.ic),u.Kb(),u.oc(3,k,2,0,"ion-button",13),u.Kb()}if(2&t){const t=u.Zb();u.xb(1),u.ec("value",t.startSearchBarValue),u.xb(2),u.ec("ngIf",t.closeRouteBtnIsVisible)}}let N=(()=>{class t{constructor(){this.discovery=new u.o,this.route=new u.o,this.searchBarFocus=new u.o,this.searchBtnIsVisible=!0,this.routeInputIsVisible=!1,this.closeRouteBtnIsVisible=!1}ngOnInit(){}showRouteSearchBar(){this.routeInputIsVisible=!0,this.searchBtnIsVisible=!1,this.closeRouteBtnIsVisible=!0}hideRouteSearchBar(){this.routeInputIsVisible&&(this.routeInputIsVisible=!1,this.searchBtnIsVisible=!0,this.closeRouteBtnIsVisible=!1)}routeBtnClick(){this.routeInputIsVisible?this.emitRouteEvent():this.showRouteSearchBar()}emitDiscoveryEvent(){let t=""===this.destinationSearchbar.value||void 0===this.destinationSearchbar.value;if(t=t||null===this.destinationSearchbar.value,!t){const t=document.activeElement;t&&t.blur&&t.blur(),this.discovery.emit(this.destinationSearchbar.value)}}emitRouteEvent(){let t=""===this.destinationSearchbar.value||void 0===this.destinationSearchbar.value;t=t||null===this.destinationSearchbar.value;let e=""===this.startSearchBar.value||void 0===this.startSearchBar.value;if(e=e||null===this.startSearchBar.value,!t&&!e){const t=[this.startSearchBar.value,this.destinationSearchbar.value],e=document.activeElement;e&&e.blur&&e.blur(),this.route.emit(t)}}clearDestinationInput(){this.destinationSearchbar.value=""}clearStartInput(){this.startSearchBar.value=""}setDiscoverySearchbarValue(t){this.destinationSearchbarValue=t}setStartSearchbarValue(t){this.startSearchBarValue=t}onSearchBarHasFocus(t){this.searchBarFocus.emit(t)}onKey(t,e){"Enter"===t.key&&("destinationSearchbar"===e&&this.emitDiscoveryEvent(),"startSearchBar"===e&&this.emitRouteEvent())}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=u.Cb({type:t,selectors:[["app-search-input"]],viewQuery:function(t,e){if(1&t&&(u.tc(x,!0),u.tc(I,!0)),2&t){let t;u.gc(t=u.Yb())&&(e.destinationSearchbar=t.first),u.gc(t=u.Yb())&&(e.startSearchBar=t.first)}},outputs:{discovery:"discovery",route:"route",searchBarFocus:"searchBarFocus"},decls:8,vars:4,consts:[["lines","none"],["search-icon","navigate-circle-outline","inputmode","text","mode","ios","placeholder","destination","color","","icon-color","dark",3,"value","click","keydown"],["destinationSearchbar",""],["size","default","mode","ios","color","medium",3,"click",4,"ngIf"],["class","vertical-line",4,"ngIf"],["size","default","mode","ios","color","primary",3,"click"],["size","large","slot","icon-only","src","assets/navigation-svgs/directions-24px.svg"],["lines","none",4,"ngIf"],["size","default","mode","ios","color","medium",3,"click"],["size","large","slot","icon-only","name","search","color",""],[1,"vertical-line"],["animated","true","color","","icon-color","dark","inputmode","text","mode","ios","placeholder","start","search-icon","locate-outline",3,"value","click","keydown"],["startSearchBar",""],["size","default","mode","ios","color","primary",3,"click",4,"ngIf"],["size","large","slot","icon-only","name","close-outline"]],template:function(t,e){1&t&&(u.Lb(0,"ion-item",0),u.Lb(1,"ion-searchbar",1,2),u.Xb("click",function(){return e.onSearchBarHasFocus("destinationSearchbar")})("keydown",function(t){return e.onKey(t,"destinationSearchbar")},!1,u.ic),u.Kb(),u.oc(3,R,2,0,"ion-button",3),u.oc(4,M,1,0,"span",4),u.Lb(5,"ion-button",5),u.Xb("click",function(){return e.routeBtnClick()}),u.Jb(6,"ion-icon",6),u.Kb(),u.Kb(),u.oc(7,O,4,2,"ion-item",7)),2&t&&(u.xb(1),u.ec("value",e.destinationSearchbarValue),u.xb(2),u.ec("ngIf",e.searchBtnIsVisible),u.xb(1),u.ec("ngIf",e.searchBtnIsVisible),u.xb(3),u.ec("ngIf",e.routeInputIsVisible))},directives:[n.v,n.J,n.eb,r.j,n.h,n.t],styles:["ion-searchbar[_ngcontent-%COMP%]{max-width:300px}"]}),t})();var F=i("+JbE"),P=i("YD5U");class D{constructor(t){this._campus=t,this._addressString=this.getAddressString(this._campus)}get Address(){return this._addressString}get Name(){return this._campus.Name}get ShortName(){return this._campus.ShortName}get LatLng(){return{lat:this._campus.Latitude,lng:this._campus.Longitude}}getAddressString(t){let e="";if(null!==t.edges.Address){const i=_(t.edges.Address,t=>t.Street);for(const t of Object.keys(i)){const n=i[t];""!==e&&(e+="; ");let o=n[0].Number;n.length>1&&(o+="-"+n[n.length-1].Number),e+=t+" "+o+", ",e+=i[t][0].PLZ+" "+i[t][0].City}}return e}}const _=(t,e)=>t.reduce((t,i)=>{const n=e(i);return t[n]||(t[n]=[]),t[n].push(i),t},{});var K=i("e8h1");let T=(()=>{class t{constructor(t){this.storage=t}addRecentSearch(e){return Object(s.a)(this,void 0,void 0,function*(){let i=yield this.readRecentSearches();null!==i&&0!==i.length||(i=[]);let n=-1;for(let t=0;t<i.length;t++)if(i[t].Name===e.Name){n=t;break}n>=0&&i.splice(n,1),i.unshift(e),i.length>3&&i.pop(),yield this.storage.set(t.recentSearchesKey,JSON.stringify([i])),console.log(i)})}readRecentSearches(){return Object(s.a)(this,void 0,void 0,function*(){const e=JSON.parse(yield this.storage.get(t.recentSearchesKey));if(!e)return[];const i=[];for(const t of e[0])(null==t?void 0:t.Name)&&i.push(t);return i})}}return t.recentSearchesKey="searches",t.\u0275fac=function(e){return new(e||t)(u.Tb(K.b))},t.\u0275prov=u.Eb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),E=(()=>{class t{constructor(t){this.recentSearchesService=t,this.recentSearchesVar=[],this.availableCampus=[],this.Route={Start:{Name:"",LatLng:{lat:0,lng:0}},Destination:{Name:"",LatLng:{lat:0,lng:0}},Coordinates:[],Distance:0,NavigationInstructions:[],Time:0},this.recentSearchesService.readRecentSearches().then(t=>{this.recentSearchesVar=t})}get latestSearchResult(){return void 0!==this.recentSearches[0]?this.recentSearches[0]:{Name:"",Description:"",Information:[],DetailRouterParams:{},RouteRouterParams:{},LatLng:{lat:0,lng:0}}}get recentSearches(){return this.recentSearchesVar}addRecentSearch(t){return Object(s.a)(this,void 0,void 0,function*(){yield this.recentSearchesService.addRecentSearch(t),this.recentSearchesVar=yield this.recentSearchesService.readRecentSearches()})}addRecentSearchCampus(t){return Object(s.a)(this,void 0,void 0,function*(){const e={Name:t.Name,Description:t.ShortName,Information:[["ShortName: ",t.ShortName],["Longitude: ",t.Longitude],["Latitude: ",t.Latitude]],DetailRouterParams:{},RouteRouterParams:{},LatLng:{lat:t.Latitude,lng:t.Longitude}};yield this.addRecentSearch(e)})}addRecentSearchBuilding(t,e){return Object(s.a)(this,void 0,void 0,function*(){const i={Name:t.Name,Description:"Campus:"+t.Campus,Information:[],DetailRouterParams:{building:t.Name},RouteRouterParams:{},LatLng:e};yield this.addRecentSearch(i)})}addRecentSearchLocation(t,e){return Object(s.a)(this,void 0,void 0,function*(){const i=[["Building: ",t.Name]];t.Tags&&i.push(["Tags: ",t.Tags.join(", ")]);const n={Name:t.Name,Description:t.Description,Information:i,DetailRouterParams:{location:t.Name},RouteRouterParams:{start:t.Building+".Entrance",destination:t.Name},LatLng:e};yield this.addRecentSearch(n)})}SetOsmRouteAsRoute(t,e,i){const n=[];for(const o of t.Points.Coordinates)n.push([o.Lat,o.Lng]);this.Route={Start:e,Destination:i,Coordinates:n,Distance:Math.round(t.Distance),NavigationInstructions:t.Instructions,Time:Math.round(t.Time/1e3/60)}}ClearRoute(){this.Route={Start:{Name:"",LatLng:{lat:0,lng:0}},Destination:{Name:"",LatLng:{lat:0,lng:0}},Distance:0,Coordinates:[],NavigationInstructions:[],Time:0}}}return t.\u0275fac=function(e){return new(e||t)(u.Tb(T))},t.\u0275prov=u.Eb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var B=i("gcOT");const A=["drawerContent"],V=["searchDrawer"],j=["locationDrawer"];function z(t,e){1&t&&u.Jb(0,"ion-progress-bar",30)}function X(t,e){if(1&t&&(u.Lb(0,"ion-text",31),u.Lb(1,"h5"),u.Lb(2,"span",32),u.pc(3),u.Kb(),u.Kb(),u.Lb(4,"p"),u.Pb(5,33),u.Kb(),u.Lb(6,"p"),u.Sb(7,34),u.Jb(8,"br"),u.Jb(9,"a",35),u.Qb(),u.Kb(),u.Kb()),2&t){const t=u.Zb();u.xb(3),u.qc(t.errorMessage)}}function G(t,e){if(1&t){const t=u.Mb();u.Lb(0,"ion-item",38),u.Xb("click",function(){u.jc(t);const i=e.$implicit;return u.Zb(2).recentSearchClick(i.Name)}),u.Lb(1,"ion-text"),u.pc(2),u.Kb(),u.Kb()}if(2&t){const t=e.$implicit;u.xb(2),u.qc(t.Name)}}function J(t,e){if(1&t&&(u.Lb(0,"ion-list",36),u.Lb(1,"ion-list-header"),u.pc(2," Recent Searches "),u.Kb(),u.oc(3,G,3,1,"ion-item",37),u.Kb()),2&t){const t=u.Zb();u.xb(3),u.ec("ngForOf",t.model.recentSearches)}}function Y(t,e){if(1&t&&(u.Lb(0,"ion-row"),u.Lb(1,"ion-col"),u.pc(2),u.Kb(),u.Lb(3,"ion-col"),u.pc(4),u.Kb(),u.Kb()),2&t){const t=e.$implicit;u.xb(2),u.qc(t[0]),u.xb(2),u.qc(t[1])}}const{Keyboard:Z}=B.a;let q=(()=>{class t{constructor(t,e,i,n,o,r){this.dataService=t,this.modalCtrl=e,this.route=i,this.router=n,this.model=o,this.platform=r,this.availableCampus=[],this.isSubscripted=!1}ngAfterViewInit(){this.locationDrawer.SetState(F.a.Hidden),this.searchDrawer.SetState(P.a.GetRecommendedDrawerStateForDevice())}ionViewDidEnter(){!1===this.isSubscripted&&(this.isSubscripted=!0,this.route.queryParams.subscribe(t=>Object(s.a)(this,void 0,void 0,function*(){var e;if(null!=t&&null!=t.location&&t.location.length>0)return this.searchInput.setDiscoverySearchbarValue(t.location),void(yield this.onDiscovery(t.location));if(null!=t&&null!=t.start&&t.start.length>0&&null!=t.destination&&t.destination.length>0)yield this.showNavigation(t.start,t.destination);else if(null!=t&&null!=t.building&&t.building.length>0){const i=yield this.dataService.get_building(t.building).toPromise();null!==i&&(yield this.mapView.showFloor((null===(e=i.Floors)||void 0===e?void 0:e.includes("EG"))?"EG":i.Floors[0],i.Name))}else yield this.showDiscoveryMode()})))}ngOnInit(){return Object(s.a)(this,void 0,void 0,function*(){if(0===this.model.availableCampus.length){const t=yield this.dataService.get_campus_search().toPromise();for(const e of t)this.model.availableCampus.push(new D(e))}})}onDiscovery(e){return Object(s.a)(this,void 0,void 0,function*(){this.model.errorMessage="",t.progressIsVisible=!0;try{const i=yield this.mapView.showDiscoveryLocation(e);yield this.model.addRecentSearchLocation(i,{lat:0,lng:0}),yield this.showLocationDrawer(i)}catch(i){this.handleInputError(i,e)}finally{t.progressIsVisible=!1}})}onRoute(e){return Object(s.a)(this,void 0,void 0,function*(){this.errorMessage="",t.progressIsVisible=!0;try{const i=yield this.dataService.get_location(e[0]).toPromise(),n=yield this.dataService.get_route(e[0],e[1]).toPromise();yield this.mapView.showRoute(n,i),this.mapView.CenterMap(i.PathNode.Coordinate.X,i.PathNode.Coordinate.Y)}catch(i){let t="";if(i instanceof L.d){const n=i.error.message;n.includes(e[0])&&(t=e[0]),n.includes(e[1])&&(t.length>0&&(t+=" and "),t+=e[1])}this.handleInputError(i,0===t.length?e.toString():t)}finally{t.progressIsVisible=!1}})}onDrawerStateChange(t){void 0!==this.drawerContent&&(this.drawerContent.scrollY=t===F.a.Top)}showLocationDrawer(t){return Object(s.a)(this,void 0,void 0,function*(){yield this.locationDrawer.SetState(F.a.Hidden),this.model.latestSearchResult.Name=t.Name,this.model.latestSearchResult.Description=t.Description,this.model.latestSearchResult.Information=t.Tags?[["Tags: ",t.Tags.join(",")]]:[],this.platform.is("hybrid")&&(yield Z.hide()),yield this.searchDrawer.SetState(F.a.Hidden),yield this.locationDrawer.SetState(P.a.GetRecommendedDrawerStateForDevice())})}onCloseLocationDrawer(t){return Object(s.a)(this,void 0,void 0,function*(){yield this.locationDrawer.SetState(F.a.Hidden),yield this.searchDrawer.SetState(P.a.GetRecommendedDrawerStateForDevice())})}presentAvailableFloorModal(){return Object(s.a)(this,void 0,void 0,function*(){let t=new Array,e=yield this.dataService.get_buildings_search().toPromise();e=e.filter((t,i)=>e.indexOf(t)===i);for(const o of e){const e=yield this.dataService.get_building(o.Name).toPromise();t=t.concat(e.Floors)}t=t.filter((e,i)=>t.indexOf(e)===i);const i=yield this.modalCtrl.create({component:l.a,cssClass:"floor-modal",componentProps:{floors:t}});yield i.present();const n=yield i.onDidDismiss();n.data&&(yield this.mapView.showAnotherFloorOfCurrentBuilding(n.data,this.mapView.CurrentBuilding))})}handleInputError(t,e){if(console.log(t),t instanceof L.d){const i=t;this.errorMessage=400===i.status?"Studi-Guide can't find "+e:i.message}else this.errorMessage=t.message;null!=this.mapView&&this.mapView.clearMapCanvas()}navigationBtnClick(){return Object(s.a)(this,void 0,void 0,function*(){if(null!=this.model.latestSearchResult)try{const e=yield this.dataService.get_location(this.model.latestSearchResult.Name).toPromise();yield this.showNavigation(e.Building+".Entrance",e.Name)}catch(e){let t="";e instanceof L.d&&e.error.message.includes(this.model.latestSearchResult.Name)&&(t=this.model.latestSearchResult.Name),this.handleInputError(e,0===t.length?this.model.latestSearchResult.Name:t)}finally{t.progressIsVisible=!1}})}showNavigation(t,e){return Object(s.a)(this,void 0,void 0,function*(){this.searchInput.showRouteSearchBar(),this.searchInput.setDiscoverySearchbarValue(e),this.searchInput.setStartSearchbarValue(t),yield this.onCloseLocationDrawer(null),yield this.onRoute([t,e])})}showDiscoveryMode(){return Object(s.a)(this,void 0,void 0,function*(){null==this.mapView.CurrentRoute&&null==this.mapView.CurrentBuilding&&(yield this.mapView.showDiscoveryMap("","EG"),this.mapView.CenterMap(310,550))})}recentSearchClick(t){return Object(s.a)(this,void 0,void 0,function*(){yield this.router.navigate(["tabs/navigation/detail"],{queryParams:{location:t}})})}presentMapPage(){return Object(s.a)(this,void 0,void 0,function*(){yield this.router.navigate(["tabs/navigation/"])})}get ProgressIsVisible(){return t.progressIsVisible}}return t.progressIsVisible=!1,t.\u0275fac=function(e){return new(e||t)(u.Ib(c.a),u.Ib(n.Y),u.Ib(o.a),u.Ib(o.g),u.Ib(E),u.Ib(n.ab))},t.\u0275cmp=u.Cb({type:t,selectors:[["app-navigation"]],viewQuery:function(t,e){if(1&t&&(u.tc(C,!0),u.tc(N,!0),u.tc(A,!0),u.tc(V,!0),u.tc(j,!0)),2&t){let t;u.gc(t=u.Yb())&&(e.mapView=t.first),u.gc(t=u.Yb())&&(e.searchInput=t.first),u.gc(t=u.Yb())&&(e.drawerContent=t.first),u.gc(t=u.Yb())&&(e.searchDrawer=t.first),u.gc(t=u.Yb())&&(e.locationDrawer=t.first)}},decls:51,vars:6,consts:function(){let t,e;return t="Make sure your search is spelled correctly.",e="Should this place be on Studi-Guide? " + "\ufffd#8\ufffd\ufffd/#8\ufffd" + "" + "\ufffd#9\ufffd" + "Request a missing place" + "\ufffd/#9\ufffd" + "",[["translucent",""],["slot","start"],["id","close-open-map","defaultHref","/"],["data-tap-disabled","true","scroll-y","false"],["type","indeterminate","color","secondary",4,"ngIf"],["id","map-content"],["id","error-message",4,"ngIf"],[3,"locationClick"],[3,"stateChange"],["searchDrawer",""],[1,"nav-bottom-drawer"],[1,"drawer-grip"],[1,"ion-padding-top"],[1,"nav-hbar"],[3,"discovery","route"],["drawerContent",""],["class","ion-no-padding",4,"ngIf"],[1,"ion-padding-vertical"],["state","DrawerState.Hidden"],["locationDrawer",""],[1,"ion-padding-bottom"],["id","locationdrawerContent"],[1,"ion-justify-content-between","ion-align-self-center"],["size","auto"],["id","locationdrawerName"],[1,"ion-justify-content-end","ion-padding-horizontal"],["shape","round","color","medium",1,"square-sm","ion-no-padding","ion-float-right",3,"click"],["slot","icon-only","name","close-outline","size","small"],["id","routeBtn","color","primary","expand","block",3,"click"],[4,"ngFor","ngForOf"],["type","indeterminate","color","secondary"],["id","error-message"],[1,"error"],t,e,["href","https://github.com/Studi-Guide/Studi-Guide/issues/new/choose"],[1,"ion-no-padding"],["button","",3,"click",4,"ngFor","ngForOf"],["button","",3,"click"]]},template:function(t,e){1&t&&(u.Lb(0,"ion-header",0),u.Lb(1,"ion-toolbar"),u.Lb(2,"ion-buttons",1),u.Jb(3,"ion-back-button",2),u.Kb(),u.Kb(),u.Kb(),u.Lb(4,"ion-content",3),u.oc(5,z,1,0,"ion-progress-bar",4),u.Lb(6,"div",5),u.oc(7,X,10,1,"ion-text",6),u.Lb(8,"app-map-view",7),u.Xb("locationClick",function(t){return e.showLocationDrawer(t)}),u.Kb(),u.Kb(),u.Kb(),u.Lb(9,"app-ionic-bottom-drawer",8,9),u.Xb("stateChange",function(t){return e.onDrawerStateChange(t)}),u.Lb(11,"div",10),u.Lb(12,"div",11),u.Jb(13,"div",12),u.Jb(14,"div",13),u.Lb(15,"app-search-input",14),u.Xb("discovery",function(t){return e.onDiscovery(t)})("route",function(t){return e.onRoute(t)}),u.Kb(),u.Kb(),u.Lb(16,"ion-content",null,15),u.oc(18,J,4,1,"ion-list",16),u.Jb(19,"div",17),u.Jb(20,"div",17),u.Jb(21,"div",17),u.Jb(22,"div",17),u.Jb(23,"div",17),u.Jb(24,"div",17),u.Kb(),u.Kb(),u.Kb(),u.Lb(25,"app-ionic-bottom-drawer",18,19),u.Lb(27,"div",10),u.Lb(28,"div",11),u.Jb(29,"div",12),u.Jb(30,"div",13),u.Jb(31,"div",20),u.Kb(),u.Lb(32,"ion-content"),u.Lb(33,"ion-grid",21),u.Lb(34,"ion-row",22),u.Lb(35,"ion-col",23),u.Lb(36,"ion-text",24),u.pc(37),u.Kb(),u.Kb(),u.Lb(38,"ion-col",25),u.Lb(39,"ion-button",26),u.Xb("click",function(t){return e.onCloseLocationDrawer(t)}),u.Jb(40,"ion-icon",27),u.Kb(),u.Kb(),u.Kb(),u.Lb(41,"ion-row"),u.Lb(42,"ion-col"),u.Lb(43,"ion-button",28),u.Xb("click",function(){return e.navigationBtnClick()}),u.pc(44," Route "),u.Kb(),u.Kb(),u.Kb(),u.Lb(45,"ion-row"),u.Lb(46,"ion-col"),u.pc(47,"Description:"),u.Kb(),u.Lb(48,"ion-col"),u.pc(49),u.Kb(),u.Kb(),u.oc(50,Y,5,2,"ion-row",29),u.Kb(),u.Kb(),u.Kb(),u.Kb()),2&t&&(u.xb(5),u.ec("ngIf",e.ProgressIsVisible),u.xb(2),u.ec("ngIf",e.errorMessage),u.xb(11),u.ec("ngIf",e.model.recentSearches.length>0),u.xb(19),u.qc(e.model.latestSearchResult.Name),u.xb(12),u.qc(e.model.latestSearchResult.Description),u.xb(1),u.ec("ngForOf",e.model.latestSearchResult.Information))},styles:["#map-content[_ngcontent-%COMP%]{height:100%;width:100%;position:fixed}.error[_ngcontent-%COMP%]{color:red}#error-message[_ngcontent-%COMP%]{margin-left:20px}#available-floors-btn[_ngcontent-%COMP%]{position:fixed;bottom:0;display:block;z-index:10}.center[_ngcontent-%COMP%]{margin-left:auto;margin-right:auto;display:block}ion-progress-bar[_ngcontent-%COMP%]{position:absolute;z-index:9999}.vertical-line[_ngcontent-%COMP%]{border-left:2px solid #9d9fa6;height:38px}.nav-hbar[_ngcontent-%COMP%]{border-top:2px solid var(--ion-color-medium,#9d9fa6);border-bottom:2px solid var(--ion-color-medium,#9d9fa6);border-radius:2px;height:0;width:auto;margin:0 45%}.nav-bottom-drawer[_ngcontent-%COMP%]{background-color:#fff;border-top-left-radius:20px;border-top-right-radius:20px;box-shadow:0 4px 8px 0 rgba(0,0,0,.4),0 6px 20px 0 rgba(0,0,0,.29);height:inherit;z-index:1}.square-md[_ngcontent-%COMP%]{height:64px;width:64px}.square-sm[_ngcontent-%COMP%]{height:32px;width:32px}.square-xs[_ngcontent-%COMP%]{height:16px;width:16px}#locationdrawerContent[_ngcontent-%COMP%]{margin-left:30px;margin-right:30px;position:center}#locationdrawerName[_ngcontent-%COMP%]{font-weight:700}"]}),t})(),U=(()=>{class t{}return t.\u0275mod=u.Gb({type:t}),t.\u0275inj=u.Fb({factory:function(e){return new(e||t)},imports:[[r.b,n.V]]}),t})();var H=i("4R65"),W=i("Bfh1"),$=i("AytR");let Q=(()=>{class t{constructor(t,e,i){this.locale=t,this.httpClient=e,this.env=i}GetRoute(e,i){return Object(s.a)(this,void 0,void 0,function*(){return yield this.httpClient.get(this.env.serverUrl+t.serverPathPrefix+t.routePath+"?start="+e.lat+","+e.lng+"&end="+i.lat+","+i.lng+"&locale="+this.locale).toPromise()})}GetBounds(){return Object(s.a)(this,void 0,void 0,function*(){return yield this.httpClient.get(this.env.serverUrl+t.serverPathPrefix+t.boundsPath).toPromise()})}}return t.serverPathPrefix="/osm",t.routePath="/route",t.boundsPath="/bounds",t.\u0275fac=function(e){return new(e||t)(u.Tb(u.v),u.Tb(L.b),u.Tb($.a))},t.\u0275prov=u.Eb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const tt=["ionSlides"];function et(t,e){if(1&t&&(u.Lb(0,"ion-slide"),u.Lb(1,"ion-text"),u.Lb(2,"h2"),u.pc(3),u.Kb(),u.Lb(4,"p"),u.pc(5),u.Kb(),u.Kb(),u.Kb()),2&t){const t=e.$implicit;u.xb(3),u.qc(t.Text),u.xb(2),u.rc("",t.Distance,"m")}}let it=(()=>{class t{constructor(t){this.element=t,this.nextSlide=new u.o,this.previousSlide=new u.o,this.slideOpts={initialSlide:0,speed:400}}ngOnInit(){this.hide()}onPrevSlide(){return Object(s.a)(this,void 0,void 0,function*(){this.previousSlide.emit(yield this.ionSlides.getActiveIndex())})}onNextSlide(){return Object(s.a)(this,void 0,void 0,function*(){this.nextSlide.emit(yield this.ionSlides.getActiveIndex())})}hide(){return Object(s.a)(this,void 0,void 0,function*(){this.element.nativeElement.hidden=!0})}show(){return Object(s.a)(this,void 0,void 0,function*(){this.element.nativeElement.hidden=!1})}}return t.\u0275fac=function(e){return new(e||t)(u.Ib(u.m))},t.\u0275cmp=u.Cb({type:t,selectors:[["app-navigation-instruction-slides"]],viewQuery:function(t,e){if(1&t&&u.tc(tt,!0),2&t){let t;u.gc(t=u.Yb())&&(e.ionSlides=t.first)}},inputs:{instructions:"instructions"},outputs:{nextSlide:"nextSlide",previousSlide:"previousSlide"},decls:3,vars:2,consts:[["pager","true",3,"options","ionSlideNextEnd","ionSlidePrevEnd"],["ionSlides",""],[4,"ngFor","ngForOf"]],template:function(t,e){1&t&&(u.Lb(0,"ion-slides",0,1),u.Xb("ionSlideNextEnd",function(){return e.onNextSlide()})("ionSlidePrevEnd",function(){return e.onPrevSlide()}),u.oc(2,et,6,2,"ion-slide",2),u.Kb()),2&t&&(u.ec("options",e.slideOpts),u.xb(2),u.ec("ngForOf",e.instructions))},directives:[n.N,r.i,n.M,n.R],styles:["[_nghost-%COMP%]{z-index:auto}ion-slide[_ngcontent-%COMP%]{height:100%;width:100%}@media (min-width:992px){ion-slide[_ngcontent-%COMP%]{padding-bottom:2em}}@media (max-width:991.98px){ion-slide[_ngcontent-%COMP%]{padding-bottom:.5em}}"]}),t})(),nt=(()=>{class t{static persist(t,e){return Object(s.a)(this,void 0,void 0,function*(){yield t.set(this.LAST_MAP_EVENT_KEY,e)})}load(e,i,n){return Object(s.a)(this,void 0,void 0,function*(){e.ready().then(()=>Object(s.a)(this,void 0,void 0,function*(){yield e.get(t.LAST_MAP_EVENT_KEY).then(t=>{i.setView([49.452368,11.093299],n),null!=t&&i.flyTo(t.center,t.zoom)})}))})}}return t.LAST_MAP_EVENT_KEY="lastOpenStreetMapEventTarget",t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=u.Eb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const ot=["inputFrom"],rt=["inputTo"];function at(t,e){if(1&t){const t=u.Mb();u.Lb(0,"ion-item",10),u.Xb("click",function(){return u.jc(t),u.Zb().listMyLocationClick()}),u.Lb(1,"ion-text"),u.pc(2,"My Location"),u.Kb(),u.Kb()}}function st(t,e){if(1&t){const t=u.Mb();u.Lb(0,"ion-item",10),u.Xb("click",function(){u.jc(t);const i=e.$implicit;return u.Zb().listRecentSearchClick(i)}),u.Lb(1,"ion-text"),u.pc(2),u.Kb(),u.Kb()}if(2&t){const t=e.$implicit;u.xb(2),u.qc(t.Name)}}var ct=function(t){return t[t.No=0]="No",t[t.From=1]="From",t[t.To=2]="To",t}({});let lt=(()=>{class t{constructor(t,e){this.model=t,this.geolocation=e,this.inputToCurrentlyActive=!1,this.myLocationInInput=ct.From}ngOnInit(){}ngAfterViewInit(){return Object(s.a)(this,void 0,void 0,function*(){this.UpdateFromNavigationModel(),this.inputToCurrentlyActive=!1,yield this.inputFrom.setFocus()})}SetFocus(){return Object(s.a)(this,void 0,void 0,function*(){this.inputToCurrentlyActive?yield this.inputTo.setFocus():yield this.inputFrom.setFocus()})}toggleActiveInput(){return Object(s.a)(this,void 0,void 0,function*(){this.inputToCurrentlyActive=!this.inputToCurrentlyActive,yield this.SetFocus()})}updateInputValues(){this.inputFrom.value=this.routeLocationFrom.Name,this.inputTo.value=this.routeLocationTo.Name}UpdateFromNavigationModel(){this.routeLocationFrom=this.model.Route.Start,this.routeLocationTo=this.model.Route.Destination,this.updateInputValues()}showMyLocation(){return this.myLocationInInput===ct.No}onInputFromFocus(){this.inputToCurrentlyActive=!1}onInputToFocus(){this.inputToCurrentlyActive=!0}swapInputs(){const t=this.routeLocationFrom;this.routeLocationFrom=this.routeLocationTo,this.routeLocationTo=t,this.myLocationInInput!==ct.No&&(this.myLocationInInput=this.myLocationInInput===ct.From?ct.To:ct.From),this.updateInputValues()}listRecentSearchClick(t){return Object(s.a)(this,void 0,void 0,function*(){this.inputToCurrentlyActive?(this.routeLocationTo=t,this.myLocationInInput===ct.To&&(this.myLocationInInput=ct.No)):(this.routeLocationFrom=t,this.myLocationInInput===ct.From&&(this.myLocationInInput=ct.No)),this.updateInputValues(),yield this.toggleActiveInput()})}listMyLocationClick(){return Object(s.a)(this,void 0,void 0,function*(){const t=yield this.geolocation.getCurrentPosition(),e={Name:"My Location",LatLng:{lat:t.coords.latitude,lng:t.coords.longitude}};this.inputToCurrentlyActive?(this.routeLocationTo=e,this.myLocationInInput=ct.To):(this.routeLocationFrom=e,this.myLocationInInput=ct.From),this.updateInputValues(),yield this.toggleActiveInput()})}get From(){return this.routeLocationFrom}get To(){return this.routeLocationTo}}return t.\u0275fac=function(e){return new(e||t)(u.Ib(E),u.Ib(W.a))},t.\u0275cmp=u.Cb({type:t,selectors:[["app-route-input"]],viewQuery:function(t,e){if(1&t&&(u.tc(ot,!0),u.tc(rt,!0)),2&t){let t;u.gc(t=u.Yb())&&(e.inputFrom=t.first),u.gc(t=u.Yb())&&(e.inputTo=t.first)}},decls:21,vars:2,consts:[[1,"container"],["size","11"],[3,"ionFocus"],["inputFrom",""],["inputTo",""],["size","1",1,"swappicon","ion-activatable","ripple-parent",3,"click"],["size","large","name","swap-vertical-outline"],[1,"ion-no-padding"],["button","",3,"click",4,"ngIf"],["button","",3,"click",4,"ngFor","ngForOf"],["button","",3,"click"]],template:function(t,e){1&t&&(u.Lb(0,"div",0),u.Lb(1,"ion-grid"),u.Lb(2,"ion-row"),u.Lb(3,"ion-col",1),u.Lb(4,"ion-item"),u.Lb(5,"ion-label"),u.pc(6,"From"),u.Kb(),u.Lb(7,"ion-input",2,3),u.Xb("ionFocus",function(){return e.onInputFromFocus()}),u.Kb(),u.Kb(),u.Lb(9,"ion-item"),u.Lb(10,"ion-label"),u.pc(11,"To"),u.Kb(),u.Lb(12,"ion-input",2,4),u.Xb("ionFocus",function(){return e.onInputToFocus()}),u.Kb(),u.Kb(),u.Kb(),u.Lb(14,"ion-col",5),u.Xb("click",function(){return e.swapInputs()}),u.Jb(15,"ion-icon",6),u.Jb(16,"ion-ripple-effect"),u.Kb(),u.Kb(),u.Kb(),u.Kb(),u.Lb(17,"ion-content"),u.Lb(18,"ion-list",7),u.oc(19,at,3,0,"ion-item",8),u.oc(20,st,3,1,"ion-item",9),u.Kb(),u.Kb()),2&t&&(u.xb(19),u.ec("ngIf",e.showMyLocation()),u.xb(1),u.ec("ngForOf",e.model.recentSearches))},directives:[n.r,n.I,n.o,n.v,n.x,n.u,n.eb,n.t,n.G,n.p,n.y,r.j,r.i,n.R],styles:[".container[_ngcontent-%COMP%]{position:relative}.container[_ngcontent-%COMP%], .input-container[_ngcontent-%COMP%]{width:100%;height:-webkit-fit-content;height:-moz-fit-content;height:fit-content}.input-container[_ngcontent-%COMP%]{position:absolute;top:0;left:0}.swappicon[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.swappicon[_ngcontent-%COMP%]:hover{cursor:pointer}.ripple-parent[_ngcontent-%COMP%]{position:relative;overflow:hidden}"]}),t})();const ut=["drawerContent"],dt=["searchDrawer"],ht=["locationDrawer"],bt=["routeDrawer"],ft=["inNavigationDrawer"],pt=["changeRouteDrawer"],mt=["routeInput"];function gt(t,e){if(1&t){const t=u.Mb();u.Lb(0,"ion-item",38),u.Xb("click",function(){u.jc(t);const i=e.$implicit;return u.Zb(2).search.emit(i.Name)}),u.Lb(1,"ion-text"),u.pc(2),u.Kb(),u.Kb()}if(2&t){const t=e.$implicit;u.xb(2),u.qc(t.Name)}}function vt(t,e){if(1&t&&(u.Lb(0,"ion-list",10),u.Lb(1,"ion-list-header"),u.Lb(2,"h2"),u.pc(3,"Recent Searches"),u.Kb(),u.Kb(),u.oc(4,gt,3,1,"ion-item",11),u.Kb()),2&t){const t=u.Zb();u.xb(4),u.ec("ngForOf",t.model.recentSearches)}}function wt(t,e){if(1&t){const t=u.Mb();u.Lb(0,"ion-item",38),u.Xb("click",function(){u.jc(t);const i=e.$implicit;return u.Zb().campusClick.emit(i)}),u.Lb(1,"ion-label"),u.Lb(2,"h2"),u.pc(3),u.Kb(),u.Lb(4,"h3"),u.pc(5),u.Kb(),u.Kb(),u.Kb()}if(2&t){const t=e.$implicit;u.xb(3),u.sc("",t.ShortName,": ",t.Name,""),u.xb(2),u.qc(t.Address)}}function yt(t,e){if(1&t&&(u.Lb(0,"ion-row"),u.Lb(1,"ion-col"),u.pc(2),u.Kb(),u.Lb(3,"ion-col"),u.pc(4),u.Kb(),u.Kb()),2&t){const t=e.$implicit;u.xb(2),u.qc(t[0]),u.xb(2),u.qc(t[1])}}function St(t,e){1&t&&u.Jb(0,"ion-progress-bar",39)}function Ct(t,e){if(1&t){const t=u.Mb();u.Lb(0,"ion-button",41),u.Xb("click",function(){return u.jc(t),u.Zb(2).onLaunchNavigationClick()}),u.pc(1," Go "),u.Kb()}}function Lt(t,e){if(1&t&&(u.Lb(0,"ion-row"),u.Lb(1,"ion-col"),u.Lb(2,"ion-label"),u.Lb(3,"h2"),u.pc(4),u.Kb(),u.Kb(),u.Lb(5,"ion-text"),u.pc(6),u.Kb(),u.Kb(),u.Lb(7,"ion-col"),u.oc(8,Ct,2,0,"ion-button",40),u.Kb(),u.Kb()),2&t){const t=u.Zb();u.xb(4),u.rc("",t.model.Route.Time," min"),u.xb(2),u.rc("",t.model.Route.Distance," m"),u.xb(2),u.ec("ngIf",!t.UseDrawerForNavigation())}}function xt(t,e){if(1&t){const t=u.Mb();u.Lb(0,"ion-item",38),u.Xb("click",function(){u.jc(t);const i=e.$implicit;return u.Zb(2).navInstructionClick.emit(i)}),u.Lb(1,"ion-label"),u.pc(2),u.Kb(),u.Lb(3,"ion-text"),u.pc(4),u.Kb(),u.Kb()}if(2&t){const t=e.$implicit;u.xb(2),u.qc(t.Text),u.xb(2),u.rc("",t.Distance,"m")}}function It(t,e){if(1&t&&(u.Lb(0,"ion-list"),u.oc(1,xt,5,2,"ion-item",11),u.Kb()),2&t){const t=u.Zb();u.xb(1),u.ec("ngForOf",t.model.Route.NavigationInstructions)}}var Rt=function(t){return t[t.SearchView=0]="SearchView",t[t.LocationView=1]="LocationView",t[t.RouteView=2]="RouteView",t[t.InNavigationView=3]="InNavigationView",t[t.ChangeRouteView=4]="ChangeRouteView",t}({});let Mt=(()=>{class t{constructor(t,e){this.model=t,this.platform=e,this.state=Rt.SearchView,this.stateChange=new u.o,this.campusClick=new u.o,this.detailsClick=new u.o,this.navInstructionClick=new u.o,this.search=new u.o,this.newRoute=new u.o}ngAfterViewInit(){return Object(s.a)(this,void 0,void 0,function*(){yield Promise.all([this.locationDrawer.SetState(F.a.Hidden),this.routeDrawer.SetState(F.a.Hidden),this.inNavigationDrawer.SetState(F.a.Hidden),this.changeRouteDrawer.SetState(F.a.Hidden,!1)]),yield this.searchDrawer.SetState(P.a.GetRecommendedDrawerStateForDevice())})}ngOnChanges(t){return Object(s.a)(this,void 0,void 0,function*(){t.state&&(yield this.SetState(t.state.currentValue))})}SetState(t,e=!0){return Object(s.a)(this,void 0,void 0,function*(){switch(this.state){case Rt.SearchView:yield this.searchDrawer.SetState(F.a.Hidden);break;case Rt.LocationView:yield this.locationDrawer.SetState(F.a.Hidden);break;case Rt.RouteView:yield this.routeDrawer.SetState(F.a.Hidden);break;case Rt.InNavigationView:yield this.inNavigationDrawer.SetState(F.a.Hidden);break;case Rt.ChangeRouteView:yield this.changeRouteDrawer.SetState(F.a.Hidden,!1)}switch(this.state=t,this.state){case Rt.SearchView:yield this.searchDrawer.SetState(P.a.GetRecommendedDrawerStateForDevice());break;case Rt.LocationView:yield this.locationDrawer.SetState(P.a.GetRecommendedDrawerStateForDevice());break;case Rt.RouteView:yield this.routeDrawer.SetState(P.a.GetRecommendedDrawerStateForDevice());break;case Rt.InNavigationView:yield this.inNavigationDrawer.SetState(P.a.GetRecommendedDrawerStateForDevice());break;case Rt.ChangeRouteView:yield this.changeRouteDrawer.SetState(P.a.GetRecommendedDrawerStateForDevice())}e&&this.stateChange.emit(this.state)})}onRouteClick(){return Object(s.a)(this,void 0,void 0,function*(){yield this.SetState(Rt.RouteView)})}onLaunchNavigationClick(){return Object(s.a)(this,void 0,void 0,function*(){yield this.SetState(Rt.InNavigationView)})}onEndNavigationClick(){return Object(s.a)(this,void 0,void 0,function*(){yield this.SetState(Rt.LocationView)})}onSearchFocus(t){return Object(s.a)(this,void 0,void 0,function*(){this.platform.is("hybrid")&&(yield this.searchDrawer.SetState(F.a.Top))})}emitRoute(t){}onCloseLocationDrawer(){return Object(s.a)(this,void 0,void 0,function*(){yield this.SetState(Rt.SearchView)})}onCloseRouteDrawer(){return Object(s.a)(this,void 0,void 0,function*(){yield this.SetState(Rt.LocationView)})}onChangeRouteStartEndClick(){return Object(s.a)(this,void 0,void 0,function*(){this.routeInput.UpdateFromNavigationModel(),yield this.SetState(Rt.ChangeRouteView),yield this.routeInput.SetFocus()})}onSearchDrawerStateChange(t){void 0!==this.drawerContent&&(this.drawerContent.scrollY=t===F.a.Top)}onChangeRouteDrawerStateChange(t){return Object(s.a)(this,void 0,void 0,function*(){console.log(t),t===F.a.Hidden&&(yield this.SetState(Rt.RouteView))})}onCancelChangeRoute(){return Object(s.a)(this,void 0,void 0,function*(){yield this.SetState(Rt.RouteView,!1)})}UseDrawerForNavigation(){return!(P.a.GetRecommendedDrawerStateForDevice()===F.a.Bottom)}}return t.\u0275fac=function(e){return new(e||t)(u.Ib(E),u.Ib(n.ab))},t.\u0275cmp=u.Cb({type:t,selectors:[["app-nav-drawer-manager"]],viewQuery:function(t,e){if(1&t&&(u.tc(ut,!0),u.tc(dt,!0),u.tc(ht,!0),u.tc(bt,!0),u.tc(ft,!0),u.tc(pt,!0),u.tc(mt,!0)),2&t){let t;u.gc(t=u.Yb())&&(e.drawerContent=t.first),u.gc(t=u.Yb())&&(e.searchDrawer=t.first),u.gc(t=u.Yb())&&(e.locationDrawer=t.first),u.gc(t=u.Yb())&&(e.routeDrawer=t.first),u.gc(t=u.Yb())&&(e.inNavigationDrawer=t.first),u.gc(t=u.Yb())&&(e.changeRouteDrawer=t.first),u.gc(t=u.Yb())&&(e.routeInput=t.first)}},inputs:{state:"state"},outputs:{stateChange:"stateChange",campusClick:"campusClick",detailsClick:"detailsClick",navInstructionClick:"navInstructionClick",search:"search",newRoute:"newRoute"},features:[u.vb],decls:118,vars:14,consts:[["id","searchDrawer",3,"stateChange"],["searchDrawer",""],[1,"nav-bottom-drawer"],[1,"drawer-grip"],[1,"ion-padding-top"],[1,"nav-hbar"],[3,"discovery","route","searchBarFocus"],["searchInput",""],["drawerContent",""],["class","ion-no-padding",4,"ngIf"],[1,"ion-no-padding"],["button","",3,"click",4,"ngFor","ngForOf"],[1,"ion-padding-vertical"],["id","locationDrawer","state","DrawerState.Hidden"],["locationDrawer",""],[1,"ion-padding-bottom"],["id","locationdrawerContent"],[1,"ion-justify-content-between","ion-align-self-center"],[1,"ion-justify-content-end","ion-padding-horizontal"],["shape","round","color","medium",1,"square-sm","ion-no-padding","ion-float-right",3,"click"],["slot","icon-only","name","close-outline","size","small"],["color","primary","expand","block",3,"click"],["id","routeBtn","color","primary","expand","block",3,"click"],[4,"ngFor","ngForOf"],["id","routeDrawer","state","DrawerState.Hidden"],["routeDrawer",""],["type","indeterminate",4,"ngIf"],[1,"span-button",3,"click"],[4,"ngIf"],["id","inNavigationDrawer","state","DrawerState.Hidden"],["inNavigationDrawer",""],["color","danger","expand","block",3,"click"],["id","changeRouteDrawer","state","DrawerState.Hidden",3,"shouldDockBottom","shouldDockMiddle","stateChange"],["changeRouteDrawer",""],[1,"ion-align-items-baseline"],[1,"ion-text-center"],["size","6",1,"ion-text-center"],["routeInput",""],["button","",3,"click"],["type","indeterminate"],["color","success","expand","block",3,"click",4,"ngIf"],["color","success","expand","block",3,"click"]],template:function(t,e){if(1&t){const t=u.Mb();u.Lb(0,"app-ionic-bottom-drawer",0,1),u.Xb("stateChange",function(t){return e.onSearchDrawerStateChange(t)}),u.Lb(2,"div",2),u.Lb(3,"div",3),u.Jb(4,"div",4),u.Jb(5,"div",5),u.Lb(6,"app-search-input",6,7),u.Xb("discovery",function(t){return e.search.emit(t)})("route",function(t){return e.emitRoute(t)})("searchBarFocus",function(t){return e.onSearchFocus(t)}),u.Kb(),u.Kb(),u.Lb(8,"ion-content",null,8),u.oc(10,vt,5,1,"ion-list",9),u.Lb(11,"ion-list",10),u.Lb(12,"ion-list-header"),u.Lb(13,"h2"),u.pc(14,"Choose a Campus"),u.Kb(),u.Kb(),u.oc(15,wt,6,3,"ion-item",11),u.Kb(),u.Jb(16,"div",12),u.Jb(17,"div",12),u.Jb(18,"div",12),u.Jb(19,"div",12),u.Jb(20,"div",12),u.Jb(21,"div",12),u.Kb(),u.Kb(),u.Kb(),u.Lb(22,"app-ionic-bottom-drawer",13,14),u.Lb(24,"div",2),u.Lb(25,"div",3),u.Jb(26,"div",4),u.Jb(27,"div",5),u.Jb(28,"div",15),u.Kb(),u.Lb(29,"ion-content"),u.Lb(30,"ion-grid",16),u.Lb(31,"ion-row",17),u.Lb(32,"ion-col"),u.Lb(33,"ion-label"),u.Lb(34,"h1"),u.pc(35),u.Kb(),u.Kb(),u.Lb(36,"ion-text"),u.pc(37),u.Kb(),u.Kb(),u.Lb(38,"ion-col",18),u.Lb(39,"ion-button",19),u.Xb("click",function(){return e.onCloseLocationDrawer()}),u.Jb(40,"ion-icon",20),u.Kb(),u.Kb(),u.Kb(),u.Lb(41,"ion-row"),u.Lb(42,"ion-col"),u.Lb(43,"ion-button",21),u.Xb("click",function(){return e.detailsClick.emit()}),u.pc(44," Details "),u.Kb(),u.Kb(),u.Lb(45,"ion-col"),u.Lb(46,"ion-button",22),u.Xb("click",function(){return e.onRouteClick()}),u.pc(47," Route "),u.Kb(),u.Kb(),u.Kb(),u.oc(48,yt,5,2,"ion-row",23),u.Kb(),u.Kb(),u.Kb(),u.Kb(),u.Lb(49,"app-ionic-bottom-drawer",24,25),u.Lb(51,"div",2),u.Lb(52,"div",3),u.Jb(53,"div",4),u.Jb(54,"div",5),u.Jb(55,"div",15),u.oc(56,St,1,0,"ion-progress-bar",26),u.Lb(57,"ion-grid"),u.Lb(58,"ion-row",17),u.Lb(59,"ion-col"),u.Lb(60,"ion-label"),u.Lb(61,"h1"),u.pc(62),u.Kb(),u.Kb(),u.Lb(63,"ion-text"),u.pc(64,"From "),u.Lb(65,"span",27),u.Xb("click",function(){return e.onChangeRouteStartEndClick()}),u.pc(66),u.Kb(),u.Kb(),u.Kb(),u.Lb(67,"ion-col",18),u.Lb(68,"ion-button",19),u.Xb("click",function(){return e.onCloseRouteDrawer()}),u.Jb(69,"ion-icon",20),u.Kb(),u.Kb(),u.Kb(),u.oc(70,Lt,9,3,"ion-row",28),u.Kb(),u.Kb(),u.Lb(71,"ion-content"),u.oc(72,It,2,1,"ion-list",28),u.Jb(73,"div",12),u.Jb(74,"div",12),u.Jb(75,"div",12),u.Jb(76,"div",12),u.Jb(77,"div",12),u.Jb(78,"div",12),u.Jb(79,"div",12),u.Jb(80,"div",12),u.Kb(),u.Kb(),u.Kb(),u.Lb(81,"app-ionic-bottom-drawer",29,30),u.Lb(83,"div",2),u.Lb(84,"div",3),u.Jb(85,"div",4),u.Jb(86,"div",5),u.Jb(87,"div",15),u.Lb(88,"ion-grid"),u.Lb(89,"ion-row"),u.Lb(90,"ion-col"),u.Lb(91,"ion-label"),u.Lb(92,"h2"),u.pc(93),u.Kb(),u.Kb(),u.Lb(94,"ion-text"),u.pc(95),u.Kb(),u.Kb(),u.Lb(96,"ion-col"),u.Lb(97,"ion-button",31),u.Xb("click",function(){return e.onEndNavigationClick()}),u.pc(98," End Route "),u.Kb(),u.Kb(),u.Kb(),u.Kb(),u.Kb(),u.Kb(),u.Kb(),u.Lb(99,"app-ionic-bottom-drawer",32,33),u.Xb("stateChange",function(t){return e.onChangeRouteDrawerStateChange(t)}),u.Lb(101,"div",2),u.Lb(102,"div",3),u.Jb(103,"div",4),u.Jb(104,"div",5),u.Lb(105,"ion-grid"),u.Lb(106,"ion-row",34),u.Lb(107,"ion-col",35),u.Lb(108,"span",27),u.Xb("click",function(){return e.onCancelChangeRoute()}),u.pc(109,"Cancel"),u.Kb(),u.Kb(),u.Lb(110,"ion-col",36),u.Lb(111,"h3"),u.pc(112,"Change Route"),u.Kb(),u.Kb(),u.Lb(113,"ion-col",35),u.Lb(114,"span",27),u.Xb("click",function(){u.jc(t);const i=u.hc(117);return e.newRoute.emit([i.From,i.To])}),u.pc(115,"Route"),u.Kb(),u.Kb(),u.Kb(),u.Kb(),u.Kb(),u.Jb(116,"app-route-input",null,37),u.Kb(),u.Kb()}2&t&&(u.xb(10),u.ec("ngIf",e.model.recentSearches.length>0),u.xb(5),u.ec("ngForOf",e.model.availableCampus),u.xb(20),u.qc(e.model.latestSearchResult.Name),u.xb(2),u.qc(e.model.latestSearchResult.Description),u.xb(11),u.ec("ngForOf",e.model.latestSearchResult.Information),u.xb(8),u.ec("ngIf",0===e.model.Route.Distance),u.xb(6),u.rc("To ",e.model.Route.Destination.Name,""),u.xb(4),u.qc(e.model.Route.Start.Name),u.xb(4),u.ec("ngIf",0!==e.model.Route.Distance),u.xb(2),u.ec("ngIf",0!==e.model.Route.Distance),u.xb(21),u.rc("",e.model.Route.Time," min"),u.xb(2),u.rc("",e.model.Route.Distance," m"),u.xb(4),u.ec("shouldDockBottom",!1)("shouldDockMiddle",!1))},directives:[P.a,N,n.p,r.j,n.y,n.z,r.i,n.r,n.I,n.o,n.x,n.R,n.h,n.t,lt,n.v,n.B],styles:[".vertical-line[_ngcontent-%COMP%]{border-left:2px solid #9d9fa6;height:38px}.span-button[_ngcontent-%COMP%]{color:var(--ion-color-primary,#3880ff)}.span-button[_ngcontent-%COMP%]:hover{cursor:pointer}.nav-hbar[_ngcontent-%COMP%]{border-top:2px solid var(--ion-color-medium,#9d9fa6);border-bottom:2px solid var(--ion-color-medium,#9d9fa6);border-radius:2px;height:0;width:auto;margin:0 45%}.nav-bottom-drawer[_ngcontent-%COMP%]{background-color:var(--ion-item-background,#fff);border-top-left-radius:20px;border-top-right-radius:20px;box-shadow:0 4px 8px 0 rgba(0,0,0,.4),0 6px 20px 0 rgba(0,0,0,.29);height:inherit}.square-md[_ngcontent-%COMP%]{height:64px;width:64px}.square-sm[_ngcontent-%COMP%]{height:32px;width:32px}.square-xs[_ngcontent-%COMP%]{height:16px;width:16px}#locationdrawerContent[_ngcontent-%COMP%]{margin-left:30px;margin-right:30px;position:center}#locationdrawerName[_ngcontent-%COMP%]{font-weight:700}#inNavigationDrawer[_ngcontent-%COMP%]{z-index:1}#locationDrawer[_ngcontent-%COMP%]{z-index:2}#routeDrawer[_ngcontent-%COMP%]{z-index:3}#searchDrawer[_ngcontent-%COMP%]{z-index:4}"]}),t})();const kt=["searchInput"],Ot=["navSlides"],Nt=["drawerManager"];function Ft(t,e){1&t&&u.Jb(0,"ion-progress-bar",9)}function Pt(t,e){if(1&t&&(u.Lb(0,"ion-text",10),u.Lb(1,"h5"),u.Lb(2,"span",11),u.pc(3),u.Kb(),u.Kb(),u.Lb(4,"p"),u.Pb(5,12),u.Kb(),u.Lb(6,"p"),u.Sb(7,13),u.Jb(8,"br"),u.Jb(9,"a",14),u.Qb(),u.Kb(),u.Kb()),2&t){const t=u.Zb();u.xb(3),u.qc(t.errorMessage)}}const{Keyboard:Dt}=B.a,_t=H.icon({iconRetinaUrl:"leaflet/marker-icon-2x.png",iconUrl:"leaflet/marker-icon.png",shadowUrl:"leaflet/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]});H.Marker.prototype.options.icon=_t;let Kt=(()=>{class t{constructor(t,e,i,n,o,r,a,s){this.dataService=t,this.router=e,this.model=i,this.storage=n,this.geolocation=o,this.openStreetMapService=r,this.lastOpenStreetMapCenterPersistence=a,this.platform=s,this.searchMarker=[],this.routes=[],this.progressIsVisible=!1,this.currentPositionMarker=null,this.isInitialized=!1,this.DEFAULT_ZOOM=17,this.MAX_ZOOM=18,this.MIN_ZOOM=14,this.isHybridPlatform=this.platform.is("hybrid")}static convertToLeafLetCoordinates(t){const e=[];for(const i of t)e.push({lat:i.Latitude,lng:i.Longitude});return e}ngOnInit(){return Object(s.a)(this,void 0,void 0,function*(){if(!this.model.availableCampus||0===this.model.availableCampus.length){const t=yield this.dataService.get_campus_search().toPromise();for(const e of t)this.model.availableCampus.push(new D(e))}})}ionViewDidEnter(){return Object(s.a)(this,void 0,void 0,function*(){this.isInitialized||(yield this.initializeMap(this.router),this.isInitialized=!0);try{const t=yield this.geolocation.getCurrentPosition();null===this.currentPositionMarker?this.currentPositionMarker=H.marker([t.coords.latitude,t.coords.longitude]).addTo(this.map).bindPopup("Position"):this.currentPositionMarker.setLatLng([t.coords.latitude,t.coords.longitude])}catch(t){console.log("Error getting location",t)}})}initializeMap(e){var i;return Object(s.a)(this,void 0,void 0,function*(){const n=yield this.openStreetMapService.GetBounds(),o=H.latLng(n.SouthWest.Lat,n.SouthWest.Lng),r=H.latLng(n.NorthEast.Lat,n.NorthEast.Lng),a=H.latLngBounds(o,r);console.log(n,a),this.map=H.map("leafletMap",{maxBounds:a,maxZoom:this.MAX_ZOOM,minZoom:this.MIN_ZOOM,zoomControl:!this.platform.is("hybrid")}),this.map.on("moveend",t=>{nt.persist(this.storage,{center:t.target.getCenter(),zoom:t.target.getZoom()})}),yield this.lastOpenStreetMapCenterPersistence.load(this.storage,this.map,this.DEFAULT_ZOOM),H.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"edupala.com \xa9 Angular LeafLet"}).addTo(this.map),this.platform.is("hybrid")&&(yield this.delay(500),this.map.invalidateSize());const s=yield this.dataService.get_buildings_search().toPromise();function c(t){e.navigate(["tabs/navigation/detail"],{queryParams:{building:t.target.options.className}}).then(()=>console.log(t.latlng,t.target.options.className))}if(null!==s)for(const e of s)null!==e.Body&&e.Body.length>0&&H.polygon(t.convertToLeafLetCoordinates(e.Body),{className:e.Name,color:null!==(i=e.Color)&&void 0!==i?i:"#0083C6"}).addTo(this.map).on("click",c)})}ngOnDestroy(){this.map.remove()}onSearch(t){return Object(s.a)(this,void 0,void 0,function*(){this.model.errorMessage="",this.progressIsVisible=!0;try{this.clearSearchMarkers();try{const e=yield this.dataService.get_location(t).toPromise();if(e){const t=yield this.dataService.get_building(e.Building).toPromise(),i=this.getCenterCoordinateFromBody(t.Body);return yield this.model.addRecentSearchLocation(e,{lat:i.Latitude,lng:i.Longitude}),this.searchMarker.push(this.showMarker(i.Latitude,i.Longitude,"Room "+e.Name,!0)),this.map.flyTo(this.model.latestSearchResult.LatLng,this.DEFAULT_ZOOM),void(yield this.showElementDrawer())}}catch(e){console.log(e)}try{const e=yield this.dataService.get_building(t,!1).toPromise();if(e){const t=this.getCenterCoordinateFromBody(e.Body);return yield this.model.addRecentSearchBuilding(e,{lat:t.Latitude,lng:t.Longitude}),this.map.flyTo(this.model.latestSearchResult.LatLng,this.DEFAULT_ZOOM),this.searchMarker.push(this.showMarker(t.Latitude,t.Longitude,"Building "+e.Name,!0)),void(yield this.showElementDrawer())}}catch(e){console.log(e)}try{const e=yield this.dataService.get_campus(t,!1).toPromise();if(e)return yield this.model.addRecentSearchCampus(e),this.searchMarker.push(this.showMarker(e.Latitude,e.Longitude,"Campus "+e.Name,!0)),this.map.flyTo([e.Latitude,e.Longitude],this.DEFAULT_ZOOM),void(yield this.showElementDrawer())}catch(e){console.log(e)}const i=yield this.dataService.get_buildings_search(t).toPromise();if(null!==i&&i.length>0)for(const t of i){const e=this.getCenterCoordinateFromBody(t.Body);this.searchMarker.push(this.showMarker(e.Latitude,e.Longitude,t.Name,!1))}else{const e=yield this.dataService.get_campus_search(t).toPromise();if(null!==e&&e.length>0)for(const t of e)this.searchMarker.push(this.showMarker(t.Latitude,t.Longitude,t.Name,!1))}}catch(i){this.handleInputError(i,t)}finally{this.progressIsVisible=!1}})}onRoute(t){return Object(s.a)(this,void 0,void 0,function*(){console.log(t),this.clearRoutes(),yield this.drawerManager.SetState(Rt.RouteView,!1);const e=yield this.openStreetMapService.GetRoute(t[0].LatLng,t[1].LatLng);this.model.SetOsmRouteAsRoute(e[0],t[0],t[1]);const i=H.polyline(this.model.Route.Coordinates,{color:"red"}).addTo(this.map);this.map.flyTo(i.getCenter(),this.DEFAULT_ZOOM),yield this.map.fitBounds(i.getBounds()),this.routes.push(i)})}onCloseLocationDrawer(t){return Object(s.a)(this,void 0,void 0,function*(){this.searchInput.clearDestinationInput(),yield this.drawerManager.SetState(Rt.SearchView),this.clearSearchMarkers()})}onCloseRouteDrawer(t){return Object(s.a)(this,void 0,void 0,function*(){this.clearRoutes(),yield this.drawerManager.SetState(Rt.LocationView),this.map.flyTo(this.model.latestSearchResult.LatLng,this.DEFAULT_ZOOM)})}showElementDrawer(){return Object(s.a)(this,void 0,void 0,function*(){this.isHybridPlatform&&(yield Dt.hide()),yield this.drawerManager.SetState(Rt.LocationView)})}onCampusClick(t){this.map.flyTo(t.LatLng,this.DEFAULT_ZOOM)}onDrawerManagerStateChange(t){return Object(s.a)(this,void 0,void 0,function*(){switch(console.log(t),t){case Rt.SearchView:this.clearSearchMarkers();break;case Rt.LocationView:this.clearRoutes(),this.map.flyTo(this.model.latestSearchResult.LatLng,this.DEFAULT_ZOOM);break;case Rt.RouteView:yield this.onRouteBtnClick();break;case Rt.InNavigationView:yield this.onLaunchNavigation()}})}onDetailsClick(){return Object(s.a)(this,void 0,void 0,function*(){yield this.router.navigate(["tabs/navigation/detail"],{queryParams:0===this.routes.length?this.model.latestSearchResult.DetailRouterParams:this.model.latestSearchResult.RouteRouterParams})})}onRouteBtnClick(){return Object(s.a)(this,void 0,void 0,function*(){const e=yield this.geolocation.getCurrentPosition(),i={lat:e.coords.latitude,lng:e.coords.longitude},n=yield this.openStreetMapService.GetRoute(i,this.model.latestSearchResult.LatLng);this.model.SetOsmRouteAsRoute(n[0],{Name:t.MyLocation,LatLng:i},this.model.latestSearchResult);const o=H.polyline(this.model.Route.Coordinates,{color:"red"}).addTo(this.map);this.map.flyTo(o.getCenter(),this.DEFAULT_ZOOM),yield this.map.fitBounds(o.getBounds()),this.routes.push(o)})}onLaunchNavigation(){return Object(s.a)(this,void 0,void 0,function*(){this.navSlides.instructions=this.model.Route.NavigationInstructions,yield this.navSlides.show(),this.map.flyTo(this.model.Route.Coordinates[this.model.Route.NavigationInstructions[0].Interval[0]],this.MAX_ZOOM)})}onSlideChange(t){this.onNavigationInstructionClick(this.model.Route.NavigationInstructions[t])}onNavigationInstructionClick(t){this.map.flyTo(this.model.Route.Coordinates[t.Interval[0]],this.MAX_ZOOM)}handleInputError(t,e){if(t instanceof L.d){const i=t;this.errorMessage=400===i.status?"Studi-Guide can't find "+e:i.message}else this.errorMessage=t.message}showMarker(t,e,i="",n){const o=H.marker([t,e]).addTo(this.map);return i?n?o.bindPopup(i).openPopup():o.bindPopup(i):o}getCenterCoordinateFromBody(t){const e=[];for(const o of t)e.push([o.Latitude,o.Longitude]);const i=new H.Polygon(e).addTo(this.map),n={Longitude:i.getCenter().lng,Latitude:i.getCenter().lat};return i.remove(),n}clearSearchMarkers(){for(const t of this.searchMarker)this.map.removeLayer(t)}clearRoutes(){for(const t of this.routes)t.remove();this.routes=[],this.model.ClearRoute(),this.navSlides.hide()}delay(t){return new Promise(e=>setTimeout(e,t))}}return t.MyLocation="My Location",t.\u0275fac=function(e){return new(e||t)(u.Ib(c.a),u.Ib(o.g),u.Ib(E),u.Ib(K.b),u.Ib(W.a),u.Ib(Q),u.Ib(nt),u.Ib(n.ab))},t.\u0275cmp=u.Cb({type:t,selectors:[["app-map-page"]],viewQuery:function(t,e){if(1&t&&(u.tc(kt,!0),u.tc(Ot,!0),u.tc(Nt,!0)),2&t){let t;u.gc(t=u.Yb())&&(e.searchInput=t.first),u.gc(t=u.Yb())&&(e.navSlides=t.first),u.gc(t=u.Yb())&&(e.drawerManager=t.first)}},decls:9,vars:2,consts:function(){let t,e;return t="Make sure your search is spelled correctly.",e="Should this place be on Studi-Guide? " + "\ufffd#8\ufffd\ufffd/#8\ufffd" + "" + "\ufffd#9\ufffd" + "Request a missing place" + "\ufffd/#9\ufffd" + "",[[3,"nextSlide","previousSlide"],["navSlides",""],[3,"campusClick","navInstructionClick","search","detailsClick","stateChange","newRoute"],["drawerManager",""],["data-tap-disabled","true","scroll-y","false"],["type","indeterminate","color","secondary",4,"ngIf"],["id","map-content"],["id","error-message",4,"ngIf"],["id","leafletMap"],["type","indeterminate","color","secondary"],["id","error-message"],[1,"error"],t,e,["href","https://github.com/Studi-Guide/Studi-Guide/issues/new/choose"]]},template:function(t,e){1&t&&(u.Lb(0,"app-navigation-instruction-slides",0,1),u.Xb("nextSlide",function(t){return e.onSlideChange(t)})("previousSlide",function(t){return e.onSlideChange(t)}),u.Kb(),u.Lb(2,"app-nav-drawer-manager",2,3),u.Xb("campusClick",function(t){return e.onCampusClick(t)})("navInstructionClick",function(t){return e.onNavigationInstructionClick(t)})("search",function(t){return e.onSearch(t)})("detailsClick",function(){return e.onDetailsClick()})("stateChange",function(t){return e.onDrawerManagerStateChange(t)})("newRoute",function(t){return e.onRoute(t)}),u.Kb(),u.Lb(4,"ion-content",4),u.oc(5,Ft,1,0,"ion-progress-bar",5),u.Lb(6,"div",6),u.oc(7,Pt,10,1,"ion-text",7),u.Jb(8,"div",8),u.Kb(),u.Kb()),2&t&&(u.xb(5),u.ec("ngIf",e.progressIsVisible),u.xb(2),u.ec("ngIf",e.errorMessage))},directives:[it,Mt,n.p,r.j,n.B,n.R],styles:["#map-content[_ngcontent-%COMP%]{height:100%;width:100%;position:fixed}.error[_ngcontent-%COMP%]{color:red}#error-message[_ngcontent-%COMP%]{margin-left:20px}#leafletMap[_ngcontent-%COMP%]{height:100%;width:100%;z-index:0}#leafletMap[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}#available-floors-btn[_ngcontent-%COMP%]{position:fixed;bottom:0;display:block;z-index:10}.draggable[_ngcontent-%COMP%]{cursor:-webkit-grab;cursor:grab}.draggable[_ngcontent-%COMP%]:active{cursor:-webkit-grabbing;cursor:grabbing}.center[_ngcontent-%COMP%]{margin-left:auto;margin-right:auto;display:block}ion-progress-bar[_ngcontent-%COMP%]{position:absolute;z-index:9999}"]}),t})(),Tt=(()=>{class t{}return t.\u0275mod=u.Gb({type:t}),t.\u0275inj=u.Fb({factory:function(e){return new(e||t)},imports:[[n.V,r.b,a.a,o.i.forChild([{path:"detail",component:q},{path:"",component:Kt}]),U]]}),t})();u.mc(q,[n.s,n.U,n.i,n.f,n.g,n.p,r.j,n.B,n.R,C,P.a,N,n.y,n.z,r.i,n.v,n.r,n.I,n.o,n.h,n.t],[])},wyfB:function(t,e){function i(t){return t&&t.ownerSVGElement&&t.getCTM}t.exports=function(t,e){if(!i(t))throw new Error("svg element is required for svg.panzoom to work");var n=t.ownerSVGElement;if(!n)throw new Error("Do not apply panzoom to the root <svg> element. Use its child instead (e.g. <g></g>). As of March 2016 only FireFox supported transform on the root element");return e.disableKeyboardInteraction||n.setAttribute("tabindex",0),{getBBox:function(){var e=t.getBBox();return{left:e.x,top:e.y,width:e.width,height:e.height}},getScreenCTM:function(){return n.getCTM()||n.getScreenCTM()},getOwner:function(){return n},applyTransform:function(e){t.setAttribute("transform","matrix("+e.scale+" 0 0 "+e.scale+" "+e.x+" "+e.y+")")},initTransform:function(e){var i=t.getCTM();null===i&&(i=document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix()),e.x=i.e,e.y=i.f,e.scale=i.a,n.removeAttributeNS(null,"viewBox")}}},t.exports.canAttach=i}}]);